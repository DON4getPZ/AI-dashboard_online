<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AARRR í¼ë„ ëŒ€ì‹œë³´ë“œ - GA4 ë¶„ì„</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <!-- D3.js -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <!-- Embed Mode Detection -->
    <script>
        (function() {
            if (new URLSearchParams(window.location.search).get('embed') === 'true') {
                document.documentElement.classList.add('embed-mode');
            }
        })();
    </script>
    <style>
        /* Embed Mode Styles - ì‚¬ì´ë“œë°” ìˆ¨ê¹€ */
        html.embed-mode .sidebar { display: none !important; }
        html.embed-mode .main-content { margin-left: 0 !important; }
        html.embed-mode .mobile-menu-btn { display: none !important; }
        html.embed-mode .sidebar-overlay { display: none !important; }
        :root {
            /* Berry Theme Colors */
            --primary-main: #673ab7;
            --primary-light: #ede7f6;
            --primary-dark: #5e35b1;
            --secondary-main: #2196f3;
            --secondary-light: #e3f2fd;
            --success-main: #00c853;
            --success-light: #b9f6ca;
            --warning-main: #ffab00;
            --warning-light: #fff8e1;
            --error-main: #ff1744;
            --error-light: #ffeaea;
            --grey-50: #fafafa;
            --grey-100: #f5f5f5;
            --grey-200: #eeeeee;
            --grey-300: #e0e0e0;
            --grey-500: #9e9e9e;
            --grey-600: #757575;
            --grey-700: #616161;
            --grey-900: #212121;
            --paper: #ffffff;
            --background: #f8fafc;
            --sidebar-bg: #ffffff;
            --sidebar-width: 260px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Roboto', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--background);
            color: var(--grey-900);
            line-height: 1.5;
        }

        /* ë ˆì´ì•„ì›ƒ êµ¬ì¡° */
        .app-wrapper {
            display: flex;
            min-height: 100vh;
        }

        /* ì‚¬ì´ë“œë°” */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--sidebar-bg);
            border-right: 1px solid var(--grey-200);
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
        }

        .sidebar-header {
            padding: 24px 20px;
            border-bottom: 1px solid var(--grey-200);
        }

        .sidebar-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
        }

        .sidebar-logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary-main) 0%, var(--primary-dark) 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sidebar-logo-icon svg {
            width: 24px;
            height: 24px;
            fill: white;
        }

        .sidebar-logo-text {
            font-size: 18px;
            font-weight: 700;
            color: var(--grey-900);
        }

        .sidebar-logo-subtitle {
            font-size: 11px;
            color: var(--grey-500);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .simplebar-content-wrapper {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .simplebar-content-wrapper::-webkit-scrollbar {
            width: 6px;
        }

        .simplebar-content-wrapper::-webkit-scrollbar-track {
            background: transparent;
        }

        .simplebar-content-wrapper::-webkit-scrollbar-thumb {
            background: var(--grey-300);
            border-radius: 3px;
        }

        .sidebar-content {
            padding: 16px 12px;
        }

        .nav-group {
            margin-bottom: 16px;
        }

        .nav-group-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--grey-500);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 8px 16px;
            margin-bottom: 4px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            color: var(--grey-700);
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .nav-item:hover {
            background: var(--grey-100);
            color: var(--primary-main);
        }

        .nav-item.active {
            background: var(--primary-light);
            color: var(--primary-main);
        }

        .nav-item-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nav-item-icon svg {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }

        .nav-item-text {
            flex: 1;
        }

        /* ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 24px;
            min-height: 100vh;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        /* í—¤ë” */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
        }

        h1 {
            font-size: 24px;
            font-weight: 700;
            color: var(--grey-900);
            margin: 0;
        }

        .header-subtitle {
            font-size: 14px;
            color: var(--grey-500);
            margin-top: 4px;
        }

        /* ì¹´ë“œ ê³µí†µ ìŠ¤íƒ€ì¼ */
        .card {
            background: var(--paper);
            border-radius: 12px;
            box-shadow: 0 2px 14px 0 rgba(32, 40, 45, 0.08);
            transition: box-shadow 0.3s ease;
            position: relative;
            z-index: 1;
            overflow: visible;
        }

        .card:hover {
            box-shadow: 0 4px 20px 0 rgba(32, 40, 45, 0.12);
        }

        /* KPI ìš”ì•½ ì„¹ì…˜ - ì—…ê·¸ë ˆì´ë“œ ë””ìì¸ */
        .kpi-summary-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .kpi-summary-card {
            background: var(--paper);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            position: relative;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .kpi-summary-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.1);
        }

        .kpi-summary-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
        }

        .kpi-summary-card:nth-child(1)::before { background: #d6beff; }
        .kpi-summary-card:nth-child(2)::before { background: #be9ff2; }
        .kpi-summary-card:nth-child(3)::before { background: #ab87ea; }
        .kpi-summary-card:nth-child(4)::before { background: #8c63d3; }
        .kpi-summary-card:nth-child(5)::before { background: #673ab7; }

        .kpi-summary-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--grey-600);
            margin-bottom: 12px;
        }

        .kpi-summary-value {
            font-size: 26px;
            font-weight: 700;
            color: var(--grey-900);
            margin-bottom: 8px;
        }

        .kpi-summary-unit {
            font-size: 13px;
            color: var(--grey-500);
        }

        .kpi-summary-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 11px;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 12px;
            margin-top: 8px;
        }

        .kpi-summary-badge.positive {
            background: var(--success-light);
            color: var(--success-main);
        }

        .kpi-summary-badge.negative {
            background: var(--error-light);
            color: var(--error-main);
        }

        /* ì°¨íŠ¸ ì„¹ì…˜ */
        .chart-section {
            margin-bottom: 24px;
            padding: 24px;
            overflow: visible;
        }

        .chart-header {
            font-size: 16px;
            font-weight: 600;
            color: var(--grey-900);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chart-header::before {
            content: '';
            width: 4px;
            height: 20px;
            background: var(--secondary-main);
            border-radius: 2px;
        }

        .chart-container {
            position: relative;
            height: 400px;
            overflow: visible;
        }

        .chart-container-small {
            position: relative;
            height: 300px;
            overflow: visible;
        }

        /* ë·° íƒ€ì… ë²„íŠ¼ */
        .view-type-section {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
        }

        .view-btn {
            padding: 10px 24px;
            border: none;
            background: var(--paper);
            color: var(--grey-700);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.2s ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        }

        .view-btn:hover {
            background: var(--primary-light);
            color: var(--primary-main);
        }

        .view-btn.active {
            background: var(--primary-main);
            color: white;
            box-shadow: 0 4px 12px rgba(103, 58, 183, 0.4);
        }

        /* íƒ­ ì»¨í…ì¸  ìŠ¤íƒ€ì¼ */
        .decision-tool-tab-content,
        .channel-analysis-tab-content,
        .customer-analysis-tab-content {
            display: none;
        }

        .decision-tool-tab-content.active,
        .channel-analysis-tab-content.active,
        .customer-analysis-tab-content.active {
            display: block;
        }

        /* ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ */
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 24px;
            margin-bottom: 24px;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
            margin-bottom: 24px;
        }

        /* ì¸ì‚¬ì´íŠ¸ ì„¹ì…˜ */
        .insight-section {
            padding: 24px;
            margin-bottom: 24px;
        }

        .insight-header {
            font-size: 16px;
            font-weight: 600;
            color: var(--grey-900);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .insight-header::before {
            content: '';
            width: 4px;
            height: 20px;
            background: var(--warning-main);
            border-radius: 2px;
        }

        .insight-content {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }

        .insight-card {
            padding: 18px 20px;
            background: var(--grey-50);
            border-radius: 12px;
            border-left: 4px solid var(--primary-main);
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
        }

        .insight-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .insight-card.positive {
            background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%);
            border-left-color: var(--success-main);
        }

        .insight-card.negative {
            background: linear-gradient(135deg, #ffebee 0%, #fce4ec 100%);
            border-left-color: var(--error-main);
        }

        .insight-card.neutral {
            background: linear-gradient(135deg, #fff8e1 0%, #fff3e0 100%);
            border-left-color: var(--warning-main);
        }

        .insight-card.opportunity {
            background: linear-gradient(135deg, #e3f2fd 0%, #e1f5fe 100%);
            border-left-color: var(--secondary-main);
        }

        /* ì¸ì‚¬ì´íŠ¸ ì¹´ë“œ í—¤ë” */
        .insight-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .insight-icon-box {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .insight-card.positive .insight-icon-box {
            background: rgba(0, 200, 83, 0.15);
        }

        .insight-card.negative .insight-icon-box {
            background: rgba(255, 23, 68, 0.15);
        }

        .insight-card.neutral .insight-icon-box {
            background: rgba(255, 171, 0, 0.15);
        }

        .insight-card.opportunity .insight-icon-box {
            background: rgba(33, 150, 243, 0.15);
        }

        .insight-label {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .insight-card.positive .insight-label { color: #2e7d32; }
        .insight-card.negative .insight-label { color: #c62828; }
        .insight-card.neutral .insight-label { color: #e65100; }
        .insight-card.opportunity .insight-label { color: #1565c0; }

        .insight-urgency {
            margin-left: auto;
            font-size: 10px;
            padding: 3px 8px;
            color: white;
            border-radius: 10px;
            font-weight: 600;
        }

        /* ì¸ì‚¬ì´íŠ¸ ì¹´ë“œ ë³¸ë¬¸ */
        .insight-message {
            font-size: 14px;
            font-weight: 500;
            color: var(--grey-900);
            line-height: 1.6;
            margin-bottom: 12px;
            flex: 1;
        }

        /* ì¸ì‚¬ì´íŠ¸ ì¹´ë“œ ìƒì„¸ì •ë³´ */
        .insight-detail-box {
            background: rgba(255,255,255,0.7);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
        }

        .insight-detail-title {
            font-size: 11px;
            font-weight: 600;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .insight-detail-item {
            font-size: 12px;
            color: #333;
            line-height: 1.6;
            padding-left: 12px;
            position: relative;
        }

        .insight-detail-item::before {
            content: 'â†’';
            position: absolute;
            left: 0;
            color: var(--grey-500);
        }

        /* ì¸ì‚¬ì´íŠ¸ ì¹´ë“œ ì•¡ì…˜ */
        .insight-action-box {
            background: rgba(255,255,255,0.7);
            border-radius: 8px;
            padding: 12px;
            border-left: 3px solid #ab47bc;
        }

        .insight-action-header {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 6px;
        }

        .insight-action-title {
            font-size: 11px;
            font-weight: 600;
            color: #7b1fa2;
        }

        .insight-action-badge {
            font-size: 9px;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
        }

        .insight-action-badge.scale_up,
        .insight-action-badge.opportunity {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .insight-action-badge.primary {
            background: #fff3e0;
            color: #e65100;
        }

        .insight-action-badge.maintain {
            background: #e3f2fd;
            color: #1565c0;
        }

        .insight-action-text {
            font-size: 12px;
            color: #333;
            line-height: 1.5;
        }

        .insight-action-secondary {
            font-size: 11px;
            color: #5e35b1;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px dashed #d1c4e9;
            line-height: 1.4;
        }

        .insight-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--grey-900);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .insight-title svg {
            width: 18px;
            height: 18px;
        }

        .insight-text {
            font-size: 13px;
            color: var(--grey-700);
            line-height: 1.6;
        }

        /* ë°ì´í„° í…Œì´ë¸” */
        .table-section {
            overflow: visible;
            position: relative;
        }

        .table-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--grey-200);
            font-size: 16px;
            font-weight: 600;
            color: var(--grey-900);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .table-header::before {
            content: '';
            width: 4px;
            height: 20px;
            background: var(--success-main);
            border-radius: 2px;
        }

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            position: relative;
            z-index: 50;
        }

        th, td {
            padding: 14px 16px;
            text-align: right;
            font-size: 14px;
        }

        th {
            background: var(--grey-50);
            font-weight: 600;
            color: var(--grey-700);
            border-bottom: 2px solid var(--grey-200);
            white-space: nowrap;
            overflow: visible;
            position: relative;
        }

        td {
            border-bottom: 1px solid var(--grey-100);
            color: var(--grey-900);
        }

        th:first-child,
        td:first-child {
            text-align: left;
            position: sticky;
            left: 0;
            background: var(--paper);
            font-weight: 500;
        }

        th:first-child {
            background: var(--grey-50);
            z-index: 51;
        }

        tbody tr {
            transition: background 0.2s ease;
        }

        tbody tr:hover {
            background: var(--grey-50);
        }

        tbody tr:hover td:first-child {
            background: var(--grey-50);
        }

        /* ì ‘ê¸°/í¼ì¹˜ê¸° ìŠ¤íƒ€ì¼ */
        .collapsible-section {
            margin-bottom: 24px;
        }

        .collapsible-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            user-select: none;
            padding: 20px 24px;
            background: var(--paper);
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: all 0.2s ease;
        }

        .collapsible-header:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
        }

        .collapsible-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 18px;
            font-weight: 600;
            color: var(--grey-900);
        }

        .collapsible-icon {
            font-size: 20px;
        }

        .collapsible-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: var(--primary-light);
            color: var(--primary-main);
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .collapsible-toggle:hover {
            background: var(--primary-main);
            color: white;
        }

        .collapsible-toggle-icon {
            transition: transform 0.3s ease;
            transform: rotate(180deg);
        }

        .collapsible-toggle-icon.collapsed {
            transform: rotate(0deg);
        }

        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease, opacity 0.3s ease;
            opacity: 0;
        }

        .collapsible-content.expanded {
            max-height: 10000px;
            opacity: 1;
            padding-top: 16px;
            overflow: visible;
        }

        /* ì°¨íŠ¸ ì¸ì‚¬ì´íŠ¸ íˆ´íŒ */
        .chart-insight-tooltip {
            position: fixed;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            padding: 0;
            display: none;
            z-index: 99999;
            max-width: 320px;
            min-width: 280px;
            pointer-events: none;
        }

        .chart-insight-tooltip.show {
            display: block;
        }

        .tooltip-insight-section {
            padding: 16px;
            background: linear-gradient(135deg, #fff9e6 0%, #fffbf0 100%);
            border-radius: 12px 12px 0 0;
            border-bottom: 2px solid #ffd54f;
        }

        .tooltip-insight-header {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            font-weight: 700;
            color: #f57c00;
            margin-bottom: 8px;
        }

        .tooltip-insight-text {
            font-size: 13px;
            color: var(--grey-800);
            line-height: 1.5;
            margin: 0;
        }

        .tooltip-recommendation-section {
            padding: 16px;
            background: white;
            border-radius: 0 0 12px 12px;
        }

        .tooltip-recommendation-header {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            font-weight: 700;
            color: var(--primary-main);
            margin-bottom: 8px;
        }

        .tooltip-recommendation-text {
            font-size: 13px;
            color: var(--grey-700);
            line-height: 1.5;
            margin: 0;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 1400px) {
            .kpi-summary-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            .grid-2 {
                grid-template-columns: 1fr;
            }
            .insight-content {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 1200px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .main-content {
                margin-left: 0;
            }
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 16px;
            }
            .kpi-summary-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .chart-container {
                height: 300px;
            }
            .insight-content {
                grid-template-columns: 1fr;
            }
        }

        /* í¼ë„ ë¹„ìœ¨ ë°” */
        .funnel-bar {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
        }

        .funnel-bar-fill {
            height: 8px;
            background: linear-gradient(90deg, var(--primary-main), var(--success-main));
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .funnel-bar-label {
            font-size: 11px;
            color: var(--grey-600);
            min-width: 40px;
        }

        /* D3 Funnel Styles */
        #d3FunnelChart {
            width: 100%;
            height: 650px;
            position: relative;
            overflow: visible;
        }

        .funnel-stage {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .funnel-stage:hover {
            opacity: 1;
            filter: brightness(1.1);
        }

        .funnel-stage path {
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.15));
            transition: filter 0.3s ease;
        }

        .funnel-stage:hover path {
            filter: drop-shadow(0 6px 16px rgba(0, 0, 0, 0.25));
        }

        .funnel-stage-label {
            font-size: 16px;
            font-weight: 600;
            fill: var(--grey-900);
            pointer-events: none;
        }

        .funnel-stage-value {
            font-size: 14px;
            font-weight: 500;
            fill: var(--grey-700);
            pointer-events: none;
        }

        .funnel-stage-conversion {
            font-size: 12px;
            fill: var(--grey-600);
            pointer-events: none;
        }

        .funnel-tooltip {
            position: fixed;
            background: white;
            border: 2px solid var(--primary-main);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 8px 24px rgba(103, 58, 183, 0.2), 0 4px 12px rgba(0, 0, 0, 0.1);
            pointer-events: none;
            z-index: 9999;
            max-width: 380px;
            min-width: 300px;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .funnel-tooltip.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .funnel-tooltip::before {
            content: '';
            position: absolute;
            top: 20px;
            left: -10px;
            width: 0;
            height: 0;
            border-top: 10px solid transparent;
            border-bottom: 10px solid transparent;
            border-right: 10px solid var(--primary-main);
        }

        .funnel-tooltip-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary-main);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .funnel-tooltip-title::before {
            content: 'ğŸ“Š';
            font-size: 20px;
        }

        .funnel-tooltip-metric {
            font-size: 14px;
            color: var(--grey-700);
            margin: 8px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 16px;
            padding: 8px;
            background: var(--grey-50);
            border-radius: 6px;
        }

        .funnel-tooltip-metric-label {
            font-weight: 600;
            color: var(--grey-700);
        }

        .funnel-tooltip-metric-value {
            font-weight: 700;
            font-size: 16px;
            color: var(--primary-main);
        }

        .funnel-tooltip-insight {
            margin-top: 16px;
            padding: 12px;
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--secondary-light) 100%);
            border-radius: 8px;
            border-left: 4px solid var(--secondary-main);
            font-size: 13px;
            color: var(--grey-700);
            line-height: 1.6;
        }

        .funnel-tooltip-insight::before {
            content: 'ğŸ’¡ ';
            font-size: 16px;
        }

        .funnel-tooltip-recommendation {
            margin-top: 12px;
            padding: 12px 16px;
            background: linear-gradient(135deg, var(--warning-light) 0%, #fff9e6 100%);
            border-radius: 8px;
            border-left: 4px solid var(--warning-main);
            font-size: 13px;
            font-weight: 500;
            color: var(--grey-900);
            line-height: 1.6;
        }

        .funnel-tooltip-recommendation::before {
            content: 'ğŸ¯ ì¶”ì²œ: ';
            font-weight: 700;
            color: var(--warning-main);
        }

        /* í•„í„° ì„¹ì…˜ */
        .filter-section {
            padding: 20px 24px;
            margin-bottom: 24px;
        }

        .filter-header {
            font-size: 16px;
            font-weight: 600;
            color: var(--grey-900);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-header::before {
            content: '';
            width: 4px;
            height: 20px;
            background: var(--primary-main);
            border-radius: 2px;
        }

        .filter-row {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            margin-bottom: 16px;
        }

        .filter-row:last-child {
            margin-bottom: 0;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            min-width: 160px;
            flex: 1;
        }

        .filter-group label {
            font-size: 12px;
            font-weight: 500;
            color: var(--grey-700);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .filter-group select,
        .filter-group input {
            padding: 10px 14px;
            border: 1px solid var(--grey-300);
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            background: var(--paper);
            color: var(--grey-900);
            transition: all 0.2s ease;
        }

        .filter-group select:hover,
        .filter-group input:hover {
            border-color: var(--primary-main);
        }

        .filter-group select:focus,
        .filter-group input:focus {
            outline: none;
            border-color: var(--primary-main);
            box-shadow: 0 0 0 3px rgba(103, 58, 183, 0.1);
        }

        .date-range {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .date-range input[type="date"] {
            padding: 10px 14px;
            border: 1px solid var(--grey-300);
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            background: var(--paper);
            color: var(--grey-900);
            transition: all 0.2s ease;
            flex: 1;
        }

        .date-range input[type="date"]:hover {
            border-color: var(--primary-main);
        }

        .date-range input[type="date"]:focus {
            outline: none;
            border-color: var(--primary-main);
            box-shadow: 0 0 0 3px rgba(103, 58, 183, 0.1);
        }

        .date-range span {
            color: var(--grey-500);
            font-weight: 500;
        }

        /* í¼ë„ ì°¨íŠ¸ ì¤‘ì•™ ì •ë ¬ */
        #d3FunnelChart,
        #d3FunnelChartLeft,
        #d3FunnelChartRight {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #d3FunnelChart svg,
        #d3FunnelChartLeft svg,
        #d3FunnelChartRight svg {
            display: block;
            margin: 0 auto;
        }

        /* í…Œì´ë¸” ì •ë ¬ ê¸°ëŠ¥ */
        .sortable-header {
            cursor: pointer;
            user-select: none;
            position: relative;
            padding-right: 24px !important;
            transition: background 0.2s ease;
            z-index: 100;
        }

        .sortable-header:hover {
            background: var(--grey-100);
        }

        .sort-icon {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 2px;
            opacity: 0.3;
            transition: opacity 0.2s ease;
        }

        .sortable-header:hover .sort-icon {
            opacity: 0.6;
        }

        .sort-icon.active {
            opacity: 1;
        }

        .sort-arrow {
            width: 0;
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
        }

        .sort-arrow.up {
            border-bottom: 5px solid var(--grey-700);
        }

        .sort-arrow.down {
            border-top: 5px solid var(--grey-700);
        }

        .sort-arrow.active {
            border-bottom-color: var(--primary-main);
            border-top-color: var(--primary-main);
        }

        /* ì •ë ¬ íˆ´íŒ */
        .sort-tooltip {
            position: fixed;
            transform: translate(-50%, -100%);
            background: var(--grey-900);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease;
            z-index: 9999;
            margin-top: -8px;
        }

        .sort-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 6px solid var(--grey-900);
        }

        .sortable-header:hover .sort-tooltip {
            opacity: 1 !important;
            visibility: visible !important;
        }

        /* í…Œì´ë¸” ì…€ ìƒ‰ìƒ ìŠ¤ì¼€ì¼ */
        .cell-value {
            position: relative;
            font-weight: 500;
        }

        .cell-bg {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            opacity: 0.15;
            transition: opacity 0.3s ease;
            border-radius: 4px;
        }

        tr:hover .cell-bg {
            opacity: 0.25;
        }

        /* ìƒ‰ìƒ ìŠ¤ì¼€ì¼ - ê° ë©”íŠ¸ë¦­ë³„ */
        .scale-acquisition { background: linear-gradient(90deg, transparent, #673ab7); }
        .scale-activation { background: linear-gradient(90deg, transparent, #2196f3); }
        .scale-consideration { background: linear-gradient(90deg, transparent, #ff9800); }
        .scale-conversion { background: linear-gradient(90deg, transparent, #4caf50); }
        .scale-purchase { background: linear-gradient(90deg, transparent, #00c853); }
        .scale-revenue { background: linear-gradient(90deg, transparent, #f44336); }
        .scale-cvr { background: linear-gradient(90deg, transparent, #9c27b0); }

        /* í…Œì´ë¸” ì…€ íŒ¨ë”© ì¡°ì • */
        td.has-bg {
            position: relative;
            padding: 14px 16px;
        }

        td.has-bg > span {
            position: relative;
            z-index: 1;
        }

        /* ë” ë³´ê¸°/ì ‘ê¸° ê¸°ëŠ¥ */
        .hidden-row {
            display: none;
        }

        .show-more-container {
            padding: 16px 24px;
            text-align: center;
        }

        .show-more-btn {
            padding: 10px 32px;
            background: var(--grey-100);
            color: var(--grey-700);
            border: 1px solid var(--grey-300);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.2s ease;
        }

        .show-more-btn:hover {
            background: var(--primary-light);
            color: var(--primary-main);
            border-color: var(--primary-main);
        }
    </style>
</head>
<body>
    <div class="app-wrapper">
        <!-- ì‚¬ì´ë“œë°” -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <a href="#" class="sidebar-logo">
                    <div class="sidebar-logo-icon">
                        <svg viewBox="0 0 24 24">
                            <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/>
                        </svg>
                    </div>
                    <div>
                        <div class="sidebar-logo-text">Analytics</div>
                        <div class="sidebar-logo-subtitle">Dashboard</div>
                    </div>
                </a>
            </div>

            <div class="simplebar-content-wrapper">
                <div class="sidebar-content">
                    <!-- ëŒ€ì‹œë³´ë“œ ê·¸ë£¹ -->
                    <div class="nav-group">
                        <div class="nav-group-title">ëŒ€ì‹œë³´ë“œ</div>
                        <a href="marketing_dashboard_v3.html" class="nav-item">
                            <div class="nav-item-icon">
                                <svg viewBox="0 0 24 24">
                                    <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zM7 10h2v7H7zm4-3h2v10h-2zm4 6h2v4h-2z"/>
                                </svg>
                            </div>
                            <span class="nav-item-text">ê´‘ê³  ì„±ê³¼ ëŒ€ì‹œë³´ë“œ</span>
                        </a>
                        <a href="#" class="nav-item active">
                            <div class="nav-item-icon">
                                <svg viewBox="0 0 24 24">
                                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                                </svg>
                            </div>
                            <span class="nav-item-text">AARRR í¼ë„ ë¶„ì„</span>
                        </a>
                    </div>

                    <!-- ë¶„ì„ ê·¸ë£¹ -->
                    <div class="nav-group">
                        <div class="nav-group-title">ë¶„ì„</div>
                        <a href="creative_analysis.html" class="nav-item">
                            <div class="nav-item-icon">
                                <svg viewBox="0 0 24 24">
                                    <path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/>
                                </svg>
                            </div>
                            <span class="nav-item-text">ê´‘ê³  ì†Œì¬ë³„ ë¶„ì„</span>
                        </a>
                        <a href="timeseries_analysis.html" class="nav-item">
                            <div class="nav-item-icon">
                                <svg viewBox="0 0 24 24">
                                    <path d="M23 8c0 1.1-.9 2-2 2-.18 0-.35-.02-.51-.07l-3.56 3.55c.05.16.07.34.07.52 0 1.1-.9 2-2 2s-2-.9-2-2c0-.18.02-.36.07-.52l-2.55-2.55c-.16.05-.34.07-.52.07s-.36-.02-.52-.07l-4.55 4.56c.05.16.07.33.07.51 0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2c.18 0 .35.02.51.07l4.56-4.55C8.02 9.36 8 9.18 8 9c0-1.1.9-2 2-2s2 .9 2 2c0 .18-.02.36-.07.52l2.55 2.55c.16-.05.34-.07.52-.07s.36.02.52.07l3.55-3.56C19.02 8.35 19 8.18 19 8c0-1.1.9-2 2-2s2 .9 2 2z"/>
                                </svg>
                            </div>
                            <span class="nav-item-text">ì‹œê³„ì—´ ë°ì´í„° ë¶„ì„</span>
                        </a>
                    </div>
                </div>
            </div>
        </aside>

        <!-- ë©”ì¸ ì»¨í…ì¸  -->
        <main class="main-content">
            <div class="container">
                <!-- í—¤ë” -->
                <div class="header">
                    <div>
                        <h1>ê³ ê° êµ¬ë§¤ ì—¬ì • ë¶„ì„ ëŒ€ì‹œë³´ë“œ</h1>
                        <div class="header-subtitle">ë°©ë¬¸ìê°€ ê³ ê°ì´ ë˜ê¸°ê¹Œì§€ì˜ ì „ ê³¼ì •ì„ í•œëˆˆì— ë¶„ì„ <span id="analysisPeriod" style="color: var(--primary-main); font-weight: 600;"></span></div>
                        <div style="margin-top: 8px; font-size: 13px; color: var(--grey-600); line-height: 1.6;">
                            ğŸ’¡ <strong>ì´ ëŒ€ì‹œë³´ë“œëŠ”</strong> ì›¹ì‚¬ì´íŠ¸ ë°©ë¬¸ìê°€ ì‹¤ì œ êµ¬ë§¤ê¹Œì§€ ì´ë¥´ëŠ” ê³¼ì •ì„ 5ë‹¨ê³„ë¡œ ë‚˜ëˆ„ì–´ ë³´ì—¬ì¤ë‹ˆë‹¤. ê° ë‹¨ê³„ì—ì„œ ì–¼ë§ˆë‚˜ ë§ì€ ê³ ê°ì„ ìƒëŠ”ì§€, ì–´ë–¤ ì±„ë„ì´ íš¨ê³¼ì ì¸ì§€ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                        </div>
                    </div>
                </div>

                <!-- 0. ì„±ê³¼ ìš”ì•½ ë°°ë„ˆ -->
                <div id="summaryCardBanner" style="display: none; margin-bottom: 24px; padding: 20px 24px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; color: white; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);">
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px;">
                        <div>
                            <div id="summaryCardTitle" style="font-size: 18px; font-weight: 700; margin-bottom: 8px;">ì´ë²ˆ ë‹¬ ì„±ê³¼ ìš”ì•½</div>
                            <div id="summaryCardMessage" style="font-size: 15px; opacity: 0.95;"></div>
                        </div>
                        <div style="display: flex; gap: 24px; flex-wrap: wrap;">
                            <div style="text-align: center;">
                                <div style="font-size: 11px; opacity: 0.8; margin-bottom: 4px;">ë°©ë¬¸ì</div>
                                <div id="summaryCardVisitors" style="font-size: 20px; font-weight: 700;"></div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 11px; opacity: 0.8; margin-bottom: 4px;">êµ¬ë§¤ì</div>
                                <div id="summaryCardPurchasers" style="font-size: 20px; font-weight: 700;"></div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 11px; opacity: 0.8; margin-bottom: 4px;">ì „í™˜ìœ¨</div>
                                <div id="summaryCardCVR" style="font-size: 20px; font-weight: 700;"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 1. í•µì‹¬ KPI ìš”ì•½ -->
                <div class="kpi-summary-grid" id="kpiSummaryGrid">
                    <!-- JSë¡œ ë™ì  ìƒì„± -->
                </div>

                <!-- 2. ì¸í„°ë™í‹°ë¸Œ í¼ë„ ì‹œê°í™” (D3.js) - KPI ë°”ë¡œ ë‹¤ìŒ ë°°ì¹˜ -->
                <div class="chart-section card">
                    <div class="chart-header">
                        ğŸ“Š ê³ ê° êµ¬ë§¤ ì—¬ì • 5ë‹¨ê³„
                        <div style="float: right; display: flex; align-items: center; gap: 8px;">
                            <button id="funnelCompareBtn" class="view-btn" style="font-size: 14px; padding: 8px 20px;">
                                ë¹„êµ
                            </button>
                            <button id="funnelFilterBtn" class="view-btn" style="font-size: 14px; padding: 8px 20px;">
                                í•„í„°
                            </button>
                            <select id="funnelChannelFilter" style="display: none; padding: 8px 12px; font-size: 13px; border: 1px solid #dee2e6; border-radius: 6px; background: white; cursor: pointer; min-width: 150px;">
                                <option value="">ì±„ë„ ì„ íƒ...</option>
                            </select>
                        </div>
                    </div>

                    <!-- ì„¤ëª… -->
                    <div style="font-size: 13px; color: var(--grey-600); margin-bottom: 16px;">
                        <strong>ê° ë‹¨ê³„ë¥¼ ë§ˆìš°ìŠ¤ë¡œ ê°€ë¦¬í‚¤ë©´</strong> í•´ë‹¹ ë‹¨ê³„ì˜ ì „í™˜ìœ¨ê³¼ ê°œì„  ë°©ë²•ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </div>

                    <!-- ë‹¨ì¼ í¼ë„ ë·° -->
                    <div id="singleFunnelView">
                        <div id="d3FunnelChart"></div>
                    </div>

                    <!-- ë¹„êµ í¼ë„ ë·° -->
                    <div id="compareFunnelView" style="display: none;">                       
                    
                        <!-- ê¸°ê°„ ì„ íƒ ì¹´ë“œ -->
                        <div style="display: grid; grid-template-columns: 1fr auto 1fr; gap: 20px; margin-bottom: 20px;">
                            <!-- ì™¼ìª½ ê¸°ê°„ ì„ íƒ -->
                            <div class="filter-section card">
                                <div class="filter-header">ì™¼ìª½ ê¸°ê°„ ì„ íƒ</div>
                                <div class="filter-row" style="margin-bottom: 0;">
                                    <div class="filter-group">
                                        <div class="date-range">
                                            <input type="date" id="leftStartDate">
                                            <span>~</span>
                                            <input type="date" id="leftEndDate">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- ê°€ìš´ë° ë¹ˆ ê³µê°„ -->
                            <div style="min-width: 60px;"></div>

                            <!-- ì˜¤ë¥¸ìª½ ê¸°ê°„ ì„ íƒ -->
                            <div class="filter-section card">
                                <div class="filter-header">ì˜¤ë¥¸ìª½ ê¸°ê°„ ì„ íƒ</div>
                                <div class="filter-row" style="margin-bottom: 0;">
                                    <div class="filter-group">
                                        <div class="date-range">
                                            <input type="date" id="rightStartDate">
                                            <span>~</span>
                                            <input type="date" id="rightEndDate">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- í¼ë„ ì°¨íŠ¸ ë¹„êµ -->
                        <div style="display: grid; grid-template-columns: 1fr auto 1fr; gap: 20px; align-items: start;">
                            <!-- ì™¼ìª½ í¼ë„ -->
                            <div id="d3FunnelChartLeft"></div>

                            <!-- ê°€ìš´ë° ë¹„êµ ì¸ì‚¬ì´íŠ¸ -->
                            <div id="comparisonInsights" style="min-width: 320px; max-width: 400px; padding: 16px; background: linear-gradient(135deg, #f8f9ff 0%, #f0f2ff 100%); border-radius: 12px; border: 2px solid #e0e7ff;">
                                <div style="text-align: center; margin-bottom: 12px;">
                                    <div style="font-size: 13px; font-weight: 600; color: var(--grey-700);">ğŸ“Š ë³€í™” ìš”ì•½</div>
                                    <div style="font-size: 10px; color: var(--grey-500); margin-top: 2px;">ì™¼ìª½ â†’ ì˜¤ë¥¸ìª½</div>
                                </div>
                                <div id="comparisonContent" style="font-size: 13px; color: var(--grey-700);"></div>
                            </div>

                            <!-- ì˜¤ë¥¸ìª½ í¼ë„ -->
                            <div id="d3FunnelChartRight"></div>
                        </div>
                    </div>
                </div>

                <!-- 3. ê³ ê¸‰ ë¶„ì„ ê²°ê³¼ (A/B Testing, Clustering, Churn Prediction) -->
                <div class="collapsible-section">
                    <div class="collapsible-header">
                        <div class="collapsible-title">
                            <span class="collapsible-icon">ğŸ”¬</span>
                            <span>ë°ì´í„° ê¸°ë°˜ ì˜ì‚¬ê²°ì • ë„êµ¬ (í•µì‹¬ ìš”ì•½, ê¸´ê¸‰ ê°œì„ , ì±„ë„ ë¶„ì„, ì˜ˆì‚°, CRM ê°€ì´ë“œ)</span>
                        </div>
                        <button class="collapsible-toggle">
                            <span>í¼ì¹˜ê¸°</span>
                            <span class="collapsible-toggle-icon collapsed">â–¼</span>
                        </button>
                    </div>
                    <div class="collapsible-content">
                        <!-- ê¸°ê°„ í•„í„° ë²„íŠ¼ -->
                        <div style="margin-bottom: 12px; padding: 12px 16px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 10px; border: 1px solid #dee2e6;">
                            <div style="display: flex; align-items: center; gap: 12px; flex-wrap: wrap;">
                                <span style="font-size: 12px; font-weight: 600; color: #495057;">ğŸ“… ë¶„ì„ ê¸°ê°„:</span>
                                <div style="display: flex; gap: 6px; flex-wrap: wrap;">
                                    <button class="period-filter-btn active" data-period="full" onclick="switchPeriod('full')"
                                            style="padding: 6px 14px; font-size: 11px; font-weight: 600; border: 1px solid #673ab7; border-radius: 20px; cursor: pointer; transition: all 0.2s; background: #673ab7; color: white;">
                                        ì „ì²´ ê¸°ê°„
                                    </button>
                                    <button class="period-filter-btn" data-period="180d" onclick="switchPeriod('180d')"
                                            style="padding: 6px 14px; font-size: 11px; font-weight: 600; border: 1px solid #dee2e6; border-radius: 20px; cursor: pointer; transition: all 0.2s; background: white; color: #495057;">
                                        ìµœê·¼ 180ì¼
                                    </button>
                                    <button class="period-filter-btn" data-period="90d" onclick="switchPeriod('90d')"
                                            style="padding: 6px 14px; font-size: 11px; font-weight: 600; border: 1px solid #dee2e6; border-radius: 20px; cursor: pointer; transition: all 0.2s; background: white; color: #495057;">
                                        ìµœê·¼ 90ì¼
                                    </button>
                                    <button class="period-filter-btn" data-period="30d" onclick="switchPeriod('30d')"
                                            style="padding: 6px 14px; font-size: 11px; font-weight: 600; border: 1px solid #dee2e6; border-radius: 20px; cursor: pointer; transition: all 0.2s; background: white; color: #495057;">
                                        ìµœê·¼ 30ì¼
                                    </button>
                                </div>
                                <span id="periodDateRange" style="font-size: 11px; color: #6c757d; margin-left: auto;"></span>
                            </div>
                        </div>

                        <!-- íƒ­ ë²„íŠ¼ -->
                        <div class="view-type-section" style="margin-bottom: 24px; flex-wrap: wrap; gap: 6px; align-items: center;">
                            <button class="view-btn decision-tool-tab-btn period-filter-enabled active" data-tab="summary" title="ì„ íƒí•œ ê¸°ê°„ í•„í„°ê°€ ì ìš©ë©ë‹ˆë‹¤">ğŸ“Š í•µì‹¬ ìš”ì•½</button>
                            <button class="view-btn decision-tool-tab-btn period-filter-enabled" data-tab="urgent" title="ì„ íƒí•œ ê¸°ê°„ í•„í„°ê°€ ì ìš©ë©ë‹ˆë‹¤">ğŸš¨ ê¸´ê¸‰ ê°œì„  <span id="urgentTotalCount" style="font-size: 11px; opacity: 0.8;"></span></button>
                            <button class="view-btn decision-tool-tab-btn period-filter-enabled" data-tab="clustering" title="ì„ íƒí•œ ê¸°ê°„ í•„í„°ê°€ ì ìš©ë©ë‹ˆë‹¤">ì±„ë„ ê·¸ë£¹ë³„ ë¶„ì„</button>
                            <button class="view-btn decision-tool-tab-btn period-filter-enabled" data-tab="budget" title="ì„ íƒí•œ ê¸°ê°„ í•„í„°ê°€ ì ìš©ë©ë‹ˆë‹¤">ì˜ˆì‚° íˆ¬ì ê°€ì´ë“œ</button>
                            <button class="view-btn decision-tool-tab-btn period-filter-enabled" data-tab="crm_guide" title="ì„ íƒí•œ ê¸°ê°„ í•„í„°ê°€ ì ìš©ë©ë‹ˆë‹¤">CRM ê°€ì´ë“œ</button>
                        </div>

                        <!-- íƒ­ 1: í•µì‹¬ ìš”ì•½ -->
                        <div class="decision-tool-tab-content active" id="summaryTab">
                            <div class="insight-content" id="insightContent">
                                <div class="insight-card neutral">
                                    <div class="insight-text">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                                </div>
                            </div>
                        </div>

                        <!-- íƒ­ 2: ê¸´ê¸‰ ê°œì„  í¬ì¸íŠ¸ -->
                        <div class="decision-tool-tab-content" id="urgentTab" style="display: none;">
                            <!-- ì„œë¸Œíƒ­: ì¦‰ì‹œ ì¡°ì¹˜ / ê°œì„  ê¶Œì¥ -->
                            <div style="display: flex; gap: 8px; margin-bottom: 16px;">
                                <button class="view-btn urgent-alert-tab-btn active" data-tab="high" style="font-size: 13px;">âš ï¸ ì¦‰ì‹œ ì¡°ì¹˜ í•„ìš” <span id="highAlertCount" style="font-size: 11px; opacity: 0.8;"></span></button>
                                <button class="view-btn urgent-alert-tab-btn" data-tab="medium" style="font-size: 13px;">ğŸ“Œ ê°œì„  ê¶Œì¥ <span id="mediumAlertCount" style="font-size: 11px; opacity: 0.8;"></span></button>
                            </div>
                            <!-- ì¦‰ì‹œ ì¡°ì¹˜ í•„ìš” -->
                            <div id="highAlertsTab" class="urgent-alert-tab-content active">
                                <div id="highAlertsCards" style="display: grid; gap: 12px;"></div>
                                <div id="highAlertsToggleContainer" style="text-align: center; margin-top: 12px; display: none;">
                                    <button id="highAlertsToggleBtn" class="view-btn" style="font-size: 13px; padding: 8px 20px;">ë” ë³´ê¸°</button>
                                </div>
                            </div>
                            <!-- ê°œì„  ê¶Œì¥ -->
                            <div id="mediumAlertsTab" class="urgent-alert-tab-content" style="display: none;">
                                <div id="mediumAlertsCards" style="display: grid; gap: 12px;"></div>
                                <div id="mediumAlertsToggleContainer" style="text-align: center; margin-top: 12px; display: none;">
                                    <button id="mediumAlertsToggleBtn" class="view-btn" style="font-size: 13px; padding: 8px 20px;">ë” ë³´ê¸°</button>
                                </div>
                            </div>
                        </div>

                        <!-- íƒ­ 3: ì±„ë„ í´ëŸ¬ìŠ¤í„°ë§ + BCG Matrix í†µí•© -->
                        <div class="decision-tool-tab-content" id="clusteringTab" style="display: none;">
                        <!-- BCG Matrix ì±„ë„ ì „ëµ -->
                        <div class="chart-section card" style="margin-bottom: 16px;">
                            <div class="chart-header">ğŸ“ˆ BCG Matrix ì±„ë„ ì „ëµ</div>
                            <div style="font-size: 13px; color: var(--grey-600); padding: 0 20px 12px 20px;">
                                <strong>'ì§€ê¸ˆ ì–´ë–¤ ì±„ë„ì— ëˆì„ ì¨ì•¼í•˜ë‚˜?'</strong> íˆ¬ì ì˜ì‚¬ê²°ì •ì„ ë•ê¸°ìœ„í•´ íŠ¸ë˜í”½ê³¼ ì „í™˜ìœ¨ì„ ê¸°ì¤€ìœ¼ë¡œ ê° ì±„ë„ì„ 4ê°€ì§€ ìœ í˜•ìœ¼ë¡œ ë¶„ë¥˜í–ˆìŠµë‹ˆë‹¤.
                            </div>
                            <div id="bcgMatrixContent" style="padding: 20px; display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
                                <!-- JSë¡œ ë™ì  ìƒì„± -->
                            </div>
                        </div>
                        <!-- ì±„ë„ í¼ë„ ê±´ê°•ë„ ë¶„ì„ -->
                        <div class="chart-section card" style="margin-bottom: 16px;">
                            <div class="chart-header">ğŸ©º ì±„ë„ í¼ë„ ê±´ê°•ë„ ë¶„ì„</div>
                            <div style="font-size: 13px; color: var(--grey-600); padding: 0 20px 12px 20px;">
                                <strong>'ì§€ê¸ˆ ì–´ë–¤ ì±„ë„ì˜ í¼ë„ íë¦„ì´ ê±´ê°•í•´?'</strong> ê° ì±„ë„ì˜ ìœ ì…â†’í™œë™â†’ê´€ì‹¬â†’ê²°ì œ ë‹¨ê³„ë³„ ì „í™˜ íš¨ìœ¨ì„ K-mean íˆ´ë¡œ ì¢…í•© ë¶„ì„í–ˆìŠµë‹ˆë‹¤. í¼ë„ ê±´ê°• ê·¸ë£¹ì€ ëª¨ë“  ë‹¨ê³„ê°€ ì›í™œí•˜ê³ , ì ê²€ í•„ìš” ê·¸ë£¹ì€ ì¤‘ê°„ ì´íƒˆì´ ì‹¬í•©ë‹ˆë‹¤.
                            </div>
                            <div id="channelClusters" style="padding: 20px;">
                                <p style="color: var(--grey-500);">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                            </div>
                            <!-- A/B í…ŒìŠ¤íŠ¸ í†µê³„ ê²°ê³¼ ì»¨í…Œì´ë„ˆ -->
                            <div id="abTestStatsContainer" style="padding: 0 20px 20px 20px;"></div>
                        </div>
                        </div>

                        <!-- íƒ­ 2: ì˜ˆì‚° íˆ¬ì ê°€ì´ë“œ -->
                        <div class="decision-tool-tab-content" id="budgetTab" style="display: none;">
                        <div class="chart-section card" style="margin-bottom: 16px;">
                            <div class="chart-header">ğŸ’° ì˜ˆì‚° íˆ¬ì ê°€ì´ë“œ: ì±„ë„ë³„ íˆ¬ì íš¨ìœ¨ì„± ë¶„ì„</div>
                            <div style="font-size: 13px; color: var(--grey-600); padding: 0 20px 12px 20px;">
                                ê° ì±„ë„ì˜ ì „í™˜ìœ¨, ê°ë‹¨ê°€, ì‹¤ì œ ì„±ê³¼ ë°ì´í„°ë¥¼ ì¢…í•©í•˜ì—¬ <strong>100ë§Œì› íˆ¬ì ì‹œ ì˜ˆìƒë˜ëŠ” êµ¬ì²´ì ì¸ ì„±ê³¼</strong>ë¥¼ ì‹œë®¬ë ˆì´ì…˜í–ˆìŠµë‹ˆë‹¤.
                                <strong>"ì‹ ë¢°ë„"</strong>ëŠ” ë°ì´í„° ì–‘ì— ê¸°ë°˜í•œ ë¶„ì„ì˜ ì •í™•ë„ë¥¼ ë‚˜íƒ€ë‚´ë©°, ì±„ë„ íƒ€ì…ë³„ë¡œ ë‹¤ë¥¸ íˆ¬ì ì „ëµì„ ì œì‹œí•©ë‹ˆë‹¤.
                                <div style="margin-top: 8px; padding: 8px; background: var(--grey-50); border-radius: 6px; font-size: 12px;">
                                    <strong>ğŸ“Œ ë¶„ì„ ê¸°ì¤€:</strong> ê´‘ê³  ì±„ë„(1,500ì›/ë°©ë¬¸ì), ì˜¤ê°€ë‹‰ ìµœì í™”(300ì›/ë°©ë¬¸ì), ë ˆí¼ëŸ´(500ì›/ë°©ë¬¸ì) ë“± ì—…ê³„ í‰ê·  CPA ì ìš©
                                </div>
                            </div>
                            <div id="abTestResults" style="padding: 20px;">
                                <p style="color: var(--grey-500);">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                            </div>
                        </div>
                        </div>

                        <!-- íƒ­ 3: CRM ê°€ì´ë“œ (ê¸°ê°„ í•„í„° ì ìš©) -->
                        <div class="decision-tool-tab-content" id="crmGuideTab" style="display: none;">
                        <div class="chart-section card" style="margin-bottom: 16px;">
                            <div class="chart-header">ğŸ“‹ CRM ì•¡ì…˜ ê°€ì´ë“œ</div>
                            <div style="font-size: 13px; color: var(--grey-600); padding: 0 20px 12px 20px;">
                                ì„ íƒí•œ ê¸°ê°„ì˜ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì—¬ ì´íƒˆ ìœ„í—˜ì„ ë°©ì§€í•˜ê¸° ìœ„í•œ <strong>êµ¬ì²´ì ì¸ CRM ì•¡ì…˜</strong>ì„ ì œì•ˆí•©ë‹ˆë‹¤.
                                ê° ë‹¨ê³„ë³„ë¡œ ì¦‰ì‹œ ì‹¤í–‰ ê°€ëŠ¥í•œ ì²˜ë°©ì„ í™•ì¸í•˜ì„¸ìš”.
                            </div>
                            <div id="crmActionsContainer" style="padding: 20px;">
                                <p style="color: var(--grey-500);">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                            </div>
                        </div>
                        </div>


                    </div>
                </div>

                <!-- 4. ìµœê·¼ ë³€í™” ì¸ì‚¬ì´íŠ¸ (ì ‘ê¸°/í¼ì¹˜ê¸°) -->
                <div class="collapsible-section" style="margin-bottom: 24px;">
                    <div class="collapsible-header">
                        <div class="collapsible-title">
                            <span class="collapsible-icon">ğŸ“ˆ</span>
                            <span>ìµœê·¼ ë³€í™” ì¸ì‚¬ì´íŠ¸</span>
                        </div>
                        <button class="collapsible-toggle">
                            <span>í¼ì¹˜ê¸°</span>
                            <span class="collapsible-toggle-icon collapsed">â–¼</span>
                        </button>
                    </div>
                    <div class="collapsible-content">
                        <!-- ê¸°ê°„ ë¹„êµ ì„ íƒ -->
                        <div id="trendPeriodIndicator" style="margin-bottom: 16px; padding: 14px 18px; background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%); border-radius: 10px; border: 1px solid #bbdefb;">
                            <div style="display: flex; align-items: center; gap: 12px; flex-wrap: wrap;">
                                <span style="font-size: 16px;">ğŸ“Š</span>
                                <span style="font-size: 13px; font-weight: 600; color: #1565c0;">ë¹„êµ ê¸°ê°„:</span>
                                <div style="display: flex; gap: 6px;">
                                    <button class="trend-period-btn" data-trend-period="30d" style="padding: 6px 14px; font-size: 11px; font-weight: 600; border: 1px solid #dee2e6; border-radius: 20px; cursor: pointer; transition: all 0.2s; background: white; color: #495057;">30ì¼</button>
                                    <button class="trend-period-btn" data-trend-period="14d" style="padding: 6px 14px; font-size: 11px; font-weight: 600; border: 1px solid #dee2e6; border-radius: 20px; cursor: pointer; transition: all 0.2s; background: white; color: #495057;">14ì¼</button>
                                    <button class="trend-period-btn active" data-trend-period="7d" style="padding: 6px 14px; font-size: 11px; font-weight: 600; border: 1px solid #673ab7; border-radius: 20px; cursor: pointer; transition: all 0.2s; background: #673ab7; color: white;">7ì¼</button>
                                </div>
                                <span id="trendPeriodText" style="font-size: 12px; color: #37474f; margin-left: auto;"></span>
                            </div>
                        </div>
                        <!-- 2ì—´ ê·¸ë¦¬ë“œ -->
                        <div class="compact-grid-2" style="margin-bottom: 0; display: grid; grid-template-columns: 1fr 1fr; gap: 0; background: white; border: 1px solid var(--grey-200); border-radius: 12px; overflow: hidden;">
                            <!-- ì„±ê³¼ ê°œì„  ë¶„ì„ -->
                            <div style="padding: 24px; border-right: 1px solid var(--grey-200); background: #fafafa;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px; padding-bottom: 12px; border-bottom: 2px solid #4caf50;">
                                    <div style="width: 32px; height: 32px; background: linear-gradient(135deg, #66bb6a 0%, #4caf50 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                        <span style="font-size: 14px; filter: brightness(10);">âœ¨</span>
                                    </div>
                                    <span style="font-size: 14px; font-weight: 700; color: #2e7d32;">ì¢‹ì€ ì†Œì‹: ì–´ë–¤ ë¶€ë¶„ì´ ì¢‹ì•„ì¡Œë‚˜ìš”?</span>
                                </div>
                                <div class="insight-content" id="improvementTrendContent" style="display: block; max-height: 400px; overflow-y: auto; padding-top: 4px;">
                                    <div class="insight-card neutral">
                                        <div class="insight-text">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                                    </div>
                                </div>
                            </div>

                            <!-- ì„±ê³¼ í•˜ë½ ê²½ê³  -->
                            <div style="padding: 24px; background: #fafafa;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px; padding-bottom: 12px; border-bottom: 2px solid #ef5350;">
                                    <div style="width: 32px; height: 32px; background: linear-gradient(135deg, #ef5350 0%, #f44336 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                        <span style="font-size: 14px; filter: brightness(10);">âš ï¸</span>
                                    </div>
                                    <span style="font-size: 14px; font-weight: 700; color: #c62828;">ì£¼ì˜ í•„ìš”: ì„±ê³¼ í•˜ë½ ê°ì§€</span>
                                </div>
                                <div class="insight-content" id="declineTrendContent" style="display: block; max-height: 400px; overflow-y: auto; padding-top: 4px;">
                                    <div class="insight-card neutral">
                                        <div class="insight-text">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 5. ìœ í˜•ë³„ ì¡°ì¹˜ ê°€ì´ë“œ (ë…ë¦½ ì„¹ì…˜) -->
                <div class="collapsible-section">
                    <div class="collapsible-header">
                        <div class="collapsible-title">
                            <span class="collapsible-icon">ğŸ¯</span>
                            <span>ìœ í˜•ë³„ ì¡°ì¹˜ ê°€ì´ë“œ (SA, DA, PR, CRM, etc)</span>
                        </div>
                        <button class="collapsible-toggle">
                            <span>í¼ì¹˜ê¸°</span>
                            <span class="collapsible-toggle-icon collapsed">â–¼</span>
                        </button>
                    </div>
                    <div class="collapsible-content">
                        <div style="font-size: 13px; color: var(--grey-600); margin-bottom: 16px;">
                            ì±„ë„ ì¹´í…Œê³ ë¦¬(SA, DA, SNS ë“±)ë³„ë¡œ <strong>ë§ì¶¤ ì²˜ë°©</strong>ê³¼ <strong>ì¡°ì¹˜ ê°€ì´ë“œ</strong>ë¥¼ ì œê³µí•©ë‹ˆë‹¤. ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ë©´ í•´ë‹¹ ìœ í˜•ì˜ ë¬¸ì œì ê³¼ ê°œì„  ë°©ì•ˆì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                        </div>

                        <!-- ê¸°ê°„ í•„í„° -->
                        <div style="margin-bottom: 12px; padding: 12px 16px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 10px; border: 1px solid #dee2e6;">
                            <div style="display: flex; align-items: center; gap: 12px; flex-wrap: wrap;">
                                <span style="font-size: 12px; font-weight: 600; color: #495057;">ğŸ“… ë¶„ì„ ê¸°ê°„:</span>
                                <div style="display: flex; gap: 6px; flex-wrap: wrap;">
                                    <button class="micro-segment-period-btn active" data-period="full" onclick="switchMicroSegmentPeriod('full')"
                                            style="padding: 6px 14px; font-size: 11px; font-weight: 600; border: 1px solid #673ab7; border-radius: 20px; cursor: pointer; transition: all 0.2s; background: #673ab7; color: white;">
                                        ì „ì²´ ê¸°ê°„
                                    </button>
                                    <button class="micro-segment-period-btn" data-period="180d" onclick="switchMicroSegmentPeriod('180d')"
                                            style="padding: 6px 14px; font-size: 11px; font-weight: 600; border: 1px solid #dee2e6; border-radius: 20px; cursor: pointer; transition: all 0.2s; background: white; color: #495057;">
                                        ìµœê·¼ 180ì¼
                                    </button>
                                    <button class="micro-segment-period-btn" data-period="90d" onclick="switchMicroSegmentPeriod('90d')"
                                            style="padding: 6px 14px; font-size: 11px; font-weight: 600; border: 1px solid #dee2e6; border-radius: 20px; cursor: pointer; transition: all 0.2s; background: white; color: #495057;">
                                        ìµœê·¼ 90ì¼
                                    </button>
                                    <button class="micro-segment-period-btn" data-period="30d" onclick="switchMicroSegmentPeriod('30d')"
                                            style="padding: 6px 14px; font-size: 11px; font-weight: 600; border: 1px solid #dee2e6; border-radius: 20px; cursor: pointer; transition: all 0.2s; background: white; color: #495057;">
                                        ìµœê·¼ 30ì¼
                                    </button>
                                </div>
                                <span id="microSegmentPeriodDateRange" style="font-size: 11px; color: #6c757d; margin-left: auto;"></span>
                            </div>
                        </div>

                        <!-- ì¹´í…Œê³ ë¦¬ í•„í„° -->
                        <div style="display: flex; gap: 6px; margin-bottom: 12px; flex-wrap: wrap; align-items: center;">
                            <span style="font-size: 12px; font-weight: 600; color: var(--grey-600);">ì¹´í…Œê³ ë¦¬:</span>
                            <button class="view-btn micro-category-filter active" data-category="all" style="font-size: 11px; padding: 5px 10px;">ì „ì²´</button>
                            <button class="view-btn micro-category-filter" data-category="SA" style="font-size: 11px; padding: 5px 10px;">SA</button>
                            <button class="view-btn micro-category-filter" data-category="DA" style="font-size: 11px; padding: 5px 10px;">DA</button>
                            <button class="view-btn micro-category-filter" data-category="SNS" style="font-size: 11px; padding: 5px 10px;">SNS</button>
                            <button class="view-btn micro-category-filter" data-category="CRM" style="font-size: 11px; padding: 5px 10px;">CRM</button>
                            <button class="view-btn micro-category-filter" data-category="PR" style="font-size: 11px; padding: 5px 10px;">PR</button>
                            <button class="view-btn micro-category-filter" data-category="Organic" style="font-size: 11px; padding: 5px 10px;">Organic</button>
                            <button class="view-btn micro-category-filter" data-category="etc" style="font-size: 11px; padding: 5px 10px;">ê¸°íƒ€</button>
                        </div>

                        <!-- ì„¸ê·¸ë¨¼íŠ¸ ì•Œë¦¼ ì„œë¸Œíƒ­ -->
                        <div style="display: flex; gap: 8px; margin-bottom: 16px;">
                            <button class="view-btn micro-segment-tab-btn active" data-type="problem" style="font-size: 13px;">ğŸš§ ë¬¸ì œì  <span id="microProblemCount" style="font-size: 11px; opacity: 0.8;"></span></button>
                            <button class="view-btn micro-segment-tab-btn" data-type="opportunity" style="font-size: 13px;">ğŸš€ ê¸°íšŒ <span id="microOpportunityCount" style="font-size: 11px; opacity: 0.8;"></span></button>
                        </div>

                        <!-- ë¬¸ì œì  ì•Œë¦¼ -->
                        <div id="microProblemTab" class="micro-segment-tab-content" style="display: block;">
                            <div id="microProblemCards" style="display: grid; gap: 12px;"></div>
                            <div id="microProblemToggleContainer" style="text-align: center; margin-top: 12px; display: none;">
                                <button id="microProblemToggleBtn" class="view-btn" style="font-size: 13px; padding: 8px 20px;">ë” ë³´ê¸°</button>
                            </div>
                        </div>

                        <!-- ê¸°íšŒ ì•Œë¦¼ -->
                        <div id="microOpportunityTab" class="micro-segment-tab-content" style="display: none;">
                            <div id="microOpportunityCards" style="display: grid; gap: 12px;"></div>
                            <div id="microOpportunityToggleContainer" style="text-align: center; margin-top: 12px; display: none;">
                                <button id="microOpportunityToggleBtn" class="view-btn" style="font-size: 13px; padding: 8px 20px;">ë” ë³´ê¸°</button>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- 6. ì±„ë„ë³„ ë¶„ì„ (ì ‘ê¸° ê°€ëŠ¥) -->
                <div class="collapsible-section">
                    <div class="collapsible-header">
                        <div class="collapsible-title">
                            <span class="collapsible-icon">ğŸ“Š</span>
                            <span>ìœ ì… ì±„ë„ë³„ ìƒì„¸ ë¶„ì„ (ë„¤ì´ë²„, êµ¬ê¸€, ì¸ìŠ¤íƒ€ê·¸ë¨ ë“±)</span>
                        </div>
                        <button class="collapsible-toggle">
                            <span>í¼ì¹˜ê¸°</span>
                            <span class="collapsible-toggle-icon collapsed">â–¼</span>
                        </button>
                    </div>
                    <div class="collapsible-content">
                        <!-- íƒ­ ë²„íŠ¼ -->
                        <div class="view-type-section" style="margin-bottom: 24px;">
                            <button class="view-btn channel-analysis-tab-btn active" data-tab="table">ì±„ë„ë³„ ê³ ê° íë¦„</button>
                            <button class="view-btn channel-analysis-tab-btn" data-tab="kpi">ì§€í‘œë³„ ë¹„êµ</button>
                            <button class="view-btn channel-analysis-tab-btn" data-tab="balance">íš¨ìœ¨ì„±ê³¼ ê·œëª¨</button>
                            <button class="view-btn channel-analysis-tab-btn" data-tab="top10">ì „í™˜ìœ¨ TOP 10</button>
                        </div>

                        <!-- íƒ­ 1: ì±„ë„ë³„ ë‹¨ê³„ë³„ ê³ ê° ìˆ˜ í…Œì´ë¸” -->
                        <div class="channel-analysis-tab-content active" id="tableTab">
                        <div class="table-section card" style="margin-bottom: 16px;">
                            <div class="table-header">ğŸ“Š ì±„ë„ë³„ ê³ ê° íë¦„: ê° ì±„ë„ì—ì„œ ì–¼ë§ˆë‚˜ ë§ì€ ê³ ê°ì´ êµ¬ë§¤ê¹Œì§€ ë„ë‹¬í•˜ë‚˜ìš”?</div>

                            <!-- ì„¤ëª… ì„¹ì…˜ -->
                            <div style="font-size: 13px; color: var(--grey-700); padding: 16px 24px; background: linear-gradient(135deg, #fafafa 0%, #f5f5f5 100%); line-height: 1.7;">
                                <strong style="color: var(--primary-main);">ğŸ“– ì´ í‘œëŠ” ë¬´ì—‡ì„ ë³´ì—¬ì£¼ë‚˜ìš”?</strong><br>
                                ê° ë§ˆì¼€íŒ… ì±„ë„(ë„¤ì´ë²„, êµ¬ê¸€, ì¸ìŠ¤íƒ€ê·¸ë¨ ë“±)ì—ì„œ ê³ ê°ì´ <strong>5ë‹¨ê³„ ì—¬ì •</strong>ì„ ì–´ë–»ê²Œ ê±°ì¹˜ëŠ”ì§€ ë³´ì—¬ì¤ë‹ˆë‹¤.<br>
                                <span style="color: var(--grey-600);">ì˜ˆì‹œ: ìœ ì… 1,000ëª… â†’ í™œë™ 800ëª… â†’ ê´€ì‹¬ 400ëª… â†’ ê²°ì œì§„í–‰ 100ëª… â†’ êµ¬ë§¤ì™„ë£Œ 50ëª… (CVR 5%)</span><br><br>
                                <strong style="color: var(--primary-main);">ğŸ’¡ í‘œ ë³´ëŠ” ë²•:</strong><br>
                                â€¢ <strong>ì™¼ìª½ì—ì„œ ì˜¤ë¥¸ìª½</strong>ìœ¼ë¡œ ê°ˆìˆ˜ë¡ ìˆ«ìê°€ ì¤„ì–´ë“œëŠ” ê²ƒì´ ì •ìƒì…ë‹ˆë‹¤ (ê³ ê°ì´ ë‹¨ê³„ë¥¼ ê±°ì¹˜ë©° ì´íƒˆ)<br>
                                â€¢ <strong>CVR(ì „í™˜ìœ¨)</strong>ì€ ë°©ë¬¸ì 100ëª… ì¤‘ ëª‡ ëª…ì´ ìµœì¢… êµ¬ë§¤í–ˆëŠ”ì§€ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤ (ë†’ì„ìˆ˜ë¡ ì¢‹ìŒ)<br>
                                â€¢ <strong>ë§¤ì¶œ</strong>ì´ ë†’ì•„ë„ CVRì´ ë‚®ìœ¼ë©´ ê°œì„  ì—¬ì§€ê°€ ë§ë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤<br>
                                â€¢ <strong>ì—´ ì œëª©ì„ í´ë¦­</strong>í•˜ë©´ í•´ë‹¹ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬ë©ë‹ˆë‹¤
                            </div>

                            <!-- ìë™ ì¸ì‚¬ì´íŠ¸ ë°•ìŠ¤ -->
                            <div id="channelTableInsightSummary" style="margin: 16px 24px; padding: 16px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8f4 100%); border-radius: 10px; border-left: 4px solid #4caf50;">
                                <div style="font-size: 13px; font-weight: 600; color: #4caf50; margin-bottom: 8px;">
                                    ğŸ¯ ë°ì´í„° ë¶„ì„ ê²°ê³¼
                                </div>
                                <div id="channelTableInsightText" style="font-size: 13px; color: var(--grey-800); line-height: 1.6;">
                                    ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                                </div>
                            </div>

                            <div class="table-container">
                                <table id="channelTable">
                                    <thead>
                                        <tr>
                                            <th>ì±„ë„</th>
                                            <th class="sortable-header" data-column="ìœ ì…" data-type="number">
                                                ìœ ì…
                                                <div class="sort-icon active">
                                                    <div class="sort-arrow up"></div>
                                                    <div class="sort-arrow down active"></div>
                                                </div>
                                                <div class="sort-tooltip">í´ë¦­í•˜ì—¬ ìœ ì… ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬</div>
                                            </th>
                                            <th class="sortable-header" data-column="í™œë™" data-type="number">
                                                í™œë™
                                                <div class="sort-icon">
                                                    <div class="sort-arrow up"></div>
                                                    <div class="sort-arrow down"></div>
                                                </div>
                                                <div class="sort-tooltip">í´ë¦­í•˜ì—¬ í™œë™ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬</div>
                                            </th>
                                            <th class="sortable-header" data-column="ê´€ì‹¬" data-type="number">
                                                ê´€ì‹¬
                                                <div class="sort-icon">
                                                    <div class="sort-arrow up"></div>
                                                    <div class="sort-arrow down"></div>
                                                </div>
                                                <div class="sort-tooltip">í´ë¦­í•˜ì—¬ ê´€ì‹¬ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬</div>
                                            </th>
                                            <th class="sortable-header" data-column="ê²°ì œì§„í–‰" data-type="number">
                                                ê²°ì œì§„í–‰
                                                <div class="sort-icon">
                                                    <div class="sort-arrow up"></div>
                                                    <div class="sort-arrow down"></div>
                                                </div>
                                                <div class="sort-tooltip">í´ë¦­í•˜ì—¬ ê²°ì œì§„í–‰ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬</div>
                                            </th>
                                            <th class="sortable-header" data-column="êµ¬ë§¤ì™„ë£Œ" data-type="number">
                                                êµ¬ë§¤ì™„ë£Œ
                                                <div class="sort-icon">
                                                    <div class="sort-arrow up"></div>
                                                    <div class="sort-arrow down"></div>
                                                </div>
                                                <div class="sort-tooltip">í´ë¦­í•˜ì—¬ êµ¬ë§¤ì™„ë£Œ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬</div>
                                            </th>
                                            <th class="sortable-header" data-column="Revenue" data-type="number">
                                                ë§¤ì¶œ
                                                <div class="sort-icon">
                                                    <div class="sort-arrow up"></div>
                                                    <div class="sort-arrow down"></div>
                                                </div>
                                                <div class="sort-tooltip">í´ë¦­í•˜ì—¬ ë§¤ì¶œ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬</div>
                                            </th>
                                            <th class="sortable-header" data-column="CVR" data-type="number">
                                                CVR
                                                <div class="sort-icon">
                                                    <div class="sort-arrow up"></div>
                                                    <div class="sort-arrow down"></div>
                                                </div>
                                                <div class="sort-tooltip">í´ë¦­í•˜ì—¬ CVR ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬</div>
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody id="channelTableBody">
                                        <tr>
                                            <td colspan="8">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- í•´ì„ ê°€ì´ë“œ -->
                            <div style="margin-top: 20px; padding: 0 24px 20px 24px;">
                                <div style="font-size: 14px; font-weight: 600; color: var(--grey-900); margin-bottom: 12px;">
                                    ğŸ“‹ ë°ì´í„° í•´ì„ ê°€ì´ë“œ
                                </div>
                                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 16px;">
                                    <!-- CVRì´ ë†’ì€ ê²½ìš° -->
                                    <div style="padding: 14px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8f4 100%); border-radius: 8px; border-left: 3px solid #4caf50;">
                                        <div style="font-size: 13px; font-weight: 600; color: #4caf50; margin-bottom: 6px;">
                                            âœ… CVRì´ ë†’ì€ ì±„ë„ (3% ì´ìƒ)
                                        </div>
                                        <div style="font-size: 12px; color: var(--grey-700); line-height: 1.5;">
                                            <strong>ì˜ë¯¸:</strong> íš¨ìœ¨ì ì¸ ì±„ë„. ì ì€ ë°©ë¬¸ìë¡œë„ ë§ì´ êµ¬ë§¤<br>
                                            <strong>ì „ëµ:</strong> ê´‘ê³ ë¹„ë¥¼ ë” íˆ¬ìí•˜ê³ , ì´ ì±„ë„ì˜ ì„±ê³µ ìš”ì¸ì„ ë‹¤ë¥¸ ì±„ë„ì— ì ìš©í•˜ì„¸ìš”
                                        </div>
                                    </div>

                                    <!-- ë§¤ì¶œì´ ë†’ì§€ë§Œ CVRì´ ë‚®ì€ ê²½ìš° -->
                                    <div style="padding: 14px; background: linear-gradient(135deg, #fff3e0 0%, #fff8f0 100%); border-radius: 8px; border-left: 3px solid #ff9800;">
                                        <div style="font-size: 13px; font-weight: 600; color: #ff9800; margin-bottom: 6px;">
                                            âš ï¸ ë§¤ì¶œì€ ë†’ì€ë° CVRì´ ë‚®ì€ ì±„ë„
                                        </div>
                                        <div style="font-size: 12px; color: var(--grey-700); line-height: 1.5;">
                                            <strong>ì˜ë¯¸:</strong> ë°©ë¬¸ìê°€ ë§ì§€ë§Œ ì „í™˜ìœ¨ì´ ë‚®ì•„ ë¹„íš¨ìœ¨ì <br>
                                            <strong>ì „ëµ:</strong> ëœë”© í˜ì´ì§€ ê°œì„ , íƒ€ê²ŸíŒ… ì •ë°€í™”ë¡œ CVRì„ ë†’ì´ë©´ ë§¤ì¶œì´ í¬ê²Œ ì¦ê°€í•©ë‹ˆë‹¤
                                        </div>
                                    </div>

                                    <!-- ë°©ë¬¸ìê°€ ë§ì§€ë§Œ ì´íƒˆì´ ë†’ì€ ê²½ìš° -->
                                    <div style="padding: 14px; background: linear-gradient(135deg, #e3f2fd 0%, #f1f8fc 100%); border-radius: 8px; border-left: 3px solid #2196f3;">
                                        <div style="font-size: 13px; font-weight: 600; color: #2196f3; margin-bottom: 6px;">
                                            ğŸšª ìœ ì…ì€ ë§ì€ë° í™œë™ ìˆ˜ê°€ ê¸‰ê°í•˜ëŠ” ì±„ë„
                                        </div>
                                        <div style="font-size: 12px; color: var(--grey-700); line-height: 1.5;">
                                            <strong>ì˜ë¯¸:</strong> ì²« í™”ë©´ì—ì„œ ëŒ€ë¶€ë¶„ ì´íƒˆ. ê´‘ê³ ì™€ í˜ì´ì§€ ë¶ˆì¼ì¹˜ ê°€ëŠ¥ì„±<br>
                                            <strong>ì „ëµ:</strong> ê´‘ê³  ë©”ì‹œì§€ì™€ ëœë”© í˜ì´ì§€ì˜ ì¼ê´€ì„± í™•ì¸, ë¡œë”© ì†ë„ ê°œì„ 
                                        </div>
                                    </div>

                                    <!-- ê´€ì‹¬ê¹Œì§€ëŠ” ê°€ì§€ë§Œ ê²°ì œë¡œ ì•ˆ ê°€ëŠ” ê²½ìš° -->
                                    <div style="padding: 14px; background: linear-gradient(135deg, #f3e5f5 0%, #faf5fc 100%); border-radius: 8px; border-left: 3px solid #9c27b0;">
                                        <div style="font-size: 13px; font-weight: 600; color: #9c27b0; margin-bottom: 6px;">
                                            ğŸ’­ ê´€ì‹¬ê¹Œì§€ëŠ” ê°€ëŠ”ë° ê²°ì œ ì•ˆ í•˜ëŠ” ì±„ë„
                                        </div>
                                        <div style="font-size: 12px; color: var(--grey-700); line-height: 1.5;">
                                            <strong>ì˜ë¯¸:</strong> ê´€ì‹¬ì€ ìˆì§€ë§Œ êµ¬ë§¤ ê²°ì •ì„ ë§ì„¤ì„. ê°€ê²©ì´ë‚˜ ì‹ ë¢° ë¬¸ì œ<br>
                                            <strong>ì „ëµ:</strong> ë¦¬ë·°/í›„ê¸° ê°•í™”, ì²« êµ¬ë§¤ í• ì¸ ì œê³µ, ê²°ì œ ê³¼ì • ê°„ì†Œí™”
                                        </div>
                                    </div>
                                </div>

                                <!-- ì‹¤í–‰ ì²´í¬ë¦¬ìŠ¤íŠ¸ -->
                                <div style="padding: 16px; background: linear-gradient(135deg, #fff9e6 0%, #fffcf5 100%); border-radius: 8px; border-left: 3px solid #ffc107;">
                                    <div style="font-size: 13px; font-weight: 600; color: #f57c00; margin-bottom: 10px;">
                                        âœ… ì´ í‘œë¥¼ ë³´ê³  ë°”ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ê²ƒë“¤
                                    </div>
                                    <div style="font-size: 12px; color: var(--grey-700); line-height: 1.8;">
                                        1. <strong>CVR 1ìœ„ ì±„ë„</strong>ì„ ì°¾ì•„ ê´‘ê³  ì˜ˆì‚°ì„ 20% ë” ë°°ì •í•˜ì„¸ìš”<br>
                                        2. <strong>ìœ ì…ì€ ë§ì§€ë§Œ CVRì´ ë‚®ì€ ì±„ë„</strong>ì˜ ê´‘ê³  ì†Œì¬ì™€ ëœë”© í˜ì´ì§€ë¥¼ ì ê²€í•˜ì„¸ìš”<br>
                                        3. <strong>ë‹¨ê³„ë³„ ì´íƒˆë¥ ì´ ê°€ì¥ ë†’ì€ êµ¬ê°„</strong>ì„ ì°¾ì•„ ì§‘ì¤‘ ê°œì„ í•˜ì„¸ìš” (ì˜ˆ: ìœ ì…â†’í™œë™ 50% ì´ìƒ ì´íƒˆ)<br>
                                        4. <strong>ë§¤ì¶œ ìƒìœ„ 3ê°œ ì±„ë„</strong>ì˜ ê³µí†µì ì„ ì°¾ì•„ ì„±ê³µ íŒ¨í„´ì„ ë¬¸ì„œí™”í•˜ì„¸ìš”<br>
                                        5. <strong>CVR 0.5% ì´í•˜ ì±„ë„</strong>ì€ ì¼ì‹œ ì¤‘ë‹¨í•˜ê³  ì˜ˆì‚°ì„ ì¬ë°°ë¶„í•˜ì„¸ìš”
                                    </div>
                                </div>
                            </div>
                        </div>
                        </div>

                        <!-- íƒ­ 2: KPI ì°¨íŠ¸ -->
                        <div class="channel-analysis-tab-content" id="kpiTab" style="display: none;">
                        <div class="chart-section card" style="margin-bottom: 16px;">
                            <div class="chart-header">ğŸ“ˆ ê° ì§€í‘œë³„ë¡œ ì–´ë–¤ ì±„ë„ì´ 1ë“±ì¸ê°€ìš”?</div>

                            <!-- ì„¤ëª… ì„¹ì…˜ -->
                            <div style="font-size: 13px; color: var(--grey-700); padding: 16px 24px; background: linear-gradient(135deg, #fafafa 0%, #f5f5f5 100%); margin-bottom: 16px; line-height: 1.7;">
                                <strong style="color: var(--primary-main);">ğŸ“– ì´ ì°¨íŠ¸ëŠ” ë¬´ì—‡ì„ ë³´ì—¬ì£¼ë‚˜ìš”?</strong><br>
                                ì›í•˜ëŠ” ì§€í‘œ(ì „í™˜ìœ¨, ë°©ë¬¸ì ìˆ˜, ë§¤ì¶œ ë“±)ë³„ë¡œ ê° ì±„ë„ì˜ ì„±ê³¼ë¥¼ í•œëˆˆì— ë¹„êµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br><br>
                                <strong style="color: var(--primary-main);">ğŸ’¡ ì‚¬ìš© ë°©ë²•:</strong><br>
                                â€¢ ì•„ë˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë³´ê³  ì‹¶ì€ ì§€í‘œë¥¼ ì„ íƒí•˜ì„¸ìš”<br>
                                â€¢ <strong>ì „í™˜ìœ¨</strong>ì€ íš¨ìœ¨ì„±ì„, <strong>ë§¤ì¶œ</strong>ì€ ì‹¤ì œ ìˆ˜ìµì„, <strong>ë°©ë¬¸ì ìˆ˜</strong>ëŠ” íŠ¸ë˜í”½ ê·œëª¨ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤<br>
                                â€¢ <strong>ì°¨íŠ¸ ìœ„ì— ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë¦¬ë©´</strong> í•´ë‹¹ ì§€í‘œì— ëŒ€í•œ ìì„¸í•œ ì„¤ëª…ê³¼ ê°œì„  ì „ëµì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤
                            </div>

                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px; flex-wrap: wrap; padding: 0 24px;">
                                <span style="font-size: 13px; font-weight: 600; color: var(--grey-700);">ğŸ“Š ë³´ê³  ì‹¶ì€ ì§€í‘œ:</span>
                                <button class="view-btn channel-kpi-btn active" data-kpi="cvr" data-chart="kpi">ì „í™˜ìœ¨ (%)</button>
                                <button class="view-btn channel-kpi-btn" data-kpi="acquisition" data-chart="kpi">ë°©ë¬¸ì ìˆ˜</button>
                                <button class="view-btn channel-kpi-btn" data-kpi="activation" data-chart="kpi">í™œì„± ì‚¬ìš©ì</button>
                                <button class="view-btn channel-kpi-btn" data-kpi="consideration" data-chart="kpi">ê´€ì‹¬ ê³ ê°</button>
                                <button class="view-btn channel-kpi-btn" data-kpi="conversion" data-chart="kpi">ê²°ì œ ì‹œë„</button>
                                <button class="view-btn channel-kpi-btn" data-kpi="purchase" data-chart="kpi">êµ¬ë§¤ ê±´ìˆ˜</button>
                                <button class="view-btn channel-kpi-btn" data-kpi="revenue" data-chart="kpi">ë§¤ì¶œì•¡</button>
                            </div>

                            <!-- ìë™ ì¸ì‚¬ì´íŠ¸ ë°•ìŠ¤ -->
                            <div id="kpiChartInsightSummary" style="margin: 16px 24px; padding: 16px; background: linear-gradient(135deg, #e3f2fd 0%, #f1f8fc 100%); border-radius: 10px; border-left: 4px solid #2196f3;">
                                <div style="font-size: 13px; font-weight: 600; color: #2196f3; margin-bottom: 8px;">
                                    ğŸ’¡ ì§€í‘œ ë¶„ì„ ì¸ì‚¬ì´íŠ¸
                                </div>
                                <div id="kpiChartInsightText" style="font-size: 13px; color: var(--grey-800); line-height: 1.6;">
                                    ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì§€í‘œë¥¼ ì„ íƒí•˜ë©´ ìë™ ë¶„ì„ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
                                </div>
                            </div>

                            <div class="chart-container-small" style="position: relative;">
                                <canvas id="channelKpiChart"></canvas>
                            </div>

                            <!-- í•´ì„ ê°€ì´ë“œ -->
                            <div style="margin-top: 20px; padding: 0 24px 20px 24px;">
                                <div style="font-size: 14px; font-weight: 600; color: var(--grey-900); margin-bottom: 12px;">
                                    ğŸ“‹ ê° ì§€í‘œë¥¼ ë³¼ ë•Œ ì£¼ì˜í•  ì 
                                </div>
                                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
                                    <!-- ì „í™˜ìœ¨ -->
                                    <div style="padding: 14px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8f4 100%); border-radius: 8px; border-left: 3px solid #4caf50;">
                                        <div style="font-size: 13px; font-weight: 600; color: #4caf50; margin-bottom: 6px;">
                                            ğŸ“Š ì „í™˜ìœ¨ (CVR)ì„ ë³¼ ë•Œ
                                        </div>
                                        <div style="font-size: 12px; color: var(--grey-700); line-height: 1.5;">
                                            <strong>ë†’ì„ìˆ˜ë¡ ì¢‹ìŒ:</strong> íš¨ìœ¨ì„±ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤<br>
                                            <strong>ì£¼ì˜:</strong> ë°©ë¬¸ìê°€ ë„ˆë¬´ ì ìœ¼ë©´ í†µê³„ì ìœ¼ë¡œ ë¶ˆì•ˆì •í•  ìˆ˜ ìˆì–´ìš”
                                        </div>
                                    </div>

                                    <!-- ë°©ë¬¸ì/ë§¤ì¶œ -->
                                    <div style="padding: 14px; background: linear-gradient(135deg, #fff3e0 0%, #fff8f0 100%); border-radius: 8px; border-left: 3px solid #ff9800;">
                                        <div style="font-size: 13px; font-weight: 600; color: #ff9800; margin-bottom: 6px;">
                                            ğŸ‘¥ ë°©ë¬¸ì ìˆ˜ / ğŸ’° ë§¤ì¶œì„ ë³¼ ë•Œ
                                        </div>
                                        <div style="font-size: 12px; color: var(--grey-700); line-height: 1.5;">
                                            <strong>ë†’ì„ìˆ˜ë¡ ì¢‹ìŒ:</strong> ê·œëª¨ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤<br>
                                            <strong>ì£¼ì˜:</strong> ë°©ë¬¸ìë§Œ ë§ê³  ì „í™˜ìœ¨ì´ ë‚®ìœ¼ë©´ ë¹„íš¨ìœ¨ì ì´ì—ìš”
                                        </div>
                                    </div>

                                    <!-- í™œì„± ì‚¬ìš©ì -->
                                    <div style="padding: 14px; background: linear-gradient(135deg, #e3f2fd 0%, #f1f8fc 100%); border-radius: 8px; border-left: 3px solid #2196f3;">
                                        <div style="font-size: 13px; font-weight: 600; color: #2196f3; margin-bottom: 6px;">
                                            âš¡ í™œì„± ì‚¬ìš©ìë¥¼ ë³¼ ë•Œ
                                        </div>
                                        <div style="font-size: 12px; color: var(--grey-700); line-height: 1.5;">
                                            <strong>ì˜ë¯¸:</strong> ì‹¤ì œë¡œ ì‚¬ì´íŠ¸ë¥¼ ì‚¬ìš©í•œ ë°©ë¬¸ì ìˆ˜<br>
                                            <strong>í™œìš©:</strong> ë°©ë¬¸ì ìˆ˜ì™€ ë¹„êµí•´ ì²« ì´íƒˆë¥ ì„ íŒŒì•…í•˜ì„¸ìš”
                                        </div>
                                    </div>

                                    <!-- ê´€ì‹¬/ê²°ì œ/êµ¬ë§¤ -->
                                    <div style="padding: 14px; background: linear-gradient(135deg, #f3e5f5 0%, #faf5fc 100%); border-radius: 8px; border-left: 3px solid #9c27b0;">
                                        <div style="font-size: 13px; font-weight: 600; color: #9c27b0; margin-bottom: 6px;">
                                            ğŸ›’ ê´€ì‹¬/ê²°ì œ/êµ¬ë§¤ë¥¼ ë³¼ ë•Œ
                                        </div>
                                        <div style="font-size: 12px; color: var(--grey-700); line-height: 1.5;">
                                            <strong>ì˜ë¯¸:</strong> êµ¬ë§¤ ì—¬ì •ì˜ ê° ë‹¨ê³„ë³„ ê³ ê° ìˆ˜<br>
                                            <strong>í™œìš©:</strong> ë‹¨ê³„ë³„ë¡œ ê¸‰ê°í•˜ëŠ” êµ¬ê°„ì„ ì°¾ì•„ ê°œì„ í•˜ì„¸ìš”
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        </div>

                        <!-- íƒ­ 3: ë¹„êµ ì°¨íŠ¸ -->
                        <div class="channel-analysis-tab-content" id="balanceTab" style="display: none;">
                        <div class="chart-section card" style="margin-bottom: 16px;">
                            <div class="chart-header">ğŸ”„ ì–´ë–¤ ì±„ë„ì´ íš¨ìœ¨ì„±ê³¼ ê·œëª¨ë¥¼ ëª¨ë‘ ê°–ì·„ë‚˜ìš”?</div>

                            <!-- ì„¤ëª… ì„¹ì…˜ -->
                            <div style="font-size: 13px; color: var(--grey-700); padding: 16px 24px; background: linear-gradient(135deg, #fafafa 0%, #f5f5f5 100%); margin-bottom: 16px; line-height: 1.7;">
                                <strong style="color: var(--primary-main);">ğŸ“– ì´ ì°¨íŠ¸ëŠ” ë¬´ì—‡ì„ ë³´ì—¬ì£¼ë‚˜ìš”?</strong><br>
                                ì „í™˜ìœ¨, ë°©ë¬¸ì ìˆ˜, êµ¬ë§¤ ê±´ìˆ˜, ë§¤ì¶œì„ ëª¨ë‘ <strong>100ì  ë§Œì </strong>ìœ¼ë¡œ í™˜ì‚°í•˜ì—¬ ë¹„êµí•©ë‹ˆë‹¤.<br>
                                <span style="color: var(--grey-600);">ì˜ˆì‹œ: CVRì´ ê°€ì¥ ë†’ì€ ì±„ë„ì„ 100ì ìœ¼ë¡œ í–ˆì„ ë•Œ, ë‹¤ë¥¸ ì±„ë„ë“¤ì€ ëª‡ ì ì¸ì§€ ë³´ì—¬ì¤ë‹ˆë‹¤.</span><br><br>
                                <strong style="color: var(--primary-main);">ğŸ’¡ ì°¨íŠ¸ ë³´ëŠ” ë²•:</strong><br>
                                â€¢ <strong>ëª¨ë“  ë§‰ëŒ€ê°€ ê³ ë¥´ê²Œ ë†’ì€ ì±„ë„</strong> = íš¨ìœ¨ë„ ì¢‹ê³  ê·œëª¨ë„ í° ìµœê³ ì˜ ì±„ë„<br>
                                â€¢ <strong>CVRë§Œ ë†’ê³  ë‹¤ë¥¸ ë§‰ëŒ€ê°€ ë‚®ì€ ì±„ë„</strong> = íš¨ìœ¨ì€ ì¢‹ì§€ë§Œ ê·œëª¨ê°€ ì‘ì€ ì±„ë„ (íˆ¬ì í™•ëŒ€ í•„ìš”)<br>
                                â€¢ <strong>ë°©ë¬¸ì/ë§¤ì¶œë§Œ ë†’ê³  CVRì´ ë‚®ì€ ì±„ë„</strong> = ê·œëª¨ëŠ” í¬ì§€ë§Œ ë¹„íš¨ìœ¨ì ì¸ ì±„ë„ (ê°œì„  í•„ìš”)<br>
                                â€¢ <strong>ì°¨íŠ¸ ìœ„ì— ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë¦¬ë©´</strong> ë” ìì„¸í•œ í•´ì„ ë°©ë²•ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤
                            </div>

                            <!-- ìë™ ì¸ì‚¬ì´íŠ¸ ë°•ìŠ¤ -->
                            <div id="compareChartInsightSummary" style="margin: 16px 24px; padding: 16px; background: linear-gradient(135deg, #f3e5f5 0%, #faf5fc 100%); border-radius: 10px; border-left: 4px solid #9c27b0;">
                                <div style="font-size: 13px; font-weight: 600; color: #9c27b0; margin-bottom: 8px;">
                                    ğŸ’ ê· í˜• ë¶„ì„ ê²°ê³¼
                                </div>
                                <div id="compareChartInsightText" style="font-size: 13px; color: var(--grey-800); line-height: 1.6;">
                                    ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                                </div>
                            </div>

                            <div style="position: relative; height: 450px;">
                                <canvas id="channelCompareChart"></canvas>
                            </div>

                            <!-- í•´ì„ ê°€ì´ë“œ -->
                            <div style="margin-top: 20px; padding: 0 24px 20px 24px;">
                                <div style="font-size: 14px; font-weight: 600; color: var(--grey-900); margin-bottom: 12px;">
                                    ğŸ“‹ ì±„ë„ ìœ í˜•ë³„ ì „ëµ
                                </div>
                                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
                                    <!-- ì™„ë²½í•œ ì±„ë„ -->
                                    <div style="padding: 14px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8f4 100%); border-radius: 8px; border-left: 3px solid #4caf50;">
                                        <div style="font-size: 13px; font-weight: 600; color: #4caf50; margin-bottom: 6px;">
                                            ğŸŒŸ ëª¨ë“  ë§‰ëŒ€ê°€ ê³ ë¥´ê²Œ ë†’ì€ ì±„ë„
                                        </div>
                                        <div style="font-size: 12px; color: var(--grey-700); line-height: 1.5;">
                                            <strong>ìœ í˜•:</strong> ì™„ë²½í•œ ì±„ë„ (íš¨ìœ¨â†‘ + ê·œëª¨â†‘)<br>
                                            <strong>ì „ëµ:</strong> ìµœìš°ì„  íˆ¬ì ëŒ€ìƒ. ê´‘ê³ ë¹„ë¥¼ ì ê·¹ ëŠ˜ë¦¬ì„¸ìš”
                                        </div>
                                    </div>

                                    <!-- íš¨ìœ¨ì€ ì¢‹ì€ë° ê·œëª¨ê°€ ì‘ì€ ì±„ë„ -->
                                    <div style="padding: 14px; background: linear-gradient(135deg, #e3f2fd 0%, #f1f8fc 100%); border-radius: 8px; border-left: 3px solid #2196f3;">
                                        <div style="font-size: 13px; font-weight: 600; color: #2196f3; margin-bottom: 6px;">
                                            ğŸ’ CVRì€ ë†’ì€ë° ë°©ë¬¸ìê°€ ì ì€ ì±„ë„
                                        </div>
                                        <div style="font-size: 12px; color: var(--grey-700); line-height: 1.5;">
                                            <strong>ìœ í˜•:</strong> ìˆ¨ê²¨ì§„ ë³´ì„ (íš¨ìœ¨â†‘ + ê·œëª¨â†“)<br>
                                            <strong>ì „ëµ:</strong> ê´‘ê³  ì˜ˆì‚°ì„ ëŠ˜ë ¤ ë°©ë¬¸ìë¥¼ í™•ëŒ€í•˜ì„¸ìš”
                                        </div>
                                    </div>

                                    <!-- ê·œëª¨ëŠ” í°ë° íš¨ìœ¨ì´ ë‚®ì€ ì±„ë„ -->
                                    <div style="padding: 14px; background: linear-gradient(135deg, #fff3e0 0%, #fff8f0 100%); border-radius: 8px; border-left: 3px solid #ff9800;">
                                        <div style="font-size: 13px; font-weight: 600; color: #ff9800; margin-bottom: 6px;">
                                            âš ï¸ ë°©ë¬¸ì/ë§¤ì¶œì€ ë†’ì€ë° CVRì´ ë‚®ì€ ì±„ë„
                                        </div>
                                        <div style="font-size: 12px; color: var(--grey-700); line-height: 1.5;">
                                            <strong>ìœ í˜•:</strong> ê°œì„  í•„ìš” ì±„ë„ (íš¨ìœ¨â†“ + ê·œëª¨â†‘)<br>
                                            <strong>ì „ëµ:</strong> ëœë”© í˜ì´ì§€ ê°œì„ ìœ¼ë¡œ CVRì„ ë†’ì´ë©´ ë§¤ì¶œ ê¸‰ì¦
                                        </div>
                                    </div>

                                    <!-- ëª¨ë“  ê²Œ ë‚®ì€ ì±„ë„ -->
                                    <div style="padding: 14px; background: linear-gradient(135deg, #ffebee 0%, #fff5f5 100%); border-radius: 8px; border-left: 3px solid #f44336;">
                                        <div style="font-size: 13px; font-weight: 600; color: #f44336; margin-bottom: 6px;">
                                            âŒ ëª¨ë“  ë§‰ëŒ€ê°€ ë‚®ì€ ì±„ë„
                                        </div>
                                        <div style="font-size: 12px; color: var(--grey-700); line-height: 1.5;">
                                            <strong>ìœ í˜•:</strong> ì €ì„±ê³¼ ì±„ë„ (íš¨ìœ¨â†“ + ê·œëª¨â†“)<br>
                                            <strong>ì „ëµ:</strong> ì¼ì‹œ ì¤‘ë‹¨í•˜ê³  ì˜ˆì‚°ì„ ìƒìœ„ ì±„ë„ë¡œ ì´ë™
                                        </div>
                                    </div>
                                </div>

                                <!-- ì‹¤í–‰ íŒ -->
                                <div style="margin-top: 12px; padding: 16px; background: linear-gradient(135deg, #fff9e6 0%, #fffcf5 100%); border-radius: 8px; border-left: 3px solid #ffc107;">
                                    <div style="font-size: 13px; font-weight: 600; color: #f57c00; margin-bottom: 10px;">
                                        âœ… ì´ ì°¨íŠ¸ë¡œ ë°”ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ê²ƒ
                                    </div>
                                    <div style="font-size: 12px; color: var(--grey-700); line-height: 1.8;">
                                        1. <strong>ëª¨ë“  ë§‰ëŒ€ê°€ ë†’ì€ ì±„ë„</strong>ì„ ì°¾ì•„ ê´‘ê³ ë¹„ë¥¼ 30-50% ì¦ì•¡í•˜ì„¸ìš”<br>
                                        2. <strong>CVRë§Œ ë†’ê³  ê·œëª¨ê°€ ì‘ì€ ì±„ë„</strong>ì€ íƒ€ê²Ÿì„ í™•ëŒ€í•˜ì—¬ ë°©ë¬¸ìë¥¼ ëŠ˜ë¦¬ì„¸ìš”<br>
                                        3. <strong>ê·œëª¨ëŠ” í¬ì§€ë§Œ CVRì´ ë‚®ì€ ì±„ë„</strong>ì€ ëœë”© í˜ì´ì§€ A/B í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•˜ì„¸ìš”<br>
                                        4. <strong>ëª¨ë“  ì§€í‘œê°€ ë‚®ì€ ì±„ë„</strong>ì€ ì¼ì‹œ ì¤‘ë‹¨í•˜ê³  ì›ì¸ ë¶„ì„ì„ ë¨¼ì € í•˜ì„¸ìš”
                                    </div>
                                </div>
                            </div>
                        </div>
                        </div>

                        <!-- íƒ­ 4: TOP 10 ì „í™˜ìœ¨ ì°¨íŠ¸ -->
                        <div class="channel-analysis-tab-content" id="top10Tab" style="display: none;">
                        <div class="chart-section card">
                            <div class="chart-header">ğŸ¯ ê° ë‹¨ê³„ë³„ ì „í™˜ìœ¨ TOP 10: ì–´ë–¤ ì±„ë„ì´ ê°€ì¥ íš¨ìœ¨ì ì¸ê°€ìš”?</div>

                            <!-- ì„¤ëª… ì„¹ì…˜ -->
                            <div style="font-size: 13px; color: var(--grey-700); padding: 16px 24px; background: linear-gradient(135deg, #fafafa 0%, #f5f5f5 100%); margin-bottom: 16px; line-height: 1.7;">
                                <strong style="color: var(--primary-main);">ğŸ“– ì´ ì°¨íŠ¸ëŠ” ë¬´ì—‡ì„ ë³´ì—¬ì£¼ë‚˜ìš”?</strong><br>
                                ê° ê³ ê° ì—¬ì • ë‹¨ê³„ë³„ë¡œ ì „í™˜ìœ¨ì´ ë†’ì€ ìƒìœ„ 10ê°œ ì±„ë„ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.<br>
                                <span style="color: var(--grey-600);">ì˜ˆì‹œ: "í™œë™" ë‹¨ê³„ë¥¼ ì„ íƒí•˜ë©´, ìœ ì…í•œ ê³ ê° ì¤‘ ì‹¤ì œë¡œ í™œë™ê¹Œì§€ ì´ì–´ì§„ ë¹„ìœ¨ì´ ë†’ì€ ì±„ë„ ìˆœìœ„ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span><br><br>
                                <strong style="color: var(--primary-main);">ğŸ’¡ ì „í™˜ìœ¨ì´ë€?</strong><br>
                                â€¢ <strong>í™œë™ ì „í™˜ìœ¨</strong> = (í™œë™ ê³ ê° Ã· ìœ ì… ê³ ê°) Ã— 100<br>
                                â€¢ <strong>ê´€ì‹¬ ì „í™˜ìœ¨</strong> = (ê´€ì‹¬ ê³ ê° Ã· ìœ ì… ê³ ê°) Ã— 100<br>
                                â€¢ <strong>ê²°ì œì§„í–‰ ì „í™˜ìœ¨</strong> = (ê²°ì œì§„í–‰ Ã· ìœ ì… ê³ ê°) Ã— 100<br>
                                â€¢ <strong>êµ¬ë§¤ì™„ë£Œ ì „í™˜ìœ¨(CVR)</strong> = (êµ¬ë§¤ ê³ ê° Ã· ìœ ì… ê³ ê°) Ã— 100 â† ê°€ì¥ ì¤‘ìš”!<br><br>
                                <strong>ë†’ì„ìˆ˜ë¡</strong> íš¨ìœ¨ì ì¸ ì±„ë„ì…ë‹ˆë‹¤ (ì ì€ ë°©ë¬¸ìë¡œë„ ë§ì€ ì „í™˜ ë‹¬ì„±)
                            </div>

                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px; flex-wrap: wrap; padding: 0 24px;">
                                <span style="font-size: 13px; font-weight: 600; color: var(--grey-700);">ğŸ“Š ì „í™˜ìœ¨ ê¸°ì¤€:</span>
                                <button class="view-btn channel-funnel-btn" data-funnel="activation">í™œë™</button>
                                <button class="view-btn channel-funnel-btn" data-funnel="consideration">ê´€ì‹¬</button>
                                <button class="view-btn channel-funnel-btn" data-funnel="conversion">ê²°ì œì§„í–‰</button>
                                <button class="view-btn channel-funnel-btn active" data-funnel="purchase">êµ¬ë§¤ì™„ë£Œ</button>
                            </div>

                            <!-- ìë™ ì¸ì‚¬ì´íŠ¸ ë°•ìŠ¤ -->
                            <div id="top10ChartInsightSummary" style="margin: 16px 24px; padding: 16px; background: linear-gradient(135deg, #fff3e0 0%, #fff8f0 100%); border-radius: 10px; border-left: 4px solid #ff9800;">
                                <div style="font-size: 13px; font-weight: 600; color: #ff9800; margin-bottom: 8px;">
                                    ğŸ† TOP 10 ë¶„ì„ ê²°ê³¼
                                </div>
                                <div id="top10ChartInsightText" style="font-size: 13px; color: var(--grey-800); line-height: 1.6;">
                                    ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë‹¨ê³„ë¥¼ ì„ íƒí•˜ë©´ ìë™ ë¶„ì„ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
                                </div>
                            </div>

                            <div class="chart-container-small">
                                <canvas id="campaignChart"></canvas>
                            </div>

                            <!-- í•´ì„ ê°€ì´ë“œ -->
                            <div style="margin-top: 20px; padding: 0 24px 20px 24px;">
                                <div style="font-size: 14px; font-weight: 600; color: var(--grey-900); margin-bottom: 12px;">
                                    ğŸ“‹ ì „í™˜ìœ¨ ìˆœìœ„ë¥¼ ë³¼ ë•Œ ì£¼ì˜í•  ì 
                                </div>
                                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 16px;">
                                    <!-- ì „í™˜ìœ¨ ë†’ì§€ë§Œ ê·œëª¨ ì‘ì€ ê²½ìš° -->
                                    <div style="padding: 14px; background: linear-gradient(135deg, #e3f2fd 0%, #f1f8fc 100%); border-radius: 8px; border-left: 3px solid #2196f3;">
                                        <div style="font-size: 13px; font-weight: 600; color: #2196f3; margin-bottom: 6px;">
                                            âš ï¸ ì „í™˜ìœ¨ì€ ë†’ì€ë° ë°©ë¬¸ìê°€ ì ë‹¤ë©´?
                                        </div>
                                        <div style="font-size: 12px; color: var(--grey-700); line-height: 1.5;">
                                            <strong>ì˜ë¯¸:</strong> íš¨ìœ¨ì€ ìš°ìˆ˜í•˜ì§€ë§Œ ê·œëª¨ê°€ ì‘ìŒ<br>
                                            <strong>ì „ëµ:</strong> ê´‘ê³  ì˜ˆì‚°ì„ ëŠ˜ë ¤ ë°©ë¬¸ì í™•ëŒ€ (í° ì„±ê³¼ ê¸°ëŒ€)
                                        </div>
                                    </div>

                                    <!-- ì „í™˜ìœ¨ ë‚®ì§€ë§Œ ê·œëª¨ í° ê²½ìš° -->
                                    <div style="padding: 14px; background: linear-gradient(135deg, #fff3e0 0%, #fff8f0 100%); border-radius: 8px; border-left: 3px solid #ff9800;">
                                        <div style="font-size: 13px; font-weight: 600; color: #ff9800; margin-bottom: 6px;">
                                            âš ï¸ ì „í™˜ìœ¨ì€ ë‚®ì€ë° ë§¤ì¶œì´ ë†’ë‹¤ë©´?
                                        </div>
                                        <div style="font-size: 12px; color: var(--grey-700); line-height: 1.5;">
                                            <strong>ì˜ë¯¸:</strong> ê·œëª¨ëŠ” í¬ì§€ë§Œ ë¹„íš¨ìœ¨ì <br>
                                            <strong>ì „ëµ:</strong> ëœë”© í˜ì´ì§€ ê°œì„ ìœ¼ë¡œ CVR ìƒìŠ¹ â†’ ë§¤ì¶œ í­ë°œì  ì¦ê°€
                                        </div>
                                    </div>

                                    <!-- ì´ˆê¸° ë‹¨ê³„ ì „í™˜ìœ¨ì´ ë‚®ì€ ê²½ìš° -->
                                    <div style="padding: 14px; background: linear-gradient(135deg, #ffebee 0%, #fff5f5 100%); border-radius: 8px; border-left: 3px solid #f44336;">
                                        <div style="font-size: 13px; font-weight: 600; color: #f44336; margin-bottom: 6px;">
                                            ğŸš¨ í™œë™ ì „í™˜ìœ¨ì´ 50% ì´í•˜ë¼ë©´?
                                        </div>
                                        <div style="font-size: 12px; color: var(--grey-700); line-height: 1.5;">
                                            <strong>ì˜ë¯¸:</strong> ì²« í™”ë©´ì—ì„œ ì ˆë°˜ ì´ìƒì´ ì´íƒˆ<br>
                                            <strong>ì „ëµ:</strong> ê´‘ê³  ë©”ì‹œì§€ì™€ ëœë”© í˜ì´ì§€ ì¼ì¹˜ í™•ì¸, ë¡œë”© ì†ë„ ê°œì„ 
                                        </div>
                                    </div>

                                    <!-- ìµœì¢… ì „í™˜ìœ¨ì´ ë†’ì€ ê²½ìš° -->
                                    <div style="padding: 14px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8f4 100%); border-radius: 8px; border-left: 3px solid #4caf50;">
                                        <div style="font-size: 13px; font-weight: 600; color: #4caf50; margin-bottom: 6px;">
                                            âœ… êµ¬ë§¤ì™„ë£Œ ì „í™˜ìœ¨ì´ 3% ì´ìƒì´ë¼ë©´?
                                        </div>
                                        <div style="font-size: 12px; color: var(--grey-700); line-height: 1.5;">
                                            <strong>ì˜ë¯¸:</strong> ë§¤ìš° ìš°ìˆ˜í•œ ì±„ë„!<br>
                                            <strong>ì „ëµ:</strong> ìµœìš°ì„  íˆ¬ì ëŒ€ìƒ. ê´‘ê³ ë¹„ë¥¼ 30-50% ì¦ì•¡í•˜ì„¸ìš”
                                        </div>
                                    </div>
                                </div>

                                <!-- ì‹¤í–‰ íŒ -->
                                <div style="padding: 16px; background: linear-gradient(135deg, #fff9e6 0%, #fffcf5 100%); border-radius: 8px; border-left: 3px solid #ffc107;">
                                    <div style="font-size: 13px; font-weight: 600; color: #f57c00; margin-bottom: 10px;">
                                        âœ… ì´ ìˆœìœ„í‘œë¡œ ë°”ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ê²ƒ
                                    </div>
                                    <div style="font-size: 12px; color: var(--grey-700); line-height: 1.8;">
                                        1. <strong>êµ¬ë§¤ì™„ë£Œ TOP 3 ì±„ë„</strong>ì˜ ê³µí†µì ì„ ì°¾ì•„ ë‹¤ë¥¸ ì±„ë„ì— ì ìš©í•˜ì„¸ìš”<br>
                                        2. <strong>í™œë™ ì „í™˜ìœ¨ì´ ë†’ì€ ì±„ë„</strong>ì€ ì²« í™”ë©´ì´ íš¨ê³¼ì . ëœë”© í˜ì´ì§€ë¥¼ ë²¤ì¹˜ë§ˆí‚¹í•˜ì„¸ìš”<br>
                                        3. <strong>ê²°ì œì§„í–‰ê¹Œì§€ëŠ” ê°€ì§€ë§Œ êµ¬ë§¤ëŠ” ì•ˆ í•˜ëŠ” ì±„ë„</strong>ì€ ê²°ì œ ê³¼ì •ì„ ê°„ì†Œí™”í•˜ì„¸ìš”<br>
                                        4. <strong>ì „í™˜ìœ¨ 1%  ë¯¸ë§Œ ì±„ë„</strong>ì€ ì¼ì‹œ ì¤‘ë‹¨í•˜ê³  ì›ì¸ ë¶„ì„ì„ ë¨¼ì € í•˜ì„¸ìš”<br>
                                        5. ê° ë‹¨ê³„ë³„ íƒ­ì„ í´ë¦­í•˜ë©° ì–´ëŠ êµ¬ê°„ì—ì„œ ì´íƒˆì´ ë§ì€ì§€ íŒŒì•…í•˜ì„¸ìš”
                                    </div>
                                </div>
                            </div>
                        </div>
                        </div>
                    </div>
                </div>

                <!-- 6. ì‹ ê·œ vs ì¬ë°©ë¬¸ ë° ì´íƒˆ ë¶„ì„ (ì ‘ê¸° ê°€ëŠ¥) -->
                <div class="collapsible-section">
                    <div class="collapsible-header">
                        <div class="collapsible-title">
                            <span class="collapsible-icon">ğŸ‘¥</span>
                            <span>ê³ ê° ì¬ë°©ë¬¸ ë° ì´íƒˆ ë¶„ì„</span>
                        </div>
                        <button class="collapsible-toggle">
                            <span>í¼ì¹˜ê¸°</span>
                            <span class="collapsible-toggle-icon collapsed">â–¼</span>
                        </button>
                    </div>
                    <div class="collapsible-content">
                        <!-- íƒ­ ë²„íŠ¼ -->
                        <div class="view-type-section" style="margin-bottom: 24px;">
                            <button class="view-btn customer-analysis-tab-btn active" data-tab="trend">ì‹ ê·œ vs ì¬ë°©ë¬¸ ì¶”ì„¸</button>
                            <button class="view-btn customer-analysis-tab-btn" data-tab="conversion">ì „í™˜ìœ¨ ë¹„êµ</button>
                            <button class="view-btn customer-analysis-tab-btn" data-tab="churn">ì´íƒˆë¥  ë¶„ì„</button>
                            <button class="view-btn customer-analysis-tab-btn" data-tab="matrix">ì±„ë„ í’ˆì§ˆ ë§¤íŠ¸ë¦­ìŠ¤</button>
                            <button class="view-btn customer-analysis-tab-btn" data-tab="engagement">ê³ ê° ì°¸ì—¬ë„</button>
                        </div>

                        <!-- íƒ­ 1: í†µí•© ì‹ ê·œ/ì¬ë°©ë¬¸ ê³ ê° ì¶”ì„¸ ì°¨íŠ¸ -->
                        <div class="customer-analysis-tab-content active" id="trendTab">
                        <!-- ë°ì´í„° ê¸°ì¤€ ì„ íƒ -->
                        <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 16px; padding: 16px 0;">
                            <span style="font-size: 14px; font-weight: 600; color: var(--grey-700);">ğŸ“Š ë°ì´í„° ê¸°ì¤€:</span>
                            <div style="display: flex; gap: 8px;">
                                <button class="view-btn new-vs-returning-view-btn active" data-view="monthly">ğŸ“† ì›”ë³„</button>
                                <button class="view-btn new-vs-returning-view-btn" data-view="weekly">ğŸ“† ì£¼ë³„</button>
                                <button class="view-btn new-vs-returning-view-btn" data-view="daily">ğŸ“… ì¼ë³„</button>
                            </div>
                        </div>
                        <div class="chart-section card" style="margin-bottom: 16px;">
                            <div class="chart-header">ğŸ“Š ì‹ ê·œ vs ì¬ë°©ë¬¸ ê³ ê° ì¶”ì„¸ ë¶„ì„</div>
                            <div style="font-size: 13px; color: var(--grey-600); margin-bottom: 12px; padding: 0 24px;">
                                ì‹œê°„ì— ë”°ë¥¸ ì‹ ê·œ ê³ ê° ë¹„ìœ¨ê³¼ ì¬ë°©ë¬¸ìœ¨ì˜ ë³€í™”ë¥¼ ì¶”ì í•©ë‹ˆë‹¤. ì‹ ê·œ ê³ ê° ë¹„ìœ¨ì´ ë†’ìœ¼ë©´ ìƒˆë¡œìš´ ê³ ê° ìœ ì…ì´ í™œë°œí•œ ê²ƒì´ê³ , ì¬ë°©ë¬¸ìœ¨ì´ ë†’ìœ¼ë©´ ê³ ê° ì¶©ì„±ë„ê°€ ë†’ë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤. <strong>ì°¨íŠ¸ ìœ„ì— ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë¦¬ë©´</strong> ì¶”ê°€ ì¸ì‚¬ì´íŠ¸ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                            </div>
                            <div class="chart-container-small" style="position: relative;">
                                <canvas id="customerTrendChart"></canvas>
                            </div>
                        </div>
                        </div>

                        <!-- íƒ­ 2: ì‹ ê·œ vs ì¬ë°©ë¬¸ ê³ ê° ì „í™˜ìœ¨ ë¹„êµ -->
                        <div class="customer-analysis-tab-content" id="conversionTab" style="display: none;">
                        <div class="chart-section card" style="margin-bottom: 16px;">
                            <div class="chart-header">ğŸ”„ ì²« ë°©ë¬¸ ê³ ê° vs ì¬ë°©ë¬¸ ê³ ê°: êµ¬ë§¤ ì „í™˜ìœ¨ ì°¨ì´ ë¶„ì„</div>
                            <div style="font-size: 13px; color: var(--grey-600); margin-bottom: 16px; padding: 0 24px; line-height: 1.7;">
                                <strong>ì´ ì°¨íŠ¸ëŠ” ë¬´ì—‡ì„ ë³´ì—¬ì£¼ë‚˜ìš”?</strong><br>
                                ì²˜ìŒ ìš°ë¦¬ ì‚¬ì´íŠ¸ì— ì˜¨ ì‚¬ëŒ(ì‹ ê·œ)ê³¼ ì´ë¯¸ ì™”ë˜ ì ì´ ìˆëŠ” ì‚¬ëŒ(ì¬ë°©ë¬¸)ì˜ í–‰ë™ì„ ë¹„êµí•©ë‹ˆë‹¤.
                                ê° ë‹¨ê³„ë³„ë¡œ ì–¼ë§ˆë‚˜ ë§ì€ ì‚¬ëŒì´ ë‹¤ìŒ ë‹¨ê³„ë¡œ ë„˜ì–´ê°€ëŠ”ì§€ ì „í™˜ìœ¨(%)ë¡œ í‘œì‹œë©ë‹ˆë‹¤.
                                <strong>ì°¨íŠ¸ ìœ„ì— ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë¦¬ë©´</strong> ë” ìì„¸í•œ ë¶„ì„ê³¼ ê°œì„  ë°©ë²•ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                            </div>

                            <!-- ì£¼ìš” ì¸ì‚¬ì´íŠ¸ ìš”ì•½ -->
                            <div id="conversionInsightSummary" style="margin: 0 24px 16px 24px; padding: 16px; background: linear-gradient(135deg, #f0f4ff 0%, #e8eeff 100%); border-radius: 10px; border-left: 4px solid var(--primary-main);">
                                <div style="font-size: 13px; font-weight: 600; color: var(--primary-main); margin-bottom: 8px;">
                                    ğŸ’¡ í•µì‹¬ ì¸ì‚¬ì´íŠ¸
                                </div>
                                <div id="conversionInsightText" style="font-size: 13px; color: var(--grey-800); line-height: 1.6;">
                                    ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                                </div>
                            </div>

                            <div class="chart-container-small" style="position: relative;">
                                <canvas id="newVsReturningConversionChart"></canvas>
                            </div>

                            <!-- í•´ì„ ê°€ì´ë“œ -->
                            <div style="margin-top: 20px; padding: 0 24px;">
                                <div style="font-size: 14px; font-weight: 600; color: var(--grey-900); margin-bottom: 12px;">
                                    ğŸ“‹ ì°¨íŠ¸ í•´ì„ ê°€ì´ë“œ
                                </div>
                                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
                                    <div style="padding: 14px; background: linear-gradient(135deg, #fff3e0 0%, #fff9e6 100%); border-radius: 8px; border-left: 3px solid #ff9800;">
                                        <div style="font-size: 13px; font-weight: 600; color: #f57c00; margin-bottom: 6px;">
                                            ğŸ†• ì‹ ê·œ ê³ ê° (ì£¼í™©ìƒ‰ ë§‰ëŒ€)
                                        </div>
                                        <div style="font-size: 12px; color: var(--grey-700); line-height: 1.5;">
                                            ì²˜ìŒ ë°©ë¬¸í•œ ê³ ê°ë“¤ì˜ ì „í™˜ìœ¨ì…ë‹ˆë‹¤. ì‹ ê·œ ê³ ê°ì€ ìš°ë¦¬ ì‚¬ì´íŠ¸ë¥¼ ì²˜ìŒ ê²½í—˜í•˜ê¸° ë•Œë¬¸ì— ì¼ë°˜ì ìœ¼ë¡œ ì „í™˜ìœ¨ì´ ë‚®ìŠµë‹ˆë‹¤.
                                            <strong>ì²«ì¸ìƒì´ ì¤‘ìš”</strong>í•˜ë¯€ë¡œ ëœë”©í˜ì´ì§€ì™€ ì²« í™”ë©´ ìµœì í™”ê°€ í•µì‹¬ì…ë‹ˆë‹¤.
                                        </div>
                                    </div>
                                    <div style="padding: 14px; background: linear-gradient(135deg, #ede7f6 0%, #f3f0ff 100%); border-radius: 8px; border-left: 3px solid #673ab7;">
                                        <div style="font-size: 13px; font-weight: 600; color: #673ab7; margin-bottom: 6px;">
                                            ğŸ”„ ì¬ë°©ë¬¸ ê³ ê° (ë³´ë¼ìƒ‰ ë§‰ëŒ€)
                                        </div>
                                        <div style="font-size: 12px; color: var(--grey-700); line-height: 1.5;">
                                            ì´ë¯¸ ë°©ë¬¸í•œ ì ì´ ìˆëŠ” ê³ ê°ë“¤ì˜ ì „í™˜ìœ¨ì…ë‹ˆë‹¤. ì¬ë°©ë¬¸ ê³ ê°ì€ ìš°ë¦¬ ë¸Œëœë“œë¥¼ ì•Œê³  ìˆì–´ <strong>ì‹ ë¢°ë„ê°€ ë†’ê³  êµ¬ë§¤ ê°€ëŠ¥ì„±ì´ í½ë‹ˆë‹¤</strong>.
                                            ì´ë©”ì¼ ë§ˆì¼€íŒ…ì´ë‚˜ ë¦¬íƒ€ê²ŸíŒ…ìœ¼ë¡œ ì¬ë°©ë¬¸ì„ ìœ ë„í•˜ì„¸ìš”.
                                        </div>
                                    </div>
                                </div>

                                <!-- ì‹¤í–‰ ê°€ëŠ¥í•œ íŒ -->
                                <div style="margin-top: 12px; padding: 14px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8f4 100%); border-radius: 8px; border-left: 3px solid var(--success-main);">
                                    <div style="font-size: 13px; font-weight: 600; color: var(--success-main); margin-bottom: 6px;">
                                        âœ… ì‹¤í–‰ ê°€ëŠ¥í•œ ê°œì„  ë°©ë²•
                                    </div>
                                    <div style="font-size: 12px; color: var(--grey-700); line-height: 1.6;">
                                        <strong>ì‹ ê·œ ê³ ê° ì „í™˜ìœ¨ì´ ë‚®ë‹¤ë©´:</strong>
                                        ì²« í™”ë©´ ë¡œë”© ì†ë„ ê°œì„ , ëª…í™•í•œ ê°€ì¹˜ ì œì•ˆ í‘œì‹œ, ì‹ ë¢° ìš”ì†Œ ê°•í™”(ë¦¬ë·°, ë³´ì•ˆ ì¸ì¦ ë“±), íšŒì›ê°€ì… ì—†ì´ ë‘˜ëŸ¬ë³´ê¸° ê°€ëŠ¥í•˜ê²Œ<br>
                                        <strong>ì¬ë°©ë¬¸ ê³ ê° ì „í™˜ìœ¨ì´ ë‚®ë‹¤ë©´:</strong>
                                        ê°œì¸í™”ëœ ì¶”ì²œ ì‹œìŠ¤í…œ ë„ì…, ì¬ë°©ë¬¸ ì¿ í° ì œê³µ, ì´ë©”ì¼ë¡œ ì‹ ìƒí’ˆ ì•Œë¦¼, ë¡œê·¸ì¸ ì‹œ ì´ì „ ì¥ë°”êµ¬ë‹ˆ ìë™ ë³µì›<br>
                                        <strong>ë‘ ê·¸ë£¹ ëª¨ë‘ ë‚®ë‹¤ë©´:</strong>
                                        ì „ì²´ì ì¸ ì‚¬ìš©ì ê²½í—˜(UX) ì ê²€ í•„ìš”, ê°€ê²© ê²½ìŸë ¥ í™•ì¸, ê²°ì œ ì˜µì…˜ ë‹¤ì–‘í™”
                                    </div>
                                </div>
                            </div>
                        </div>
                        </div>

                        <!-- íƒ­ 3: ì´íƒˆë¥  ì°¨íŠ¸ -->
                        <div class="customer-analysis-tab-content" id="churnTab" style="display: none;">
                        <div class="chart-section card" style="margin-bottom: 16px;">
                            <div class="chart-header">ğŸ“‰ ì±„ë„ë³„ ê³ ê° ì´íƒˆ ë¶„ì„: ì–´ëŠ ë‹¨ê³„ì—ì„œ ê°€ì¥ ë§ì´ ë– ë‚˜ë‚˜ìš”?</div>

                            <!-- ì„¤ëª… -->
                            <div style="font-size: 13px; color: var(--grey-600); margin-bottom: 16px; padding: 0 24px; line-height: 1.7;">
                                <strong>ì´íƒˆë¥ ì´ë€?</strong><br>
                                ê° í¼ë„ ë‹¨ê³„ì—ì„œ ë‹¤ìŒ ë‹¨ê³„ë¡œ ë„˜ì–´ê°€ì§€ ëª»í•˜ê³  ë– ë‚˜ëŠ” ê³ ê°ì˜ ë¹„ìœ¨ì…ë‹ˆë‹¤.
                                ì˜ˆë¥¼ ë“¤ì–´, "ìœ ì…â†’í™œë™" ì´íƒˆë¥  80%ëŠ” ë°©ë¬¸ì 100ëª… ì¤‘ 80ëª…ì´ ì•„ë¬´ í–‰ë™ë„ í•˜ì§€ ì•Šê³  ë– ë‚¬ë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤.
                                <strong>ì´íƒˆë¥ ì´ ë†’ì€ ë‹¨ê³„ë¥¼ ì°¾ì•„ ì§‘ì¤‘ ê°œì„ </strong>í•˜ë©´ ì „ì²´ ì „í™˜ìœ¨ì„ í¬ê²Œ í–¥ìƒì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                                <strong>ì°¨íŠ¸ ìœ„ì— ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë¦¬ë©´</strong> ë” ìì„¸í•œ ë¶„ì„ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                            </div>

                            <!-- ì´íƒˆë¥  ìë™ ì¸ì‚¬ì´íŠ¸ -->
                            <div id="churnInsightSummary" style="margin: 0 24px 16px 24px; padding: 16px; background: linear-gradient(135deg, #ffebee 0%, #fff5f5 100%); border-radius: 10px; border-left: 4px solid #ff5722;">
                                <div style="font-size: 13px; font-weight: 600; color: #ff5722; margin-bottom: 8px;">
                                    âš ï¸ ì´íƒˆë¥  ë¶„ì„ ê²°ê³¼
                                </div>
                                <div id="churnInsightText" style="font-size: 13px; color: var(--grey-800); line-height: 1.6;">
                                    ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                                </div>
                            </div>

                            <!-- í•„í„° ë²„íŠ¼ -->
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px; flex-wrap: wrap; padding: 0 24px;">
                                <span style="font-size: 13px; font-weight: 600; color: var(--grey-700);">ğŸ“Š í¼ë„ ë‹¨ê³„:</span>
                                <button class="view-btn channel-churn-stage-btn" data-stage="activation">ìœ ì…â†’í™œë™</button>
                                <button class="view-btn channel-churn-stage-btn" data-stage="consideration">í™œë™â†’ê´€ì‹¬</button>
                                <button class="view-btn channel-churn-stage-btn" data-stage="conversion">ê´€ì‹¬â†’ê²°ì œì§„í–‰</button>
                                <button class="view-btn channel-churn-stage-btn" data-stage="purchase">ê²°ì œì§„í–‰â†’êµ¬ë§¤ì™„ë£Œ</button>
                                <button class="view-btn channel-churn-stage-btn active" data-stage="avg">í‰ê·  ì´íƒˆë¥ </button>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px; flex-wrap: wrap; padding: 0 24px;">
                                <span style="font-size: 13px; font-weight: 600; color: var(--grey-700);">ğŸ”¢ ì •ë ¬:</span>
                                <button class="view-btn channel-churn-sort-btn active" data-sort="desc">ğŸ“‰ ë†’ì€ìˆœ</button>
                                <button class="view-btn channel-churn-sort-btn" data-sort="asc">ğŸ“ˆ ë‚®ì€ìˆœ</button>
                            </div>

                            <div class="chart-container-small" style="position: relative;">
                                <canvas id="channelChurnChart"></canvas>
                            </div>

                            <!-- ì´íƒˆë¥  í•´ì„ ê°€ì´ë“œ -->
                            <div style="margin-top: 20px; padding: 0 24px;">
                                <div style="font-size: 14px; font-weight: 600; color: var(--grey-900); margin-bottom: 12px;">
                                    ğŸ“‹ ë‹¨ê³„ë³„ ì´íƒˆ ì›ì¸ê³¼ ê°œì„  ë°©ë²•
                                </div>
                                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 16px;">
                                    <!-- ìœ ì…â†’í™œë™ ì´íƒˆ -->
                                    <div style="padding: 14px; background: linear-gradient(135deg, #e3f2fd 0%, #f1f8fc 100%); border-radius: 8px; border-left: 3px solid #2196f3;">
                                        <div style="font-size: 13px; font-weight: 600; color: #2196f3; margin-bottom: 6px;">
                                            ğŸšª ìœ ì…â†’í™œë™ ì´íƒˆì´ ë†’ë‹¤ë©´
                                        </div>
                                        <div style="font-size: 12px; color: var(--grey-700); line-height: 1.5;">
                                            <strong>ì›ì¸:</strong> ëœë”© í˜ì´ì§€ê°€ ëŠë¦¬ê±°ë‚˜, ê´‘ê³  ë‚´ìš©ê³¼ ì‹¤ì œ í˜ì´ì§€ê°€ ë‹¤ë¥´ê±°ë‚˜, ì²« í™”ë©´ì´ ë³µì¡í•¨<br>
                                            <strong>í•´ê²°:</strong> ë¡œë”© ì†ë„ ê°œì„ (3ì´ˆ ì´ë‚´), ê´‘ê³ ì™€ ëœë”© í˜ì´ì§€ ë©”ì‹œì§€ ì¼ì¹˜, ëª…í™•í•œ í—¤ë“œë¼ì¸ ë°°ì¹˜
                                        </div>
                                    </div>

                                    <!-- í™œë™â†’ê´€ì‹¬ ì´íƒˆ -->
                                    <div style="padding: 14px; background: linear-gradient(135deg, #fff3e0 0%, #fff9e6 100%); border-radius: 8px; border-left: 3px solid #ff9800;">
                                        <div style="font-size: 13px; font-weight: 600; color: #f57c00; margin-bottom: 6px;">
                                            ğŸ‘€ í™œë™â†’ê´€ì‹¬ ì´íƒˆì´ ë†’ë‹¤ë©´
                                        </div>
                                        <div style="font-size: 12px; color: var(--grey-700); line-height: 1.5;">
                                            <strong>ì›ì¸:</strong> ì œí’ˆ/ì„œë¹„ìŠ¤ ì •ë³´ ë¶€ì¡±, ì‹ ë¢° ìš”ì†Œ ë¶€ì¡±, ê°€ê²© ì •ë³´ ìˆ¨ê¹€<br>
                                            <strong>í•´ê²°:</strong> ìƒì„¸í•œ ì œí’ˆ ì„¤ëª…, ê³ ê° í›„ê¸°/ë¦¬ë·° ê°•ì¡°, ê°€ê²© íˆ¬ëª…í•˜ê²Œ ê³µê°œ, ë¹„êµí‘œ ì œê³µ
                                        </div>
                                    </div>

                                    <!-- ê´€ì‹¬â†’ê²°ì œì§„í–‰ ì´íƒˆ -->
                                    <div style="padding: 14px; background: linear-gradient(135deg, #f3e5f5 0%, #fce4ec 100%); border-radius: 8px; border-left: 3px solid #9c27b0;">
                                        <div style="font-size: 13px; font-weight: 600; color: #9c27b0; margin-bottom: 6px;">
                                            ğŸ›’ ê´€ì‹¬â†’ê²°ì œì§„í–‰ ì´íƒˆì´ ë†’ë‹¤ë©´
                                        </div>
                                        <div style="font-size: 12px; color: var(--grey-700); line-height: 1.5;">
                                            <strong>ì›ì¸:</strong> ê°€ê²©ì´ ì˜ˆìƒë³´ë‹¤ ë†’ìŒ, ë°°ì†¡ë¹„ ì¶”ê°€ ë¹„ìš© ë°œê²¬, íšŒì›ê°€ì… ê°•ìš”<br>
                                            <strong>í•´ê²°:</strong> ì²« êµ¬ë§¤ í• ì¸ ì œê³µ, ë¬´ë£Œ ë°°ì†¡ ì„ê³„ê°’ ë‚®ì¶”ê¸°, ê²ŒìŠ¤íŠ¸ ì²´í¬ì•„ì›ƒ í—ˆìš©
                                        </div>
                                    </div>

                                    <!-- ê²°ì œì§„í–‰â†’êµ¬ë§¤ì™„ë£Œ ì´íƒˆ -->
                                    <div style="padding: 14px; background: linear-gradient(135deg, #ffebee 0%, #fff5f5 100%); border-radius: 8px; border-left: 3px solid #ff5722;">
                                        <div style="font-size: 13px; font-weight: 600; color: #ff5722; margin-bottom: 6px;">
                                            ğŸ’³ ê²°ì œì§„í–‰â†’êµ¬ë§¤ì™„ë£Œ ì´íƒˆì´ ë†’ë‹¤ë©´
                                        </div>
                                        <div style="font-size: 12px; color: var(--grey-700); line-height: 1.5;">
                                            <strong>ì›ì¸:</strong> ê²°ì œ ê³¼ì • ë³µì¡, ë³´ì•ˆ ë¶ˆì•ˆ, ê²°ì œ ìˆ˜ë‹¨ ë¶€ì¡±, ì‹œìŠ¤í…œ ì˜¤ë¥˜<br>
                                            <strong>í•´ê²°:</strong> ê°„í¸ ê²°ì œ ë„ì…(ì¹´ì¹´ì˜¤í˜ì´, ë„¤ì´ë²„í˜ì´), SSL ì¸ì¦ í‘œì‹œ, ë‹¤ì–‘í•œ ê²°ì œ ì˜µì…˜, ì¥ë°”êµ¬ë‹ˆ ë³µì› ì´ë©”ì¼
                                        </div>
                                    </div>
                                </div>

                                <!-- ì´íƒˆë¥  ë²¤ì¹˜ë§ˆí¬ -->
                                <div style="padding: 14px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8f4 100%); border-radius: 8px; border-left: 3px solid #00c853; margin-bottom: 12px;">
                                    <div style="font-size: 13px; font-weight: 600; color: #00c853; margin-bottom: 6px;">
                                        ğŸ“Š ì—…ê³„ í‰ê·  ì´íƒˆë¥  ë²¤ì¹˜ë§ˆí¬
                                    </div>
                                    <div style="font-size: 12px; color: var(--grey-700); line-height: 1.6;">
                                        <strong>ìœ ì…â†’í™œë™:</strong> í‰ê·  40-60% (ë‚®ì„ìˆ˜ë¡ ì¢‹ìŒ)<br>
                                        <strong>í™œë™â†’ê´€ì‹¬:</strong> í‰ê·  50-70%<br>
                                        <strong>ê´€ì‹¬â†’ê²°ì œì§„í–‰:</strong> í‰ê·  60-80%<br>
                                        <strong>ê²°ì œì§„í–‰â†’êµ¬ë§¤ì™„ë£Œ:</strong> í‰ê·  20-40% (ì´ ë‹¨ê³„ëŠ” íŠ¹íˆ ë‚®ì•„ì•¼ í•¨)<br><br>
                                        <strong>ğŸ’¡ íŒ:</strong> ì—…ê³„ í‰ê· ë³´ë‹¤ 10%p ì´ìƒ ë†’ë‹¤ë©´ ì¦‰ì‹œ ê°œì„ ì´ í•„ìš”í•©ë‹ˆë‹¤.
                                    </div>
                                </div>

                                <!-- ì‹¤í–‰ ì²´í¬ë¦¬ìŠ¤íŠ¸ -->
                                <div style="padding: 14px; background: var(--primary-light); border-radius: 8px; border-left: 3px solid var(--primary-main);">
                                    <div style="font-size: 13px; font-weight: 600; color: var(--primary-main); margin-bottom: 8px;">
                                        âœ… ì´íƒˆë¥  ê°œì„  ìš°ì„ ìˆœìœ„ ì²´í¬ë¦¬ìŠ¤íŠ¸
                                    </div>
                                    <div style="font-size: 12px; color: var(--grey-700); line-height: 1.6;">
                                        <strong>1ë‹¨ê³„:</strong> ì°¨íŠ¸ì—ì„œ <strong>ì´íƒˆë¥ ì´ ê°€ì¥ ë†’ì€ ë‹¨ê³„</strong>ë¥¼ ì°¾ê¸° (ì˜ˆ: ìœ ì…â†’í™œë™ 80%)<br>
                                        <strong>2ë‹¨ê³„:</strong> í•´ë‹¹ ë‹¨ê³„ì—ì„œ <strong>ì´íƒˆë¥ ì´ ê°€ì¥ ë†’ì€ ì±„ë„ TOP 3</strong> í™•ì¸<br>
                                        <strong>3ë‹¨ê³„:</strong> ìœ„ ê°€ì´ë“œì—ì„œ í•´ë‹¹ ë‹¨ê³„ì˜ <strong>ì›ì¸ê³¼ í•´ê²°ì±…</strong> í™•ì¸<br>
                                        <strong>4ë‹¨ê³„:</strong> ê°€ì¥ ì´íƒˆë¥ ì´ ë†’ì€ 1-2ê°œ ì±„ë„ì— ëŒ€í•´ <strong>ì¦‰ì‹œ ê°œì„  ì‘ì—… ì‹œì‘</strong><br>
                                        <strong>5ë‹¨ê³„:</strong> 2ì£¼ í›„ ë‹¤ì‹œ ì¸¡ì •í•˜ì—¬ ì´íƒˆë¥ ì´ 10%p ì´ìƒ ê°ì†Œí–ˆëŠ”ì§€ í™•ì¸<br><br>
                                        <strong>âš¡ ë¹ ë¥¸ ê°œì„  íŒ:</strong> í•œ ë²ˆì— ëª¨ë“  ì±„ë„ì„ ê³ ì¹˜ë ¤ í•˜ì§€ ë§ˆì„¸ìš”. ì´íƒˆë¥ ì´ ê°€ì¥ ë†’ì€ 1-2ê°œ ì±„ë„ì—ë§Œ ì§‘ì¤‘í•˜ë©´ ì „ì²´ ì „í™˜ìœ¨ì´ ê·¹ì ìœ¼ë¡œ ê°œì„ ë©ë‹ˆë‹¤.
                                    </div>
                                </div>
                            </div>
                        </div>
                        </div>

                        <!-- íƒ­ 4: ì±„ë„ë³„ ì¬ë°©ë¬¸ìœ¨ vs ì´íƒˆë¥  ë§¤íŠ¸ë¦­ìŠ¤ -->
                        <div class="customer-analysis-tab-content" id="matrixTab" style="display: none;">
                        <div class="chart-section card" style="margin-bottom: 16px;">
                            <div class="chart-header">ğŸ¯ ì±„ë„ í’ˆì§ˆ ë§¤íŠ¸ë¦­ìŠ¤: ì¬ë°©ë¬¸ìœ¨ vs ì´íƒˆë¥ </div>
                            <div style="font-size: 13px; color: var(--grey-600); margin-bottom: 12px; padding: 0 24px;">
                                ì±„ë„ì„ ì¬ë°©ë¬¸ìœ¨(Yì¶•)ê³¼ ì´íƒˆë¥ (Xì¶•)ë¡œ ë¶„ë¥˜í•©ë‹ˆë‹¤. í‰ê·  ê¸°ì¤€ì„ ì„ ì¤‘ì‹¬ìœ¼ë¡œ 4ê°œ ë¶„ë©´ìœ¼ë¡œ ìë™ êµ¬ë¶„ë˜ë©°, ê° ì±„ë„ ìœ í˜•ì— ë§ëŠ” ì•¡ì…˜ í”Œëœì„ ì•„ë˜ì—ì„œ í™•ì¸í•˜ì„¸ìš”.
                            </div>
                            <div style="position: relative; height: 450px;">
                                <canvas id="channelMatrixChart"></canvas>
                            </div>

                            <!-- ì±„ë„ ìœ í˜•ë³„ ì•¡ì…˜ ê°€ì´ë“œ -->
                            <div style="margin-top: 24px; padding: 0 24px;">
                                <div style="font-size: 14px; font-weight: 600; color: var(--grey-900); margin-bottom: 16px;">
                                    ğŸ“‹ ì±„ë„ ìœ í˜•ë³„ ì•¡ì…˜ ê°€ì´ë“œ
                                </div>
                                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
                                    <!-- ìŠ¤íƒ€ ì±„ë„ -->
                                    <div style="padding: 16px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8f4 100%); border-radius: 10px; border-left: 4px solid #00c853;">
                                        <div style="font-size: 14px; font-weight: 700; color: #00c853; margin-bottom: 8px;">
                                            â­ ìŠ¤íƒ€ ì±„ë„ (ë‚®ì€ ì´íƒˆ + ë†’ì€ ì¬ë°©ë¬¸)
                                        </div>
                                        <div style="font-size: 13px; color: var(--grey-700); line-height: 1.6;">
                                            <strong>ğŸ’¡ í•´ì•¼ í•  ì¼:</strong> íˆ¬ì í™•ëŒ€ ë° í˜„ì¬ ì „ëµ ìœ ì§€<br>
                                            <strong>âœ¨ ê¸°ëŒ€ íš¨ê³¼:</strong> ì•ˆì •ì ì¸ ë§¤ì¶œ ì¦ëŒ€, ROI ê·¹ëŒ€í™”<br>
                                            <strong>ğŸ¯ êµ¬ì²´ì  í–‰ë™:</strong>
                                            <ul style="margin: 8px 0 0 20px; padding: 0;">
                                                <li>ë§ˆì¼€íŒ… ì˜ˆì‚°ì„ 20-30% ì¦ì•¡</li>
                                                <li>ìœ ì‚¬í•œ íƒ€ê²Ÿ ì˜¤ë””ì–¸ìŠ¤ë¡œ í™•ì¥</li>
                                                <li>ì„±ê³µ ìš”ì¸ ë¶„ì„ í›„ ë‹¤ë¥¸ ì±„ë„ì— ì ìš©</li>
                                                <li>ê³ ê° ì¶”ì²œ í”„ë¡œê·¸ë¨ ìš´ì˜</li>
                                            </ul>
                                        </div>
                                    </div>

                                    <!-- ì„±ì¥ ì±„ë„ -->
                                    <div style="padding: 16px; background: linear-gradient(135deg, #e3f2fd 0%, #f1f8fc 100%); border-radius: 10px; border-left: 4px solid #2196f3;">
                                        <div style="font-size: 14px; font-weight: 700; color: #2196f3; margin-bottom: 8px;">
                                            ğŸ“ˆ ì„±ì¥ ì±„ë„ (ë†’ì€ ì´íƒˆ + ë†’ì€ ì¬ë°©ë¬¸)
                                        </div>
                                        <div style="font-size: 13px; color: var(--grey-700); line-height: 1.6;">
                                            <strong>ğŸ’¡ í•´ì•¼ í•  ì¼:</strong> ì´íƒˆë¥  ê°œì„ ì— ì§‘ì¤‘<br>
                                            <strong>âœ¨ ê¸°ëŒ€ íš¨ê³¼:</strong> ì „í™˜ìœ¨ ìƒìŠ¹, ì‹ ê·œ ê³ ê° í™•ë³´<br>
                                            <strong>ğŸ¯ êµ¬ì²´ì  í–‰ë™:</strong>
                                            <ul style="margin: 8px 0 0 20px; padding: 0;">
                                                <li>ëœë”© í˜ì´ì§€ ê°œì„  (ë¡œë”© ì†ë„, ë””ìì¸)</li>
                                                <li>ì²« ë°©ë¬¸ ê³ ê° ê²½í—˜ ìµœì í™”</li>
                                                <li>ëª…í™•í•œ CTA(í–‰ë™ ìœ ë„) ë²„íŠ¼ ë°°ì¹˜</li>
                                                <li>ì‹ ë¢° ìš”ì†Œ ê°•í™” (ë¦¬ë·°, ë³´ì•ˆ ì¸ì¦)</li>
                                            </ul>
                                        </div>
                                    </div>

                                    <!-- ì•ˆì • ì±„ë„ -->
                                    <div style="padding: 16px; background: linear-gradient(135deg, #f5f5f5 0%, #fafafa 100%); border-radius: 10px; border-left: 4px solid #9e9e9e;">
                                        <div style="font-size: 14px; font-weight: 700; color: #757575; margin-bottom: 8px;">
                                            ğŸ”’ ì•ˆì • ì±„ë„ (ë‚®ì€ ì´íƒˆ + ë‚®ì€ ì¬ë°©ë¬¸)
                                        </div>
                                        <div style="font-size: 13px; color: var(--grey-700); line-height: 1.6;">
                                            <strong>ğŸ’¡ í•´ì•¼ í•  ì¼:</strong> ì¬ë°©ë¬¸ ìœ ë„ ì „ëµ êµ¬ì¶•<br>
                                            <strong>âœ¨ ê¸°ëŒ€ íš¨ê³¼:</strong> ê³ ê° ìƒì• ê°€ì¹˜(LTV) ì¦ê°€<br>
                                            <strong>ğŸ¯ êµ¬ì²´ì  í–‰ë™:</strong>
                                            <ul style="margin: 8px 0 0 20px; padding: 0;">
                                                <li>ë¦¬íƒ€ê²ŸíŒ… ê´‘ê³  ìº í˜ì¸ ìš´ì˜</li>
                                                <li>ì´ë©”ì¼/SMS ë§ˆì¼€íŒ… ìë™í™”</li>
                                                <li>ì¿ í°/í• ì¸ í”„ë¡œëª¨ì…˜ ì œê³µ</li>
                                                <li>íšŒì› ë“±ê¸‰ì œ ë° í¬ì¸íŠ¸ ì ë¦½ ë„ì…</li>
                                            </ul>
                                        </div>
                                    </div>

                                    <!-- ë¬¸ì œ ì±„ë„ -->
                                    <div style="padding: 16px; background: linear-gradient(135deg, #ffebee 0%, #fff5f5 100%); border-radius: 10px; border-left: 4px solid #ff5722;">
                                        <div style="font-size: 14px; font-weight: 700; color: #ff5722; margin-bottom: 8px;">
                                            âš ï¸ ë¬¸ì œ ì±„ë„ (ë†’ì€ ì´íƒˆ + ë‚®ì€ ì¬ë°©ë¬¸)
                                        </div>
                                        <div style="font-size: 13px; color: var(--grey-700); line-height: 1.6;">
                                            <strong>ğŸ’¡ í•´ì•¼ í•  ì¼:</strong> ì „ë©´ ì¬ê²€í†  ë˜ëŠ” ì¤‘ë‹¨<br>
                                            <strong>âœ¨ ê¸°ëŒ€ íš¨ê³¼:</strong> ë¹„ìš© ì ˆê°, íš¨ìœ¨ì  ìì› ë°°ë¶„<br>
                                            <strong>ğŸ¯ êµ¬ì²´ì  í–‰ë™:</strong>
                                            <ul style="margin: 8px 0 0 20px; padding: 0;">
                                                <li>íƒ€ê²Ÿ ì˜¤ë””ì–¸ìŠ¤ ì¬ì„¤ì •</li>
                                                <li>ê´‘ê³  í¬ë¦¬ì—ì´í‹°ë¸Œ ì „ë©´ êµì²´</li>
                                                <li>ì˜ˆì‚° ì¶•ì†Œ ë˜ëŠ” ì¼ì‹œ ì¤‘ë‹¨</li>
                                                <li>A/B í…ŒìŠ¤íŠ¸ë¡œ ê°œì„  ê°€ëŠ¥ì„± ê²€ì¦</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>

                                <!-- ì¶”ê°€ íŒ -->
                                <div style="margin-top: 16px; padding: 12px 16px; background: var(--primary-light); border-radius: 8px; border-left: 4px solid var(--primary-main);">
                                    <div style="font-size: 13px; color: var(--grey-800); line-height: 1.6;">
                                        <strong>ğŸ’¡ í”„ë¡œ íŒ:</strong> ëª¨ë“  ì±„ë„ì„ í•œ ë²ˆì— ë³€ê²½í•˜ì§€ ë§ˆì„¸ìš”. í•œ ë²ˆì— 1-2ê°œ ì±„ë„ì— ì§‘ì¤‘í•˜ì—¬ ê°œì„ í•˜ê³ , 2-4ì£¼ í›„ ê²°ê³¼ë¥¼ ì¸¡ì •í•œ ë’¤ ë‹¤ìŒ ì±„ë„ë¡œ ë„˜ì–´ê°€ëŠ” ê²ƒì´ íš¨ê³¼ì ì…ë‹ˆë‹¤.
                                    </div>
                                </div>
                            </div>
                        </div>
                        </div>

                        <!-- íƒ­ 5: ì±„ë„ë³„ ì°¸ì—¬ë„ ë¶„ì„ -->
                        <div class="customer-analysis-tab-content" id="engagementTab" style="display: none;">
                        <div class="chart-section card">
                            <div class="chart-header">ğŸ’ ì±„ë„ë³„ ê³ ê° ì°¸ì—¬ë„: ì–´ë–¤ ì±„ë„ì´ ì§„ì§œ ê´€ì‹¬ ìˆëŠ” ê³ ê°ì„ ë°ë ¤ì˜¤ë‚˜ìš”?</div>

                            <!-- ì„¤ëª… -->
                            <div style="font-size: 13px; color: var(--grey-600); margin-bottom: 16px; padding: 0 24px; line-height: 1.7;">
                                <strong>ì°¸ì—¬ë„(Engagement Rate)ë€?</strong><br>
                                ë°©ë¬¸ì ì¤‘ ì‹¤ì œë¡œ ì›¹ì‚¬ì´íŠ¸ë¥¼ ì ê·¹ì ìœ¼ë¡œ ì‚¬ìš©í•œ ë¹„ìœ¨ì…ë‹ˆë‹¤. ë‹¨ìˆœ í´ë¦­ ì‹¤ìˆ˜ë‚˜ ì¦‰ì‹œ ì´íƒˆí•œ ë°©ë¬¸ì´ ì•„ë‹ˆë¼,
                                <strong>í˜ì´ì§€ë¥¼ ì—¬ëŸ¬ ê°œ ë³´ê±°ë‚˜ ì¼ì • ì‹œê°„ ì´ìƒ ë¨¸ë¬¸ "ì§„ì§œ ê´€ì‹¬ ìˆëŠ”" ê³ ê°ì˜ ë¹„ìœ¨</strong>ì…ë‹ˆë‹¤.
                                <strong>ì°¨íŠ¸ ìœ„ì— ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë¦¬ë©´</strong> ë” ìì„¸í•œ ë¶„ì„ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                            </div>

                            <!-- ì°¸ì—¬ë„ ìë™ ì¸ì‚¬ì´íŠ¸ -->
                            <div id="engagementInsightSummary" style="margin: 0 24px 16px 24px; padding: 16px; background: linear-gradient(135deg, #f3e5f5 0%, #fce4ec 100%); border-radius: 10px; border-left: 4px solid #9c27b0;">
                                <div style="font-size: 13px; font-weight: 600; color: #9c27b0; margin-bottom: 8px;">
                                    ğŸ’¡ ì°¸ì—¬ë„ ë¶„ì„ ê²°ê³¼
                                </div>
                                <div id="engagementInsightText" style="font-size: 13px; color: var(--grey-800); line-height: 1.6;">
                                    ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                                </div>
                            </div>

                            <div class="chart-container-small" style="position: relative;">
                                <canvas id="channelEngagementChart"></canvas>
                            </div>

                            <!-- ì°¸ì—¬ë„ í•´ì„ ê°€ì´ë“œ -->
                            <div style="margin-top: 20px; padding: 0 24px;">
                                <div style="font-size: 14px; font-weight: 600; color: var(--grey-900); margin-bottom: 12px;">
                                    ğŸ“‹ ì°¸ì—¬ë„ ìˆ˜ì¹˜ í•´ì„ ê°€ì´ë“œ
                                </div>
                                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 16px;">
                                    <!-- ë†’ì€ ì°¸ì—¬ë„ -->
                                    <div style="padding: 14px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8f4 100%); border-radius: 8px; border-left: 3px solid #00c853;">
                                        <div style="font-size: 13px; font-weight: 600; color: #00c853; margin-bottom: 6px;">
                                            ğŸŒŸ ë†’ìŒ (60% ì´ìƒ)
                                        </div>
                                        <div style="font-size: 12px; color: var(--grey-700); line-height: 1.5;">
                                            <strong>ì˜ë¯¸:</strong> ë§¤ìš° ì§ˆ ì¢‹ì€ íŠ¸ë˜í”½. ê´€ì‹¬ë„ ë†’ì€ ê³ ê°ì„ ë°ë ¤ì˜¤ê³  ìˆìŠµë‹ˆë‹¤.<br>
                                            <strong>í–‰ë™:</strong> ì´ ì±„ë„ì— ì˜ˆì‚°ì„ ë” íˆ¬ìí•˜ì„¸ìš”. ì„±ê³µ ìš”ì¸ì„ ë¶„ì„í•˜ì—¬ ë‹¤ë¥¸ ì±„ë„ì—ë„ ì ìš©í•˜ì„¸ìš”.
                                        </div>
                                    </div>

                                    <!-- ì¤‘ê°„ ì°¸ì—¬ë„ -->
                                    <div style="padding: 14px; background: linear-gradient(135deg, #fff3e0 0%, #fff9e6 100%); border-radius: 8px; border-left: 3px solid #ff9800;">
                                        <div style="font-size: 13px; font-weight: 600; color: #f57c00; margin-bottom: 6px;">
                                            âš–ï¸ ë³´í†µ (40-60%)
                                        </div>
                                        <div style="font-size: 12px; color: var(--grey-700); line-height: 1.5;">
                                            <strong>ì˜ë¯¸:</strong> í‰ê· ì ì¸ íŠ¸ë˜í”½. ê°œì„  ì—¬ì§€ê°€ ìˆìŠµë‹ˆë‹¤.<br>
                                            <strong>í–‰ë™:</strong> ëœë”© í˜ì´ì§€ë¥¼ ìµœì í™”í•˜ê±°ë‚˜ íƒ€ê²ŸíŒ…ì„ ì¡°ì •í•˜ì„¸ìš”. A/B í…ŒìŠ¤íŠ¸ë¡œ ì°¸ì—¬ë„ í–¥ìƒì„ ì‹œë„í•˜ì„¸ìš”.
                                        </div>
                                    </div>

                                    <!-- ë‚®ì€ ì°¸ì—¬ë„ -->
                                    <div style="padding: 14px; background: linear-gradient(135deg, #ffebee 0%, #fff5f5 100%); border-radius: 8px; border-left: 3px solid #ff5722;">
                                        <div style="font-size: 13px; font-weight: 600; color: #ff5722; margin-bottom: 6px;">
                                            âš ï¸ ë‚®ìŒ (40% ë¯¸ë§Œ)
                                        </div>
                                        <div style="font-size: 12px; color: var(--grey-700); line-height: 1.5;">
                                            <strong>ì˜ë¯¸:</strong> í’ˆì§ˆì´ ë‚®ì€ íŠ¸ë˜í”½. ì˜ëª»ëœ ê³ ê°ì¸µì´ ìœ ì…ë˜ê³  ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                                            <strong>í–‰ë™:</strong> ê´‘ê³  íƒ€ê²ŸíŒ…ì„ ì¬ê²€í† í•˜ê±°ë‚˜ ì˜ˆì‚°ì„ ì¤„ì´ì„¸ìš”. ê´‘ê³  ë©”ì‹œì§€ì™€ ëœë”© í˜ì´ì§€ì˜ ì¼ì¹˜ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ì„¸ìš”.
                                        </div>
                                    </div>
                                </div>

                                <!-- ì¶”ê°€ íŒ -->
                                <div style="padding: 14px; background: linear-gradient(135deg, #e3f2fd 0%, #f1f8fc 100%); border-radius: 8px; border-left: 3px solid #2196f3;">
                                    <div style="font-size: 13px; font-weight: 600; color: #2196f3; margin-bottom: 6px;">
                                        ğŸ’¡ ì°¸ì—¬ë„ì™€ ì „í™˜ìœ¨ì˜ ê´€ê³„
                                    </div>
                                    <div style="font-size: 12px; color: var(--grey-700); line-height: 1.6;">
                                        <strong>í•µì‹¬:</strong> ì°¸ì—¬ë„ê°€ ë†’ìœ¼ë©´ ì „í™˜ìœ¨ë„ ë†’ì•„ì§‘ë‹ˆë‹¤. ì°¸ì—¬ë„ê°€ ë‚®ì€ ì±„ë„ì€ ë°©ë¬¸ì ìˆ˜ê°€ ë§ì•„ë„ ì‹¤ì œ ë§¤ì¶œì€ ì ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                                        ë”°ë¼ì„œ ë‹¨ìˆœíˆ í´ë¦­ ìˆ˜ë§Œ ë³´ì§€ ë§ê³ , <strong>ì°¸ì—¬ë„ì™€ ì „í™˜ìœ¨ì„ í•¨ê»˜ ê³ ë ¤</strong>í•˜ì—¬ ì˜ˆì‚°ì„ ë°°ë¶„í•˜ì„¸ìš”.<br><br>
                                        <strong>ì˜ˆì‹œ:</strong> Aì±„ë„ì€ ë°©ë¬¸ì 1,000ëª…ì— ì°¸ì—¬ë„ 30%, Bì±„ë„ì€ ë°©ë¬¸ì 500ëª…ì— ì°¸ì—¬ë„ 70%ë¼ë©´,
                                        ì‹¤ì œë¡œ Bì±„ë„ì´ ë” ë§ì€ ë§¤ì¶œì„ ê°€ì ¸ì˜¬ ê°€ëŠ¥ì„±ì´ í½ë‹ˆë‹¤.
                                    </div>
                                </div>

                                <!-- ì‹¤í–‰ ì²´í¬ë¦¬ìŠ¤íŠ¸ -->
                                <div style="margin-top: 12px; padding: 14px; background: var(--primary-light); border-radius: 8px; border-left: 3px solid var(--primary-main);">
                                    <div style="font-size: 13px; font-weight: 600; color: var(--primary-main); margin-bottom: 8px;">
                                        âœ… ì§€ê¸ˆ ë°”ë¡œ ì‹¤í–‰í•  ì²´í¬ë¦¬ìŠ¤íŠ¸
                                    </div>
                                    <div style="font-size: 12px; color: var(--grey-700); line-height: 1.6;">
                                        1. <strong>ì°¸ì—¬ë„ ìƒìœ„ 3ê°œ ì±„ë„</strong>ì˜ ê³µí†µì ì„ ì°¾ì•„ ë‹¤ë¥¸ ì±„ë„ì— ì ìš©<br>
                                        2. <strong>ì°¸ì—¬ë„ í•˜ìœ„ 3ê°œ ì±„ë„</strong>ì˜ ê´‘ê³  íƒ€ê²ŸíŒ… ë˜ëŠ” ëœë”© í˜ì´ì§€ ì ê²€<br>
                                        3. ì°¸ì—¬ë„ê°€ ë†’ì§€ë§Œ ì „í™˜ìœ¨ì´ ë‚®ì€ ì±„ë„ì´ ìˆë‹¤ë©´ <strong>ê²°ì œ í”„ë¡œì„¸ìŠ¤ë‚˜ ê°€ê²© ì •ì±…</strong> ê°œì„ <br>
                                        4. ì°¸ì—¬ë„ê°€ ë‚®ì€ ì±„ë„ì€ ì˜ˆì‚°ì„ ì¤„ì´ê³ , ì°¸ì—¬ë„ê°€ ë†’ì€ ì±„ë„ì— ì¬íˆ¬ì
                                    </div>
                                </div>
                            </div>
                        </div>
                        </div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <!-- ì „ì—­ íˆ´íŒ (ëª¨ë“  ì°¨íŠ¸ì—ì„œ ì‚¬ìš©) -->
    <div id="kpiChartTooltip" class="chart-insight-tooltip"></div>
    <div id="compareChartTooltip" class="chart-insight-tooltip"></div>
    <div id="customerTrendTooltip" class="chart-insight-tooltip"></div>
    <div id="churnChartTooltip" class="chart-insight-tooltip"></div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let dailyData = [];
        let weeklyData = [];
        let channelData = [];
        let newVsReturningData = [];
        let channelEngagementData = [];
        let newVsReturningConversionData = [];
        let insightsData = null;
        let currentPeriod = 'full';  // ë°ì´í„° ê¸°ë°˜ ì˜ì‚¬ê²°ì • ë„êµ¬ ê¸°ê°„ í•„í„°
        let insightPeriod = 'full'; // ì¸ì‚¬ì´íŠ¸ & ì±„ë„ ì „ëµ ê¸°ê°„ í•„í„° (ë…ë¦½)
        let microSegmentPeriod = 'full'; // ìœ í˜•ë³„ ì¡°ì¹˜ ê°€ì´ë“œ ê¸°ê°„ í•„í„° (ë…ë¦½)

        // í˜„ì¬ ì„ íƒëœ ê¸°ê°„ì˜ ë°ì´í„° ë°˜í™˜ (ë°ì´í„° ê¸°ë°˜ ì˜ì‚¬ê²°ì • ë„êµ¬ìš©)
        function getPeriodData() {
            if (!insightsData || !insightsData.by_period) {
                return insightsData;  // ì´ì „ êµ¬ì¡° í˜¸í™˜
            }
            return insightsData.by_period[currentPeriod] || insightsData.by_period['full'];
        }

        // ì¸ì‚¬ì´íŠ¸ & ì±„ë„ ì „ëµ ì„¹ì…˜ìš© ê¸°ê°„ ë°ì´í„° ë°˜í™˜
        function getInsightPeriodData() {
            if (!insightsData || !insightsData.by_period) {
                return insightsData;  // ì´ì „ êµ¬ì¡° í˜¸í™˜
            }
            return insightsData.by_period[insightPeriod] || insightsData.by_period['full'];
        }

        // ìœ í˜•ë³„ ì¡°ì¹˜ ê°€ì´ë“œ ì„¹ì…˜ìš© ê¸°ê°„ ë°ì´í„° ë°˜í™˜
        function getMicroSegmentPeriodData() {
            if (!insightsData || !insightsData.by_period) {
                return insightsData;  // ì´ì „ êµ¬ì¡° í˜¸í™˜
            }
            return insightsData.by_period[microSegmentPeriod] || insightsData.by_period['full'];
        }

        // ì´íƒˆ ë¶„ì„ ë°ì´í„° (ì „ì²´ ê¸°ê°„ë§Œ ì‚¬ìš©)
        function getChurnData() {
            if (!insightsData) return null;
            return insightsData.churn_analysis || {
                churn_predictions_7d: [],
                churn_predictions_30d: [],
                improvement_predictions_7d: [],
                improvement_predictions_30d: [],
                crm_actions: []
            };
        }
        let newVsReturningView = 'monthly';
        let currentKpiType = 'cvr';
        let currentChurnStage = 'avg';
        let currentChurnSort = 'desc';
        let currentChannelFunnel = 'purchase';

        // í…Œì´ë¸” ì •ë ¬ ìƒíƒœ
        let channelTableSort = {
            column: 'ìœ ì…',
            direction: 'desc'  // 'asc' ë˜ëŠ” 'desc'
        };

        // Chart.js ì¸ìŠ¤í„´ìŠ¤ (D3 í¼ë„ì€ ì¬ìƒì„± ë°©ì‹ ì‚¬ìš©)
        let channelKpiChart = null;
        let channelChurnChart = null;
        let channelCompareChart = null;
        let campaignChart = null;
        let newVsReturningChart = null;
        let returnRateTrendChart = null;
        let customerTrendChart = null; // í†µí•© ì‹ ê·œ/ì¬ë°©ë¬¸ ì¶”ì„¸ ì°¨íŠ¸
        let newVsReturningConversionChart = null;
        let channelMatrixChart = null;
        let channelEngagementChart = null;

        // ìˆ«ì í¬ë§·
        function formatNumber(num) {
            if (num === 0 || num === null || num === undefined) return '0';
            return Math.round(num).toLocaleString('ko-KR');
        }

        // ì†Œìˆ˜ì  í¬ë§·
        function formatDecimal(num) {
            if (num === 0 || num === null || num === undefined || !isFinite(num)) return '0';
            return num.toLocaleString('ko-KR', { minimumFractionDigits: 0, maximumFractionDigits: 2 });
        }

        // CSV íŒŒì‹± (RFC 4180 í˜¸í™˜)
        function parseCSV(text, filename = 'unknown') {
            console.log(`=== parseCSV ì‹œì‘: ${filename} ===`);

            // BOM (Byte Order Mark) ì œê±°
            const originalFirstChar = text.charCodeAt(0);
            text = text.replace(/^\uFEFF/, '');

            if (originalFirstChar === 0xFEFF) {
                console.log('BOM ë¬¸ì ì œê±°ë¨');
            }

            const lines = text.trim().split('\n');
            console.log(`ì´ ë¼ì¸ ìˆ˜: ${lines.length}`);

            // RFC 4180 í˜¸í™˜ CSV íŒŒì‹±
            function parseLine(line) {
                const result = [];
                let current = '';
                let inQuotes = false;

                for (let i = 0; i < line.length; i++) {
                    const char = line[i];
                    const nextChar = line[i + 1];

                    if (char === '"') {
                        if (inQuotes && nextChar === '"') {
                            // ì—°ì†ëœ ë”°ì˜´í‘œëŠ” ì´ìŠ¤ì¼€ì´í”„ëœ ë”°ì˜´í‘œ
                            current += '"';
                            i++; // ë‹¤ìŒ ë”°ì˜´í‘œ ê±´ë„ˆë›°ê¸°
                        } else {
                            // ë”°ì˜´í‘œ ì‹œì‘/ì¢…ë£Œ
                            inQuotes = !inQuotes;
                        }
                    } else if (char === ',' && !inQuotes) {
                        // ë”°ì˜´í‘œ ë°–ì˜ ì‰¼í‘œëŠ” êµ¬ë¶„ì
                        result.push(current);
                        current = '';
                    } else {
                        current += char;
                    }
                }

                // ë§ˆì§€ë§‰ í•„ë“œ ì¶”ê°€
                result.push(current);
                return result;
            }

            const headers = parseLine(lines[0]);
            console.log('ì›ë³¸ í—¤ë”:', headers);

            const cleanHeaders = headers.map(h => h.replace(/^\uFEFF/, '').trim());
            console.log('ì •ë¦¬ëœ í—¤ë”:', cleanHeaders);

            const data = [];

            for (let i = 1; i < lines.length; i++) {
                const values = parseLine(lines[i]);
                if (values.length === cleanHeaders.length) {
                    const row = {};
                    cleanHeaders.forEach((header, index) => {
                        row[header] = values[index].trim();
                    });
                    data.push(row);
                }
            }

            console.log(`íŒŒì‹±ëœ ë°ì´í„° í–‰ ìˆ˜: ${data.length}`);
            if (data.length > 0) {
                console.log('ì²« ë²ˆì§¸ í–‰ ë°ì´í„°:', data[0]);

                const allKeys = Object.keys(data[0]);
                console.log('ì²« ë²ˆì§¸ í–‰ì˜ ëª¨ë“  í‚¤ (' + allKeys.length + 'ê°œ):', allKeys);

                // ê° í‚¤ë¥¼ ê°œë³„ì ìœ¼ë¡œ ì¶œë ¥í•˜ì—¬ ì •í™•í•œ í•„ë“œëª… í™•ì¸
                console.log('=== í•„ë“œëª… ìƒì„¸ ë¶„ì„ ===');
                allKeys.forEach((key, index) => {
                    console.log(`  [${index}] "${key}" (ê¸¸ì´: ${key.length}, ê°’ ìƒ˜í”Œ: "${data[0][key]}")`);
                });

                // ë‚ ì§œ í•„ë“œ í™•ì¸
                const dateFields = ['Day', 'week', 'date', 'Date', 'ì¼ì'];
                const foundDateField = dateFields.find(field => data[0][field] !== undefined);
                if (foundDateField) {
                    console.log(`âœ“ ë‚ ì§œ í•„ë“œ ë°œê²¬: "${foundDateField}" = "${data[0][foundDateField]}"`);
                } else {
                    console.warn('âŒ ë‚ ì§œ í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
                    console.warn('ì°¾ìœ¼ë ¤ê³  ì‹œë„í•œ í•„ë“œëª…:', dateFields);
                    console.warn('ì‹¤ì œ ì¡´ì¬í•˜ëŠ” í•„ë“œëª…:', allKeys);

                    // ìœ ì‚¬í•œ í•„ë“œëª… ì°¾ê¸°
                    const similarFields = allKeys.filter(key =>
                        key.toLowerCase().includes('day') ||
                        key.toLowerCase().includes('week') ||
                        key.toLowerCase().includes('date') ||
                        key.includes('ì¼ì')
                    );
                    if (similarFields.length > 0) {
                        console.log('âš ï¸ ìœ ì‚¬í•œ í•„ë“œëª… ë°œê²¬:', similarFields);
                    }
                }

                console.log('ë§ˆì§€ë§‰ í–‰ ë°ì´í„°:', data[data.length - 1]);
            } else {
                console.warn('íŒŒì‹±ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤!');
            }

            console.log(`=== parseCSV ì™„ë£Œ: ${filename} ===\n`);
            return data;
        }

        // ë°ì´í„° ë¡œë“œ
        async function loadData() {
            console.log('========================================');
            console.log('=== ë°ì´í„° ë¡œë“œ ì‹œì‘ ===');
            console.log('========================================\n');

            try {
                // ì±„ë„ë³„ ì¼ë³„ ë°ì´í„° (singleFunnelView, compareFunnelViewìš©)
                console.log('ì±„ë„ë³„ ì¼ë³„ ë°ì´í„° ë¡œë”© ì¤‘...');
                const dailyResponse = await fetch('funnel/channel_daily_funnel.csv');
                const dailyText = await dailyResponse.text();
                dailyData = parseCSV(dailyText, 'channel_daily_funnel.csv');
                console.log(`âœ“ ì±„ë„ë³„ ì¼ë³„ ë°ì´í„° ë¡œë“œ ì™„ë£Œ: ${dailyData.length}ê°œ í–‰\n`);

                // ì£¼ë³„ ë°ì´í„°
                console.log('ì£¼ë³„ ë°ì´í„° ë¡œë”© ì¤‘...');
                const weeklyResponse = await fetch('funnel/weekly_funnel.csv');
                const weeklyText = await weeklyResponse.text();
                weeklyData = parseCSV(weeklyText, 'weekly_funnel.csv');
                console.log(`âœ“ ì£¼ë³„ ë°ì´í„° ë¡œë“œ ì™„ë£Œ: ${weeklyData.length}ê°œ í–‰\n`);

                // ì±„ë„ë³„ ë°ì´í„°
                const channelResponse = await fetch('funnel/channel_funnel.csv');
                const channelText = await channelResponse.text();
                channelData = parseCSV(channelText, 'channel_funnel.csv');

                // ì‹ ê·œ vs ì¬ë°©ë¬¸
                const newVsReturningResponse = await fetch('funnel/new_vs_returning.csv');
                const newVsReturningText = await newVsReturningResponse.text();
                newVsReturningData = parseCSV(newVsReturningText, 'new_vs_returning.csv');

                // ì±„ë„ ì°¸ì—¬ë„ ë°ì´í„°
                const channelEngagementResponse = await fetch('funnel/channel_engagement.csv');
                const channelEngagementText = await channelEngagementResponse.text();
                channelEngagementData = parseCSV(channelEngagementText, 'channel_engagement.csv');

                // ì‹ ê·œ vs ì¬ë°©ë¬¸ ì „í™˜ìœ¨ ë°ì´í„°
                const newVsReturningConversionResponse = await fetch('funnel/new_vs_returning_conversion.csv');
                const newVsReturningConversionText = await newVsReturningConversionResponse.text();
                newVsReturningConversionData = parseCSV(newVsReturningConversionText, 'new_vs_returning_conversion.csv');

                // ì¸ì‚¬ì´íŠ¸
                const insightsResponse = await fetch('funnel/insights.json');
                insightsData = await insightsResponse.json();

                console.log('========================================');
                console.log('=== ëª¨ë“  ë°ì´í„° ë¡œë“œ ì™„ë£Œ ===');
                console.log(`ì¼ë³„ ë°ì´í„°: ${dailyData.length}ê°œ`);
                console.log(`ì£¼ë³„ ë°ì´í„°: ${weeklyData.length}ê°œ`);
                console.log(`ì±„ë„ ì°¸ì—¬ë„ ë°ì´í„°: ${channelEngagementData.length}ê°œ`);
                console.log(`ì‹ ê·œ vs ì¬ë°©ë¬¸ ì „í™˜ìœ¨ ë°ì´í„°: ${newVsReturningConversionData.length}ê°œ`);
                console.log('========================================\n');

                updateDashboard();
            } catch (error) {
                console.error('âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸
        function updateDashboard() {
            console.log('========================================');
            console.log('=== updateDashboard í˜¸ì¶œ ===');
            console.log(`dailyData: ${dailyData.length}ê°œ, weeklyData: ${weeklyData.length}ê°œ`);
            console.log('========================================\n');

            updateAnalysisPeriod();
            updateSummaryCardBanner();
            updateKPISummary();
            updateFunnelChart();
            updateInsights();
            updateUrgentAlerts();
            updateMicroSegmentAlerts();
            setupTrendPeriodButtons();
            updateTrendPeriodIndicator('7d');
            renderPerformanceTrends('7d');
            updateAdvancedAnalysis();
            updateKpiChart('cvr');
            updateChurnChart();
            updateCompareChart();
            updateCampaignChart('purchase');
            updateCustomerTrendChart();
            updateNewVsReturningConversionChart();
            updateChannelMatrixChart();
            updateChannelEngagementChart();
            updateChannelTable();
            updatePeriodDateRange();
            updateInsightPeriodDateRange();
            updateMicroSegmentPeriodDateRange();
        }

        // ê¸°ê°„ ì „í™˜ í•¨ìˆ˜
        function switchPeriod(period) {
            currentPeriod = period;

            // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.period-filter-btn').forEach(btn => {
                if (btn.dataset.period === period) {
                    btn.style.background = '#673ab7';
                    btn.style.color = 'white';
                    btn.style.borderColor = '#673ab7';
                    btn.classList.add('active');
                } else {
                    btn.style.background = 'white';
                    btn.style.color = '#495057';
                    btn.style.borderColor = '#dee2e6';
                    btn.classList.remove('active');
                }
            });

            // ë‚ ì§œ ë²”ìœ„ í‘œì‹œ ì—…ë°ì´íŠ¸
            updatePeriodDateRange();

            // ê¸°ê°„ í•„í„°ê°€ ì ìš©ë˜ëŠ” ëª¨ë“  íƒ­ ë‹¤ì‹œ ë Œë”ë§
            updateInsights();
            updateUrgentAlerts();
            updateAdvancedAnalysis();
        }

        // ì¸ì‚¬ì´íŠ¸ & ì±„ë„ ì „ëµ ì„¹ì…˜ ì „ìš© ê¸°ê°„ ì „í™˜ í•¨ìˆ˜
        function switchInsightPeriod(period) {
            insightPeriod = period;

            // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸ (ê¸°ê°„ í•„í„° ë²„íŠ¼ê³¼ ë™ì¼í•œ ë””ìì¸)
            document.querySelectorAll('.insight-period-btn').forEach(btn => {
                if (btn.dataset.period === period) {
                    btn.style.background = '#673ab7';
                    btn.style.color = 'white';
                    btn.style.borderColor = '#673ab7';
                    btn.classList.add('active');
                } else {
                    btn.style.background = 'white';
                    btn.style.color = '#495057';
                    btn.style.borderColor = '#dee2e6';
                    btn.classList.remove('active');
                }
            });

            // ë‚ ì§œ ë²”ìœ„ í‘œì‹œ ì—…ë°ì´íŠ¸
            updateInsightPeriodDateRange();

            // ì¸ì‚¬ì´íŠ¸ & ì±„ë„ ì „ëµ ì„¹ì…˜ë§Œ ë‹¤ì‹œ ë Œë”ë§
            updateInsights();
            updateUrgentAlerts();
        }

        // ì¸ì‚¬ì´íŠ¸ ì„¹ì…˜ ë‚ ì§œ ë²”ìœ„ í‘œì‹œ
        function updateInsightPeriodDateRange() {
            const periodData = getInsightPeriodData();
            if (periodData && periodData.overall && periodData.overall.current_period) {
                const { start_date, end_date } = periodData.overall.current_period;
                const dateRangeEl = document.getElementById('insightPeriodDateRange');
                if (dateRangeEl) {
                    const start = new Date(start_date);
                    const end = new Date(end_date);
                    const diffTime = Math.abs(end - start);
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
                    dateRangeEl.textContent = `${start_date} ~ ${end_date} (${diffDays}ì¼)`;
                }
            }
        }

        // ìœ í˜•ë³„ ì¡°ì¹˜ ê°€ì´ë“œ ì„¹ì…˜ ì „ìš© ê¸°ê°„ ì „í™˜ í•¨ìˆ˜
        function switchMicroSegmentPeriod(period) {
            microSegmentPeriod = period;

            // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.micro-segment-period-btn').forEach(btn => {
                if (btn.dataset.period === period) {
                    btn.style.background = '#673ab7';
                    btn.style.color = 'white';
                    btn.style.borderColor = '#673ab7';
                    btn.classList.add('active');
                } else {
                    btn.style.background = 'white';
                    btn.style.color = '#495057';
                    btn.style.borderColor = '#dee2e6';
                    btn.classList.remove('active');
                }
            });

            // ë‚ ì§œ ë²”ìœ„ í‘œì‹œ ì—…ë°ì´íŠ¸
            updateMicroSegmentPeriodDateRange();

            // ìœ í˜•ë³„ ì¡°ì¹˜ ê°€ì´ë“œ ì„¹ì…˜ë§Œ ë‹¤ì‹œ ë Œë”ë§
            updateMicroSegmentAlerts();
        }

        // ìœ í˜•ë³„ ì¡°ì¹˜ ê°€ì´ë“œ ì„¹ì…˜ ë‚ ì§œ ë²”ìœ„ í‘œì‹œ
        function updateMicroSegmentPeriodDateRange() {
            const periodData = getMicroSegmentPeriodData();
            if (periodData && periodData.overall && periodData.overall.current_period) {
                const { start_date, end_date } = periodData.overall.current_period;
                const dateRangeEl = document.getElementById('microSegmentPeriodDateRange');
                if (dateRangeEl) {
                    const start = new Date(start_date);
                    const end = new Date(end_date);
                    const diffTime = Math.abs(end - start);
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
                    dateRangeEl.textContent = `${start_date} ~ ${end_date} (${diffDays}ì¼)`;
                }
            }
        }

        // ì„ íƒëœ ê¸°ê°„ì˜ ë‚ ì§œ ë²”ìœ„ í‘œì‹œ
        function updatePeriodDateRange() {
            const periodData = getPeriodData();
            if (periodData && periodData.overall && periodData.overall.current_period) {
                const { start_date, end_date } = periodData.overall.current_period;
                const dateRangeEl = document.getElementById('periodDateRange');
                if (dateRangeEl) {
                    // ì¼ìˆ˜ ê³„ì‚°
                    const start = new Date(start_date);
                    const end = new Date(end_date);
                    const diffTime = Math.abs(end - start);
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
                    dateRangeEl.textContent = `${start_date} ~ ${end_date} (${diffDays}ì¼)`;
                }
            }
        }

        // ë¶„ì„ ê¸°ê°„ ì—…ë°ì´íŠ¸
        function updateAnalysisPeriod() {
            const periodData = getPeriodData();
            if (!periodData || !periodData.overall) return;

            const { start_date, end_date } = periodData.overall.current_period;
            document.getElementById('analysisPeriod').textContent = `(${start_date} ~ ${end_date})`;
        }

        // summary_card ë°°ë„ˆ ì—…ë°ì´íŠ¸
        function updateSummaryCardBanner() {
            const periodData = getPeriodData();
            if (!periodData || !periodData.summary_card) return;

            const banner = document.getElementById('summaryCardBanner');
            const card = periodData.summary_card;

            document.getElementById('summaryCardTitle').textContent = card.title || 'ì´ë²ˆ ë‹¬ ì„±ê³¼ ìš”ì•½';
            document.getElementById('summaryCardMessage').textContent = card.status_message || '';
            document.getElementById('summaryCardVisitors').textContent = card.visitors_text || '-';
            document.getElementById('summaryCardPurchasers').textContent = card.purchasers_text || '-';
            document.getElementById('summaryCardCVR').textContent = card.cvr_text || '-';

            banner.style.display = 'block';
        }

        // urgent_alerts ì„¹ì…˜ ì—…ë°ì´íŠ¸ (micro_segment_alerts í†µí•© ë²„ì „)
        let urgentAlertsData = { high: [], medium: [] };
        let urgentAlertsExpanded = { high: false, medium: false };

        function updateUrgentAlerts() {
            const periodData = getPeriodData();

            // micro_segment_alertsì—ì„œ problem ìœ í˜•ë§Œ í•„í„°ë§ (urgent_alerts ëŒ€ì²´)
            const microAlerts = periodData?.micro_segment_alerts || [];
            const problemAlerts = microAlerts
                .filter(a => a.type === 'problem')
                .sort((a, b) => (b.urgency_score || 0) - (a.urgency_score || 0));  // ê¸´ê¸‰ë„ ìˆœ ì •ë ¬

            // ì‹¬ê°ë„ë³„ë¡œ ê·¸ë£¹í™” (critical/high -> high, medium -> medium)
            urgentAlertsData.high = problemAlerts.filter(a => ['critical', 'high'].includes(a.severity));
            urgentAlertsData.medium = problemAlerts.filter(a => a.severity === 'medium');

            // íƒ­ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
            const totalCount = problemAlerts.length;
            const urgentTotalEl = document.getElementById('urgentTotalCount');
            if (urgentTotalEl) {
                urgentTotalEl.textContent = totalCount > 0 ? `(${totalCount}ê±´)` : '';
            }

            const highCountEl = document.getElementById('highAlertCount');
            const mediumCountEl = document.getElementById('mediumAlertCount');
            if (highCountEl) highCountEl.textContent = `(${urgentAlertsData.high.length}ê±´)`;
            if (mediumCountEl) mediumCountEl.textContent = `(${urgentAlertsData.medium.length}ê±´)`;

            // ì¹´ë“œ ë Œë”ë§
            renderUrgentAlertCards('high');
            renderUrgentAlertCards('medium');

            // ì„œë¸Œíƒ­ ë²„íŠ¼ ì´ë²¤íŠ¸ ë“±ë¡
            document.querySelectorAll('.urgent-alert-tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const targetTab = this.dataset.tab;

                    // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
                    document.querySelectorAll('.urgent-alert-tab-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');

                    // íƒ­ ì»¨í…ì¸  í‘œì‹œ/ìˆ¨ê¹€
                    document.querySelectorAll('.urgent-alert-tab-content').forEach(content => {
                        content.style.display = 'none';
                    });
                    document.getElementById(targetTab + 'AlertsTab').style.display = 'block';
                });
            });
        }

        function renderUrgentAlertCards(type) {
            const alerts = urgentAlertsData[type];
            const cardsContainer = document.getElementById(type + 'AlertsCards');
            const toggleContainer = document.getElementById(type + 'AlertsToggleContainer');
            const toggleBtn = document.getElementById(type + 'AlertsToggleBtn');
            const isExpanded = urgentAlertsExpanded[type];
            const displayCount = isExpanded ? alerts.length : 3;

            // severityë³„ ìŠ¤íƒ€ì¼
            const severityStyles = {
                critical: { bgColor: '#ffebee', borderColor: '#f44336', textColor: '#c62828' },
                high: { bgColor: '#fff3e0', borderColor: '#ff9800', textColor: '#e65100' },
                medium: { bgColor: '#fff8e1', borderColor: '#ffc107', textColor: '#f57f17' }
            };

            // ì„¸ê·¸ë¨¼íŠ¸ íƒ€ì…ë³„ ì•„ì´ì½˜
            const subTypeIcons = {
                'traffic_leak': 'ğŸš¿',
                'hidden_vip': 'ğŸ’',
                'checkout_friction': 'ğŸ›’',
                'growth_engine': 'ğŸš€',
                'activation_drop': 'ğŸšª',
                'engagement_gap': 'ğŸ“‰',
                'silent_majority': 'ğŸ˜¶'
            };

            // ë©”íŠ¸ë¦­ìŠ¤ ë°°ì§€ ìƒì„± í•¨ìˆ˜
            const renderMetricsBadges = (metrics) => {
                if (!metrics) return '';
                const colorMap = {
                    'ìœ ì…â†’í™œë™': { color: '#1565c0', border: '#90caf9' },
                    'í™œë™â†’ê´€ì‹¬': { color: '#1565c0', border: '#90caf9' },
                    'ê´€ì‹¬â†’êµ¬ë§¤': { color: '#1565c0', border: '#90caf9' },
                    'ì „í™˜ìœ¨': { color: '#2e7d32', border: '#a5d6a7' },
                    'CVR': { color: '#2e7d32', border: '#a5d6a7' },
                    'ìœ ì…': { color: '#5e35b1', border: '#b39ddb' },
                    'í™œë™': { color: '#5e35b1', border: '#b39ddb' },
                    'ê´€ì‹¬': { color: '#5e35b1', border: '#b39ddb' },
                    'RPV': { color: '#e65100', border: '#ffcc80' }
                };
                const percentKeys1 = ['ìœ ì…â†’í™œë™', 'í™œë™â†’ê´€ì‹¬', 'ê´€ì‹¬â†’êµ¬ë§¤'];
                const percentKeys2 = ['ì „í™˜ìœ¨', 'CVR'];
                return Object.entries(metrics).map(([k, v]) => {
                    let formatted;
                    if (percentKeys2.includes(k)) {
                        formatted = (typeof v === 'number' ? v.toFixed(2) : v) + '%';
                    } else if (percentKeys1.includes(k)) {
                        formatted = (typeof v === 'number' ? v.toFixed(1) : v) + '%';
                    } else {
                        formatted = typeof v === 'number' ? v.toLocaleString() : v;
                    }
                    const s = colorMap[k] || { color: '#616161', border: '#bdbdbd' };
                    return '<span style="background: white; padding: 3px 8px; border-radius: 12px; font-size: 10px; color: ' + s.color + '; border: 1px solid ' + s.border + '; font-weight: 500;">' + k + ' ' + formatted + '</span>';
                }).join('');
            };

            if (alerts.length === 0) {
                cardsContainer.innerHTML = `
                    <div style="padding: 20px; text-align: center; color: var(--grey-500);">
                        ${type === 'high' ? 'ì¦‰ì‹œ ì¡°ì¹˜ê°€ í•„ìš”í•œ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.' : 'ê°œì„  ê¶Œì¥ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.'}
                    </div>
                `;
                toggleContainer.style.display = 'none';
                return;
            }

            cardsContainer.innerHTML = alerts.slice(0, displayCount).map(alert => {
                const style = severityStyles[alert.severity] || severityStyles.medium;
                const icon = subTypeIcons[alert.sub_type] || 'âš ï¸';
                const diagnosis = alert.diagnosis || alert.reason || '';
                const impact = alert.impact || {};
                const actionDetail = alert.action_detail || {};
                const urgencyScore = alert.urgency_score || 0;
                const urgencyLabel = urgencyScore >= 70 ? 'ê¸´ê¸‰' : urgencyScore >= 40 ? 'ì£¼ì˜' : 'ì°¸ê³ ';

                return `
                <div style="background: ${style.bgColor}; border: 2px solid ${style.borderColor}; border-radius: 10px; padding: 14px; transition: transform 0.2s;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                    <!-- í—¤ë” -->
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                        <span style="font-size: 18px;">${icon}</span>
                        <div style="flex: 1;">
                            <div style="font-size: 13px; font-weight: 700; color: ${style.textColor};">${alert.title}</div>
                            <div style="font-size: 10px; color: ${style.textColor}; opacity: 0.8;">${alert.category || 'ì¼ë°˜'} > ${alert.sub_type || 'ë¶„ì„'}</div>
                        </div>
                        ${urgencyScore > 0 ? '<span style="background: ' + style.borderColor + '; color: white; font-size: 9px; padding: 2px 8px; border-radius: 10px; font-weight: 600;">' + urgencyLabel + ' ' + urgencyScore + '</span>' : ''}
                    </div>
                    <!-- ë©”íŠ¸ë¦­ìŠ¤ ë°°ì§€ -->
                    ${alert.metrics ? '<div style="display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 10px;">' + renderMetricsBadges(alert.metrics) + '</div>' : ''}
                    <!-- ì§„ë‹¨ (ì²´í¬ë§ˆí¬ ìŠ¤íƒ€ì¼) -->
                    ${diagnosis ? `
                        <div style="font-size: 11px; color: #555; line-height: 1.6; margin-bottom: 10px;">
                            <div style="display: flex; align-items: flex-start; gap: 6px;">
                                <span style="color: ${style.borderColor};">âœ“</span>
                                <span>${diagnosis}</span>
                            </div>
                        </div>
                    ` : ''}
                    <!-- ì¶”ì²œ ì•¡ì…˜ -->
                    <div style="background: #ffffff; border-radius: 6px; padding: 10px; border-left: 3px solid ${style.borderColor};">
                        <div style="font-size: 10px; font-weight: 600; color: ${style.textColor}; margin-bottom: 4px;">ğŸ’¡ ì¶”ì²œ ì•¡ì…˜</div>
                        <div style="font-size: 11px; color: #333; line-height: 1.4;">${actionDetail.primary || alert.action || 'ë°ì´í„° ë¶„ì„ í›„ ëŒ€ì‘ ë°©ì•ˆì„ ìˆ˜ë¦½í•˜ì„¸ìš”.'}</div>
                        ${actionDetail.secondary ? '<div style="font-size: 10px; color: #5e35b1; margin-top: 6px; padding-top: 6px; border-top: 1px dashed #d1c4e9; line-height: 1.4;">â• ' + actionDetail.secondary + '</div>' : ''}
                        ${(impact.lost_users || impact.potential_revenue) ? '<div style="font-size: 10px; color: #c62828; margin-top: 6px;">ğŸ“‰ ì˜í–¥: ' + (impact.lost_users ? 'ì´íƒˆ ' + impact.lost_users + 'ëª…' : '') + (impact.potential_revenue ? ' Â· ì ì¬ ì†ì‹¤ â‚©' + impact.potential_revenue.toLocaleString() : '') + '</div>' : ''}
                    </div>
                </div>
            `}).join('');

            // ì ‘ê¸°/í¼ì¹˜ê¸° ë²„íŠ¼ ì²˜ë¦¬
            if (alerts.length > 3) {
                toggleContainer.style.display = 'block';
                const hiddenCount = alerts.length - 3;
                toggleBtn.textContent = isExpanded ? 'ì ‘ê¸°' : `ë” ë³´ê¸° (${hiddenCount}ê±´)`;

                // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¬ë“±ë¡ (ì¤‘ë³µ ë°©ì§€ë¥¼ ìœ„í•´ í´ë¡  í›„ êµì²´)
                const newBtn = toggleBtn.cloneNode(true);
                toggleBtn.parentNode.replaceChild(newBtn, toggleBtn);
                newBtn.addEventListener('click', function() {
                    urgentAlertsExpanded[type] = !urgentAlertsExpanded[type];
                    renderUrgentAlertCards(type);
                });
            } else {
                toggleContainer.style.display = 'none';
            }
        }

        // ========================================
        // ë§ˆì´í¬ë¡œ ì„¸ê·¸ë¨¼íŠ¸ ë¶„ì„ ì„¹ì…˜
        // ========================================

        // ë§ˆì´í¬ë¡œ ì„¸ê·¸ë¨¼íŠ¸ ìƒíƒœ ê´€ë¦¬
        let microSegmentData = { problem: [], opportunity: [] };
        let microSegmentExpanded = { problem: false, opportunity: false };
        let currentMicroCategoryFilter = 'all';

        // ë§ˆì´í¬ë¡œ ì„¸ê·¸ë¨¼íŠ¸ ì´ë²¤íŠ¸ ì´ˆê¸°í™” í”Œë˜ê·¸
        let microSegmentEventsInitialized = false;

        // ë§ˆì´í¬ë¡œ ì„¸ê·¸ë¨¼íŠ¸ ì—…ë°ì´íŠ¸
        function updateMicroSegmentAlerts() {
            const periodData = getMicroSegmentPeriodData();
            const alerts = periodData?.micro_segment_alerts || [];
            const definitions = periodData?.micro_segment_definitions || {};
            const thresholds = periodData?.dynamic_thresholds || {};

            // ì¹´í…Œê³ ë¦¬ í•„í„° ì ìš©
            const filteredAlerts = currentMicroCategoryFilter === 'all'
                ? alerts
                : alerts.filter(a => a.category === currentMicroCategoryFilter || (a.category === 'ê¸°íƒ€' && currentMicroCategoryFilter === 'etc'));

            // ìœ í˜•ë³„ë¡œ ê·¸ë£¹í™”
            microSegmentData.problem = filteredAlerts.filter(a => a.type === 'problem');
            microSegmentData.opportunity = filteredAlerts.filter(a => a.type === 'opportunity');

            // ì´ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
            const totalCount = alerts.length;
            const microCountEl = document.getElementById('microSegmentCount');
            if (microCountEl) {
                microCountEl.textContent = totalCount > 0 ? `(${totalCount}ê±´)` : '';
            }

            // ì„œë¸Œíƒ­ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
            const problemCountEl = document.getElementById('microProblemCount');
            const opportunityCountEl = document.getElementById('microOpportunityCount');
            if (problemCountEl) problemCountEl.textContent = `(${microSegmentData.problem.length}ê±´)`;
            if (opportunityCountEl) opportunityCountEl.textContent = `(${microSegmentData.opportunity.length}ê±´)`;

            // ì¹´ë“œ ë Œë”ë§
            renderMicroSegmentCards('problem');
            renderMicroSegmentCards('opportunity');

            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆëŠ” ìµœì´ˆ 1íšŒë§Œ ë“±ë¡
            if (!microSegmentEventsInitialized) {
                // ì„œë¸Œíƒ­ ì´ë²¤íŠ¸ ë“±ë¡
                document.querySelectorAll('.micro-segment-tab-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const targetType = this.dataset.type;
                        document.querySelectorAll('.micro-segment-tab-btn').forEach(b => b.classList.remove('active'));
                        this.classList.add('active');
                        document.querySelectorAll('.micro-segment-tab-content').forEach(content => {
                            content.style.display = 'none';
                        });
                        document.getElementById('micro' + targetType.charAt(0).toUpperCase() + targetType.slice(1) + 'Tab').style.display = 'block';
                    });
                });

                // ì¹´í…Œê³ ë¦¬ í•„í„° ì´ë²¤íŠ¸ ë“±ë¡
                document.querySelectorAll('.micro-category-filter').forEach(btn => {
                    btn.addEventListener('click', function() {
                        document.querySelectorAll('.micro-category-filter').forEach(b => b.classList.remove('active'));
                        this.classList.add('active');
                        currentMicroCategoryFilter = this.dataset.category;

                        // ë°ì´í„° ë¨¼ì € ì—…ë°ì´íŠ¸
                        const periodData = getMicroSegmentPeriodData();
                        const alerts = periodData?.micro_segment_alerts || [];
                        const filtered = currentMicroCategoryFilter === 'all'
                            ? alerts
                            : alerts.filter(a => a.category === currentMicroCategoryFilter || (a.category === 'ê¸°íƒ€' && currentMicroCategoryFilter === 'etc'));
                        microSegmentData.problem = filtered.filter(a => a.type === 'problem');
                        microSegmentData.opportunity = filtered.filter(a => a.type === 'opportunity');

                        // ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
                        document.getElementById('microProblemCount').textContent = `(${microSegmentData.problem.length}ê±´)`;
                        document.getElementById('microOpportunityCount').textContent = `(${microSegmentData.opportunity.length}ê±´)`;

                        // ì¹´ë“œ ë Œë”ë§ (ë°ì´í„° ì—…ë°ì´íŠ¸ í›„)
                        renderMicroSegmentCards('problem');
                        renderMicroSegmentCards('opportunity');
                    });
                });

                microSegmentEventsInitialized = true;
            }
        }

        // ë§ˆì´í¬ë¡œ ì„¸ê·¸ë¨¼íŠ¸ ì¹´ë“œ ë Œë”ë§
        function renderMicroSegmentCards(type) {
            const alerts = microSegmentData[type];
            const cardsContainer = document.getElementById('micro' + type.charAt(0).toUpperCase() + type.slice(1) + 'Cards');
            const toggleContainer = document.getElementById('micro' + type.charAt(0).toUpperCase() + type.slice(1) + 'ToggleContainer');
            const toggleBtn = document.getElementById('micro' + type.charAt(0).toUpperCase() + type.slice(1) + 'ToggleBtn');
            const isExpanded = microSegmentExpanded[type];
            const displayCount = isExpanded ? alerts.length : 5;

            const severityStyles = {
                critical: { bgColor: '#ffebee', borderColor: '#f44336', textColor: '#c62828', icon: 'ğŸš¨' },
                high: { bgColor: '#fff3e0', borderColor: '#ff9800', textColor: '#e65100', icon: 'âš ï¸' },
                medium: { bgColor: '#fff8e1', borderColor: '#ffc107', textColor: '#f57f17', icon: 'ğŸ“Œ' },
                opportunity: { bgColor: '#e8f5e9', borderColor: '#4caf50', textColor: '#2e7d32', icon: 'ğŸš€' }
            };

            const categoryColors = {
                'SA': '#1976d2',
                'DA': '#7b1fa2',
                'SNS': '#e91e63',
                'CRM': '#00897b',
                'PR': '#ff5722',
                'Organic': '#43a047',
                'etc': '#757575',
                'ê¸°íƒ€': '#757575'
            };

            if (alerts.length === 0) {
                cardsContainer.innerHTML = `
                    <div style="padding: 20px; text-align: center; color: var(--grey-500);">
                        ${type === 'problem' ? 'í˜„ì¬ ë¬¸ì œì ì´ ì—†ìŠµë‹ˆë‹¤.' : 'í˜„ì¬ ê¸°íšŒ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.'}
                    </div>
                `;
                toggleContainer.style.display = 'none';
                return;
            }

            cardsContainer.innerHTML = alerts.slice(0, displayCount).map(alert => {
                const style = severityStyles[alert.severity] || severityStyles.medium;
                const categoryColor = categoryColors[alert.category] || '#757575';

                // ì„¸ê·¸ë¨¼íŠ¸ íƒ€ì…ë³„ ì•„ì´ì½˜
                const subTypeIcons = {
                    'traffic_leak': 'ğŸš¿',
                    'hidden_vip': 'ğŸ’',
                    'checkout_friction': 'ğŸ›’',
                    'growth_engine': 'ğŸš€',
                    'activation_drop': 'ğŸšª',
                    'engagement_gap': 'ğŸ“‰',
                    'silent_majority': 'ğŸ˜¶'
                };
                const icon = subTypeIcons[alert.sub_type] || (alert.type === 'opportunity' ? 'âœ¨' : 'âš ï¸');

                // ê¸´ê¸‰ë„ ì ìˆ˜ í‘œì‹œ
                const urgencyScore = alert.urgency_score || 0;
                const urgencyLabel = urgencyScore >= 70 ? 'ê¸´ê¸‰' : urgencyScore >= 40 ? 'ì£¼ì˜' : 'ì°¸ê³ ';

                // ë©”íŠ¸ë¦­ìŠ¤ ë°°ì§€ ìƒì„± í•¨ìˆ˜
                const renderMetricsBadges = (metrics) => {
                    if (!metrics) return '';
                    const colorMap = {
                        'ìœ ì…â†’í™œë™': { color: '#1565c0', border: '#90caf9' },
                        'í™œë™â†’ê´€ì‹¬': { color: '#1565c0', border: '#90caf9' },
                        'ê´€ì‹¬â†’êµ¬ë§¤': { color: '#1565c0', border: '#90caf9' },
                        'ì „í™˜ìœ¨': { color: '#2e7d32', border: '#a5d6a7' },
                        'CVR': { color: '#2e7d32', border: '#a5d6a7' },
                        'ìœ ì…': { color: '#5e35b1', border: '#b39ddb' },
                        'í™œë™': { color: '#5e35b1', border: '#b39ddb' },
                        'ê´€ì‹¬': { color: '#5e35b1', border: '#b39ddb' },
                        'RPV': { color: '#e65100', border: '#ffcc80' }
                    };
                    const percentKeys1 = ['ìœ ì…â†’í™œë™', 'í™œë™â†’ê´€ì‹¬', 'ê´€ì‹¬â†’êµ¬ë§¤'];
                    const percentKeys2 = ['ì „í™˜ìœ¨', 'CVR'];
                    return Object.entries(metrics).map(([k, v]) => {
                        let formatted;
                        if (percentKeys2.includes(k)) {
                            formatted = (typeof v === 'number' ? v.toFixed(2) : v) + '%';
                        } else if (percentKeys1.includes(k)) {
                            formatted = (typeof v === 'number' ? v.toFixed(1) : v) + '%';
                        } else {
                            formatted = typeof v === 'number' ? v.toLocaleString() : v;
                        }
                        const s = colorMap[k] || { color: '#616161', border: '#bdbdbd' };
                        return '<span style="background: white; padding: 3px 8px; border-radius: 12px; font-size: 10px; color: ' + s.color + '; border: 1px solid ' + s.border + '; font-weight: 500;">' + k + ' ' + formatted + '</span>';
                    }).join('');
                };

                return `
                    <div class="micro-segment-card" style="background: ${style.bgColor}; border: 2px solid ${style.borderColor}; border-radius: 10px; padding: 14px; cursor: pointer; transition: transform 0.2s;" data-prescription="${alert.action.replace(/"/g, '&quot;')}" data-title="${alert.title.replace(/"/g, '&quot;')}" data-subtype="${alert.sub_type || ''}" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                        <!-- í—¤ë” -->
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                            <span style="font-size: 18px;">${icon}</span>
                            <div style="flex: 1;">
                                <div style="font-size: 13px; font-weight: 700; color: ${style.textColor};">${alert.title}</div>
                                <div style="font-size: 10px; color: ${style.textColor}; opacity: 0.8;">${alert.category} > ${alert.sub_type || 'ì¼ë°˜'}</div>
                            </div>
                            ${urgencyScore > 0 ? '<span style="background: ' + style.borderColor + '; color: white; font-size: 9px; padding: 2px 8px; border-radius: 10px; font-weight: 600;">' + urgencyLabel + ' ' + urgencyScore + '</span>' : ''}
                        </div>
                        <!-- ë©”íŠ¸ë¦­ìŠ¤ ë°°ì§€ -->
                        ${alert.metrics ? '<div style="display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 10px;">' + renderMetricsBadges(alert.metrics) + '</div>' : ''}
                        <!-- ì§„ë‹¨ (ì´ìœ  ëª©ë¡ ìŠ¤íƒ€ì¼) -->
                        ${alert.diagnosis ? `
                            <div style="font-size: 11px; color: #555; line-height: 1.6; margin-bottom: 10px;">
                                <div style="display: flex; align-items: flex-start; gap: 6px;">
                                    <span style="color: ${style.borderColor};">âœ“</span>
                                    <span>${alert.diagnosis}</span>
                                </div>
                            </div>
                        ` : ''}
                        <!-- ì¶”ì²œ ì•¡ì…˜ -->
                        ${alert.action ? `
                            <div style="background: #ffffff; border-radius: 6px; padding: 10px; border-left: 3px solid ${style.borderColor};">
                                <div style="font-size: 10px; font-weight: 600; color: ${style.textColor}; margin-bottom: 4px;">ğŸ’¡ ì¶”ì²œ ì•¡ì…˜</div>
                                <div style="font-size: 11px; color: #333; line-height: 1.4;">${alert.action}</div>
                                ${alert.impact && alert.impact.potential_revenue ? '<div style="font-size: 10px; color: #2e7d32; margin-top: 6px;">ğŸ“ˆ ì˜ˆìƒ íš¨ê³¼: ' + (alert.impact.potential_revenue > 0 ? alert.impact.potential_revenue.toLocaleString() + 'ì› ë§¤ì¶œ ê¸°íšŒ' : 'ì´íƒˆ ë°©ì§€') + '</div>' : ''}
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');

            // ì ‘ê¸°/í¼ì¹˜ê¸° ë²„íŠ¼ ì²˜ë¦¬
            if (alerts.length > 5) {
                toggleContainer.style.display = 'block';
                const hiddenCount = alerts.length - 5;
                toggleBtn.textContent = isExpanded ? 'ì ‘ê¸°' : `ë” ë³´ê¸° (${hiddenCount}ê±´)`;

                const newBtn = toggleBtn.cloneNode(true);
                toggleBtn.parentNode.replaceChild(newBtn, toggleBtn);
                newBtn.addEventListener('click', function() {
                    microSegmentExpanded[type] = !microSegmentExpanded[type];
                    renderMicroSegmentCards(type);
                });
            } else {
                toggleContainer.style.display = 'none';
            }
        }

        // BCG Matrix ì±„ë„ ì „ëµ ì—…ë°ì´íŠ¸ (ë°ì´í„° ê¸°ë°˜ ì˜ì‚¬ê²°ì • ë„êµ¬ ê¸°ê°„ í•„í„° ì‚¬ìš©)
        function updateBCGMatrix() {
            const content = document.getElementById('bcgMatrixContent');
            if (!content) return;

            const periodData = getPeriodData();
            if (!periodData || !periodData.channel_strategy || periodData.channel_strategy.status !== 'success') {
                content.innerHTML = '<div style="padding: 20px; text-align: center; color: var(--grey-500);">ì±„ë„ ì „ëµ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            const strategy = periodData.channel_strategy;

            // ì±„ë„ë“¤ì„ BCG ìœ í˜•ë³„ë¡œ ê·¸ë£¹í™”
            const quadrants = {
                cash_cow: { channels: [], color: '#4caf50', bgColor: '#e8f5e9', title: 'ğŸ‘‘ Cash Cow (íš¨ì ì±„ë„)', desc: 'íŠ¸ë˜í”½ë„ ë§ê³  ì „í™˜ìœ¨ë„ ë†’ìŒ - íˆ¬ì ìœ ì§€' },
                hidden_gem: { channels: [], color: '#2196f3', bgColor: '#e3f2fd', title: 'ğŸ’ Hidden Gem (ìˆ¨ì€ ë³´ì„)', desc: 'ì „í™˜ìœ¨ì€ ë†’ì§€ë§Œ íŠ¸ë˜í”½ì´ ì ìŒ - íˆ¬ì í™•ëŒ€' },
                money_pit: { channels: [], color: '#ff9800', bgColor: '#fff3e0', title: 'ğŸ’¸ Money Pit (ë°‘ ë¹ ì§„ ë…)', desc: 'íŠ¸ë˜í”½ì€ ë§ì§€ë§Œ ì „í™˜ìœ¨ì´ ë‚®ìŒ - ìµœì í™” í•„ìš”' },
                dog: { channels: [], color: '#9e9e9e', bgColor: '#fafafa', title: 'ğŸ¤” Dog (ì¬ê²€í†  í•„ìš”)', desc: 'íŠ¸ë˜í”½ë„ ì „í™˜ìœ¨ë„ ë‚®ìŒ - ì „ëµ ì¬ê³ ' }
            };

            // ì±„ë„ ë¶„ë¥˜
            Object.entries(strategy.channels).forEach(([name, data]) => {
                const quadrant = data.bcg_matrix.quadrant;
                if (quadrants[quadrant]) {
                    quadrants[quadrant].channels.push({
                        name,
                        ...data.stats,
                        action: data.bcg_matrix.action
                    });
                }
            });

            // HTML ìƒì„±
            let html = '';
            Object.entries(quadrants).forEach(([key, q]) => {
                if (q.channels.length > 0) {
                    html += `
                        <div style="padding: 16px; background: ${q.bgColor}; border-radius: 12px; border-left: 4px solid ${q.color};">
                            <div style="font-size: 15px; font-weight: 700; color: var(--grey-900); margin-bottom: 4px;">
                                ${q.title}
                            </div>
                            <div style="font-size: 12px; color: var(--grey-600); margin-bottom: 12px;">
                                ${q.desc}
                            </div>
                            <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 12px;">
                                ${q.channels.map(ch => `
                                    <span style="display: inline-flex; align-items: center; gap: 6px; padding: 6px 12px; background: white; border-radius: 6px; font-size: 13px; font-weight: 500; color: var(--grey-800);">
                                        ${ch.name}
                                        <span style="font-size: 11px; color: ${q.color};">(CVR ${ch.cvr}%)</span>
                                    </span>
                                `).join('')}
                            </div>
                            ${q.channels[0] ? `
                                <div style="font-size: 12px; color: var(--grey-700); padding: 10px; background: white; border-radius: 6px;">
                                    ${q.channels[0].action}
                                </div>
                            ` : ''}
                        </div>
                    `;
                }
            });

            content.innerHTML = html || '<div style="padding: 20px; text-align: center; color: var(--grey-500);">ë¶„ë¥˜ëœ ì±„ë„ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        }

        // ìµœê·¼ ë³€í™” ì¸ì‚¬ì´íŠ¸ - ê¸°ê°„ ì„ íƒ ë³€ìˆ˜
        let trendPeriod = '7d';

        // ìµœê·¼ ë³€í™” ì¸ì‚¬ì´íŠ¸ - ê¸°ê°„ ë²„íŠ¼ ì„¤ì •
        function setupTrendPeriodButtons() {
            document.querySelectorAll('.trend-period-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const period = this.dataset.trendPeriod;
                    trendPeriod = period;

                    // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
                    document.querySelectorAll('.trend-period-btn').forEach(b => {
                        b.style.background = 'white';
                        b.style.color = '#495057';
                        b.style.border = '1px solid #dee2e6';
                        b.classList.remove('active');
                    });
                    this.style.background = '#673ab7';
                    this.style.color = 'white';
                    this.style.border = '1px solid #673ab7';
                    this.classList.add('active');

                    // ê¸°ê°„ í‘œì‹œ ì—…ë°ì´íŠ¸
                    updateTrendPeriodIndicator(period);

                    // ë°ì´í„° ì—…ë°ì´íŠ¸
                    renderPerformanceTrends(period);
                });
            });
        }

        // ê¸°ê°„ ë¹„êµ í‘œì‹œ ì—…ë°ì´íŠ¸ (êµ¬ì²´ì ì¸ ë‚ ì§œ ë²”ìœ„ í‘œì‹œ)
        function updateTrendPeriodIndicator(period) {
            const indicator = document.getElementById('trendPeriodText');
            if (!indicator) return;

            // ë§ˆì§€ë§‰ ë‚ ì§œ ê°€ì ¸ì˜¤ê¸° (insightsDataì—ì„œ)
            let lastDate = new Date();
            if (insightsData && insightsData.overall && insightsData.overall.current_period) {
                const endDateStr = insightsData.overall.current_period.end_date;
                if (endDateStr) {
                    lastDate = new Date(endDateStr);
                }
            }

            const formatDate = (date) => {
                const m = date.getMonth() + 1;
                const d = date.getDate();
                return `${m}/${d}`;
            };

            let recentStart, recentEnd, previousStart, previousEnd;
            let days = 7;

            if (period === '7d') {
                days = 7;
            } else if (period === '14d') {
                days = 14;
            } else if (period === '30d') {
                days = 30;
            }

            // ìµœê·¼ Nì¼: lastDate - (N-1)ì¼ ~ lastDate
            recentEnd = new Date(lastDate);
            recentStart = new Date(lastDate);
            recentStart.setDate(recentStart.getDate() - (days - 1));

            // ì´ì „ Nì¼: lastDate - (2N-1)ì¼ ~ lastDate - Nì¼
            previousEnd = new Date(lastDate);
            previousEnd.setDate(previousEnd.getDate() - days);
            previousStart = new Date(lastDate);
            previousStart.setDate(previousStart.getDate() - (days * 2 - 1));

            indicator.innerHTML = `
                <strong style="color: #1565c0;">ìµœê·¼ ${days}ì¼</strong> (${formatDate(recentStart)}~${formatDate(recentEnd)}) vs
                <strong style="color: #7b1fa2;">ì´ì „ ${days}ì¼</strong> (${formatDate(previousStart)}~${formatDate(previousEnd)})
            `;
        }

        // ì„±ê³¼ íŠ¸ë Œë“œ ë Œë”ë§ (ê°œì„  + í•˜ë½)
        function renderPerformanceTrends(period) {
            const fullData = insightsData;
            if (!fullData || !fullData.performance_trends) {
                renderNoTrendData();
                return;
            }

            const trends = fullData.performance_trends;
            updateImprovementTrends(period, trends);
            updateDeclineTrends(period, trends);
        }

        // íŠ¸ë Œë“œ ë°ì´í„° ì—†ìŒ í‘œì‹œ
        function renderNoTrendData() {
            const noDataHtml = `
                <div class="insight-card neutral">
                    <div class="insight-text" style="text-align: center; padding: 20px;">
                        <svg viewBox="0 0 24 24" fill="currentColor" style="width: 48px; height: 48px; margin-bottom: 12px; opacity: 0.5; color: var(--grey-500);">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15h2v2h-2v-2zm0-12h2v10h-2V5z"/>
                        </svg>
                        <p style="font-size: 16px; font-weight: 600; margin-bottom: 4px; color: var(--grey-700);">ë°ì´í„° ì—†ìŒ</p>
                        <p style="font-size: 14px; color: var(--grey-600);">ì„±ê³¼ íŠ¸ë Œë“œ ë°ì´í„°ê°€ ì•„ì§ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>
                    </div>
                </div>
            `;
            const improvementContainer = document.getElementById('improvementTrendContent');
            const declineContainer = document.getElementById('declineTrendContent');
            if (improvementContainer) improvementContainer.innerHTML = noDataHtml;
            if (declineContainer) declineContainer.innerHTML = noDataHtml;
        }

        // ê°œì„  í•­ëª© ë Œë”ë§
        function updateImprovementTrends(period, trends) {
            const container = document.getElementById('improvementTrendContent');
            if (!container) return;

            const dataKeyMap = { '7d': 'improvements_7d', '14d': 'improvements_14d', '30d': 'improvements_30d' };
            const periodTextMap = { '7d': 'ìµœê·¼ 7ì¼ vs ì´ì „ 7ì¼', '14d': 'ìµœê·¼ 14ì¼ vs ì´ì „ 14ì¼', '30d': 'ìµœê·¼ 30ì¼ vs ì´ì „ 30ì¼' };
            const dataKey = dataKeyMap[period] || 'improvements_7d';
            const improvements = trends[dataKey] || [];
            const periodText = periodTextMap[period] || 'ìµœê·¼ 7ì¼ vs ì´ì „ 7ì¼';

            if (improvements.length === 0) {
                container.innerHTML = `
                    <div class="insight-card neutral">
                        <div class="insight-text" style="text-align: center; padding: 20px;">
                            <svg viewBox="0 0 24 24" fill="currentColor" style="width: 48px; height: 48px; margin-bottom: 12px; opacity: 0.5; color: var(--grey-500);">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15h2v2h-2v-2zm0-12h2v10h-2V5z"/>
                            </svg>
                            <p style="font-size: 16px; font-weight: 600; margin-bottom: 4px; color: var(--grey-700);">ê°œì„  ì‚¬í•­ ì—†ìŒ</p>
                            <p style="font-size: 14px; color: var(--grey-600);">í˜„ì¬ ê¸°ê°„ì— ìœ ì˜ë¯¸í•œ ì„±ê³¼ ê°œì„ ì´ ê°ì§€ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>
                        </div>
                    </div>
                `;
                return;
            }

            container.innerHTML = `
                <div style="display: grid; gap: 12px;">
                    ${improvements.map(item => `
                        <div style="background: #e8f5e9; border: 2px solid #4caf50; border-radius: 10px; padding: 14px; transition: transform 0.2s;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                            <!-- í—¤ë” -->
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                <span style="font-size: 18px;">ğŸ“ˆ</span>
                                <div style="flex: 1;">
                                    <div style="font-size: 13px; font-weight: 700; color: #2e7d32;">${item.metric}</div>
                                    <div style="font-size: 10px; color: #2e7d32; opacity: 0.8;">${periodText}</div>
                                </div>
                                <span style="background: #4caf50; color: white; font-size: 9px; padding: 2px 8px; border-radius: 10px; font-weight: 600;">+${item.change_pct}% ${item.improvement_level === 'high' ? 'ë†’ìŒ' : 'ì¤‘ê°„'}</span>
                            </div>
                            <!-- ë©”íŠ¸ë¦­ìŠ¤ ë°°ì§€ -->
                            <div style="display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 10px;">
                                <span style="background: white; padding: 3px 8px; border-radius: 12px; font-size: 10px; color: #1565c0; border: 1px solid #90caf9; font-weight: 500;">ìµœê·¼ ${formatNumber(item.recent_avg)}</span>
                                <span style="background: white; padding: 3px 8px; border-radius: 12px; font-size: 10px; color: #5e35b1; border: 1px solid #b39ddb; font-weight: 500;">ì´ì „ ${formatNumber(item.previous_avg)}</span>
                            </div>
                            <!-- ì¶”ì²œ ì•¡ì…˜ -->
                            <div style="background: #ffffff; border-radius: 6px; padding: 10px; border-left: 3px solid #4caf50;">
                                <div style="font-size: 10px; font-weight: 600; color: #2e7d32; margin-bottom: 4px;">ğŸ’¡ ì¶”ì²œ ì•¡ì…˜</div>
                                <div style="font-size: 11px; color: #333; line-height: 1.4;">${item.recommendation}</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // í•˜ë½ í•­ëª© ë Œë”ë§
        function updateDeclineTrends(period, trends) {
            const container = document.getElementById('declineTrendContent');
            if (!container) return;

            const dataKeyMap = { '7d': 'declines_7d', '14d': 'declines_14d', '30d': 'declines_30d' };
            const periodTextMap = { '7d': 'ìµœê·¼ 7ì¼ vs ì´ì „ 7ì¼', '14d': 'ìµœê·¼ 14ì¼ vs ì´ì „ 14ì¼', '30d': 'ìµœê·¼ 30ì¼ vs ì´ì „ 30ì¼' };
            const dataKey = dataKeyMap[period] || 'declines_7d';
            const declines = trends[dataKey] || [];
            const periodText = periodTextMap[period] || 'ìµœê·¼ 7ì¼ vs ì´ì „ 7ì¼';

            if (declines.length === 0) {
                container.innerHTML = `
                    <div class="insight-card neutral">
                        <div class="insight-text" style="text-align: center; padding: 20px;">
                            <svg viewBox="0 0 24 24" fill="currentColor" style="width: 48px; height: 48px; margin-bottom: 12px; color: var(--success-main);">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                            </svg>
                            <p style="font-size: 16px; font-weight: 600; margin-bottom: 4px; color: var(--success-main);">í•˜ë½ ì—†ìŒ</p>
                            <p style="font-size: 14px; color: var(--grey-600);">ëª¨ë“  ì§€í‘œê°€ ì•ˆì •ì ì´ê±°ë‚˜ ê°œì„ ë˜ê³  ìˆìŠµë‹ˆë‹¤.</p>
                        </div>
                    </div>
                `;
                return;
            }

            container.innerHTML = `
                <div style="display: grid; gap: 12px;">
                    ${declines.map(item => {
                        const isHigh = item.risk_level === 'high';
                        const bgColor = isHigh ? '#ffebee' : '#fff3e0';
                        const borderColor = isHigh ? '#f44336' : '#ff9800';
                        const textColor = isHigh ? '#c62828' : '#e65100';
                        const badgeColor = isHigh ? '#f44336' : '#ff9800';
                        return `
                        <div style="background: ${bgColor}; border: 2px solid ${borderColor}; border-radius: 10px; padding: 14px; transition: transform 0.2s;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                            <!-- í—¤ë” -->
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                <span style="font-size: 18px;">ğŸ“‰</span>
                                <div style="flex: 1;">
                                    <div style="font-size: 13px; font-weight: 700; color: ${textColor};">${item.metric}</div>
                                    <div style="font-size: 10px; color: ${textColor}; opacity: 0.8;">${periodText}</div>
                                </div>
                                <span style="background: ${badgeColor}; color: white; font-size: 9px; padding: 2px 8px; border-radius: 10px; font-weight: 600;">${item.change_pct}% ${isHigh ? 'ë†’ìŒ' : 'ì¤‘ê°„'}</span>
                            </div>
                            <!-- ë©”íŠ¸ë¦­ìŠ¤ ë°°ì§€ -->
                            <div style="display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 10px;">
                                <span style="background: white; padding: 3px 8px; border-radius: 12px; font-size: 10px; color: #1565c0; border: 1px solid #90caf9; font-weight: 500;">ìµœê·¼ ${formatNumber(item.recent_avg)}</span>
                                <span style="background: white; padding: 3px 8px; border-radius: 12px; font-size: 10px; color: #5e35b1; border: 1px solid #b39ddb; font-weight: 500;">ì´ì „ ${formatNumber(item.previous_avg)}</span>
                            </div>
                            <!-- ì¶”ì²œ ì•¡ì…˜ -->
                            <div style="background: #ffffff; border-radius: 6px; padding: 10px; border-left: 3px solid ${borderColor};">
                                <div style="font-size: 10px; font-weight: 600; color: ${textColor}; margin-bottom: 4px;">âš ï¸ ì£¼ì˜ í•„ìš”</div>
                                <div style="font-size: 11px; color: #333; line-height: 1.4;">${item.recommendation}</div>
                            </div>
                        </div>
                    `;
                    }).join('')}
                </div>
            `;
        }

        // KPI ìš”ì•½ ì—…ë°ì´íŠ¸ (ì¼ë³„ ë°ì´í„° ì‚¬ìš©)
        function updateKPISummary() {
            // í•­ìƒ daily ë°ì´í„° ì‚¬ìš©
            const data = dailyData;
            if (data.length === 0) return;

            // ê° í¼ë„ ë‹¨ê³„ë³„ í•©ê³„ ê³„ì‚°
            const totalAcquisition = data.reduce((sum, row) => sum + (parseFloat(row['ìœ ì…']) || 0), 0);
            const totalActivation = data.reduce((sum, row) => sum + (parseFloat(row['í™œë™']) || 0), 0);
            const totalConsideration = data.reduce((sum, row) => sum + (parseFloat(row['ê´€ì‹¬']) || 0), 0);
            const totalConversion = data.reduce((sum, row) => sum + (parseFloat(row['ê²°ì œì§„í–‰']) || 0), 0);
            const totalPurchase = data.reduce((sum, row) => sum + (parseFloat(row['êµ¬ë§¤ì™„ë£Œ']) || 0), 0);

            const kpis = [
                { label: 'ìœ ì…', value: formatNumber(Math.round(totalAcquisition)), unit: 'ëª…', color: '#673ab7' },
                { label: 'í™œë™', value: formatNumber(Math.round(totalActivation)), unit: 'ëª…', color: '#2196f3' },
                { label: 'ê´€ì‹¬', value: formatNumber(Math.round(totalConsideration)), unit: 'ëª…', color: '#ff9800' },
                { label: 'ê²°ì œ ì§„í–‰', value: formatNumber(Math.round(totalConversion)), unit: 'ëª…', color: '#4caf50' },
                { label: 'êµ¬ë§¤ ì™„ë£Œ', value: formatNumber(Math.round(totalPurchase)), unit: 'ëª…', color: '#00c853' }
            ];

            document.getElementById('kpiSummaryGrid').innerHTML = kpis.map(kpi => `
                <div class="kpi-summary-card card">
                    <div class="kpi-summary-label">${kpi.label} (ì´ í•©ê³„)</div>
                    <div class="kpi-summary-value">${kpi.value}</div>
                    <div class="kpi-summary-unit">${kpi.unit}</div>
                </div>
            `).join('');
        }

        // ì¸ì‚¬ì´íŠ¸ ì—…ë°ì´íŠ¸ (ë°ì´í„° ê¸°ë°˜ ì˜ì‚¬ê²°ì • ë„êµ¬ ê¸°ê°„ í•„í„° ì‚¬ìš©)
        function updateInsights() {
            const periodData = getPeriodData();
            if (!periodData) return;

            // key_insightsê°€ ìˆìœ¼ë©´ ìƒˆë¡œìš´ 3ì¹´ë“œ ë ˆì´ì•„ì›ƒ ì‚¬ìš©
            const keyInsights = periodData.key_insights;
            if (keyInsights && keyInsights.length > 0) {
                let html = '';  // wrapper ì œê±° - .insight-contentê°€ ì´ë¯¸ 3ì—´ ê·¸ë¦¬ë“œ

                keyInsights.forEach(card => {
                    const hasAction = card.action && card.action.text;
                    const hasSubItems = card.sub_items && card.sub_items.length > 0 && card.sub_items[0];

                    html += `
                        <div style="background: ${card.bg_color}; border: 2px solid ${card.border_color}; border-radius: 10px; padding: 14px; transition: transform 0.2s; display: flex; flex-direction: column;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                            <!-- í—¤ë” -->
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px;">
                                <div style="width: 32px; height: 32px; background: ${card.border_color}20; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                    <span style="font-size: 16px;">${card.icon}</span>
                                </div>
                                <span style="font-size: 11px; font-weight: 700; color: ${card.text_color}; text-transform: uppercase; letter-spacing: 0.5px;">${card.label}</span>
                                ${card.urgency_score ? `<span style="margin-left: auto; font-size: 10px; padding: 2px 6px; background: ${card.border_color}; color: white; border-radius: 8px;">ê¸´ê¸‰ë„ ${card.urgency_score}</span>` : ''}
                            </div>
                            <!-- ë©”ì‹œì§€ -->
                            <div style="font-size: 13px; font-weight: 500; color: var(--grey-900); line-height: 1.6; flex: 1; margin-bottom: ${hasAction || hasSubItems ? '10px' : '0'};">${card.message}</div>
                            <!-- ì„œë¸Œ ì•„ì´í…œ -->
                            ${hasSubItems ? `
                                <div style="background: rgba(255,255,255,0.7); border-radius: 6px; padding: 10px; border-left: 3px solid ${card.border_color}; margin-bottom: ${hasAction ? '10px' : '0'};">
                                    <div style="font-size: 10px; font-weight: 600; color: ${card.text_color}; margin-bottom: 4px;">ğŸ“Œ ìƒì„¸ ì •ë³´</div>
                                    ${card.sub_items.filter(item => item).map(item => `<div style="font-size: 11px; color: #333; line-height: 1.5;">â†’ ${item}</div>`).join('')}
                                </div>
                            ` : ''}
                            <!-- ì¶”ì²œ ì•¡ì…˜ -->
                            ${hasAction ? `
                                <div style="background: rgba(255,255,255,0.7); border-radius: 6px; padding: 10px; border-left: 3px solid #ab47bc;">
                                    <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 4px;">
                                        <div style="font-size: 10px; font-weight: 600; color: #7b1fa2;">ğŸ’¡ ì¶”ì²œ ì•¡ì…˜</div>
                                        ${card.action.type ? `<span style="font-size: 9px; padding: 2px 6px; background: ${card.action.type === 'scale_up' || card.action.type === 'opportunity' ? '#e8f5e9' : card.action.type === 'primary' ? '#fff3e0' : '#e3f2fd'}; color: ${card.action.type === 'scale_up' || card.action.type === 'opportunity' ? '#2e7d32' : card.action.type === 'primary' ? '#e65100' : '#1565c0'}; border-radius: 4px; font-weight: 600;">${card.action.type === 'scale_up' ? 'ì¦ì•¡' : card.action.type === 'opportunity' ? 'ê¸°íšŒ' : card.action.type === 'primary' ? 'ê°œì„ ' : 'ìœ ì§€'}</span>` : ''}
                                    </div>
                                    <div style="font-size: 11px; color: #333; line-height: 1.4;">${card.action.text}</div>
                                    ${card.action.secondary ? `<div style="font-size: 10px; color: #5e35b1; margin-top: 6px; padding-top: 6px; border-top: 1px dashed #d1c4e9; line-height: 1.4;">â• ${card.action.secondary}</div>` : ''}
                                </div>
                            ` : ''}
                        </div>
                    `;
                });

                // wrapper ë‹«ëŠ” íƒœê·¸ ì œê±° - .insight-contentê°€ ì´ë¯¸ 3ì—´ ê·¸ë¦¬ë“œ
                document.getElementById('insightContent').innerHTML = html;
                return;
            }

            // Fallback: ê¸°ì¡´ ë¡œì§ (key_insightsê°€ ì—†ëŠ” ê²½ìš°)
            const insights = [];

            // ì „ì²´ CVR
            insights.push(`
                <div class="insight-card positive">
                    <div class="insight-title">
                        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg>
                        ì „ì²´ ì „í™˜ìœ¨
                    </div>
                    <div class="insight-text">
                        ì „ì²´ CVR: <strong>${formatDecimal(periodData.summary?.overall_cvr || 0)}%</strong><br>
                        ì´ ë§¤ì¶œ: <strong>${formatNumber(periodData.summary?.total_revenue || 0)}ì›</strong>
                    </div>
                </div>
            `);

            // ìƒìœ„ ì±„ë„
            if (periodData.top_channels && periodData.top_channels.length > 0) {
                const topChannel = periodData.top_channels[0];
                insights.push(`
                    <div class="insight-card positive">
                        <div class="insight-title">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"/></svg>
                            ìµœê³  ì„±ê³¼ ì±„ë„
                        </div>
                        <div class="insight-text">
                            <strong>${topChannel.name}</strong><br>
                            êµ¬ë§¤: ${formatNumber(topChannel.purchases)}ê±´<br>
                            ë§¤ì¶œ: ${formatNumber(topChannel.revenue)}ì›
                        </div>
                    </div>
                `);
            }

            // ê²½ê³ 
            if (periodData.alerts && periodData.alerts.length > 0) {
                periodData.alerts.forEach(alert => {
                    const severityClass = alert.severity === 'high' ? 'negative' : 'neutral';
                    insights.push(`
                        <div class="insight-card ${severityClass}">
                            <div class="insight-title">
                                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/></svg>
                                ${alert.type === 'low_activation' ? 'í™œì„±í™”ìœ¨ ê²½ê³ ' : 'ì „í™˜ìœ¨ ê²½ê³ '}
                            </div>
                            <div class="insight-text">${alert.message}</div>
                        </div>
                    `);
                });
            }

            document.getElementById('insightContent').innerHTML = insights.join('');
        }

        // D3.js ì¸í„°ë™í‹°ë¸Œ í¼ë„ ì°¨íŠ¸
        function updateFunnelChart() {
            console.log('=== updateFunnelChart ì‹œì‘ ===');

            // ì±„ë„ í•„í„° ì ìš©ëœ ë°ì´í„° ì‚¬ìš©
            const data = selectedFunnelChannel ? getFilteredDailyData(selectedFunnelChannel) : dailyData;
            console.log(`ì¼ë³„ ë°ì´í„°: ${data.length}ê°œ í–‰${selectedFunnelChannel ? ` (${selectedFunnelChannel} í•„í„°)` : ''}`);

            if (data.length === 0) {
                console.warn('ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                // document.getElementById('singleFunnelDateRange').textContent = 'ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...';
                return;
            }

            // ë‚ ì§œ ë²”ìœ„ í‘œì‹œ (Date ê°ì²´ ê¸°ë°˜ ì •ë ¬)
            const dateStrings = data
                .map(row => row['Day'] || row['week'] || row['date'] || row['Date'] || row['ì¼ì'])
                .filter(d => d);

            console.log(`ì¶”ì¶œëœ ë‚ ì§œ: ${dateStrings.length}ê°œ`);

            if (dateStrings.length > 0) {
                // Date ê°ì²´ë¡œ ë³€í™˜í•˜ì—¬ ì •ë ¬
                const sortedDates = dateStrings
                    .map(dateStr => new Date(dateStr))
                    .filter(date => !isNaN(date.getTime()))
                    .sort((a, b) => a - b)
                    .map(date => {
                        const year = date.getFullYear();
                        const month = String(date.getMonth() + 1).padStart(2, '0');
                        const day = String(date.getDate()).padStart(2, '0');
                        return `${year}-${month}-${day}`;
                    });

                const startDate = sortedDates[0];
                const endDate = sortedDates[sortedDates.length - 1];

                console.log(`ë‚ ì§œ ë²”ìœ„: ${startDate} ~ ${endDate}`);
                // document.getElementById('singleFunnelDateRange').textContent = `${startDate} ~ ${endDate}`;
            } else {
                console.warn('ë‚ ì§œ í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                // document.getElementById('singleFunnelDateRange').textContent = '';
            }

            // ê° í¼ë„ ë‹¨ê³„ë³„ ì´í•© ê³„ì‚°
            const baseColor = '#535A8C'; // Deep purple color
            const funnelStages = [
                { name: 'ìœ ì… (Acquisition)', key: 'ìœ ì…', color: baseColor, description: 'Acquisition' },
                { name: 'í™œë™ (Activation)', key: 'í™œë™', color: baseColor, description: 'Activation' },
                { name: 'ê´€ì‹¬ (Consideration)', key: 'ê´€ì‹¬', color: baseColor, description: 'Consideration' },
                { name: 'ê²°ì œì§„í–‰ (Conversion)', key: 'ê²°ì œì§„í–‰', color: baseColor, description: 'Conversion' },
                { name: 'êµ¬ë§¤ì™„ë£Œ (Purchase)', key: 'êµ¬ë§¤ì™„ë£Œ', color: baseColor, description: 'Purchase' }
            ];

            const funnelData = funnelStages.map((stage, index) => {
                const total = data.reduce((sum, row) => sum + (parseFloat(row[stage.key]) || 0), 0);
                const prevTotal = index > 0 ? data.reduce((sum, row) => sum + (parseFloat(row[funnelStages[index - 1].key]) || 0), 0) : total;
                const conversionRate = prevTotal > 0 ? (total / prevTotal * 100) : 100;
                const dropOffRate = prevTotal > 0 ? ((prevTotal - total) / prevTotal * 100) : 0;

                return {
                    ...stage,
                    total: Math.round(total),
                    conversionRate: conversionRate.toFixed(1),
                    dropOffRate: dropOffRate.toFixed(1),
                    index: index
                };
            });

            // SVG ì´ˆê¸°í™”
            const container = document.getElementById('d3FunnelChart');
            container.innerHTML = '';

            const margin = { top: 20, right: 40, bottom: 20, left: 40 };
            const width = container.clientWidth - margin.left - margin.right;
            const height = 550 - margin.top - margin.bottom;

            const svg = d3.select('#d3FunnelChart')
                .append('svg')
                .attr('width', width + margin.left + margin.right)
                .attr('height', height + margin.top + margin.bottom)
                .append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);

            // íˆ´íŒ ìƒì„± (bodyì— ì§ì ‘ ì¶”ê°€í•˜ì—¬ overflow ë¬¸ì œ í•´ê²°)
            let tooltip = d3.select('body').select('.funnel-tooltip');
            if (tooltip.empty()) {
                tooltip = d3.select('body')
                    .append('div')
                    .attr('class', 'funnel-tooltip');
            }

            // ìµœëŒ€ê°’ ê¸°ì¤€ìœ¼ë¡œ ìŠ¤ì¼€ì¼ ê³„ì‚°
            const maxValue = d3.max(funnelData, d => d.total);
            const stageHeight = height / funnelData.length;
            const spacing = 10;

            // ê° ë‹¨ê³„ ê·¸ë¦¬ê¸°
            funnelData.forEach((stage, i) => {
                // ê° ë‹¨ê³„ë§ˆë‹¤ ì ì§„ì ìœ¼ë¡œ ì–´ë‘ì›Œì§€ëŠ” ìƒ‰ìƒ ê³„ì‚°
                const stageColor = d3.color(stage.color).darker(i * 0.25);

                const yPos = i * stageHeight;
                const topWidth = (stage.total / maxValue) * width;
                const bottomWidth = i < funnelData.length - 1
                    ? (funnelData[i + 1].total / maxValue) * width
                    : topWidth * 0.8;

                const xOffset = (width - topWidth) / 2;
                const xOffsetBottom = (width - bottomWidth) / 2;

                // ë‹¨ê³„ ì‚¬ì´ í™”ì‚´í‘œ ì¶”ê°€ (ì²« ë‹¨ê³„ ì œì™¸)
                if (i > 0) {
                    const prevBottomWidth = funnelData[i - 1].total > 0
                        ? (funnelData[i - 1].total / maxValue) * width
                        : topWidth;
                    const prevXOffsetBottom = (width - prevBottomWidth) / 2;

                    // í™”ì‚´í‘œ ê·¸ë£¹
                    const arrowGroup = svg.append('g')
                        .attr('opacity', 0.4);

                    // í™”ì‚´í‘œ ë¼ì¸
                    arrowGroup.append('line')
                        .attr('x1', width / 2)
                        .attr('y1', yPos - spacing / 2 - 15)
                        .attr('x2', width / 2)
                        .attr('y2', yPos - spacing / 2)
                        .attr('stroke', stageColor)
                        .attr('stroke-width', 3)
                        .attr('stroke-dasharray', '5,5');

                    // í™”ì‚´í‘œ í—¤ë“œ
                    arrowGroup.append('polygon')
                        .attr('points', `
                            ${width / 2},${yPos - spacing / 2}
                            ${width / 2 - 6},${yPos - spacing / 2 - 8}
                            ${width / 2 + 6},${yPos - spacing / 2 - 8}
                        `)
                        .attr('fill', stageColor);
                }

                // í¼ë„ ë‹¨ê³„ (íŠ¸ë¼í˜ì¦ˆì´ë“œ)
                const group = svg.append('g')
                    .attr('class', 'funnel-stage')
                    .style('cursor', 'pointer');

                // ê·¸ë¼ë°ì´ì…˜ ì •ì˜ (í•˜ìœ„ depthë¡œ ê°ˆìˆ˜ë¡ ì–´ë‘ìš´ ìƒ‰ìƒ)
                const gradientId = `gradient-${i}`;
                const gradient = svg.append('defs')
                    .append('linearGradient')
                    .attr('id', gradientId)
                    .attr('x1', '0%')
                    .attr('y1', '0%')
                    .attr('x2', '0%')
                    .attr('y2', '100%');

                gradient.append('stop')
                    .attr('offset', '0%')
                    .attr('stop-color', stageColor)
                    .attr('stop-opacity', 1);

                gradient.append('stop')
                    .attr('offset', '50%')
                    .attr('stop-color', stageColor)
                    .attr('stop-opacity', 0.9);

                gradient.append('stop')
                    .attr('offset', '100%')
                    .attr('stop-color', stageColor)
                    .attr('stop-opacity', 0.75);

                // íŠ¸ë¼í˜ì¦ˆì´ë“œ ê²½ë¡œ
                const path = `
                    M ${xOffset} ${yPos}
                    L ${xOffset + topWidth} ${yPos}
                    L ${xOffsetBottom + bottomWidth} ${yPos + stageHeight - spacing}
                    L ${xOffsetBottom} ${yPos + stageHeight - spacing}
                    Z
                `;

                group.append('path')
                    .attr('d', path)
                    .attr('fill', `url(#${gradientId})`)
                    .attr('stroke', stageColor)
                    .attr('stroke-width', 2)
                    .attr('opacity', 0.85);

                // í…ìŠ¤íŠ¸ ë°°ê²½ (ê°€ë…ì„± í–¥ìƒ)
                const textBg = group.append('rect')
                    .attr('x', width / 2 - 120)
                    .attr('y', yPos + stageHeight / 2 - 35)
                    .attr('width', 240)
                    .attr('height', i > 0 ? 65 : 45)
                    .attr('fill', 'rgba(255, 255, 255, 0.95)')
                    .attr('rx', 8)
                    .attr('stroke', stageColor)
                    .attr('stroke-width', 2)
                    .attr('filter', 'drop-shadow(0 2px 4px rgba(0,0,0,0.1))');

                // ë ˆì´ë¸”
                group.append('text')
                    .attr('class', 'funnel-stage-label')
                    .attr('x', width / 2)
                    .attr('y', yPos + stageHeight / 2 - 15)
                    .attr('text-anchor', 'middle')
                    .style('fill', stageColor)
                    .text(stage.name);

                // ê°’ í‘œì‹œ
                group.append('text')
                    .attr('class', 'funnel-stage-value')
                    .attr('x', width / 2)
                    .attr('y', yPos + stageHeight / 2 + 5)
                    .attr('text-anchor', 'middle')
                    .style('fill', 'var(--grey-900)')
                    .style('font-weight', '700')
                    .text(stage.total.toLocaleString() + ' users');

                // ì „í™˜ìœ¨ ë° ì´íƒˆë¥  í‘œì‹œ (ì²« ë‹¨ê³„ ì œì™¸)
                if (i > 0) {
                    const conversionText = group.append('text')
                        .attr('class', 'funnel-stage-conversion')
                        .attr('x', width / 2)
                        .attr('y', yPos + stageHeight / 2 + 22)
                        .attr('text-anchor', 'middle');

                    // ì „í™˜ìœ¨ (ê¸°ë³¸ ìƒ‰ìƒ)
                    conversionText.append('tspan')
                        .style('fill', stageColor)
                        .style('font-weight', '600')
                        .text(`ì „í™˜ìœ¨: ${stage.conversionRate}%`);

                    // êµ¬ë¶„ì
                    conversionText.append('tspan')
                        .style('fill', 'var(--grey-600)')
                        .text(' | ');

                    // ì´íƒˆë¥  (ë¹¨ê°„ìƒ‰)
                    conversionText.append('tspan')
                        .style('fill', '#EF4444')
                        .style('font-weight', '600')
                        .text(`ì´íƒˆ: ${stage.dropOffRate}%`);
                }

                // ì¸ì‚¬ì´íŠ¸ ë° ì¶”ì²œì‚¬í•­ ë°ì´í„°
                const insights = getStageInsights(stage, i);

                // ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸
                group.on('mouseover', function(event) {
                    d3.select(this)
                        .style('opacity', 1)
                        .style('filter', 'brightness(1.1)');

                    tooltip.html(`
                        <div class="funnel-tooltip-title">${stage.name}</div>
                        <div class="funnel-tooltip-metric">
                            <span class="funnel-tooltip-metric-label">ì´ ì‚¬ìš©ì</span>
                            <span class="funnel-tooltip-metric-value">${stage.total.toLocaleString()}ëª…</span>
                        </div>
                        ${i > 0 ? `
                        <div class="funnel-tooltip-metric">
                            <span class="funnel-tooltip-metric-label">ì „í™˜ìœ¨</span>
                            <span class="funnel-tooltip-metric-value" style="color: ${stageColor}; font-weight: 600;">${stage.conversionRate}%</span>
                        </div>
                        <div class="funnel-tooltip-metric">
                            <span class="funnel-tooltip-metric-label">ì´íƒˆë¥ </span>
                            <span class="funnel-tooltip-metric-value" style="color: #EF4444; font-weight: 600;">${stage.dropOffRate}%</span>
                        </div>
                        ` : ''}
                        <div class="funnel-tooltip-insight">${insights.insight}</div>
                        <div class="funnel-tooltip-recommendation">${insights.recommendation}</div>
                    `)
                    .classed('visible', true);

                    // íˆ´íŒ ìœ„ì¹˜ ì¡°ì • (rect ë°•ìŠ¤ ì˜†ì— í‘œì‹œ)
                    requestAnimationFrame(() => {
                        const tooltipNode = tooltip.node();
                        const tooltipRect = tooltipNode.getBoundingClientRect();
                        const padding = 15;

                        // rect ë°•ìŠ¤ì˜ ìœ„ì¹˜ ê³„ì‚°
                        const rectX = width / 2 - 120; // rectì˜ x ì¢Œí‘œ
                        const rectY = yPos + stageHeight / 2 - 35; // rectì˜ y ì¢Œí‘œ
                        const rectWidth = 240;

                        // ì»¨í…Œì´ë„ˆì˜ í™”ë©´ìƒ ìœ„ì¹˜
                        const containerRect = container.getBoundingClientRect();

                        // rect ì˜¤ë¥¸ìª½ ì˜†ì— ë°°ì¹˜ ì‹œë„
                        let left = containerRect.left + margin.left + rectX + rectWidth + padding;
                        let top = containerRect.top + margin.top + rectY;

                        // ì˜¤ë¥¸ìª½ ê²½ê³„ë¥¼ ë„˜ìœ¼ë©´ ì™¼ìª½ì— ë°°ì¹˜
                        if (left + tooltipRect.width + padding > window.innerWidth) {
                            left = containerRect.left + margin.left + rectX - tooltipRect.width - padding;
                        }

                        // ì™¼ìª½ ê²½ê³„ë„ ë„˜ìœ¼ë©´ í™”ë©´ ì•ˆìª½ìœ¼ë¡œ ì¡°ì •
                        if (left < padding) {
                            left = padding;
                        }

                        // í•˜ë‹¨ ê²½ê³„ë¥¼ ë„˜ìœ¼ë©´ ìœ„ë¡œ ì¡°ì •
                        if (top + tooltipRect.height + padding > window.innerHeight) {
                            top = window.innerHeight - tooltipRect.height - padding;
                        }

                        // ìƒë‹¨ ê²½ê³„ë¥¼ ë„˜ìœ¼ë©´ ì•„ë˜ë¡œ ì¡°ì •
                        if (top < padding) {
                            top = padding;
                        }

                        tooltip
                            .style('left', left + 'px')
                            .style('top', top + 'px');
                    });
                })
                .on('mouseout', function() {
                    d3.select(this)
                        .style('opacity', 0.85)
                        .style('filter', 'none');
                    tooltip.classed('visible', false);
                });
            });

            console.log('=== updateFunnelChart ì™„ë£Œ ===\n');
        }

        // ë‹¨ê³„ë³„ ì¸ì‚¬ì´íŠ¸ ë° ì¶”ì²œì‚¬í•­ ìƒì„±
        function getStageInsights(stage, index) {
            const insights = {
                0: {
                    insight: 'ì‚¬ìš©ì ìœ ì…ì˜ ì‹œì‘ ë‹¨ê³„ì…ë‹ˆë‹¤. ëª¨ë“  ë§ˆì¼€íŒ… ì±„ë„ì˜ íŠ¸ë˜í”½ì´ ì§‘ê³„ë©ë‹ˆë‹¤.',
                    recommendation: 'ìœ ë£Œ ê´‘ê³ , SEO, ì†Œì…œ ë¯¸ë””ì–´ ë“± ë‹¤ì–‘í•œ ì±„ë„ì˜ ìœ ì… í’ˆì§ˆì„ ê°œì„ í•˜ì„¸ìš”.'
                },
                1: {
                    insight: 'ì²« ë°©ë¬¸ìê°€ í™œì„±í™”ë˜ëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤. ì´íƒˆë¥ ì´ ë†’ë‹¤ë©´ ëœë”©í˜ì´ì§€ì— ë¬¸ì œê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
                    recommendation: parseFloat(stage.dropOffRate) > 50
                        ? 'ì´íƒˆë¥ ì´ ë§¤ìš° ë†’ìŠµë‹ˆë‹¤. ëœë”©í˜ì´ì§€ ì†ë„, ë””ìì¸, CTAë¥¼ ì¦‰ì‹œ ê°œì„ í•˜ì„¸ìš”.'
                        : 'ëœë”©í˜ì´ì§€ A/B í…ŒìŠ¤íŠ¸ë¥¼ í†µí•´ ì „í™˜ìœ¨ì„ ì§€ì†ì ìœ¼ë¡œ ê°œì„ í•˜ì„¸ìš”.'
                },
                2: {
                    insight: 'ì‚¬ìš©ìê°€ ì œí’ˆ/ì„œë¹„ìŠ¤ì— ê´€ì‹¬ì„ ë³´ì´ëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤.',
                    recommendation: parseFloat(stage.dropOffRate) > 40
                        ? 'ì œí’ˆ í˜ì´ì§€ì˜ ì •ë³´ í’ˆì§ˆê³¼ ì´ë¯¸ì§€ë¥¼ ê°œì„ í•˜ê³ , ë¦¬ë·°ë¥¼ ê°•í™”í•˜ì„¸ìš”.'
                        : 'ì¶”ì²œ ì‹œìŠ¤í…œê³¼ ê°œì¸í™”ë¥¼ í†µí•´ ê´€ì‹¬ì„ êµ¬ë§¤ë¡œ ì „í™˜í•˜ì„¸ìš”.'
                },
                3: {
                    insight: 'ê²°ì œë¥¼ ì‹œì‘í•œ ë‹¨ê³„ì…ë‹ˆë‹¤. ì—¬ê¸°ì„œì˜ ì´íƒˆì€ í° ê¸°íšŒ ì†ì‹¤ì…ë‹ˆë‹¤.',
                    recommendation: parseFloat(stage.dropOffRate) > 30
                        ? 'ê²°ì œ í”„ë¡œì„¸ìŠ¤ë¥¼ ë‹¨ìˆœí™”í•˜ê³ , ë°°ì†¡ë¹„/ê²°ì œ ìˆ˜ë‹¨ì„ ëª…í™•íˆ í‘œì‹œí•˜ì„¸ìš”.'
                        : 'ì›í´ë¦­ ê²°ì œ, ê²ŒìŠ¤íŠ¸ ì²´í¬ì•„ì›ƒ ë“±ìœ¼ë¡œ ë§ˆì°°ì„ ìµœì†Œí™”í•˜ì„¸ìš”.'
                },
                4: {
                    insight: 'ìµœì¢… êµ¬ë§¤ ì™„ë£Œ ë‹¨ê³„ì…ë‹ˆë‹¤. ì´ ì‚¬ìš©ìë“¤ì„ ì¬êµ¬ë§¤ ê³ ê°ìœ¼ë¡œ ì „í™˜í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.',
                    recommendation: 'ì´ë©”ì¼ ë§ˆì¼€íŒ…, ë¦¬íƒ€ê²ŸíŒ… ê´‘ê³ , ë¡œì—´í‹° í”„ë¡œê·¸ë¨ìœ¼ë¡œ ì¬êµ¬ë§¤ë¥¼ ìœ ë„í•˜ì„¸ìš”.'
                }
            };

            return insights[index] || { insight: '', recommendation: '' };
        }

        // ê³ ê¸‰ ë¶„ì„ ê²°ê³¼ ì—…ë°ì´íŠ¸ (ë°ì´í„° ê¸°ë°˜ ì˜ì‚¬ê²°ì • ë„êµ¬ìš©)
        function updateAdvancedAnalysis() {
            const periodData = getPeriodData();
            if (!periodData) return;

            // 1. ì˜ˆì‚° íˆ¬ì ê°€ì´ë“œ (íˆ¬ì ëŒ€ë¹„ ê¸°ëŒ€ ì„±ê³¼ ë¶„ì„) - ê¸°ê°„ í•„í„° ì ìš©
            const abTestContainer = document.getElementById('abTestResults');

            // ê¸°ê°„ë³„ channel_strategy ë°ì´í„° ì‚¬ìš©
            const channelStrategy = periodData.channel_strategy;
            if (channelStrategy && channelStrategy.status === 'success' && channelStrategy.channels) {
                const channelEntries = Object.entries(channelStrategy.channels);

                // ê° ì±„ë„ì˜ íˆ¬ì íš¨ìœ¨ì„± ê³„ì‚°
                const channelInvestmentScores = channelEntries.map(([channelName, channelInfo]) => {
                    const stats = channelInfo.stats || {};
                    const acquisition = parseFloat(stats.users) || 0;
                    const cvr = parseFloat(stats.cvr) || 0;
                    const revenue = parseFloat(stats.revenue) || 0;
                    // purchaseëŠ” users * cvr / 100ìœ¼ë¡œ ê³„ì‚°
                    const purchase = Math.round(acquisition * cvr / 100);

                    // ì‹ ë¢°ë„: ë°ì´í„° ìƒ˜í”Œ ìˆ˜ ê¸°ë°˜ (ìœ ì… ìˆ˜ê°€ ë§ì„ìˆ˜ë¡ ë†’ìŒ)
                    let confidence = 'ë‚®ìŒ';
                    let confidenceScore = 0;
                    if (acquisition >= 100000) {
                        confidence = 'ë§¤ìš° ë†’ìŒ';
                        confidenceScore = 4;
                    } else if (acquisition >= 10000) {
                        confidence = 'ë†’ìŒ';
                        confidenceScore = 3;
                    } else if (acquisition >= 1000) {
                        confidence = 'ë³´í†µ';
                        confidenceScore = 2;
                    } else if (acquisition >= 100) {
                        confidence = 'ë‚®ìŒ';
                        confidenceScore = 1;
                    }

                    // í‰ê·  ê°ë‹¨ê°€ (ARPU)
                    const arpu = purchase > 0 ? revenue / purchase : 0;

                    // ì±„ë„ íƒ€ì… ë¶„ë¥˜ (ê´‘ê³  vs ì˜¤ê°€ë‹‰)
                    const channelNameLower = channelName.toLowerCase();
                    let channelType = 'organic';
                    let estimatedCPA = 0; // ë°©ë¬¸ì 1ëª…ë‹¹ ìœ ì… ë¹„ìš©

                    if (channelNameLower.includes('ê´‘ê³ ') || channelNameLower.includes('ad') || channelNameLower.includes('paid')) {
                        channelType = 'paid';
                        estimatedCPA = 1500; // ìœ ë£Œ ê´‘ê³  í‰ê·  CPA (ì›/ë°©ë¬¸ì)
                    } else if (channelNameLower.includes('direct') || channelNameLower === 'direct') {
                        channelType = 'direct';
                        estimatedCPA = 0; // DirectëŠ” ìì—° ìœ ì…, íˆ¬ì ë¶ˆê°€
                    } else if (channelNameLower.includes('organic') || channelNameLower.includes('ì‡¼í•‘') || channelNameLower.includes('ë¸”ë¡œê·¸')) {
                        channelType = 'organic_optimizable';
                        estimatedCPA = 300; // ì˜¤ê°€ë‹‰ ìµœì í™” ë¹„ìš© (SEO, ì½˜í…ì¸  ë“±)
                    } else {
                        channelType = 'referral';
                        estimatedCPA = 500; // ë ˆí¼ëŸ´/ê¸°íƒ€ ì±„ë„
                    }

                    // íˆ¬ì íš¨ìœ¨ì„± ì ìˆ˜ = CVR Ã— ARPU Ã— ì‹ ë¢°ë„ ê°€ì¤‘ì¹˜
                    const investmentScore = cvr * arpu * (1 + confidenceScore * 0.1);

                    // 100ë§Œì› íˆ¬ì ì‹œ ì˜ˆìƒ ì„±ê³¼ ê³„ì‚°
                    let estimatedVisitors = 0;
                    let expectedPurchases = 0;
                    let expectedRevenue = 0;
                    let roi = -100;
                    let isInvestable = true;

                    if (channelType === 'direct') {
                        // DirectëŠ” ìì—° ìœ ì…ì´ë¯€ë¡œ ê´‘ê³  íˆ¬ì ë¶ˆê°€
                        isInvestable = false;
                    } else if (estimatedCPA > 0) {
                        estimatedVisitors = 1000000 / estimatedCPA; // 100ë§Œì›ìœ¼ë¡œ í™•ë³´ ê°€ëŠ¥í•œ ë°©ë¬¸ì ìˆ˜
                        expectedPurchases = estimatedVisitors * (cvr / 100); // ì˜ˆìƒ êµ¬ë§¤ ê±´ìˆ˜
                        expectedRevenue = expectedPurchases * arpu; // ì˜ˆìƒ ë§¤ì¶œì•¡
                        roi = expectedRevenue > 0 ? ((expectedRevenue - 1000000) / 1000000 * 100) : -100;
                    }

                    return {
                        channel: channelName,
                        cvr: cvr,
                        revenue: revenue,
                        purchase: purchase,
                        acquisition: acquisition,
                        arpu: arpu,
                        confidence: confidence,
                        confidenceScore: confidenceScore,
                        investmentScore: investmentScore,
                        channelType: channelType,
                        estimatedCPA: estimatedCPA,
                        isInvestable: isInvestable,
                        estimatedVisitors: estimatedVisitors,
                        expectedPurchases: expectedPurchases,
                        expectedRevenue: expectedRevenue,
                        roi: roi
                    };
                }).filter(item => item.acquisition > 0 && item.cvr > 0)
                  .sort((a, b) => b.roi - a.roi)
                  .slice(0, 8);

                if (channelInvestmentScores.length > 0) {
                    abTestContainer.innerHTML = `
                        <div style="margin-bottom: 16px;">
                            <p style="font-size: 14px; color: var(--grey-700); margin-bottom: 8px;">
                                <strong>${channelInvestmentScores.length}ê°œ</strong> ì±„ë„ì˜ íˆ¬ì íš¨ìœ¨ì„± ë¶„ì„ ì™„ë£Œ
                            </p>
                            <p style="font-size: 12px; color: var(--grey-600);">
                                ğŸ’¡ ì „í™˜ìœ¨, í‰ê·  ê°ë‹¨ê°€, ë°ì´í„° ì‹ ë¢°ë„ë¥¼ ì¢…í•©í•˜ì—¬ íˆ¬ì ì‹œ ê¸°ëŒ€ ì„±ê³¼ê°€ ë†’ì€ ìˆœìœ¼ë¡œ ì •ë ¬í–ˆìŠµë‹ˆë‹¤.
                            </p>
                        </div>
                        <div id="investmentItemsContainer" style="display: grid; gap: 12px;">
                            ${channelInvestmentScores.map((channel, index) => {
                                const rankEmoji = index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : `${index + 1}ìœ„`;
                                const confidenceColor = channel.confidenceScore >= 3 ? 'var(--success-main)' :
                                                       channel.confidenceScore === 2 ? 'var(--warning-main)' : 'var(--grey-400)';
                                const bgColor = channel.confidenceScore >= 3 ? 'linear-gradient(135deg, var(--success-light) 0%, #f0fff4 100%)' :
                                               channel.confidenceScore === 2 ? 'linear-gradient(135deg, var(--warning-light) 0%, #fff9e6 100%)' : 'var(--grey-50)';
                                const borderColor = channel.confidenceScore >= 3 ? 'var(--success-main)' :
                                                   channel.confidenceScore === 2 ? 'var(--warning-main)' : 'var(--grey-300)';
                                const hiddenClass = index >= 3 ? ' hidden-row' : '';

                                return `
                                <div class="investment-item${hiddenClass}" style="padding: 16px; background: ${bgColor}; border-radius: 8px; border-left: 4px solid ${borderColor};">
                                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                                        <div style="flex: 1;">
                                            <div style="font-size: 16px; font-weight: 700; color: var(--grey-900); margin-bottom: 8px;">
                                                ${rankEmoji} ${channel.channel}
                                            </div>
                                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 12px;">
                                                <div style="padding: 8px; background: white; border-radius: 6px;">
                                                    <div style="font-size: 11px; color: var(--grey-600); margin-bottom: 2px;">ì „í™˜ìœ¨</div>
                                                    <div style="font-size: 16px; font-weight: 700; color: var(--primary-main);">
                                                        ${formatDecimal(channel.cvr)}%
                                                    </div>
                                                </div>
                                                <div style="padding: 8px; background: white; border-radius: 6px;">
                                                    <div style="font-size: 11px; color: var(--grey-600); margin-bottom: 2px;">í‰ê·  ê°ë‹¨ê°€</div>
                                                    <div style="font-size: 16px; font-weight: 700; color: var(--success-main);">
                                                        ${formatNumber(Math.round(channel.arpu))}ì›
                                                    </div>
                                                </div>
                                                <div style="padding: 8px; background: white; border-radius: 6px;">
                                                    <div style="font-size: 11px; color: var(--grey-600); margin-bottom: 2px;">ë°ì´í„° ì‹ ë¢°ë„</div>
                                                    <div style="font-size: 13px; font-weight: 700; color: ${confidenceColor};">
                                                        ${channel.confidence}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    ${channel.confidenceScore >= 2 ? (
                                        channel.isInvestable ? `
                                        <div style="padding: 14px; background: white; border-radius: 8px; border-left: 3px solid var(--primary-main); margin-bottom: 8px;">
                                            <div style="font-size: 13px; color: var(--grey-900); font-weight: 700; margin-bottom: 10px;">
                                                ğŸ’° 100ë§Œì› íˆ¬ì ì‹œ ì˜ˆìƒ ì„±ê³¼
                                                <span style="font-size: 11px; font-weight: 500; color: var(--grey-600); margin-left: 8px;">
                                                    (ì˜ˆìƒ CPA: ${formatNumber(channel.estimatedCPA)}ì›/ë°©ë¬¸ì)
                                                </span>
                                            </div>
                                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 12px;">
                                                <div>
                                                    <div style="font-size: 11px; color: var(--grey-600); margin-bottom: 4px;">ì˜ˆìƒ ìœ ì…</div>
                                                    <div style="font-size: 16px; font-weight: 700; color: var(--secondary-main);">
                                                        ì•½ ${formatNumber(Math.round(channel.estimatedVisitors))}ëª…
                                                    </div>
                                                </div>
                                                <div>
                                                    <div style="font-size: 11px; color: var(--grey-600); margin-bottom: 4px;">ì˜ˆìƒ êµ¬ë§¤</div>
                                                    <div style="font-size: 16px; font-weight: 700; color: var(--primary-main);">
                                                        ì•½ ${formatNumber(Math.round(channel.expectedPurchases))}ê±´
                                                    </div>
                                                </div>
                                                <div>
                                                    <div style="font-size: 11px; color: var(--grey-600); margin-bottom: 4px;">ì˜ˆìƒ ë§¤ì¶œ</div>
                                                    <div style="font-size: 16px; font-weight: 700; color: var(--success-main);">
                                                        ì•½ ${formatNumber(Math.round(channel.expectedRevenue))}ì›
                                                    </div>
                                                </div>
                                            </div>
                                            <div style="padding: 10px; background: ${channel.roi > 100 ? '#e8f5e9' : channel.roi > 0 ? '#fff3e0' : '#ffebee'}; border-radius: 6px;">
                                                <div style="font-size: 11px; color: var(--grey-600); margin-bottom: 4px;">ì˜ˆìƒ ROI (íˆ¬ììˆ˜ìµë¥ )</div>
                                                <div style="font-size: 22px; font-weight: 700; color: ${channel.roi > 0 ? 'var(--success-main)' : 'var(--error-main)'};">
                                                    ${channel.roi > 0 ? '+' : ''}${formatDecimal(channel.roi)}%
                                                    <span style="font-size: 12px; font-weight: 500; margin-left: 8px;">
                                                        (ìˆœì´ìµ: ${channel.roi > 0 ? '+' : ''}${formatNumber(Math.round(channel.expectedRevenue - 1000000))}ì›)
                                                    </span>
                                                </div>
                                            </div>
                                        </div>

                                        <div style="padding: 14px; background: linear-gradient(135deg, #e8eaf6 0%, #f3f4f9 100%); border-radius: 6px;">
                                            <div style="font-size: 12px; color: var(--grey-800); line-height: 1.7;">
                                                ğŸ’¡ <strong>íˆ¬ì ì „ëµ:</strong><br>
                                                ${channel.channelType === 'paid' ?
                                                    (channel.roi > 200 ?
                                                        `ì´ ê´‘ê³  ì±„ë„ì€ <strong style="color: var(--success-main);">ë§¤ìš° ë†’ì€ ìˆ˜ìµë¥ (+${formatDecimal(channel.roi)}%)</strong>ì„ ë³´ì…ë‹ˆë‹¤. 100ë§Œì› íˆ¬ì ì‹œ ì•½ <strong>${formatNumber(Math.round(channel.expectedRevenue))}ì›</strong>ì˜ ë§¤ì¶œì´ ì˜ˆìƒë˜ë©°, <strong>ì¶”ê°€ ì˜ˆì‚° íˆ¬ì…</strong>ì„ ì ê·¹ ê¶Œì¥í•©ë‹ˆë‹¤.` :
                                                    channel.roi > 100 ?
                                                        `ì´ ê´‘ê³  ì±„ë„ì€ <strong style="color: var(--success-main);">ì–‘í˜¸í•œ ìˆ˜ìµë¥ (+${formatDecimal(channel.roi)}%)</strong>ì„ ë³´ì…ë‹ˆë‹¤. 100ë§Œì› íˆ¬ìë¡œ ì•½ ${formatNumber(Math.round(channel.estimatedVisitors))}ëª… ìœ ì…, ${formatNumber(Math.round(channel.expectedPurchases))}ê±´ êµ¬ë§¤ê°€ ì˜ˆìƒë©ë‹ˆë‹¤. <strong>ì˜ˆì‚° ì¦ì•¡ ê³ ë ¤</strong>ë¥¼ ì¶”ì²œí•©ë‹ˆë‹¤.` :
                                                    channel.roi > 0 ?
                                                        `ì´ ê´‘ê³  ì±„ë„ì€ ìˆ˜ìµì„±ì´ ìˆìœ¼ë‚˜(+${formatDecimal(channel.roi)}%), ë‹¤ë¥¸ ì±„ë„ ëŒ€ë¹„ íš¨ìœ¨ì´ ë‚®ìŠµë‹ˆë‹¤. ê´‘ê³  ì†Œì¬ì™€ íƒ€ê²ŸíŒ…ì„ ê°œì„ í•˜ë©´ ë” ë‚˜ì€ ì„±ê³¼ë¥¼ ê¸°ëŒ€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.` :
                                                        `í˜„ì¬ ì´ ê´‘ê³  ì±„ë„ì€ ì†ì‹¤(${formatDecimal(channel.roi)}%)ì´ ì˜ˆìƒë©ë‹ˆë‹¤. <strong>ìº í˜ì¸ ìµœì í™” ë˜ëŠ” ì˜ˆì‚° ì¬ë¶„ë°°</strong>ê°€ í•„ìš”í•©ë‹ˆë‹¤.`) :
                                                channel.channelType === 'organic_optimizable' ?
                                                    (channel.roi > 200 ?
                                                        `SEO/ì½˜í…ì¸  ìµœì í™”ì— <strong>100ë§Œì› íˆ¬ì ì‹œ ì•½ ${formatNumber(Math.round(channel.estimatedVisitors))}ëª…ì˜ ì¶”ê°€ ìœ ì…</strong>ê³¼ <strong>${formatNumber(Math.round(channel.expectedRevenue))}ì›ì˜ ë§¤ì¶œ</strong>ì´ ì˜ˆìƒë©ë‹ˆë‹¤. ì „í™˜ìœ¨ì´ ${formatDecimal(channel.cvr)}%ë¡œ ë†’ì•„ <strong style="color: var(--success-main);">ë§¤ìš° íš¨ìœ¨ì ì¸ íˆ¬ìì²˜</strong>ì…ë‹ˆë‹¤.` :
                                                    channel.roi > 0 ?
                                                        `ì´ ì±„ë„ì€ ì˜¤ê°€ë‹‰ íŠ¸ë˜í”½ ìµœì í™”ë¥¼ í†µí•´ ìˆ˜ìµì„ ì°½ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. SEO, ë¸”ë¡œê·¸ ì½˜í…ì¸ , ì‡¼í•‘ëª° ìµœì í™” ë“±ì— íˆ¬ìí•˜ë©´ ì§€ì† ê°€ëŠ¥í•œ ì„±ì¥ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.` :
                                                        `í˜„ì¬ ì „í™˜ìœ¨(${formatDecimal(channel.cvr)}%)ê³¼ ê°ë‹¨ê°€(${formatNumber(Math.round(channel.arpu))}ì›)ë¥¼ ê³ ë ¤í•  ë•Œ, íˆ¬ì ì „ ì½˜í…ì¸  í’ˆì§ˆê³¼ ì‚¬ìš©ì ê²½í—˜ ê°œì„ ì´ ìš°ì„ ì…ë‹ˆë‹¤.`) :
                                                    `ì´ ì±„ë„ì€ ì „í™˜ìœ¨ ${formatDecimal(channel.cvr)}%, ê°ë‹¨ê°€ ${formatNumber(Math.round(channel.arpu))}ì›ìœ¼ë¡œ íˆ¬ì íš¨ìœ¨ì„±ì´ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤. íŒŒíŠ¸ë„ˆì‹­ ê°•í™”ë‚˜ ì œíœ´ í™•ëŒ€ë¥¼ ê³ ë ¤í•´ë³´ì„¸ìš”.`
                                                }
                                            </div>
                                        </div>
                                        ` : `
                                        <div style="padding: 14px; background: linear-gradient(135deg, #fff3e0 0%, #fff9e6 100%); border-radius: 8px; border-left: 3px solid var(--warning-main);">
                                            <div style="font-size: 13px; color: var(--grey-900); font-weight: 700; margin-bottom: 8px;">
                                                â„¹ï¸ Direct ìì—° ìœ ì… ì±„ë„
                                            </div>
                                            <div style="font-size: 12px; color: var(--grey-700); line-height: 1.6;">
                                                ì´ ì±„ë„ì€ <strong>ìì—° ìœ ì…(Direct Traffic)</strong>ìœ¼ë¡œ, ì§ì ‘ì ì¸ ê´‘ê³  íˆ¬ì ëŒ€ìƒì´ ì•„ë‹™ë‹ˆë‹¤.<br><br>
                                                <strong>í˜„ì¬ ì„±ê³¼:</strong><br>
                                                â€¢ ì „í™˜ìœ¨: ${formatDecimal(channel.cvr)}%<br>
                                                â€¢ í‰ê·  ê°ë‹¨ê°€: ${formatNumber(Math.round(channel.arpu))}ì›<br>
                                                â€¢ ì´ ë§¤ì¶œ: ${formatNumber(channel.revenue)}ì›<br><br>
                                                ğŸ’¡ <strong>ê°œì„  ë°©ì•ˆ:</strong> ë¸Œëœë“œ ì¸ì§€ë„ í–¥ìƒ, ì´ë©”ì¼ ë§ˆì¼€íŒ…, ë¦¬ë§ˆì¼€íŒ… ë“±ì„ í†µí•´ Direct ìœ ì…ì„ ëŠ˜ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í˜„ì¬ ë†’ì€ ì „í™˜ìœ¨(${formatDecimal(channel.cvr)}%)ì„ ìœ ì§€í•˜ë©´ì„œ ìœ ì…ëŸ‰ì„ ì¦ê°€ì‹œí‚¤ëŠ” ê²ƒì´ í•µì‹¬ì…ë‹ˆë‹¤.
                                            </div>
                                        </div>
                                        `
                                    ) : `
                                        <div style="padding: 12px; background: white; border-radius: 6px; border-left: 3px solid var(--grey-300);">
                                            <div style="font-size: 12px; color: var(--grey-700);">
                                                âš ï¸ ë°ì´í„°ê°€ ì¶©ë¶„í•˜ì§€ ì•Šì•„ ì •í™•í•œ íˆ¬ì ì„±ê³¼ ì˜ˆì¸¡ì´ ì–´ë µìŠµë‹ˆë‹¤. ë” ë§ì€ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•œ í›„ ì¬í‰ê°€í•˜ì„¸ìš”. (í˜„ì¬ ìœ ì…: ${formatNumber(channel.acquisition)}ëª…)
                                            </div>
                                        </div>
                                    `}
                                </div>
                            `;
                            }).join('')}
                        </div>
                        ${channelInvestmentScores.length > 3 ? `
                        <div class="show-more-container" id="investmentShowMoreContainer" style="margin-top: 12px;">
                            <button class="show-more-btn" id="investmentShowMoreBtn">ë” ë³´ê¸° (<span id="investmentHiddenCount">${channelInvestmentScores.length - 3}</span>ê°œ)</button>
                        </div>
                        <div class="show-more-container" id="investmentCollapseContainer" style="display: none; margin-top: 12px;">
                            <button class="show-more-btn" id="investmentCollapseBtn">ì ‘ê¸°</button>
                        </div>
                        ` : ''}
                    `;

                    // ë”ë³´ê¸°/ì ‘ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
                    if (channelInvestmentScores.length > 3) {
                        const showMoreBtn = document.getElementById('investmentShowMoreBtn');
                        const collapseBtn = document.getElementById('investmentCollapseBtn');

                        if (showMoreBtn) {
                            showMoreBtn.addEventListener('click', function() {
                                const hiddenItems = document.querySelectorAll('.investment-item.hidden-row');
                                const showMoreContainer = document.getElementById('investmentShowMoreContainer');
                                const collapseContainer = document.getElementById('investmentCollapseContainer');

                                hiddenItems.forEach(item => {
                                    item.classList.remove('hidden-row');
                                });

                                showMoreContainer.style.display = 'none';
                                collapseContainer.style.display = 'block';
                            });
                        }

                        if (collapseBtn) {
                            collapseBtn.addEventListener('click', function() {
                                const allItems = document.querySelectorAll('.investment-item');
                                const showMoreContainer = document.getElementById('investmentShowMoreContainer');
                                const collapseContainer = document.getElementById('investmentCollapseContainer');

                                allItems.forEach((item, index) => {
                                    if (index >= 3) {
                                        item.classList.add('hidden-row');
                                    }
                                });

                                showMoreContainer.style.display = 'block';
                                collapseContainer.style.display = 'none';
                            });
                        }
                    }
                } else {
                    abTestContainer.innerHTML = '<p style="color: var(--grey-500);">ì„ íƒí•œ ê¸°ê°„ì— ë¶„ì„ ê°€ëŠ¥í•œ ì±„ë„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                }
            } else {
                abTestContainer.innerHTML = '<p style="color: var(--grey-500);">ì±„ë„ ì „ëµ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            }

            // 2. BCG Matrix ì±„ë„ ì „ëµ ì—…ë°ì´íŠ¸ (ê¸°ê°„ í•„í„° ì ìš©)
            updateBCGMatrix();

            // 3. ì±„ë„ í´ëŸ¬ìŠ¤í„°ë§ (ê¸°ê°„ í•„í„° ì ìš©)
            const clusterContainer = document.getElementById('channelClusters');
            if (periodData.channel_clusters && periodData.channel_clusters.clusters) {
                const clusters = periodData.channel_clusters.clusters;
                const descriptions = periodData.channel_clusters.description;

                clusterContainer.innerHTML = `
                    <div style="margin-bottom: 16px;">
                        <p style="font-size: 14px; color: var(--grey-700); margin-bottom: 12px;">
                            í¼ë„ ê±´ê°•ë„ ê¸°ì¤€ <strong>${periodData.channel_clusters.n_clusters}ê°œ</strong> ê·¸ë£¹ìœ¼ë¡œ ë¶„ë¥˜
                            <span style="font-size: 12px; color: var(--grey-500); margin-left: 8px;">(ìœ ì…â†’í™œë™â†’ê´€ì‹¬â†’ê²°ì œ ë‹¨ê³„ë³„ ì „í™˜ìœ¨ í‰ê· )</span>
                        </p>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px;">
                        ${Object.entries(clusters).map(([clusterName, channels], index) => {
                            const colors = ['var(--success-main)', 'var(--warning-main)', 'var(--error-main)'];
                            const bgColors = ['var(--success-light)', 'var(--warning-light)', 'var(--error-light)'];
                            return `
                                <div style="padding: 16px; background: ${bgColors[index % 3]}; border-radius: 8px; border-left: 4px solid ${colors[index % 3]};">
                                    <div style="font-size: 14px; font-weight: 600; color: var(--grey-900); margin-bottom: 8px;">
                                        ${descriptions[clusterName] || clusterName}
                                    </div>
                                    <div style="font-size: 13px; color: var(--grey-700);">
                                        ${channels.map(ch => `<span style="display: inline-block; padding: 4px 8px; background: white; border-radius: 4px; margin: 2px;">${ch}</span>`).join('')}
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            } else {
                clusterContainer.innerHTML = '<p style="color: var(--grey-500);">í´ëŸ¬ìŠ¤í„°ë§ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            }

            // 2.5 A/B í…ŒìŠ¤íŠ¸ í†µê³„ ê²°ê³¼ (ìœ ì˜ë¯¸í•œ ì±„ë„ ë¹„êµë§Œ í‘œì‹œ)
            const abStatsContainer = document.getElementById('abTestStatsContainer');
            if (periodData.ab_test_results && periodData.ab_test_results.length > 0) {
                const significantTests = periodData.ab_test_results.filter(t => t.significant === true);
                if (significantTests.length > 0) {
                    abStatsContainer.innerHTML = `
                        <div style="padding: 16px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8f4 100%); border-radius: 8px; border-left: 4px solid var(--success-main);">
                            <div style="font-size: 14px; font-weight: 600; color: var(--success-main); margin-bottom: 12px;">
                                ğŸ“Š í†µê³„ì ìœ¼ë¡œ ìœ ì˜ë¯¸í•œ ì±„ë„ ë¹„êµ (${significantTests.length}ê±´)
                            </div>
                            <div style="font-size: 12px; color: var(--grey-600); margin-bottom: 12px;">
                                p-value < 0.05ë¡œ í†µê³„ì ìœ¼ë¡œ ìœ ì˜ë¯¸í•œ ì „í™˜ìœ¨ ì°¨ì´ê°€ í™•ì¸ëœ ì±„ë„ ì¡°í•©ì…ë‹ˆë‹¤.
                            </div>
                            <div style="display: grid; gap: 8px;">
                                ${significantTests.map(test => `
                                    <div style="padding: 12px; background: white; border-radius: 6px; display: flex; align-items: center; gap: 12px; flex-wrap: wrap;">
                                        <div style="display: flex; align-items: center; gap: 8px;">
                                            <span style="font-weight: 600; color: var(--grey-800);">${test.group_a}</span>
                                            <span style="font-size: 12px; color: ${test.cvr_a < test.cvr_b ? 'var(--error-main)' : 'var(--success-main)'};">(${test.cvr_a}%)</span>
                                        </div>
                                        <span style="color: var(--grey-400);">vs</span>
                                        <div style="display: flex; align-items: center; gap: 8px;">
                                            <span style="font-weight: 600; color: var(--grey-800);">${test.group_b}</span>
                                            <span style="font-size: 12px; color: ${test.cvr_b < test.cvr_a ? 'var(--error-main)' : 'var(--success-main)'};">(${test.cvr_b}%)</span>
                                        </div>
                                        <span style="font-size: 11px; color: var(--grey-500); margin-left: auto;">p=${test.p_value.toFixed(4)}</span>
                                    </div>
                                `).join('')}
                            </div>
                            <div style="margin-top: 12px; padding: 10px; background: #f5f5f5; border-radius: 6px; font-size: 12px; color: var(--grey-700);">
                                ğŸ’¡ <strong>í™œìš© ë°©ë²•:</strong> ì „í™˜ìœ¨ì´ ë†’ì€ ì±„ë„ì˜ ì „ëµì„ ì „í™˜ìœ¨ì´ ë‚®ì€ ì±„ë„ì— ì ìš©í•´ë³´ì„¸ìš”.
                            </div>
                        </div>
                    `;
                } else {
                    abStatsContainer.innerHTML = `
                        <div style="padding: 16px; background: linear-gradient(135deg, #f5f5f5 0%, #fafafa 100%); border-radius: 8px; border-left: 4px solid var(--grey-400);">
                            <div style="font-size: 14px; font-weight: 600; color: var(--grey-600); margin-bottom: 8px;">
                                ğŸ“Š í†µê³„ì ìœ¼ë¡œ ìœ ì˜ë¯¸í•œ ì±„ë„ ë¹„êµ
                            </div>
                            <div style="font-size: 13px; color: var(--grey-500);">
                                ì„ íƒí•œ ê¸°ê°„ ë‚´ì—ì„œëŠ” í†µê³„ì ìœ¼ë¡œ ìœ ì˜ë¯¸í•œ ì „í™˜ìœ¨ ì°¨ì´(p-value < 0.05)ë¥¼ ë³´ì´ëŠ” ì±„ë„ ì¡°í•©ì´ ì—†ìŠµë‹ˆë‹¤.
                            </div>
                            <div style="margin-top: 12px; padding: 10px; background: white; border-radius: 6px; font-size: 12px; color: var(--grey-600);">
                                ğŸ’¡ <strong>ì°¸ê³ :</strong> ë¶„ì„ ê¸°ê°„ì„ 'ì „ì²´ ê¸°ê°„'ìœ¼ë¡œ ë³€ê²½í•˜ë©´ ë” ë§ì€ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìœ ì˜ë¯¸í•œ ê²°ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                            </div>
                        </div>
                    `;
                }
            } else {
                abStatsContainer.innerHTML = `
                    <div style="padding: 16px; background: linear-gradient(135deg, #f5f5f5 0%, #fafafa 100%); border-radius: 8px; border-left: 4px solid var(--grey-400);">
                        <div style="font-size: 14px; font-weight: 600; color: var(--grey-600); margin-bottom: 8px;">
                            ğŸ“Š í†µê³„ì ìœ¼ë¡œ ìœ ì˜ë¯¸í•œ ì±„ë„ ë¹„êµ
                        </div>
                        <div style="font-size: 13px; color: var(--grey-500);">
                            ì±„ë„ ë¹„êµ ë¶„ì„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.
                        </div>
                    </div>
                `;
            }

            // 4. CRM ì•¡ì…˜ ê°€ì´ë“œ (ê¸°ê°„ í•„í„° ì ìš©)
            renderCrmActions();
        }

        // CRM ì•¡ì…˜ ê°€ì´ë“œ ë Œë”ë§ í•¨ìˆ˜ (ê¸°ê°„ í•„í„° ì—°ë™)
        function renderCrmActions() {
            const crmContainer = document.getElementById('crmActionsContainer');
            if (!crmContainer) return;

            // crm_actions_by_period ë°ì´í„°ì—ì„œ í˜„ì¬ ê¸°ê°„ì˜ CRM ì•¡ì…˜ ê°€ì ¸ì˜¤ê¸°
            const crmActionsByPeriod = insightsData.crm_actions_by_period;
            if (!crmActionsByPeriod || !crmActionsByPeriod[currentPeriod]) {
                crmContainer.innerHTML = `
                    <div style="padding: 20px; text-align: center; color: var(--grey-500);">
                        <p>ì„ íƒí•œ ê¸°ê°„ì˜ CRM ì•¡ì…˜ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                `;
                return;
            }

            const periodCrmData = crmActionsByPeriod[currentPeriod];
            const crmActions = periodCrmData.crm_actions || [];
            const periodLabel = periodCrmData.period_label || currentPeriod;

            if (crmActions.length === 0) {
                crmContainer.innerHTML = `
                    <div style="padding: 20px; text-align: center; color: var(--success-main);">
                        <svg viewBox="0 0 24 24" fill="currentColor" style="width: 48px; height: 48px; margin-bottom: 12px;">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                        <p style="font-size: 16px; font-weight: 600; margin-bottom: 4px;">ì´íƒˆ ìœ„í—˜ ì—†ìŒ</p>
                        <p style="font-size: 14px; color: var(--grey-600);">${periodLabel} ë™ì•ˆ íŠ¹ë³„í•œ CRM ì•¡ì…˜ì´ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
                    </div>
                `;
                return;
            }

            // CRM ì•¡ì…˜ ìš°ì„ ìˆœìœ„ ìƒ‰ìƒ
            const priorityColors = {
                'high': { border: '#ef5350', bg: '#ffebee', badge: '#c62828', label: 'ê¸´ê¸‰' },
                'medium': { border: '#ffa726', bg: '#fff3e0', badge: '#ef6c00', label: 'ì£¼ì˜' },
                'low': { border: '#66bb6a', bg: '#e8f5e9', badge: '#2e7d32', label: 'ëª¨ë‹ˆí„°ë§' }
            };

            crmContainer.innerHTML = `
                <div style="margin-bottom: 16px; padding: 12px; background: #f5f5f5; border-radius: 8px;">
                    <div style="font-size: 13px; color: var(--grey-700);">
                        <strong>${periodLabel}</strong> ê¸°ê°„ ë¶„ì„ ê²°ê³¼, <strong style="color: var(--primary-main);">${crmActions.length}ê±´</strong>ì˜ CRM ì•¡ì…˜ì´ í•„ìš”í•©ë‹ˆë‹¤.
                    </div>
                </div>
                <div style="display: grid; gap: 12px;">
                    ${crmActions.map((action, index) => {
                        const priority = action.priority || 'medium';
                        const colors = priorityColors[priority] || priorityColors['medium'];
                        return `
                            <div style="padding: 16px; background: ${colors.bg}; border-radius: 8px; border-left: 4px solid ${colors.border};">
                                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;">
                                    <div style="font-size: 14px; font-weight: 600; color: var(--grey-900);">
                                        ğŸ“ ${action.stage || 'ì•Œ ìˆ˜ ì—†ëŠ” ë‹¨ê³„'}
                                    </div>
                                    <span style="font-size: 11px; padding: 3px 8px; background: ${colors.badge}; color: white; border-radius: 10px;">
                                        ${colors.label}
                                    </span>
                                </div>
                                <div style="font-size: 13px; color: var(--grey-700); margin-bottom: 6px;">
                                    <strong>í˜„í™©:</strong> ${action.trend || 'ë°ì´í„° ì—†ìŒ'}
                                </div>
                                <div style="font-size: 13px; color: var(--grey-600); margin-bottom: 10px; font-style: italic;">
                                    <strong>ì§„ë‹¨:</strong> ${action.diagnosis || 'ì§„ë‹¨ ì •ë³´ ì—†ìŒ'}
                                </div>
                                <div style="font-size: 13px; color: var(--grey-900); padding: 12px; background: white; border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                                    ğŸ’Š <strong>ì²˜ë°©:</strong> ${action.prescription || 'ì²˜ë°© ì •ë³´ ì—†ìŒ'}
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        // ë‹¨ê³„ë³„ ë§ì¶¤ ì´íƒˆ ëŒ€ì‘ ì¶”ì²œ ìƒì„±
        function getChurnRecommendation(stage, changePercent, riskLevel) {
            const absChange = Math.abs(parseFloat(changePercent));
            const urgency = riskLevel === 'high' ? 'ì¦‰ì‹œ' : 'ë¹ ë¥´ê²Œ';

            // ë‹¨ê³„ë³„ ë§ì¶¤ ì¶”ì²œ
            const stageRecommendations = {
                'ìœ ì…': [
                    `ê´‘ê³  ìº í˜ì¸ì˜ íƒ€ê²ŸíŒ…ì„ ${urgency} ì¬ê²€í† í•˜ì„¸ìš”. ì˜ëª»ëœ ê³ ê°ì¸µì—ê²Œ ê´‘ê³ ê°€ ë…¸ì¶œë˜ê³  ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.`,
                    `ê´‘ê³  ì†Œì¬(ì´ë¯¸ì§€, ë¬¸êµ¬)ë¥¼ ì ê²€í•˜ì„¸ìš”. í´ë¦­ì€ ë§ì§€ë§Œ ì´íƒˆì´ ëŠ˜ì—ˆë‹¤ë©´ ê´‘ê³  ë‚´ìš©ê³¼ ì‹¤ì œ í˜ì´ì§€ê°€ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.`,
                    `ê²½ìŸì‚¬ì˜ í”„ë¡œëª¨ì…˜ì´ë‚˜ ì‹œì¥ ë³€í™”ë¥¼ í™•ì¸í•˜ì„¸ìš”. ì™¸ë¶€ ìš”ì¸ì´ ìœ ì…ì— ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.`
                ],
                'í™œë™': [
                    `ëœë”©í˜ì´ì§€ ë¡œë”© ì†ë„ë¥¼ ${urgency} ê°œì„ í•˜ì„¸ìš”. ëŠë¦° í˜ì´ì§€ëŠ” ë°©ë¬¸ìë¥¼ ì¦‰ì‹œ ë– ë‚˜ê²Œ ë§Œë“­ë‹ˆë‹¤.`,
                    `ì²« í™”ë©´ì˜ ë©”ì‹œì§€ê°€ ëª…í™•í•œì§€ í™•ì¸í•˜ì„¸ìš”. ë°©ë¬¸ìê°€ 5ì´ˆ ì•ˆì— "ì—¬ê¸°ì„œ ë­˜ í•  ìˆ˜ ìˆëŠ”ì§€" ì´í•´í•´ì•¼ í•©ë‹ˆë‹¤.`,
                    `ëª¨ë°”ì¼ í™”ë©´ì—ì„œë„ ì œëŒ€ë¡œ ë³´ì´ëŠ”ì§€ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”. ë§ì€ ì‚¬ìš©ìê°€ ëª¨ë°”ì¼ë¡œ ì ‘ì†í•©ë‹ˆë‹¤.`
                ],
                'ê´€ì‹¬': [
                    `ì œí’ˆ/ì„œë¹„ìŠ¤ ì„¤ëª…ì„ ë” êµ¬ì²´ì ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”. ê³ ê°ì´ ê´€ì‹¬ì„ ìƒëŠ” ì´ìœ ëŠ” ì •ë³´ ë¶€ì¡±ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.`,
                    `ê³ ê° í›„ê¸°ì™€ ë¦¬ë·°ë¥¼ ë” ëˆˆì— ë„ê²Œ ë°°ì¹˜í•˜ì„¸ìš”. ì‹ ë¢°ê°€ ë¶€ì¡±í•˜ë©´ ê´€ì‹¬ì´ ë–¨ì–´ì§‘ë‹ˆë‹¤.`,
                    `ê°€ê²©ì´ë‚˜ í˜œíƒ ì •ë³´ë¥¼ ë” ì¼ì° ë³´ì—¬ì£¼ì„¸ìš”. ìˆ¨ê²¨ì§„ ë¹„ìš©ì€ ê³ ê°ì„ ì´íƒˆì‹œí‚µë‹ˆë‹¤.`
                ],
                'ê²°ì œì§„í–‰': [
                    `ê²°ì œ ë‹¨ê³„ë¥¼ ë‹¨ìˆœí™”í•˜ì„¸ìš”. ë¶ˆí•„ìš”í•œ ì •ë³´ ì…ë ¥ì„ ì œê±°í•˜ê³  í•„ìˆ˜ í•­ëª©ë§Œ ë‚¨ê¸°ì„¸ìš”.`,
                    `ë°°ì†¡ë¹„ì™€ ì´ ê¸ˆì•¡ì„ ê²°ì œ ì „ì— ë¯¸ë¦¬ ë³´ì—¬ì£¼ì„¸ìš”. ë§ˆì§€ë§‰ì— ì˜ˆìƒë³´ë‹¤ ë¹„ì‹¸ë©´ ì´íƒˆí•©ë‹ˆë‹¤.`,
                    `ë‹¤ì–‘í•œ ê²°ì œ ìˆ˜ë‹¨ì„ ì œê³µí•˜ì„¸ìš”. ì„ í˜¸í•˜ëŠ” ê²°ì œ ë°©ë²•ì´ ì—†ìœ¼ë©´ í¬ê¸°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`
                ],
                'êµ¬ë§¤ì™„ë£Œ': [
                    `ê²°ì œ ì˜¤ë¥˜ë‚˜ ì‹œìŠ¤í…œ ë¬¸ì œë¥¼ ${urgency} ì ê²€í•˜ì„¸ìš”. ê¸°ìˆ ì  ë¬¸ì œë¡œ êµ¬ë§¤ê°€ ì‹¤íŒ¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`,
                    `ë§ˆì§€ë§‰ ë‹¨ê³„ì˜ ë³´ì•ˆ ì¸ì¦ì´ ë„ˆë¬´ ë³µì¡í•˜ì§€ ì•Šì€ì§€ í™•ì¸í•˜ì„¸ìš”. ê°„í¸ ê²°ì œ ë„ì…ì„ ê³ ë ¤í•˜ì„¸ìš”.`,
                    `ì¬ê³  ë¶€ì¡± ì•Œë¦¼ì„ í™•ì¸í•˜ì„¸ìš”. í’ˆì ˆë¡œ ì¸í•´ êµ¬ë§¤ë¥¼ ì™„ë£Œí•˜ì§€ ëª»í–ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.`
                ]
            };

            // í•´ë‹¹ ë‹¨ê³„ì˜ ì¶”ì²œ ëª©ë¡
            const recommendations = stageRecommendations[stage] || [
                `${stage} ë‹¨ê³„ì˜ ê³ ê° ê²½í—˜ì„ ì „ë°˜ì ìœ¼ë¡œ ì¬ê²€í† í•˜ì„¸ìš”.`,
                `ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì—¬ ì´íƒˆì˜ ê·¼ë³¸ ì›ì¸ì„ íŒŒì•…í•˜ì„¸ìš”.`,
                `A/B í…ŒìŠ¤íŠ¸ë¥¼ í†µí•´ ë‹¤ì–‘í•œ ê°œì„ ì•ˆì„ ì‹¤í—˜í•´ë³´ì„¸ìš”.`
            ];

            // ì´íƒˆë¥ ì— ë”°ë¼ ì¶”ì²œ ì„ íƒ (ë†’ì„ìˆ˜ë¡ ë” ê¸´ê¸‰í•œ ì¶”ì²œ)
            const index = absChange > 15 ? 0 : absChange > 10 ? 1 : 2;
            return recommendations[index];
        }

        // ========================================
        // ì¸ì‚¬ì´íŠ¸ ì„¹ì…˜ìš© ì´íƒˆ/ì„±ê³¼ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        // ========================================

        // ì¸ì‚¬ì´íŠ¸ ì„¹ì…˜ - ì´íƒˆ ìœ„í—˜ ê²½ê³  ì—…ë°ì´íŠ¸
        function updateInsightChurnPredictions(period) {
            const churnData = getChurnData();
            if (!churnData) return;

            const dataKey = period === '7d' ? 'churn_predictions_7d' : 'churn_predictions_30d';
            const predictions = churnData[dataKey] || [];
            const periodText = period === '7d' ? 'ìµœê·¼ 7ì¼ vs ì´ì „ 7ì¼' : 'ìµœê·¼ 30ì¼ vs ì´ì „ 30ì¼';

            const churnContainer = document.getElementById('insightChurnPredictions');
            if (!churnContainer) return;

            if (predictions.length > 0) {
                churnContainer.innerHTML = `
                    <div style="margin-bottom: 16px;">
                        <p style="font-size: 14px; color: var(--error-main); font-weight: 600; margin-bottom: 12px;">
                            âš ï¸ ${predictions.length}ê°œ í¼ë„ ë‹¨ê³„ì—ì„œ ì´íƒˆ ìœ„í—˜ ê°ì§€
                        </p>
                    </div>
                    <div style="display: grid; gap: 12px;">
                        ${predictions.map(pred => {
                            const customRecommendation = getChurnRecommendation(pred.stage, pred.change_pct, pred.risk_level);
                            return `
                            <div style="padding: 16px; background: ${pred.risk_level === 'high' ? 'var(--error-light)' : 'var(--warning-light)'}; border-radius: 8px; border-left: 4px solid ${pred.risk_level === 'high' ? 'var(--error-main)' : 'var(--warning-main)'};">
                                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                                    <div>
                                        <div style="font-size: 16px; font-weight: 600; color: var(--grey-900); margin-bottom: 4px;">
                                            ${pred.stage} ë‹¨ê³„
                                        </div>
                                        <div style="font-size: 13px; color: var(--grey-700);">
                                            ${periodText}: <strong style="color: var(--error-main);">${pred.change_pct}%</strong> ê°ì†Œ
                                        </div>
                                    </div>
                                    <span style="font-size: 12px; padding: 4px 12px; background: ${pred.risk_level === 'high' ? 'var(--error-main)' : 'var(--warning-main)'}; color: white; border-radius: 12px; font-weight: 600;">
                                        ${pred.risk_level === 'high' ? 'ë†’ìŒ' : 'ì¤‘ê°„'}
                                    </span>
                                </div>
                                <div style="display: flex; gap: 16px; font-size: 13px; color: var(--grey-700); margin-bottom: 12px;">
                                    <span>ìµœê·¼ í‰ê· : <strong>${formatNumber(pred.recent_avg)}</strong>ëª…</span>
                                    <span>ì´ì „ í‰ê· : <strong>${formatNumber(pred.previous_avg)}</strong>ëª…</span>
                                </div>
                                <div style="font-size: 13px; color: var(--grey-900); padding: 12px; background: white; border-radius: 6px; line-height: 1.6;">
                                    ğŸ’¡ <strong>ìš°ì„  ì¡°ì¹˜:</strong> ${customRecommendation}
                                </div>
                            </div>
                        `;
                        }).join('')}
                    </div>
                `;
            } else {
                churnContainer.innerHTML = `
                    <div style="padding: 20px; text-align: center; color: var(--success-main);">
                        <svg viewBox="0 0 24 24" fill="currentColor" style="width: 48px; height: 48px; margin-bottom: 12px;">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                        <p style="font-size: 16px; font-weight: 600; margin-bottom: 4px;">ì´íƒˆ ìœ„í—˜ ì—†ìŒ</p>
                        <p style="font-size: 14px; color: var(--grey-600);">ëª¨ë“  í¼ë„ ë‹¨ê³„ê°€ ì•ˆì •ì ì…ë‹ˆë‹¤.</p>
                    </div>
                `;
            }
        }

        // ì¸ì‚¬ì´íŠ¸ ì„¹ì…˜ - ì„±ê³¼ ê°œì„  ë¶„ì„ ì—…ë°ì´íŠ¸
        function updateInsightImprovementPredictions(period) {
            const churnData = getChurnData();
            if (!churnData) return;

            const dataKey = period === '7d' ? 'improvement_predictions_7d' : 'improvement_predictions_30d';
            const predictions = churnData[dataKey] || [];
            const periodText = period === '7d' ? 'ìµœê·¼ 7ì¼ vs ì´ì „ 7ì¼' : 'ìµœê·¼ 30ì¼ vs ì´ì „ 30ì¼';

            const improvementContainer = document.getElementById('insightImprovementPredictions');
            if (!improvementContainer) return;

            if (predictions.length > 0) {
                improvementContainer.innerHTML = `
                    <div style="margin-bottom: 16px; padding: 16px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8f4 100%); border-radius: 8px; border-left: 4px solid var(--success-main);">
                        <p style="font-size: 15px; color: var(--success-main); font-weight: 600; margin-bottom: 6px;">
                            ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤! ${predictions.length}ê°œ ë‹¨ê³„ì—ì„œ ì„±ê³¼ê°€ ì¢‹ì•„ì¡ŒìŠµë‹ˆë‹¤
                        </p>
                        <p style="font-size: 13px; color: var(--grey-700);">
                            ê° ê°œì„  ì‚¬í•­ë§ˆë‹¤ êµ¬ì²´ì ì¸ ì‹¤í–‰ ë°©ë²•ì„ í™•ì¸í•˜ì—¬ ì´ ì„±ê³¼ë¥¼ ê³„ì† ìœ ì§€í•˜ì„¸ìš”.
                        </p>
                    </div>
                    <div style="display: grid; gap: 12px;">
                        ${predictions.map(pred => {
                            const customRecommendation = getImprovementRecommendation(pred.stage, pred.change_pct, pred.improvement_level);
                            const improvementPercent = Math.abs(parseFloat(pred.change_pct));
                            const improvementLabel = improvementPercent > 15 ? 'íƒì›”í•œ ê°œì„ !' : improvementPercent > 10 ? 'ì¢‹ì€ ê°œì„ !' : 'ê¸ì •ì  ë³€í™”';

                            return `
                            <div style="padding: 16px; background: var(--success-light); border-radius: 8px; border-left: 4px solid var(--success-main);">
                                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                                    <div>
                                        <div style="font-size: 16px; font-weight: 600; color: var(--grey-900); margin-bottom: 4px;">
                                            ${pred.stage} ë‹¨ê³„
                                        </div>
                                        <div style="font-size: 13px; color: var(--grey-700);">
                                            ${periodText}: <strong style="color: var(--success-main);">+${pred.change_pct}%</strong> ì¦ê°€
                                        </div>
                                    </div>
                                    <span style="font-size: 12px; padding: 4px 12px; background: var(--success-main); color: white; border-radius: 12px; font-weight: 600;">
                                        ${improvementLabel}
                                    </span>
                                </div>
                                <div style="display: flex; gap: 16px; font-size: 13px; color: var(--grey-700); margin-bottom: 12px;">
                                    <span>ìµœê·¼ í‰ê· : <strong>${formatNumber(pred.recent_avg)}</strong>ëª…</span>
                                    <span>ì´ì „ í‰ê· : <strong>${formatNumber(pred.previous_avg)}</strong>ëª…</span>
                                </div>
                                <div style="font-size: 13px; color: var(--grey-900); padding: 12px; background: white; border-radius: 6px; line-height: 1.6;">
                                    ğŸ¯ <strong>ì„±ê³¼ ìœ ì§€ ë°©ë²•:</strong> ${customRecommendation}
                                </div>
                            </div>
                        `;
                        }).join('')}
                    </div>
                `;
            } else {
                improvementContainer.innerHTML = `
                    <div style="padding: 20px; text-align: center; color: var(--grey-500);">
                        <svg viewBox="0 0 24 24" fill="currentColor" style="width: 48px; height: 48px; margin-bottom: 12px; opacity: 0.5;">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
                        </svg>
                        <p style="font-size: 16px; font-weight: 600; margin-bottom: 4px;">ì„±ê³¼ ê°œì„  ë°ì´í„° ì—†ìŒ</p>
                        <p style="font-size: 14px; color: var(--grey-600);">ì„ íƒí•œ ê¸°ê°„ì— ëˆˆì— ë„ëŠ” ì„±ê³¼ ê°œì„ ì´ ê°ì§€ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>
                    </div>
                `;
            }
        }

        // ========================================

        // ì´íƒˆ ìœ„í—˜ ê²½ê³  ì—…ë°ì´íŠ¸ (period: '7d' or '30d') - ê¸°ì¡´ (ë°ì´í„° ê¸°ë°˜ ì„¹ì…˜ìš© - ì‚¬ìš© ì•ˆí•¨)
        // ì´íƒˆ ë¶„ì„ì€ í•­ìƒ ì „ì²´ ê¸°ê°„ ë°ì´í„°ë§Œ ì‚¬ìš©
        function updateChurnPredictions(period) {
            const churnData = getChurnData();
            if (!churnData) return;

            const dataKey = period === '7d' ? 'churn_predictions_7d' : 'churn_predictions_30d';
            const predictions = churnData[dataKey] || [];
            const periodText = period === '7d' ? 'ìµœê·¼ 7ì¼ vs ì´ì „ 7ì¼' : 'ìµœê·¼ 30ì¼ vs ì´ì „ 30ì¼';

            const churnContainer = document.getElementById('churnPredictions');
            if (predictions.length > 0) {
                churnContainer.innerHTML = `
                    <div style="margin-bottom: 16px;">
                        <p style="font-size: 14px; color: var(--error-main); font-weight: 600; margin-bottom: 12px;">
                            âš ï¸ ${predictions.length}ê°œ í¼ë„ ë‹¨ê³„ì—ì„œ ì´íƒˆ ìœ„í—˜ ê°ì§€
                        </p>
                    </div>
                    <div style="display: grid; gap: 12px;">
                        ${predictions.map(pred => {
                            const customRecommendation = getChurnRecommendation(pred.stage, pred.change_pct, pred.risk_level);
                            return `
                            <div style="padding: 16px; background: ${pred.risk_level === 'high' ? 'var(--error-light)' : 'var(--warning-light)'}; border-radius: 8px; border-left: 4px solid ${pred.risk_level === 'high' ? 'var(--error-main)' : 'var(--warning-main)'};">
                                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                                    <div>
                                        <div style="font-size: 16px; font-weight: 600; color: var(--grey-900); margin-bottom: 4px;">
                                            ${pred.stage} ë‹¨ê³„
                                        </div>
                                        <div style="font-size: 13px; color: var(--grey-700);">
                                            ${periodText}: <strong style="color: var(--error-main);">${pred.change_pct}%</strong> ê°ì†Œ
                                        </div>
                                    </div>
                                    <span style="font-size: 12px; padding: 4px 12px; background: ${pred.risk_level === 'high' ? 'var(--error-main)' : 'var(--warning-main)'}; color: white; border-radius: 12px; font-weight: 600;">
                                        ${pred.risk_level === 'high' ? 'ë†’ìŒ' : 'ì¤‘ê°„'}
                                    </span>
                                </div>
                                <div style="display: flex; gap: 16px; font-size: 13px; color: var(--grey-700); margin-bottom: 12px;">
                                    <span>ìµœê·¼ í‰ê· : <strong>${formatNumber(pred.recent_avg)}</strong>ëª…</span>
                                    <span>ì´ì „ í‰ê· : <strong>${formatNumber(pred.previous_avg)}</strong>ëª…</span>
                                </div>
                                <div style="font-size: 13px; color: var(--grey-900); padding: 12px; background: white; border-radius: 6px; line-height: 1.6;">
                                    ğŸ’¡ <strong>ìš°ì„  ì¡°ì¹˜:</strong> ${customRecommendation}
                                </div>
                            </div>
                        `;
                        }).join('')}
                    </div>
                `;
            } else {
                churnContainer.innerHTML = `
                    <div style="padding: 20px; text-align: center; color: var(--success-main);">
                        <svg viewBox="0 0 24 24" fill="currentColor" style="width: 48px; height: 48px; margin-bottom: 12px;">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                        <p style="font-size: 16px; font-weight: 600; margin-bottom: 4px;">ì´íƒˆ ìœ„í—˜ ì—†ìŒ</p>
                        <p style="font-size: 14px; color: var(--grey-600);">ëª¨ë“  í¼ë„ ë‹¨ê³„ê°€ ì•ˆì •ì ì…ë‹ˆë‹¤.</p>
                    </div>
                `;
            }

        }

        // ë‹¨ê³„ë³„ ë§ì¶¤ ê°œì„  ìœ ì§€ ì¶”ì²œ ìƒì„±
        function getImprovementRecommendation(stage, changePercent, improvementLevel) {
            const absChange = Math.abs(parseFloat(changePercent));

            // ë‹¨ê³„ë³„ ë§ì¶¤ ì¶”ì²œ - êµ¬ì²´ì ì´ê³  ì¦‰ì‹œ ì‹¤í–‰ ê°€ëŠ¥í•œ ì•¡ì…˜
            const stageRecommendations = {
                'ìœ ì…': [
                    // ë†’ì€ ì¦ê°€ìœ¨ (15% ì´ìƒ)
                    `<strong>ì§€ê¸ˆ ë°”ë¡œ:</strong> 1) ì„±ê³¼ê°€ ì¢‹ì€ ê´‘ê³  ìº í˜ì¸ì˜ ì˜ˆì‚°ì„ 20-30% ì¦ì•¡í•˜ì„¸ìš” 2) ê´‘ê³  ì†Œì¬(ì´ë¯¸ì§€, ë¬¸êµ¬)ë¥¼ ìŠ¤í¬ë¦°ìƒ·ìœ¼ë¡œ ì €ì¥í•˜ì—¬ ì„±ê³µ í…œí”Œë¦¿ì„ ë§Œë“œì„¸ìš” 3) ê°™ì€ ë°©ì‹ì„ ë‹¤ë¥¸ ì±„ë„ì—ë„ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”`,
                    // ì¤‘ê°„ ì¦ê°€ìœ¨ (10-15%)
                    `<strong>ì„±ê³µ ìš”ì¸ ë¶„ì„:</strong> 1) ìµœê·¼ 7ì¼ê°„ ì–´ë–¤ ê´‘ê³ /ì±„ë„ì—ì„œ ìœ ì…ì´ ëŠ˜ì—ˆëŠ”ì§€ Google Analyticsì—ì„œ í™•ì¸í•˜ì„¸ìš” 2) í”„ë¡œëª¨ì…˜ì´ë‚˜ í• ì¸ ì´ë²¤íŠ¸ë¥¼ ì§„í–‰í–ˆë‹¤ë©´ ë‚ ì§œì™€ íš¨ê³¼ë¥¼ ì—‘ì…€ì— ê¸°ë¡í•˜ì„¸ìš” 3) ê³„ì ˆì„± ìš”ì¸(ëª…ì ˆ, íœ´ê°€ì²  ë“±)ì´ ìˆëŠ”ì§€ ì²´í¬í•˜ì„¸ìš”`,
                    // ë‚®ì€ ì¦ê°€ìœ¨ (10% ë¯¸ë§Œ)
                    `<strong>í˜„ìƒ ìœ ì§€ + ì¶”ê°€ ì„±ì¥:</strong> 1) í˜„ì¬ ê´‘ê³ ë¹„ ë°°ë¶„ì„ ê·¸ëŒ€ë¡œ ìœ ì§€í•˜ì„¸ìš” 2) ì‹ ê·œ í‚¤ì›Œë“œë‚˜ íƒ€ê²Ÿ ì˜¤ë””ì–¸ìŠ¤ë¥¼ 1-2ê°œ ì¶”ê°€ë¡œ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš” (ì „ì²´ ì˜ˆì‚°ì˜ 10% ì´ë‚´) 3) ì£¼ê°„ ë‹¨ìœ„ë¡œ ì„±ê³¼ë¥¼ ëª¨ë‹ˆí„°ë§í•˜ì„¸ìš”`
                ],
                'í™œë™': [
                    // ë†’ì€ ì¦ê°€ìœ¨
                    `<strong>ì¦‰ì‹œ ì‹¤í–‰:</strong> 1) ìµœê·¼ ë³€ê²½í•œ ëœë”© í˜ì´ì§€ ë””ìì¸ì´ë‚˜ ë¬¸êµ¬ê°€ ìˆë‹¤ë©´ ì ˆëŒ€ ë˜ëŒë¦¬ì§€ ë§ˆì„¸ìš” 2) í˜ì´ì§€ ë¡œë”© ì†ë„ë¥¼ PageSpeed Insightsë¡œ ì¸¡ì •í•˜ì—¬ 3ì´ˆ ì´ë‚´ ìœ ì§€í•˜ì„¸ìš” 3) ëª¨ë°”ì¼ í™”ë©´ì—ì„œ ì²« í™”ë©´ì´ ì˜ ë³´ì´ëŠ”ì§€ ì§ì ‘ í™•ì¸í•˜ì„¸ìš”`,
                    // ì¤‘ê°„ ì¦ê°€ìœ¨
                    `<strong>íš¨ê³¼ ê²€ì¦:</strong> 1) Google Analyticsì—ì„œ 'ì°¸ì—¬ ì„¸ì…˜' ì§€í‘œë¥¼ í™•ì¸í•˜ì„¸ìš” (í–‰ë™ > ì‚¬ì´íŠ¸ ì½˜í…ì¸ ) 2) ì‚¬ìš©ìê°€ ê°€ì¥ ë§ì´ í´ë¦­í•˜ëŠ” ë²„íŠ¼ì´ë‚˜ ë§í¬ë¥¼ Hotjar ê°™ì€ ë„êµ¬ë¡œ í™•ì¸í•˜ì„¸ìš” 3) ìŠ¤í¬ë¡¤ ê¹Šì´ë¥¼ ì¸¡ì •í•˜ì—¬ ì½˜í…ì¸ ê°€ ì˜ ì½íˆëŠ”ì§€ ì²´í¬í•˜ì„¸ìš”`,
                    // ë‚®ì€ ì¦ê°€ìœ¨
                    `<strong>ê°œì„  ìœ ì§€:</strong> 1) ì²« í™”ë©´ì— í‘œì‹œë˜ëŠ” í•µì‹¬ ë©”ì‹œì§€ë¥¼ ë³€ê²½í•˜ì§€ ë§ˆì„¸ìš” 2) CTA ë²„íŠ¼(ê°€ì…í•˜ê¸°, ë” ì•Œì•„ë³´ê¸° ë“±)ì˜ ìƒ‰ìƒê³¼ ìœ„ì¹˜ë¥¼ ê³ ì •í•˜ì„¸ìš” 3) ì£¼ 1íšŒ ì´íƒˆë¥ ì„ ì²´í¬í•˜ì—¬ ê°‘ì‘ìŠ¤ëŸ¬ìš´ ë³€í™”ê°€ ì—†ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”`
                ],
                'ê´€ì‹¬': [
                    // ë†’ì€ ì¦ê°€ìœ¨
                    `<strong>ì§€ê¸ˆ ë‹¹ì¥:</strong> 1) ìƒí’ˆ ìƒì„¸ í˜ì´ì§€ì— ì¶”ê°€í•œ ì´ë¯¸ì§€ë‚˜ ì„¤ëª…ì´ ìˆë‹¤ë©´ ë‹¤ë¥¸ ìƒí’ˆì—ë„ ë™ì¼í•˜ê²Œ ì ìš©í•˜ì„¸ìš” 2) ê³ ê° í›„ê¸°ë¥¼ ìµœì†Œ 10ê°œ ì´ìƒ ë…¸ì¶œí•˜ì„¸ìš” (ì—†ìœ¼ë©´ êµ¬ë§¤ ê³ ê°ì—ê²Œ ë¦¬ë·° ì‘ì„± ìš”ì²­ ì´ë©”ì¼ ë°œì†¡) 3) FAQ ì„¹ì…˜ì„ ì¶”ê°€í•˜ì—¬ ìì£¼ ë¬»ëŠ” ì§ˆë¬¸ 5ê°€ì§€ë¥¼ ë‹µë³€í•˜ì„¸ìš”`,
                    // ì¤‘ê°„ ì¦ê°€ìœ¨
                    `<strong>ê´€ì‹¬ ê°•í™”:</strong> 1) ì œí’ˆ ì‚¬ì§„ì„ ë‹¤ì–‘í•œ ê°ë„ì—ì„œ ìµœì†Œ 5ì¥ ì´ìƒ ì œê³µí•˜ì„¸ìš” 2) ì‚¬ìš© ì „/í›„ ë¹„êµ ì´ë¯¸ì§€ë‚˜ ì˜ìƒì„ ì¶”ê°€í•˜ì„¸ìš” 3) "ì´ ìƒí’ˆì„ ë³¸ ê³ ê°ì´ í•¨ê»˜ ë³¸ ìƒí’ˆ" ì¶”ì²œ ì„¹ì…˜ì„ ë§Œë“œì„¸ìš”`,
                    // ë‚®ì€ ì¦ê°€ìœ¨
                    `<strong>íŠ¸ë Œë“œ ìœ ì§€:</strong> 1) ìƒí’ˆëª…ê³¼ ì„¤ëª…ì˜ í‚¤ì›Œë“œë¥¼ ë³€ê²½í•˜ì§€ ë§ˆì„¸ìš” 2) ê°€ê²© ì •ì±…ì„ ì•ˆì •ì ìœ¼ë¡œ ìœ ì§€í•˜ì„¸ìš” (ì¦ì€ ê°€ê²© ë³€ë™ì€ ì‹ ë¢° ì €í•˜) 3) ì¬ê³  ë¶€ì¡± ë©”ì‹œì§€ê°€ ëœ¨ëŠ” ìƒí’ˆì´ ìˆëŠ”ì§€ í™•ì¸í•˜ê³  ë³´ì¶©í•˜ì„¸ìš”`
                ],
                'ê²°ì œì§„í–‰': [
                    // ë†’ì€ ì¦ê°€ìœ¨
                    `<strong>í•µì‹¬ ìœ ì§€ + í™•ì¥:</strong> 1) ìµœê·¼ ì¶”ê°€í•œ ê°„í¸ê²°ì œ(ì¹´ì¹´ì˜¤í˜ì´, ë„¤ì´ë²„í˜ì´ ë“±)ë¥¼ ë” ëˆˆì— ë„ê²Œ ê°•ì¡°í•˜ì„¸ìš” 2) ê²°ì œ í˜ì´ì§€ë¥¼ ì ˆëŒ€ ë³€ê²½í•˜ì§€ ë§ˆì„¸ìš” 3) ë°°ì†¡ë¹„ ë¬´ë£Œ ê¸°ì¤€ì´ë‚˜ í• ì¸ ì •ì±…ì„ ê·¸ëŒ€ë¡œ ìœ ì§€í•˜ì„¸ìš”`,
                    // ì¤‘ê°„ ì¦ê°€ìœ¨
                    `<strong>ì‹ ë¢° ê°•í™”:</strong> 1) SSL ì¸ì¦ì„œ(ìë¬¼ì‡  ì•„ì´ì½˜)ê°€ ë¸Œë¼ìš°ì €ì— ì œëŒ€ë¡œ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš” 2) ê²°ì œ í˜ì´ì§€ì— "ì•ˆì „í•œ ê²°ì œ" ë¬¸êµ¬ì™€ ë³´ì•ˆ ë§ˆí¬ë¥¼ ì¶”ê°€í•˜ì„¸ìš” 3) ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ ë§í¬ê°€ ëª…í™•íˆ ë³´ì´ê²Œ í•˜ì„¸ìš”`,
                    // ë‚®ì€ ì¦ê°€ìœ¨
                    `<strong>ì•ˆì •ì„± ìœ ì§€:</strong> 1) ê²°ì œ í”„ë¡œì„¸ìŠ¤ì˜ ë‹¨ê³„ ìˆ˜ë¥¼ ìœ ì§€í•˜ì„¸ìš” (í˜„ì¬ 3-4ë‹¨ê³„ ê¶Œì¥) 2) í•„ìˆ˜ ì…ë ¥ í•­ëª©ì„ ì¤„ì´ì§€ë„ ëŠ˜ë¦¬ì§€ë„ ë§ˆì„¸ìš” 3) ëª¨ë°”ì¼ì—ì„œ ê²°ì œê°€ ì˜ ë˜ëŠ”ì§€ ì§ì ‘ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”`
                ],
                'êµ¬ë§¤ì™„ë£Œ': [
                    // ë†’ì€ ì¦ê°€ìœ¨
                    `<strong>ë§¤ì¶œ ê·¹ëŒ€í™”:</strong> 1) êµ¬ë§¤ í™•ì¸ í˜ì´ì§€ì—ì„œ ê´€ë ¨ ìƒí’ˆ 3ê°œë¥¼ ì¶”ì²œí•˜ì„¸ìš” ("ì´ ìƒí’ˆë„ í•¨ê»˜ êµ¬ë§¤í•˜ì„¸ìš”") 2) êµ¬ë§¤ ê³ ê°ì—ê²Œ "ì²« ë¦¬ë·° ì‘ì„± ì‹œ 500ì› í• ì¸" ê°™ì€ ì¸ì„¼í‹°ë¸Œë¥¼ ì œê³µí•˜ì„¸ìš” 3) êµ¬ë§¤ í›„ 3ì¼ ë’¤ ë§Œì¡±ë„ ì¡°ì‚¬ ì´ë©”ì¼ì„ ìë™ ë°œì†¡í•˜ì„¸ìš”`,
                    // ì¤‘ê°„ ì¦ê°€ìœ¨
                    `<strong>ì¬êµ¬ë§¤ ìœ ë„:</strong> 1) êµ¬ë§¤ ì™„ë£Œ í›„ 10ì¼ ë’¤ "ì¬êµ¬ë§¤ ì‹œ 10% í• ì¸ ì¿ í°" ì´ë©”ì¼ì„ ìë™ ë°œì†¡í•˜ì„¸ìš” 2) ì¹´ì¹´ì˜¤í†¡ ì±„ë„ ì¶”ê°€ ì‹œ ì¶”ê°€ í˜œíƒì„ ì œê³µí•˜ì„¸ìš” 3) ë°°ì†¡ ì•Œë¦¼ ë¬¸ìì— ë‹¤ìŒ êµ¬ë§¤ë¥¼ ìœ ë„í•˜ëŠ” ë§í¬ë¥¼ ë„£ìœ¼ì„¸ìš”`,
                    // ë‚®ì€ ì¦ê°€ìœ¨
                    `<strong>ê³ ê° ê´€ê³„ ìœ ì§€:</strong> 1) êµ¬ë§¤ ê°ì‚¬ ì´ë©”ì¼ì„ ë°œì†¡í•˜ì„¸ìš” (ê°œì¸í™”ëœ ë©”ì‹œì§€ ê¶Œì¥) 2) ë°°ì†¡ ì¡°íšŒ ë§í¬ë¥¼ ëª…í™•íˆ ì œê³µí•˜ì„¸ìš” 3) ê³ ê° ì„¼í„° ì—°ë½ì²˜ë¥¼ êµ¬ë§¤ í™•ì¸ í˜ì´ì§€ì— ëˆˆì— ë„ê²Œ í‘œì‹œí•˜ì„¸ìš”`
                ]
            };

            // í•´ë‹¹ ë‹¨ê³„ì˜ ì¶”ì²œ ëª©ë¡
            const recommendations = stageRecommendations[stage] || [
                `${stage} ë‹¨ê³„ì˜ ì„±ê³¼ê°€ ì¢‹ì•„ì§€ê³  ìˆìŠµë‹ˆë‹¤. í˜„ì¬ ì „ëµì„ ìœ ì§€í•˜ë©´ì„œ ì¶”ê°€ ê°œì„  ê¸°íšŒë¥¼ ì°¾ì•„ë³´ì„¸ìš”.`,
                `ìµœê·¼ ë³€ê²½ ì‚¬í•­ì„ ë¬¸ì„œí™”í•˜ê³ , ì„±ê³µ ìš”ì¸ì„ ë‹¤ë¥¸ ì±„ë„ì´ë‚˜ ìƒí’ˆì—ë„ ì ìš©í•˜ì„¸ìš”.`,
                `A/B í…ŒìŠ¤íŠ¸ë¥¼ í†µí•´ ì¶”ê°€ ìµœì í™” ì—¬ì§€ë¥¼ í™•ì¸í•˜ê³ , ë°ì´í„° ê¸°ë°˜ìœ¼ë¡œ ì˜ì‚¬ê²°ì •í•˜ì„¸ìš”.`
            ];

            // ê°œì„ ìœ¨ì— ë”°ë¼ ì¶”ì²œ ì„ íƒ (ë†’ì„ìˆ˜ë¡ ë” ì ê·¹ì ì¸ ì¶”ì²œ)
            const index = absChange > 15 ? 0 : absChange > 10 ? 1 : 2;
            return recommendations[index];
        }

        // ì„±ê³¼ ê°œì„  ë¶„ì„ ì—…ë°ì´íŠ¸ (period: '7d' or '30d')
        // ì´íƒˆ/ê°œì„  ë¶„ì„ì€ í•­ìƒ ì „ì²´ ê¸°ê°„ ë°ì´í„°ë§Œ ì‚¬ìš©
        function updateImprovementPredictions(period) {
            const churnData = getChurnData();
            if (!churnData) return;

            const dataKey = period === '7d' ? 'improvement_predictions_7d' : 'improvement_predictions_30d';
            const predictions = churnData[dataKey] || [];
            const periodText = period === '7d' ? 'ìµœê·¼ 7ì¼ vs ì´ì „ 7ì¼' : 'ìµœê·¼ 30ì¼ vs ì´ì „ 30ì¼';

            const improvementContainer = document.getElementById('improvementPredictions');
            if (predictions.length > 0) {
                improvementContainer.innerHTML = `
                    <div style="margin-bottom: 16px; padding: 16px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8f4 100%); border-radius: 8px; border-left: 4px solid var(--success-main);">
                        <p style="font-size: 15px; color: var(--success-main); font-weight: 600; margin-bottom: 6px;">
                            ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤! ${predictions.length}ê°œ ë‹¨ê³„ì—ì„œ ì„±ê³¼ê°€ ì¢‹ì•„ì¡ŒìŠµë‹ˆë‹¤
                        </p>
                        <p style="font-size: 13px; color: var(--grey-700);">
                            ê° ê°œì„  ì‚¬í•­ë§ˆë‹¤ êµ¬ì²´ì ì¸ ì‹¤í–‰ ë°©ë²•ì„ í™•ì¸í•˜ì—¬ ì´ ì„±ê³¼ë¥¼ ê³„ì† ìœ ì§€í•˜ì„¸ìš”.
                        </p>
                    </div>
                    <div style="display: grid; gap: 12px;">
                        ${predictions.map(pred => {
                            const customRecommendation = getImprovementRecommendation(pred.stage, pred.change_pct, pred.improvement_level);
                            const improvementPercent = Math.abs(parseFloat(pred.change_pct));
                            const improvementLabel = improvementPercent > 15 ? 'íƒì›”í•œ ê°œì„ !' : improvementPercent > 10 ? 'ì¢‹ì€ ê°œì„ !' : 'ê¸ì •ì  ë³€í™”';

                            return `
                            <div style="padding: 16px; background: ${pred.improvement_level === 'high' ? 'var(--success-light)' : '#e8f5e9'}; border-radius: 8px; border-left: 4px solid ${pred.improvement_level === 'high' ? 'var(--success-main)' : '#66bb6a'};">
                                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                                    <div style="flex: 1;">
                                        <div style="font-size: 16px; font-weight: 600; color: var(--grey-900); margin-bottom: 4px;">
                                            ğŸ“ˆ ${pred.stage} ë‹¨ê³„ ê³ ê° ìˆ˜ ì¦ê°€
                                        </div>
                                        <div style="font-size: 13px; color: var(--grey-700);">
                                            ${periodText} ë¹„êµ: <strong style="color: var(--success-main);">+${pred.change_pct}%</strong> ì¦ê°€ (${formatNumber(pred.previous_avg)}ëª… â†’ ${formatNumber(pred.recent_avg)}ëª…)
                                        </div>
                                    </div>
                                    <span style="font-size: 11px; padding: 6px 12px; background: ${pred.improvement_level === 'high' ? 'var(--success-main)' : '#66bb6a'}; color: white; border-radius: 12px; font-weight: 600; white-space: nowrap;">
                                        ${improvementLabel}
                                    </span>
                                </div>
                                <div style="font-size: 13px; color: var(--grey-900); padding: 14px; background: white; border-radius: 6px; line-height: 1.8; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                                    <div style="font-weight: 600; color: var(--success-main); margin-bottom: 8px;">
                                        âœ… ì´ ì„±ê³¼ë¥¼ ìœ ì§€í•˜ë ¤ë©´ ì§€ê¸ˆ ë°”ë¡œ ì‹¤í–‰í•˜ì„¸ìš”:
                                    </div>
                                    <div style="color: var(--grey-800);">
                                        ${customRecommendation}
                                    </div>
                                </div>
                            </div>
                        `;
                        }).join('')}
                    </div>
                `;
            } else {
                improvementContainer.innerHTML = `
                    <div style="padding: 30px 20px; text-align: center;">
                        <div style="font-size: 48px; margin-bottom: 16px;">ğŸ“Š</div>
                        <p style="font-size: 16px; font-weight: 600; margin-bottom: 8px; color: var(--grey-800);">í˜„ì¬ ê¸°ê°„ì—ëŠ” ê°œì„ ëœ ë‹¨ê³„ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                        <p style="font-size: 14px; color: var(--grey-600); margin-bottom: 20px; line-height: 1.6;">
                            ì´ì „ ê¸°ê°„ê³¼ ë¹„êµí•˜ì—¬ ìœ ì˜ë¯¸í•œ ì„±ê³¼ í–¥ìƒì´ ê°ì§€ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.<br>
                            ì´ëŠ” ì„±ê³¼ê°€ ë‚˜ì˜ë‹¤ëŠ” ëœ»ì´ ì•„ë‹ˆë¼, <strong>ë¹„ìŠ·í•œ ìˆ˜ì¤€ì„ ìœ ì§€</strong>í•˜ê³  ìˆë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤.
                        </p>
                        <div style="background: linear-gradient(135deg, #f5f5f5 0%, #fafafa 100%); padding: 16px; border-radius: 8px; text-align: left; max-width: 500px; margin: 0 auto;">
                            <div style="font-size: 13px; font-weight: 600; color: var(--grey-800); margin-bottom: 8px;">
                                ğŸ’¡ ì´ëŸ´ ë•Œ í™•ì¸í•  ì :
                            </div>
                            <div style="font-size: 13px; color: var(--grey-700); line-height: 1.7;">
                                1. <strong>"ê²½ê³ : ì´íƒˆ ìœ„í—˜ ì¦ê°€"</strong> ì„¹ì…˜ì„ í™•ì¸í•˜ì—¬ ì•…í™”ëœ ë¶€ë¶„ì´ ìˆëŠ”ì§€ ì²´í¬í•˜ì„¸ìš”<br>
                                2. ìœ„ ë²„íŠ¼ì—ì„œ <strong>"ìµœê·¼ 30ì¼"</strong>ë¡œ ê¸°ê°„ì„ ë³€ê²½í•˜ì—¬ ì¥ê¸° íŠ¸ë Œë“œë¥¼ í™•ì¸í•˜ì„¸ìš”<br>
                                3. ì„±ê³¼ë¥¼ ë” ë†’ì´ë ¤ë©´ ìƒˆë¡œìš´ ë§ˆì¼€íŒ… ì „ëµì´ë‚˜ A/B í…ŒìŠ¤íŠ¸ë¥¼ ì‹œë„í•˜ì„¸ìš”
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        // ì´íƒˆë¥  ê³„ì‚° í•¨ìˆ˜
        function calculateChurnRates(row) {
            const acquisition = parseFloat(row['ìœ ì…']) || 0;
            const activation = parseFloat(row['í™œë™']) || 0;
            const consideration = parseFloat(row['ê´€ì‹¬']) || 0;
            const conversion = parseFloat(row['ê²°ì œì§„í–‰']) || 0;
            const purchase = parseFloat(row['êµ¬ë§¤ì™„ë£Œ']) || 0;

            // ì „ì²´ ì´íƒˆë¥  = (ìœ ì… - êµ¬ë§¤ì™„ë£Œ) / ìœ ì… Ã— 100
            const totalChurn = acquisition > 0 ? ((acquisition - purchase) / acquisition * 100) : 0;

            // ë‹¨ê³„ë³„ ì´íƒˆë¥ 
            const activationChurn = acquisition > 0 ? ((acquisition - activation) / acquisition * 100) : 0;
            const considerationChurn = activation > 0 ? ((activation - consideration) / activation * 100) : 0;
            const conversionChurn = consideration > 0 ? ((consideration - conversion) / consideration * 100) : 0;
            const purchaseChurn = conversion > 0 ? ((conversion - purchase) / conversion * 100) : 0;

            // ë‹¨ê³„ë³„ ìµœëŒ€ ì´íƒˆë¥ 
            const maxChurn = Math.max(activationChurn, considerationChurn, conversionChurn, purchaseChurn);

            // í‰ê·  ì´íƒˆë¥ 
            const avgChurn = (activationChurn + considerationChurn + conversionChurn + purchaseChurn) / 4;

            return {
                total: totalChurn,
                max: maxChurn,
                avg: avgChurn,
                activation: activationChurn,
                consideration: considerationChurn,
                conversion: conversionChurn,
                purchase: purchaseChurn
            };
        }

        // KPI ì°¨íŠ¸ ìë™ ë¶„ì„ í•¨ìˆ˜
        function analyzeKpiChartData(data, kpiType) {
            if (data.length === 0) return;

            const kpiNames = {
                cvr: 'ì „í™˜ìœ¨',
                acquisition: 'ë°©ë¬¸ì ìˆ˜',
                activation: 'í™œì„± ì‚¬ìš©ì',
                consideration: 'ê´€ì‹¬ ê³ ê°',
                conversion: 'ê²°ì œ ì‹œë„',
                purchase: 'êµ¬ë§¤ ê±´ìˆ˜',
                revenue: 'ë§¤ì¶œ'
            };

            const kpiKeys = {
                cvr: 'CVR',
                acquisition: 'ìœ ì…',
                activation: 'í™œë™',
                consideration: 'ê´€ì‹¬',
                conversion: 'ê²°ì œì§„í–‰',
                purchase: 'êµ¬ë§¤ì™„ë£Œ',
                revenue: 'Revenue'
            };

            const currentKpiName = kpiNames[kpiType];
            const currentKpiKey = kpiKeys[kpiType];

            // ë°ì´í„° ì¶”ì¶œ ë° ì •ë ¬
            const sortedData = [...data].map(row => ({
                channel: row['channel'],
                value: kpiType === 'cvr' ? parseFloat(row[currentKpiKey]) || 0 : parseFloat(row[currentKpiKey]) || 0
            })).sort((a, b) => b.value - a.value);

            const top1 = sortedData[0];
            const top2 = sortedData[1];
            const top3 = sortedData[2];
            const bottom = sortedData[sortedData.length - 1];

            // í‰ê·  ê³„ì‚°
            const avgValue = sortedData.reduce((sum, item) => sum + item.value, 0) / sortedData.length;

            // í‘œì¤€í¸ì°¨ ê³„ì‚° (ë°ì´í„° í¸ì°¨ íŒŒì•…)
            const variance = sortedData.reduce((sum, item) => sum + Math.pow(item.value - avgValue, 2), 0) / sortedData.length;
            const stdDev = Math.sqrt(variance);

            // ì¸ì‚¬ì´íŠ¸ HTML ìƒì„±
            let insightHTML = '';

            // 1. 1ë“± ì±„ë„ ì •ë³´
            insightHTML += `<strong style="color: #2196f3;">ğŸ¥‡ 1ìœ„ ì±„ë„:</strong> `;
            insightHTML += `<strong>${top1.channel}</strong>ì´ ${currentKpiName}ì—ì„œ 1ë“±ì…ë‹ˆë‹¤ `;
            if (kpiType === 'cvr') {
                insightHTML += `(${top1.value.toFixed(2)}%). `;
                if (top1.value > 3) {
                    insightHTML += `ë§¤ìš° ìš°ìˆ˜í•œ ì „í™˜ìœ¨ì´ë¯€ë¡œ ê´‘ê³  ì˜ˆì‚°ì„ ë” íˆ¬ìí•˜ì„¸ìš”! `;
                } else if (top1.value > 1.5) {
                    insightHTML += `ì–‘í˜¸í•œ ì „í™˜ìœ¨ì…ë‹ˆë‹¤. `;
                } else {
                    insightHTML += `ì „í™˜ìœ¨ì´ ë‚®ì€ í¸ì…ë‹ˆë‹¤. ì „ë°˜ì ì¸ ê°œì„ ì´ í•„ìš”í•©ë‹ˆë‹¤. `;
                }
            } else if (kpiType === 'revenue') {
                insightHTML += `(â‚©${formatNumber(top1.value)}). `;
                insightHTML += `ì´ ì±„ë„ì˜ ì„±ê³µ ìš”ì¸ì„ ë¶„ì„í•˜ì—¬ ë‹¤ë¥¸ ì±„ë„ì— ì ìš©í•˜ì„¸ìš”. `;
            } else {
                insightHTML += `(${formatNumber(top1.value)}ëª…). `;
            }

            // 2. 1ë“±ê³¼ 2ë“±ì˜ ê²©ì°¨
            const gap = top1.value - top2.value;
            const gapPercent = (gap / top1.value * 100);
            if (gapPercent > 30) {
                insightHTML += `<br><br><strong style="color: #ff9800;">âš ï¸ ì£¼ì˜:</strong> `;
                insightHTML += `1ìœ„ì™€ 2ìœ„ì˜ ê²©ì°¨ê°€ ${gapPercent.toFixed(0)}%ë¡œ ë§¤ìš° í½ë‹ˆë‹¤. `;
                insightHTML += `<strong>${top1.channel}</strong>ì— ê³¼ë„í•˜ê²Œ ì˜ì¡´í•˜ê³  ìˆìœ¼ë¯€ë¡œ, ë‹¤ë¥¸ ì±„ë„ë„ ìœ¡ì„±í•˜ì—¬ ë¦¬ìŠ¤í¬ë¥¼ ë¶„ì‚°í•˜ì„¸ìš”. `;
            } else {
                insightHTML += `2ìœ„ëŠ” <strong>${top2.channel}</strong>ì´ë©°, 1ìœ„ì™€ì˜ ê²©ì°¨ëŠ” ${gapPercent.toFixed(0)}%ì…ë‹ˆë‹¤. `;
            }

            // 3. ìƒìœ„ vs í•˜ìœ„ ë¹„êµ
            insightHTML += `<br><br><strong style="color: var(--primary-main);">ğŸ“Š ì „ì²´ ë¶„ì„:</strong> `;
            const topBottomRatio = top1.value / (bottom.value || 1);
            if (topBottomRatio > 10) {
                insightHTML += `ìµœê³ ì™€ ìµœì €ì˜ ì°¨ì´ê°€ ${topBottomRatio.toFixed(1)}ë°°ë¡œ ë§¤ìš° í½ë‹ˆë‹¤. `;
                insightHTML += `<strong>${bottom.channel}</strong> ê°™ì€ ì €ì„±ê³¼ ì±„ë„ì€ ì¼ì‹œ ì¤‘ë‹¨ì„ ê²€í† í•˜ê³ , `;
                insightHTML += `ì˜ˆì‚°ì„ ìƒìœ„ ì±„ë„ë¡œ ì¬ë°°ë¶„í•˜ì„¸ìš”. `;
            } else if (topBottomRatio > 3) {
                insightHTML += `ì±„ë„ ê°„ ì„±ê³¼ ì°¨ì´ê°€ ${topBottomRatio.toFixed(1)}ë°°ë¡œ ì¡´ì¬í•©ë‹ˆë‹¤. `;
                insightHTML += `ì €ì„±ê³¼ ì±„ë„ì˜ ì›ì¸ì„ ë¶„ì„í•˜ê³  ê°œì„ í•˜ì„¸ìš”. `;
            } else {
                insightHTML += `ì±„ë„ ê°„ ì„±ê³¼ê°€ ë¹„êµì  ê³ ë¥´ê²Œ ë¶„í¬ë˜ì–´ ìˆìŠµë‹ˆë‹¤. `;
            }

            // 4. ì§€í‘œë³„ ë§ì¶¤ ì¶”ì²œ
            insightHTML += `<br><br><strong style="color: var(--primary-main);">ğŸ’¡ ${currentKpiName} ê°œì„  ì „ëµ:</strong> `;
            switch(kpiType) {
                case 'cvr':
                    if (avgValue < 1.5) {
                        insightHTML += `ì „ì²´ í‰ê·  CVRì´ ${avgValue.toFixed(2)}%ë¡œ ë‚®ìŠµë‹ˆë‹¤. ëœë”© í˜ì´ì§€ ê°œì„ ê³¼ íƒ€ê²ŸíŒ… ì •ë°€í™”ê°€ ì‹œê¸‰í•©ë‹ˆë‹¤. `;
                    } else if (avgValue > 3) {
                        insightHTML += `ì „ì²´ í‰ê·  CVRì´ ${avgValue.toFixed(2)}%ë¡œ ìš°ìˆ˜í•©ë‹ˆë‹¤! í˜„ì¬ ì „ëµì„ ìœ ì§€í•˜ì„¸ìš”. `;
                    } else {
                        insightHTML += `ì „ì²´ í‰ê·  CVRì€ ${avgValue.toFixed(2)}%ì…ë‹ˆë‹¤. A/B í…ŒìŠ¤íŠ¸ë¡œ ì¶”ê°€ ê°œì„ ì„ ì‹œë„í•˜ì„¸ìš”. `;
                    }
                    break;
                case 'revenue':
                    insightHTML += `<strong>${top1.channel}</strong>ì´ ì „ì²´ ë§¤ì¶œì˜ í•µì‹¬ì…ë‹ˆë‹¤. `;
                    insightHTML += `ì´ ì±„ë„ì˜ ê´‘ê³  ì†Œì¬, íƒ€ê²ŸíŒ…, ëœë”© í˜ì´ì§€ë¥¼ ë¶„ì„í•˜ì—¬ ë‹¤ë¥¸ ì±„ë„ì— ì ìš©í•˜ì„¸ìš”. `;
                    break;
                case 'acquisition':
                    insightHTML += `ë°©ë¬¸ìê°€ ë§ë‹¤ê³  ì¢‹ì€ ê²ƒì€ ì•„ë‹™ë‹ˆë‹¤. `;
                    insightHTML += `CVRê³¼ í•¨ê»˜ ë¹„êµí•˜ì—¬ íš¨ìœ¨ì ì¸ ì±„ë„ì— ì§‘ì¤‘ íˆ¬ìí•˜ì„¸ìš”. `;
                    break;
                default:
                    insightHTML += `ìƒìœ„ 3ê°œ ì±„ë„(<strong>${top1.channel}, ${top2.channel}, ${top3.channel}</strong>)ì— ì§‘ì¤‘í•˜ì—¬ ìµœì í™”í•˜ì„¸ìš”. `;
            }

            // ì¸ì‚¬ì´íŠ¸ í‘œì‹œ
            const insightElement = document.getElementById('kpiChartInsightText');
            if (insightElement) {
                insightElement.innerHTML = insightHTML;
            }
        }

        // KPI ì°¨íŠ¸ ì—…ë°ì´íŠ¸ (CVR, ìœ ì…, í™œë™, ê´€ì‹¬, ê²°ì œì§„í–‰, êµ¬ë§¤ì™„ë£Œ, ë§¤ì¶œ)
        function updateKpiChart(kpiType = 'cvr') {
            if (channelData.length === 0) return;

            const ctx = document.getElementById('channelKpiChart');
            if (!ctx) return;

            if (channelKpiChart) {
                channelKpiChart.destroy();
            }

            // í˜„ì¬ KPI íƒ€ì… ì €ì¥
            currentKpiType = kpiType;

            // KPIë³„ ì„¤ì •
            const kpiConfig = {
                cvr: {
                    label: 'CVR (%)',
                    key: 'CVR',
                    color: '#673ab7',
                    format: (val) => formatDecimal(val) + '%',
                    getValue: (row) => parseFloat(row['CVR']) || 0
                },
                acquisition: {
                    label: 'ìœ ì… (ëª…)',
                    key: 'ìœ ì…',
                    color: '#2196f3',
                    format: (val) => formatNumber(val) + 'ëª…',
                    getValue: (row) => parseFloat(row['ìœ ì…']) || 0
                },
                activation: {
                    label: 'í™œë™ (ëª…)',
                    key: 'í™œë™',
                    color: '#00bcd4',
                    format: (val) => formatNumber(val) + 'ëª…',
                    getValue: (row) => parseFloat(row['í™œë™']) || 0
                },
                consideration: {
                    label: 'ê´€ì‹¬ (ëª…)',
                    key: 'ê´€ì‹¬',
                    color: '#ff9800',
                    format: (val) => formatNumber(val) + 'ëª…',
                    getValue: (row) => parseFloat(row['ê´€ì‹¬']) || 0
                },
                conversion: {
                    label: 'ê²°ì œì§„í–‰ (ëª…)',
                    key: 'ê²°ì œì§„í–‰',
                    color: '#4caf50',
                    format: (val) => formatNumber(val) + 'ëª…',
                    getValue: (row) => parseFloat(row['ê²°ì œì§„í–‰']) || 0
                },
                purchase: {
                    label: 'êµ¬ë§¤ì™„ë£Œ (ëª…)',
                    key: 'êµ¬ë§¤ì™„ë£Œ',
                    color: '#00c853',
                    format: (val) => formatNumber(val) + 'ëª…',
                    getValue: (row) => parseFloat(row['êµ¬ë§¤ì™„ë£Œ']) || 0
                },
                revenue: {
                    label: 'ë§¤ì¶œ (ì›)',
                    key: 'Revenue',
                    color: '#f44336',
                    format: (val) => formatNumber(val) + 'ì›',
                    getValue: (row) => parseFloat(row['Revenue']) || 0
                }
            };

            const config = kpiConfig[kpiType];
            if (!config) return;

            // ì„ íƒëœ KPI ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬ (DESC)
            const sortedData = [...channelData].sort((a, b) => {
                const aVal = config.getValue(a);
                const bVal = config.getValue(b);
                return bVal - aVal;
            }).slice(0, 10);

            const labels = sortedData.map(row => row['channel']);
            const values = sortedData.map(row => config.getValue(row));

            channelKpiChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels,
                    datasets: [{
                        label: config.label,
                        data: values,
                        backgroundColor: config.color.replace(')', ', 0.8)').replace('rgb', 'rgba'),
                        borderColor: config.color,
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return config.label + ': ' + config.format(context.parsed.x);
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: config.label
                            }
                        }
                    }
                }
            });

            // KPI ë°ì´í„° ë¶„ì„ ë° ì¸ì‚¬ì´íŠ¸ ìƒì„±
            analyzeKpiChartData(channelData, kpiType);

            // íˆ´íŒ ì´ë²¤íŠ¸ ì„¤ì •
            setupKpiChartTooltip();
        }

        // KPI ì°¨íŠ¸ íˆ´íŒ ì„¤ì •
        function setupKpiChartTooltip() {
            const canvas = document.getElementById('channelKpiChart');
            const container = canvas ? canvas.parentElement : null;
            if (!container) return;

            // Remove existing listeners by cloning container
            if (!container.dataset.tooltipSetup) {
                container.dataset.tooltipSetup = 'true';

                container.addEventListener('mouseenter', function(event) {
                    const insight = generateKpiInsight(currentKpiType);
                    showChartInsightTooltip('kpiChartTooltip', insight.insight, insight.recommendation, event);
                });

                container.addEventListener('mousemove', function(event) {
                    const tooltip = document.getElementById('kpiChartTooltip');
                    if (tooltip && tooltip.classList.contains('show')) {
                        tooltip.style.left = (event.clientX + 15) + 'px';
                        tooltip.style.top = (event.clientY + 15) + 'px';
                    }
                });

                container.addEventListener('mouseleave', function() {
                    hideChartInsightTooltip('kpiChartTooltip');
                });
            }
        }

        // ì´íƒˆë¥  ìë™ ë¶„ì„ í•¨ìˆ˜
        function analyzeChurnRates(allData, currentStage) {
            if (allData.length === 0) return;

            // ê° ë‹¨ê³„ë³„ í‰ê·  ì´íƒˆë¥  ê³„ì‚°
            let totalActivation = 0, totalConsideration = 0, totalConversion = 0, totalPurchase = 0;

            allData.forEach(row => {
                const churnRates = calculateChurnRates(row);
                totalActivation += churnRates.activation;
                totalConsideration += churnRates.consideration;
                totalConversion += churnRates.conversion;
                totalPurchase += churnRates.purchase;
            });

            const avgActivation = totalActivation / allData.length;
            const avgConsideration = totalConsideration / allData.length;
            const avgConversion = totalConversion / allData.length;
            const avgPurchase = totalPurchase / allData.length;

            // ì‚°ì—… í‰ê·  ë²¤ì¹˜ë§ˆí¬ (ì¼ë°˜ì ì¸ ë²”ìœ„ì˜ ì¤‘ê°„ê°’)
            const benchmarks = {
                activation: { min: 40, max: 60, avg: 50, label: 'ìœ ì…â†’í™œë™' },
                consideration: { min: 50, max: 70, avg: 60, label: 'í™œë™â†’ê´€ì‹¬' },
                conversion: { min: 60, max: 80, avg: 70, label: 'ê´€ì‹¬â†’ê²°ì œì§„í–‰' },
                purchase: { min: 20, max: 30, avg: 25, label: 'ê²°ì œì§„í–‰â†’êµ¬ë§¤ì™„ë£Œ' }
            };

            // ê°€ì¥ ë†’ì€ ì´íƒˆë¥ ì„ ë³´ì´ëŠ” ë‹¨ê³„ ì°¾ê¸°
            const stageAverages = [
                { stage: 'activation', avg: avgActivation, label: 'ìœ ì…â†’í™œë™' },
                { stage: 'consideration', avg: avgConsideration, label: 'í™œë™â†’ê´€ì‹¬' },
                { stage: 'conversion', avg: avgConversion, label: 'ê´€ì‹¬â†’ê²°ì œì§„í–‰' },
                { stage: 'purchase', avg: avgPurchase, label: 'ê²°ì œì§„í–‰â†’êµ¬ë§¤ì™„ë£Œ' }
            ];

            const highestChurnStage = stageAverages.reduce((max, item) =>
                item.avg > max.avg ? item : max, stageAverages[0]
            );

            // í•´ë‹¹ ë‹¨ê³„ì—ì„œ ì´íƒˆë¥ ì´ ê°€ì¥ ë†’ì€ ì±„ë„ë“¤ ì°¾ê¸°
            const channelsWithHighChurn = allData.map(row => {
                const churnRates = calculateChurnRates(row);
                return {
                    channel: row['channel'],
                    churnRate: churnRates[highestChurnStage.stage]
                };
            }).sort((a, b) => b.churnRate - a.churnRate).slice(0, 3);

            // ì¸ì‚¬ì´íŠ¸ HTML ìƒì„±
            let insightHTML = '';

            // ì „ì²´ ìƒí™© ìš”ì•½
            insightHTML += `ê°€ì¥ ë§ì€ ê³ ê°ì´ ì´íƒˆí•˜ëŠ” êµ¬ê°„ì€ <strong style="color: #ff5722;">${highestChurnStage.label}</strong> ë‹¨ê³„ë¡œ, `;
            insightHTML += `í‰ê·  <strong style="color: #ff5722;">${highestChurnStage.avg.toFixed(1)}%</strong>ì˜ ê³ ê°ì´ ì´ ë‹¨ê³„ì—ì„œ ë– ë‚©ë‹ˆë‹¤. `;

            // ì‚°ì—… í‰ê· ê³¼ ë¹„êµ
            const benchmark = benchmarks[highestChurnStage.stage];
            if (highestChurnStage.avg > benchmark.max) {
                insightHTML += `<strong style="color: var(--error-main);">âš ï¸ ì‚°ì—… í‰ê· (${benchmark.min}-${benchmark.max}%)ë³´ë‹¤ ë†’ì•„ ì¦‰ì‹œ ê°œì„ ì´ í•„ìš”í•©ë‹ˆë‹¤!</strong> `;
            } else if (highestChurnStage.avg < benchmark.min) {
                insightHTML += `<strong style="color: var(--success-main);">âœ… ì‚°ì—… í‰ê· (${benchmark.min}-${benchmark.max}%)ë³´ë‹¤ ë‚®ì•„ ì–‘í˜¸í•©ë‹ˆë‹¤!</strong> `;
            } else {
                insightHTML += `ì‚°ì—… í‰ê· (${benchmark.min}-${benchmark.max}%) ë²”ìœ„ ë‚´ì…ë‹ˆë‹¤. `;
            }

            // ë¬¸ì œ ì±„ë„ ê°•ì¡°
            insightHTML += `<br><br><strong style="color: var(--primary-main);">ğŸ¯ ì§‘ì¤‘ ê°œì„  ëŒ€ìƒ ì±„ë„:</strong><br>`;
            channelsWithHighChurn.forEach((item, index) => {
                insightHTML += `${index + 1}. <strong>${item.channel}</strong>: ${item.churnRate.toFixed(1)}% ì´íƒˆ`;
                if (index < channelsWithHighChurn.length - 1) insightHTML += '<br>';
            });

            // ë‹¨ê³„ë³„ êµ¬ì²´ì ì¸ ì¶”ì²œì‚¬í•­
            insightHTML += `<br><br><strong style="color: var(--primary-main);">ğŸ’¡ ${highestChurnStage.label} ì´íƒˆë¥  ê°œì„  ë°©ë²•:</strong><br>`;

            switch(highestChurnStage.stage) {
                case 'activation':
                    if (highestChurnStage.avg > 60) {
                        insightHTML += `â€¢ <strong>ëœë”© í˜ì´ì§€ ë¡œë”© ì†ë„</strong>ë¥¼ 3ì´ˆ ì´ë‚´ë¡œ ìµœì í™”í•˜ì„¸ìš” (í˜„ì¬ ì´íƒˆë¥ ì´ ë§¤ìš° ë†’ìŒ)<br>`;
                        insightHTML += `â€¢ ê´‘ê³  ë¬¸êµ¬ì™€ ëœë”© í˜ì´ì§€ì˜ <strong>ë©”ì‹œì§€ê°€ ì¼ì¹˜</strong>í•˜ëŠ”ì§€ ì¦‰ì‹œ í™•ì¸í•˜ì„¸ìš”<br>`;
                        insightHTML += `â€¢ ëª¨ë°”ì¼ ì‚¬ìš©ì ê²½í—˜ì„ ìš°ì„ ì ìœ¼ë¡œ ê°œì„ í•˜ì„¸ìš”`;
                    } else {
                        insightHTML += `â€¢ ì²« í™”ë©´ì— ë„ˆë¬´ ë§ì€ ì •ë³´ê°€ ìˆëŠ”ì§€ í™•ì¸í•˜ê³  <strong>í•µì‹¬ ë©”ì‹œì§€ë§Œ ê°•ì¡°</strong>í•˜ì„¸ìš”<br>`;
                        insightHTML += `â€¢ ëœë”© í˜ì´ì§€ ë””ìì¸ì´ ì‹ ë¢°ê°ì„ ì£¼ëŠ”ì§€ ì ê²€í•˜ì„¸ìš”<br>`;
                        insightHTML += `â€¢ CTA(í–‰ë™ ìœ ë„) ë²„íŠ¼ì´ ëˆˆì— ì˜ ë„ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”`;
                    }
                    break;
                case 'consideration':
                    if (highestChurnStage.avg > 70) {
                        insightHTML += `â€¢ <strong>ìƒì„¸ í˜ì´ì§€ì— ì •ë³´ê°€ ë¶€ì¡±</strong>í•©ë‹ˆë‹¤. ì œí’ˆ ì„¤ëª…, ì‚¬ì–‘, ì‚¬ìš©ë²•ì„ ë³´ê°•í•˜ì„¸ìš”<br>`;
                        insightHTML += `â€¢ <strong>ê³ ê° ë¦¬ë·°ì™€ í‰ì </strong>ì„ ëˆˆì— ë„ê²Œ ë°°ì¹˜í•˜ì„¸ìš” (ì‹ ë¢°ë„ í–¥ìƒ)<br>`;
                        insightHTML += `â€¢ ê²½ìŸì‚¬ ëŒ€ë¹„ ì°¨ë³„í™” í¬ì¸íŠ¸ë¥¼ ëª…í™•íˆ ì „ë‹¬í•˜ì„¸ìš”`;
                    } else {
                        insightHTML += `â€¢ ì œí’ˆ ì´ë¯¸ì§€ì˜ í’ˆì§ˆì„ ë†’ì´ê³  ë‹¤ì–‘í•œ ê°ë„ë¡œ ì œê³µí•˜ì„¸ìš”<br>`;
                        insightHTML += `â€¢ FAQë‚˜ ì±—ë´‡ì„ ì¶”ê°€í•˜ì—¬ ì¦‰ì‹œ ê¶ê¸ˆì¦ì„ í•´ê²°í•˜ì„¸ìš”<br>`;
                        insightHTML += `â€¢ ì‚¬ìš© ì‚¬ë¡€ë‚˜ í›„ê¸° ì˜ìƒì„ ì¶”ê°€í•˜ì„¸ìš”`;
                    }
                    break;
                case 'conversion':
                    if (highestChurnStage.avg > 75) {
                        insightHTML += `â€¢ <strong>ê°€ê²©ì´ ë„ˆë¬´ ë†’ê±°ë‚˜</strong> í• ì¸/í”„ë¡œëª¨ì…˜ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. ì²« êµ¬ë§¤ í• ì¸ì„ ì œê³µí•˜ì„¸ìš”<br>`;
                        insightHTML += `â€¢ <strong>íšŒì›ê°€ì… ì—†ì´</strong> ê²ŒìŠ¤íŠ¸ë¡œ ê²°ì œí•  ìˆ˜ ìˆê²Œ í•˜ì„¸ìš” (ì´íƒˆë¥  í¬ê²Œ ê°ì†Œ)<br>`;
                        insightHTML += `â€¢ ë°°ì†¡ë¹„ê°€ ë†’ê±°ë‚˜ ë°°ì†¡ ê¸°ê°„ì´ ê¸¸ë©´ ëª…í™•íˆ ì•ˆë‚´í•˜ì„¸ìš”`;
                    } else {
                        insightHTML += `â€¢ "ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸°" ë²„íŠ¼ì„ ë” ëˆˆì— ë„ê²Œ ë§Œë“œì„¸ìš”<br>`;
                        insightHTML += `â€¢ ì¬ê³  ë¶€ì¡± ì‹œ ì•Œë¦¼ ë°›ê¸° ê¸°ëŠ¥ì„ ì œê³µí•˜ì„¸ìš”<br>`;
                        insightHTML += `â€¢ ìœ„ì‹œë¦¬ìŠ¤íŠ¸ ê¸°ëŠ¥ìœ¼ë¡œ ë‚˜ì¤‘ì— êµ¬ë§¤ë¥¼ ìœ ë„í•˜ì„¸ìš”`;
                    }
                    break;
                case 'purchase':
                    if (highestChurnStage.avg > 30) {
                        insightHTML += `â€¢ <strong>ê²°ì œ ê³¼ì •ì´ ë„ˆë¬´ ë³µì¡</strong>í•©ë‹ˆë‹¤. ë‹¨ê³„ë¥¼ 3ë‹¨ê³„ ì´í•˜ë¡œ ì¤„ì´ì„¸ìš”<br>`;
                        insightHTML += `â€¢ <strong>ì¹´ì¹´ì˜¤í˜ì´, ë„¤ì´ë²„í˜ì´</strong> ë“± ê°„í¸ê²°ì œ ì˜µì…˜ì„ ì¶”ê°€í•˜ì„¸ìš” (ì´íƒˆë¥  ê¸‰ê°)<br>`;
                        insightHTML += `â€¢ ë³´ì•ˆ ì¸ì¦ì„œ í‘œì‹œë¡œ ê²°ì œ ì•ˆì „ì„±ì„ ê°•ì¡°í•˜ì„¸ìš”`;
                    } else {
                        insightHTML += `â€¢ ê²°ì œ ë‹¨ê³„ë§ˆë‹¤ ì§„í–‰ ìƒí™© í‘œì‹œì¤„ì„ ë³´ì—¬ì£¼ì„¸ìš”<br>`;
                        insightHTML += `â€¢ ì˜ˆìƒì¹˜ ëª»í•œ ì¶”ê°€ ë¹„ìš©(ë°°ì†¡ë¹„, ìˆ˜ìˆ˜ë£Œ)ì´ ì—†ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”<br>`;
                        insightHTML += `â€¢ ê²°ì œ ì‹¤íŒ¨ ì‹œ ëª…í™•í•œ ì˜¤ë¥˜ ë©”ì‹œì§€ì™€ í•´ê²° ë°©ë²•ì„ ì œê³µí•˜ì„¸ìš”`;
                    }
                    break;
            }

            // ì „ì²´ì ì¸ ì´íƒˆë¥  íŒ¨í„´ ë¶„ì„
            const allChurns = [avgActivation, avgConsideration, avgConversion, avgPurchase];
            const overallAvg = allChurns.reduce((sum, val) => sum + val, 0) / 4;

            insightHTML += `<br><br><strong style="color: var(--primary-main);">ğŸ“Š ì „ì²´ í¼ë„ ìƒíƒœ:</strong> `;
            if (overallAvg > 60) {
                insightHTML += `ì „ë°˜ì ìœ¼ë¡œ ì´íƒˆë¥ ì´ ë†’ìŠµë‹ˆë‹¤. <strong>ì „ì²´ ê³ ê° ì—¬ì •ì„ ì¬ê²€í† </strong>í•˜ê³ , ê° ë‹¨ê³„ë§ˆë‹¤ A/B í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ì„¸ìš”.`;
            } else if (overallAvg < 40) {
                insightHTML += `ì „ë°˜ì ìœ¼ë¡œ ìš°ìˆ˜í•œ ìƒíƒœì…ë‹ˆë‹¤! í˜„ì¬ ì „ëµì„ ìœ ì§€í•˜ë©´ì„œ ì„¸ë¶€ì ì¸ ìµœì í™”ì— ì§‘ì¤‘í•˜ì„¸ìš”.`;
            } else {
                insightHTML += `í‰ê· ì ì¸ ìˆ˜ì¤€ì…ë‹ˆë‹¤. ìœ„ì˜ ê°œì„  ë°©ë²•ì„ ìš°ì„ ìˆœìœ„ì— ë”°ë¼ í•˜ë‚˜ì”© ì ìš©í•´ë³´ì„¸ìš”.`;
            }

            // ì¸ì‚¬ì´íŠ¸ í‘œì‹œ
            const insightElement = document.getElementById('churnInsightText');
            if (insightElement) {
                insightElement.innerHTML = insightHTML;
            }
        }

        // ì´íƒˆë¥  ì°¨íŠ¸ ì—…ë°ì´íŠ¸ (í¼ë„ ë‹¨ê³„ë³„ ì´íƒˆë¥ )
        function updateChurnChart(stage = null, sort = null) {
            if (channelData.length === 0) return;

            const ctx = document.getElementById('channelChurnChart');
            if (!ctx) return;

            if (channelChurnChart) {
                channelChurnChart.destroy();
            }

            // íŒŒë¼ë¯¸í„°ê°€ ì œê³µë˜ë©´ ì „ì—­ ë³€ìˆ˜ ì—…ë°ì´íŠ¸
            if (stage !== null) currentChurnStage = stage;
            if (sort !== null) currentChurnSort = sort;

            // í¼ë„ ë‹¨ê³„ë³„ ì„¤ì •
            const stageConfig = {
                activation: {
                    label: 'ìœ ì…â†’í™œë™ ì´íƒˆë¥  (%)',
                    color: '#673ab7',
                    getValue: (row) => calculateChurnRates(row).activation,
                    tooltip: '(ìœ ì… - í™œë™) / ìœ ì… Ã— 100'
                },
                consideration: {
                    label: 'í™œë™â†’ê´€ì‹¬ ì´íƒˆë¥  (%)',
                    color: '#2196f3',
                    getValue: (row) => calculateChurnRates(row).consideration,
                    tooltip: '(í™œë™ - ê´€ì‹¬) / í™œë™ Ã— 100'
                },
                conversion: {
                    label: 'ê´€ì‹¬â†’ê²°ì œì§„í–‰ ì´íƒˆë¥  (%)',
                    color: '#ff9800',
                    getValue: (row) => calculateChurnRates(row).conversion,
                    tooltip: '(ê´€ì‹¬ - ê²°ì œì§„í–‰) / ê´€ì‹¬ Ã— 100'
                },
                purchase: {
                    label: 'ê²°ì œì§„í–‰â†’êµ¬ë§¤ì™„ë£Œ ì´íƒˆë¥  (%)',
                    color: '#4caf50',
                    getValue: (row) => calculateChurnRates(row).purchase,
                    tooltip: '(ê²°ì œì§„í–‰ - êµ¬ë§¤ì™„ë£Œ) / ê²°ì œì§„í–‰ Ã— 100'
                },
                avg: {
                    label: 'í‰ê·  ì´íƒˆë¥  (%)',
                    color: '#e91e63',
                    getValue: (row) => calculateChurnRates(row).avg,
                    tooltip: 'ëª¨ë“  ë‹¨ê³„ ì´íƒˆë¥ ì˜ í‰ê· '
                }
            };

            const config = stageConfig[currentChurnStage];
            if (!config) return;

            // ë°ì´í„° ì •ë ¬
            const sortedData = [...channelData].sort((a, b) => {
                const aVal = config.getValue(a);
                const bVal = config.getValue(b);
                return currentChurnSort === 'desc' ? (bVal - aVal) : (aVal - bVal);
            }).slice(0, 10);

            const labels = sortedData.map(row => row['channel']);
            const values = sortedData.map(row => config.getValue(row));

            channelChurnChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels,
                    datasets: [{
                        label: config.label,
                        data: values,
                        backgroundColor: config.color.replace(')', ', 0.8)').replace('rgb', 'rgba'),
                        borderColor: config.color,
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return config.label + ': ' + formatDecimal(context.parsed.x) + '%';
                                },
                                afterLabel: function(context) {
                                    return 'ê³„ì‚°ì‹: ' + config.tooltip;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: config.label
                            }
                        }
                    }
                }
            });

            // ì´íƒˆë¥  ìë™ ë¶„ì„ ì‹¤í–‰
            analyzeChurnRates(channelData, currentChurnStage);

            // íˆ´íŒ ì´ë²¤íŠ¸ ì„¤ì •
            setupChurnChartTooltip();
        }

        // ì´íƒˆë¥  ì°¨íŠ¸ íˆ´íŒ ì„¤ì •
        function setupChurnChartTooltip() {
            const canvas = document.getElementById('channelChurnChart');
            const container = canvas ? canvas.parentElement : null;
            if (!container) return;

            if (!container.dataset.tooltipSetup) {
                container.dataset.tooltipSetup = 'true';

                container.addEventListener('mouseenter', function(event) {
                    const insight = generateChurnInsight();
                    showChartInsightTooltip('churnChartTooltip', insight.insight, insight.recommendation, event);
                });

                container.addEventListener('mousemove', function(event) {
                    const tooltip = document.getElementById('churnChartTooltip');
                    if (tooltip && tooltip.classList.contains('show')) {
                        tooltip.style.left = (event.clientX + 15) + 'px';
                        tooltip.style.top = (event.clientY + 15) + 'px';
                    }
                });

                container.addEventListener('mouseleave', function() {
                    hideChartInsightTooltip('churnChartTooltip');
                });
            }
        }

        // ë¹„êµ ì°¨íŠ¸ ìë™ ë¶„ì„ í•¨ìˆ˜
        function analyzeCompareChartData(data) {
            if (data.length === 0) return;

            // ë°ì´í„° íŒŒì‹± (ìƒìœ„ 8ê°œë§Œ, ì°¨íŠ¸ì™€ ë™ì¼)
            const sortedData = [...data].sort((a, b) =>
                (parseFloat(b['CVR']) || 0) - (parseFloat(a['CVR']) || 0)
            ).slice(0, 8).map(row => ({
                channel: row['channel'],
                cvr: parseFloat(row['CVR']) || 0,
                acquisition: parseFloat(row['ìœ ì…']) || 0,
                purchase: parseFloat(row['êµ¬ë§¤ì™„ë£Œ']) || 0,
                revenue: parseFloat(row['Revenue']) || 0
            }));

            // ì •ê·œí™” (100ì  ë§Œì ìœ¼ë¡œ í™˜ì‚°)
            const maxCVR = Math.max(...sortedData.map(ch => ch.cvr));
            const maxAcquisition = Math.max(...sortedData.map(ch => ch.acquisition));
            const maxPurchase = Math.max(...sortedData.map(ch => ch.purchase));
            const maxRevenue = Math.max(...sortedData.map(ch => ch.revenue));

            const normalizedData = sortedData.map(ch => {
                const normCVR = maxCVR > 0 ? (ch.cvr / maxCVR * 100) : 0;
                const normAcquisition = maxAcquisition > 0 ? (ch.acquisition / maxAcquisition * 100) : 0;
                const normPurchase = maxPurchase > 0 ? (ch.purchase / maxPurchase * 100) : 0;
                const normRevenue = maxRevenue > 0 ? (ch.revenue / maxRevenue * 100) : 0;

                // ê· í˜•ë„ ê³„ì‚° (í‘œì¤€í¸ì°¨ ê¸°ë°˜)
                const values = [normCVR, normAcquisition, normPurchase, normRevenue];
                const avg = values.reduce((sum, val) => sum + val, 0) / values.length;
                const variance = values.reduce((sum, val) => sum + Math.pow(val - avg, 2), 0) / values.length;
                const balance = 100 - Math.sqrt(variance); // ë†’ì„ìˆ˜ë¡ ê· í˜•ì¡í˜

                return {
                    ...ch,
                    normCVR,
                    normAcquisition,
                    normPurchase,
                    normRevenue,
                    avg,
                    balance
                };
            });

            // ì±„ë„ ìœ í˜• ë¶„ë¥˜
            const perfectChannels = normalizedData.filter(ch => ch.avg >= 60 && ch.balance >= 50); // ëª¨ë“  ì§€í‘œ ê³ ë¥´ê²Œ ë†’ìŒ
            const efficientSmallChannels = normalizedData.filter(ch => ch.normCVR >= 70 && ch.normAcquisition < 50); // CVR ë†’ì§€ë§Œ ê·œëª¨ ì‘ìŒ
            const inefficientLargeChannels = normalizedData.filter(ch => ch.normAcquisition >= 70 && ch.normCVR < 50); // ê·œëª¨ í¬ì§€ë§Œ íš¨ìœ¨ ë‚®ìŒ
            const lowPerformers = normalizedData.filter(ch => ch.avg < 40); // ëª¨ë“  ì§€í‘œ ë‚®ìŒ

            // ìµœê³  ê· í˜• ì±„ë„
            const mostBalanced = normalizedData.reduce((max, ch) => ch.balance > max.balance ? ch : max, normalizedData[0]);

            // ì¸ì‚¬ì´íŠ¸ HTML ìƒì„±
            let insightHTML = '';

            // 1. ìµœê³  ê· í˜• ì±„ë„
            if (perfectChannels.length > 0) {
                insightHTML += `<strong style="color: #4caf50;">ğŸŒŸ ì™„ë²½í•œ ì±„ë„:</strong> `;
                insightHTML += `<strong>${perfectChannels[0].channel}</strong>ì´ íš¨ìœ¨ê³¼ ê·œëª¨ë¥¼ ëª¨ë‘ ê°–ì¶˜ ìµœê³ ì˜ ì±„ë„ì…ë‹ˆë‹¤. `;
                insightHTML += `ëª¨ë“  ì§€í‘œ(CVR, ë°©ë¬¸ì, êµ¬ë§¤, ë§¤ì¶œ)ê°€ ê· í˜•ìˆê²Œ ë†’ìŠµë‹ˆë‹¤. ìµœìš°ì„  íˆ¬ì ëŒ€ìƒì…ë‹ˆë‹¤! `;
            } else {
                insightHTML += `<strong style="color: #9c27b0;">ğŸ’ ê°€ì¥ ê· í˜•ì¡íŒ ì±„ë„:</strong> `;
                insightHTML += `<strong>${mostBalanced.channel}</strong>ì´ ìƒëŒ€ì ìœ¼ë¡œ ê°€ì¥ ê· í˜•ì¡í˜€ ìˆìŠµë‹ˆë‹¤ (ê· í˜•ë„: ${mostBalanced.balance.toFixed(0)}ì ). `;
            }

            // 2. ìˆ¨ê²¨ì§„ ë³´ì„ (íš¨ìœ¨ì€ ì¢‹ì€ë° ê·œëª¨ê°€ ì‘ìŒ)
            if (efficientSmallChannels.length > 0) {
                insightHTML += `<br><br><strong style="color: #2196f3;">ğŸ’ ìˆ¨ê²¨ì§„ ë³´ì„:</strong> `;
                const gems = efficientSmallChannels.slice(0, 2).map(ch => ch.channel).join(', ');
                insightHTML += `<strong>${gems}</strong>ì€ ì „í™˜ìœ¨ì´ ìš°ìˆ˜í•˜ì§€ë§Œ ë°©ë¬¸ìê°€ ì ìŠµë‹ˆë‹¤. `;
                insightHTML += `<strong>ê´‘ê³  ì˜ˆì‚°ì„ ëŠ˜ë ¤ ê·œëª¨ë¥¼ í‚¤ìš°ë©´ í° íš¨ê³¼</strong>ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤! `;
            }

            // 3. ê°œì„  í•„ìš” ì±„ë„ (ê·œëª¨ëŠ” í°ë° íš¨ìœ¨ ë‚®ìŒ)
            if (inefficientLargeChannels.length > 0) {
                insightHTML += `<br><br><strong style="color: #ff9800;">âš ï¸ ê°œì„  ê¸°íšŒ:</strong> `;
                insightHTML += `<strong>${inefficientLargeChannels[0].channel}</strong>ì€ ë°©ë¬¸ìëŠ” ë§ì§€ë§Œ (${formatNumber(inefficientLargeChannels[0].acquisition)}ëª…) `;
                insightHTML += `ì „í™˜ìœ¨ì´ ${inefficientLargeChannels[0].cvr.toFixed(2)}%ë¡œ ë‚®ìŠµë‹ˆë‹¤. `;
                insightHTML += `<strong>ëœë”© í˜ì´ì§€ì™€ íƒ€ê²ŸíŒ…ì„ ê°œì„ í•˜ë©´ ë§¤ì¶œì´ í¬ê²Œ ì¦ê°€</strong>í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤! `;
            }

            // 4. ì €ì„±ê³¼ ì±„ë„
            if (lowPerformers.length > 0) {
                insightHTML += `<br><br><strong style="color: #f44336;">âŒ ì €ì„±ê³¼ ì±„ë„:</strong> `;
                const lowChannels = lowPerformers.map(ch => ch.channel).join(', ');
                insightHTML += `<strong>${lowChannels}</strong>ì€ ëª¨ë“  ì§€í‘œê°€ ë‚®ìŠµë‹ˆë‹¤. `;
                insightHTML += `ì¼ì‹œ ì¤‘ë‹¨ì„ ê²€í† í•˜ê³  ì˜ˆì‚°ì„ ìƒìœ„ ì±„ë„ë¡œ ì¬ë°°ë¶„í•˜ì„¸ìš”. `;
            }

            // 5. ì „ì²´ì ì¸ í¬íŠ¸í´ë¦¬ì˜¤ í‰ê°€
            insightHTML += `<br><br><strong style="color: var(--primary-main);">ğŸ“Š ì±„ë„ í¬íŠ¸í´ë¦¬ì˜¤:</strong> `;
            insightHTML += `ìƒìœ„ 8ê°œ ì±„ë„ ì¤‘ `;
            if (perfectChannels.length > 0) {
                insightHTML += `<strong>${perfectChannels.length}ê°œê°€ ì™„ë²½</strong>, `;
            }
            if (efficientSmallChannels.length > 0) {
                insightHTML += `<strong>${efficientSmallChannels.length}ê°œê°€ í™•ì¥ ê°€ëŠ¥</strong>, `;
            }
            if (inefficientLargeChannels.length > 0) {
                insightHTML += `<strong>${inefficientLargeChannels.length}ê°œê°€ ê°œì„  í•„ìš”</strong>, `;
            }
            if (lowPerformers.length > 0) {
                insightHTML += `<strong>${lowPerformers.length}ê°œê°€ ì €ì„±ê³¼</strong> `;
            }
            insightHTML += `ìƒíƒœì…ë‹ˆë‹¤.`;

            // 6. ì‹¤í–‰ ê°€ëŠ¥í•œ ì¶”ì²œ
            insightHTML += `<br><br><strong style="color: var(--primary-main);">ğŸ’¡ ìš°ì„ ìˆœìœ„ ì•¡ì…˜:</strong> `;
            if (perfectChannels.length > 0) {
                insightHTML += `1) <strong>${perfectChannels[0].channel}</strong> ì˜ˆì‚° 30-50% ì¦ì•¡, `;
            }
            if (efficientSmallChannels.length > 0) {
                insightHTML += `2) <strong>${efficientSmallChannels[0].channel}</strong> íƒ€ê²Ÿ í™•ëŒ€ë¡œ ë°©ë¬¸ì ëŠ˜ë¦¬ê¸°, `;
            }
            if (inefficientLargeChannels.length > 0) {
                insightHTML += `3) <strong>${inefficientLargeChannels[0].channel}</strong> ëœë”© í˜ì´ì§€ A/B í…ŒìŠ¤íŠ¸ ì‹œì‘`;
            }

            // ì¸ì‚¬ì´íŠ¸ í‘œì‹œ
            const insightElement = document.getElementById('compareChartInsightText');
            if (insightElement) {
                insightElement.innerHTML = insightHTML;
            }
        }

        // ë¹„êµ ì°¨íŠ¸ ì—…ë°ì´íŠ¸ (ì±„ë„ë³„ ì¢…í•© ì„±ê³¼)
        function updateCompareChart() {
            if (channelData.length === 0) return;

            const ctx = document.getElementById('channelCompareChart');
            if (!ctx) return;

            if (channelCompareChart) {
                channelCompareChart.destroy();
            }

            // ê·¸ë£¹í™”ëœ ì°¨íŠ¸ í‘œì‹œ
            updateGroupedChart(ctx);

            // ë¹„êµ ì°¨íŠ¸ ë°ì´í„° ë¶„ì„ ë° ì¸ì‚¬ì´íŠ¸ ìƒì„±
            analyzeCompareChartData(channelData);

            // íˆ´íŒ ì´ë²¤íŠ¸ ì„¤ì •
            setupCompareChartTooltip();
        }

        // ë¹„êµ ì°¨íŠ¸ íˆ´íŒ ì„¤ì •
        function setupCompareChartTooltip() {
            const canvas = document.getElementById('channelCompareChart');
            const container = canvas ? canvas.parentElement : null;
            if (!container) return;

            if (!container.dataset.tooltipSetup) {
                container.dataset.tooltipSetup = 'true';

                container.addEventListener('mouseenter', function(event) {
                    const insight = generateCompareInsight();
                    showChartInsightTooltip('compareChartTooltip', insight.insight, insight.recommendation, event);
                });

                container.addEventListener('mousemove', function(event) {
                    const tooltip = document.getElementById('compareChartTooltip');
                    if (tooltip && tooltip.classList.contains('show')) {
                        tooltip.style.left = (event.clientX + 15) + 'px';
                        tooltip.style.top = (event.clientY + 15) + 'px';
                    }
                });

                container.addEventListener('mouseleave', function() {
                    hideChartInsightTooltip('compareChartTooltip');
                });
            }
        }


        // ê·¸ë£¹í™”ëœ ë§‰ëŒ€ ì°¨íŠ¸
        function updateGroupedChart(ctx) {
            // CVR ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬
            const sortedData = [...channelData].sort((a, b) =>
                (parseFloat(b['CVR']) || 0) - (parseFloat(a['CVR']) || 0)
            ).slice(0, 8);

            const labels = sortedData.map(row => row['channel']);

            // ì •ê·œí™”ë¥¼ ìœ„í•œ ìµœëŒ€ê°’ ê³„ì‚°
            const maxAcquisition = Math.max(...sortedData.map(row => parseFloat(row['ìœ ì…']) || 0));
            const maxPurchase = Math.max(...sortedData.map(row => parseFloat(row['êµ¬ë§¤ì™„ë£Œ']) || 0));
            const maxRevenue = Math.max(...sortedData.map(row => parseFloat(row['Revenue']) || 0));

            // ì›ë³¸ ë°ì´í„° ì €ì¥
            const originalData = sortedData.map(row => ({
                cvr: parseFloat(row['CVR']) || 0,
                acquisition: parseFloat(row['ìœ ì…']) || 0,
                purchase: parseFloat(row['êµ¬ë§¤ì™„ë£Œ']) || 0,
                revenue: parseFloat(row['Revenue']) || 0
            }));

            // í˜¸ë²„ ìƒíƒœ ì¶”ì 
            let hoveredIndex = null;

            channelCompareChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels,
                    datasets: [
                        {
                            label: 'CVR (%)',
                            data: sortedData.map(row => parseFloat(row['CVR']) || 0),
                            backgroundColor: 'rgba(103, 58, 183, 0.8)',
                            borderColor: '#673ab7',
                            borderWidth: 1,
                            originalData: originalData.map(d => d.cvr)
                        },
                        {
                            label: 'ìœ ì… (ì •ê·œí™”)',
                            data: sortedData.map(row => ((parseFloat(row['ìœ ì…']) || 0) / maxAcquisition * 100)),
                            backgroundColor: 'rgba(33, 150, 243, 0.8)',
                            borderColor: '#2196f3',
                            borderWidth: 1,
                            originalData: originalData.map(d => d.acquisition)
                        },
                        {
                            label: 'êµ¬ë§¤ì™„ë£Œ (ì •ê·œí™”)',
                            data: sortedData.map(row => ((parseFloat(row['êµ¬ë§¤ì™„ë£Œ']) || 0) / maxPurchase * 100)),
                            backgroundColor: 'rgba(0, 200, 83, 0.8)',
                            borderColor: '#00c853',
                            borderWidth: 1,
                            originalData: originalData.map(d => d.purchase)
                        },
                        {
                            label: 'ë§¤ì¶œ (ì •ê·œí™”)',
                            data: sortedData.map(row => ((parseFloat(row['Revenue']) || 0) / maxRevenue * 100)),
                            backgroundColor: 'rgba(244, 67, 54, 0.8)',
                            borderColor: '#f44336',
                            borderWidth: 1,
                            originalData: originalData.map(d => d.revenue)
                        }
                    ]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'y',
                        intersect: false
                    },
                    onHover: function(event, activeElements) {
                        if (activeElements.length > 0) {
                            hoveredIndex = activeElements[0].index;
                        } else {
                            hoveredIndex = null;
                        }
                        this.update('none');
                    },
                    layout: {
                        padding: {
                            right: 100
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const datasetIndex = context.datasetIndex;
                                    const dataIndex = context.dataIndex;
                                    const originalValue = context.dataset.originalData[dataIndex];
                                    let label = context.dataset.label || '';

                                    if (label.includes('CVR')) {
                                        return label + ': ' + formatDecimal(originalValue) + '%';
                                    } else if (label.includes('ìœ ì…')) {
                                        return 'ìœ ì…: ' + formatNumber(originalValue) + 'ëª…';
                                    } else if (label.includes('êµ¬ë§¤ì™„ë£Œ')) {
                                        return 'êµ¬ë§¤ì™„ë£Œ: ' + formatNumber(originalValue) + 'ëª…';
                                    } else if (label.includes('ë§¤ì¶œ')) {
                                        return 'ë§¤ì¶œ: ' + formatNumber(originalValue) + 'ì›';
                                    }
                                    return label;
                                }
                            }
                        },
                        datalabels: {
                            display: function(context) {
                                // í˜¸ë²„ëœ ì±„ë„(index)ì¸ ê²½ìš°ì—ë§Œ í‘œì‹œ
                                return context.dataIndex === hoveredIndex;
                            },
                            anchor: function(context) {
                                const dataIndex = context.dataIndex;
                                // í•´ë‹¹ ì±„ë„ì˜ ëª¨ë“  ë°ì´í„°ì…‹ ê°’ ê°€ì ¸ì˜¤ê¸°
                                const values = context.chart.data.datasets.map(ds => ds.data[dataIndex]);
                                const maxValue = Math.max(...values);
                                const currentValue = context.dataset.data[dataIndex];

                                // ìµœëŒ“ê°’ì¸ ê²½ìš°ì—ë§Œ 'end', ì•„ë‹ˆë©´ í‘œì‹œí•˜ì§€ ì•ŠìŒ
                                return currentValue === maxValue ? 'end' : 'center';
                            },
                            align: 'end',
                            offset: 4,
                            clamp: true,
                            formatter: function(value, context) {
                                const dataIndex = context.dataIndex;
                                const datasetIndex = context.datasetIndex;

                                // í•´ë‹¹ ì±„ë„ì˜ ëª¨ë“  ë°ì´í„°ì…‹ ê°’ ê°€ì ¸ì˜¤ê¸°
                                const values = context.chart.data.datasets.map(ds => ds.data[dataIndex]);
                                const maxValue = Math.max(...values);
                                const currentValue = context.dataset.data[dataIndex];

                                // ìµœëŒ“ê°’ì¸ ë°ì´í„°ì…‹ë§Œ ë ˆì´ë¸” í‘œì‹œ
                                if (currentValue !== maxValue) {
                                    return null;
                                }

                                const originalValue = context.dataset.originalData[dataIndex];
                                const label = context.dataset.label || '';

                                if (label.includes('CVR')) {
                                    return formatDecimal(originalValue) + '%';
                                } else if (label.includes('ìœ ì…')) {
                                    return formatNumber(originalValue) + 'ëª…';
                                } else if (label.includes('êµ¬ë§¤ì™„ë£Œ')) {
                                    return formatNumber(originalValue) + 'ëª…';
                                } else if (label.includes('ë§¤ì¶œ')) {
                                    return formatNumber(originalValue) + 'ì›';
                                }
                                return '';
                            },
                            font: {
                                size: 11,
                                weight: 'bold'
                            },
                            color: function(context) {
                                return context.dataset.borderColor;
                            },
                            backgroundColor: function(context) {
                                return 'rgba(255, 255, 255, 0.9)';
                            },
                            borderColor: function(context) {
                                return context.dataset.borderColor;
                            },
                            borderWidth: 1,
                            borderRadius: 4,
                            padding: 4
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'ì •ê·œí™”ëœ ê°’ (0-100)'
                            }
                        }
                    }
                }
            });
        }

        // ìº í˜ì¸ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateCampaignChart(funnelType = 'purchase') {
            if (channelData.length === 0) return;

            const ctx = document.getElementById('campaignChart');
            if (!ctx) return;

            // í˜„ì¬ í¼ë„ íƒ€ì… ì €ì¥
            currentChannelFunnel = funnelType;

            // í¼ë„ë³„ í‚¤ ë§¤í•‘
            const funnelKeyMap = {
                'activation': 'í™œë™',
                'consideration': 'ê´€ì‹¬',
                'conversion': 'ê²°ì œì§„í–‰',
                'purchase': 'êµ¬ë§¤ì™„ë£Œ'
            };

            const funnelKey = funnelKeyMap[funnelType];

            // ê° ì±„ë„ì˜ ì „í™˜ìœ¨ ê³„ì‚° (ìœ ì… ëŒ€ë¹„ í•´ë‹¹ ë‹¨ê³„)
            const channelConversionData = channelData.map(row => {
                const acquisition = parseFloat(row['ìœ ì…']) || 0;
                const funnelValue = parseFloat(row[funnelKey]) || 0;
                const conversionRate = acquisition > 0 ? (funnelValue / acquisition * 100) : 0;

                return {
                    channel: row['channel'],
                    conversionRate: conversionRate
                };
            });

            // ì „í™˜ìœ¨ ê¸°ì¤€ ìƒìœ„ 10ê°œ ì •ë ¬
            const sortedData = channelConversionData
                .sort((a, b) => b.conversionRate - a.conversionRate)
                .slice(0, 10);

            const labels = sortedData.map(row => {
                const name = row.channel;
                return name.length > 20 ? name.substring(0, 20) + '...' : name;
            });
            const conversionData = sortedData.map(row => row.conversionRate);

            if (campaignChart) {
                campaignChart.destroy();
            }

            // í¼ë„ë³„ ìƒ‰ìƒ ì„¤ì •
            const colorMap = {
                'activation': { bg: 'rgba(33, 150, 243, 0.8)', border: '#2196f3' },
                'consideration': { bg: 'rgba(255, 152, 0, 0.8)', border: '#ff9800' },
                'conversion': { bg: 'rgba(76, 175, 80, 0.8)', border: '#4caf50' },
                'purchase': { bg: 'rgba(0, 200, 83, 0.8)', border: '#00c853' }
            };

            const colors = colorMap[funnelType];

            // í¼ë„ë³„ ë ˆì´ë¸”
            const labelMap = {
                'activation': 'í™œë™ ì „í™˜ìœ¨ (%)',
                'consideration': 'ê´€ì‹¬ ì „í™˜ìœ¨ (%)',
                'conversion': 'ê²°ì œì§„í–‰ ì „í™˜ìœ¨ (%)',
                'purchase': 'êµ¬ë§¤ì™„ë£Œ ì „í™˜ìœ¨ (%)'
            };

            campaignChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels,
                    datasets: [{
                        label: labelMap[funnelType],
                        data: conversionData,
                        backgroundColor: colors.bg,
                        borderColor: colors.border,
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return labelMap[funnelType] + ': ' + formatDecimal(context.parsed.x) + '%';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'ì „í™˜ìœ¨ (%)'
                            }
                        }
                    }
                }
            });
        }

        // ì±„ë„ í…Œì´ë¸” ì—…ë°ì´íŠ¸
        // ì±„ë„ í…Œì´ë¸” ë°ì´í„° ìë™ ë¶„ì„ í•¨ìˆ˜
        function analyzeChannelTableData(data) {
            if (data.length === 0) return;

            // ë°ì´í„° íŒŒì‹± ë° ê³„ì‚°
            const channelStats = data.map(row => {
                const acquisition = parseFloat(row['ìœ ì…']) || 0;
                const activation = parseFloat(row['í™œë™']) || 0;
                const consideration = parseFloat(row['ê´€ì‹¬']) || 0;
                const conversion = parseFloat(row['ê²°ì œì§„í–‰']) || 0;
                const purchase = parseFloat(row['êµ¬ë§¤ì™„ë£Œ']) || 0;
                const revenue = parseFloat(row['Revenue']) || 0;
                const cvr = parseFloat(row['CVR']) || 0;

                // ë‹¨ê³„ë³„ ì´íƒˆë¥  ê³„ì‚°
                const activationChurn = acquisition > 0 ? ((acquisition - activation) / acquisition * 100) : 0;
                const considerationChurn = activation > 0 ? ((activation - consideration) / activation * 100) : 0;
                const conversionChurn = consideration > 0 ? ((consideration - conversion) / consideration * 100) : 0;
                const purchaseChurn = conversion > 0 ? ((conversion - purchase) / conversion * 100) : 0;

                return {
                    channel: row['channel'],
                    acquisition,
                    activation,
                    consideration,
                    conversion,
                    purchase,
                    revenue,
                    cvr,
                    activationChurn,
                    considerationChurn,
                    conversionChurn,
                    purchaseChurn
                };
            });

            // CVR ìƒìœ„ 3ê°œ ì±„ë„
            const topCVRChannels = [...channelStats]
                .sort((a, b) => b.cvr - a.cvr)
                .slice(0, 3);

            // ë§¤ì¶œ ìƒìœ„ ì±„ë„
            const topRevenueChannels = [...channelStats]
                .sort((a, b) => b.revenue - a.revenue)
                .slice(0, 3);

            // CVR í‰ê· 
            const avgCVR = channelStats.reduce((sum, ch) => sum + ch.cvr, 0) / channelStats.length;

            // ë§¤ì¶œ ë†’ì§€ë§Œ CVR ë‚®ì€ ì±„ë„ ì°¾ê¸° (ë§¤ì¶œ ìƒìœ„ 50%, CVR í‰ê·  ì´í•˜)
            const revenueMedian = channelStats.sort((a, b) => b.revenue - a.revenue)[Math.floor(channelStats.length / 2)].revenue;
            const highRevenueLowCVR = channelStats.filter(ch => ch.revenue >= revenueMedian && ch.cvr < avgCVR);

            // ìœ ì…â†’í™œë™ ì´íƒˆë¥ ì´ ë†’ì€ ì±„ë„ (50% ì´ìƒ)
            const highEarlyChurn = channelStats.filter(ch => ch.activationChurn >= 50);

            // ì „ì²´ í‰ê·  ì´íƒˆë¥ 
            const avgActivationChurn = channelStats.reduce((sum, ch) => sum + ch.activationChurn, 0) / channelStats.length;
            const avgConsiderationChurn = channelStats.reduce((sum, ch) => sum + ch.considerationChurn, 0) / channelStats.length;
            const avgConversionChurn = channelStats.reduce((sum, ch) => sum + ch.conversionChurn, 0) / channelStats.length;
            const avgPurchaseChurn = channelStats.reduce((sum, ch) => sum + ch.purchaseChurn, 0) / channelStats.length;

            // ê°€ì¥ ì´íƒˆë¥ ì´ ë†’ì€ ë‹¨ê³„ ì°¾ê¸°
            const churnStages = [
                { stage: 'ìœ ì…â†’í™œë™', avg: avgActivationChurn },
                { stage: 'í™œë™â†’ê´€ì‹¬', avg: avgConsiderationChurn },
                { stage: 'ê´€ì‹¬â†’ê²°ì œì§„í–‰', avg: avgConversionChurn },
                { stage: 'ê²°ì œì§„í–‰â†’êµ¬ë§¤ì™„ë£Œ', avg: avgPurchaseChurn }
            ];
            const highestChurnStage = churnStages.reduce((max, item) => item.avg > max.avg ? item : max, churnStages[0]);

            // ì¸ì‚¬ì´íŠ¸ HTML ìƒì„±
            let insightHTML = '';

            // 1. ìµœê³  ì„±ê³¼ ì±„ë„
            insightHTML += `<strong style="color: #4caf50;">ğŸ† ìµœê³  ì„±ê³¼ ì±„ë„:</strong> `;
            insightHTML += `<strong>${topCVRChannels[0].channel}</strong> (CVR ${topCVRChannels[0].cvr.toFixed(2)}%)ì´ ê°€ì¥ íš¨ìœ¨ì ì…ë‹ˆë‹¤. `;
            if (topCVRChannels[0].cvr > 3) {
                insightHTML += `ë§¤ìš° ìš°ìˆ˜í•œ ì „í™˜ìœ¨ì…ë‹ˆë‹¤! ì´ ì±„ë„ì˜ ê´‘ê³  ì˜ˆì‚°ì„ ëŠ˜ë¦¬ì„¸ìš”. `;
            } else if (topCVRChannels[0].cvr > 1.5) {
                insightHTML += `ì–‘í˜¸í•œ ì „í™˜ìœ¨ì…ë‹ˆë‹¤. ì¶”ê°€ íˆ¬ìë¥¼ ê³ ë ¤í•˜ì„¸ìš”. `;
            }

            // 2. ë§¤ì¶œ vs CVR ë¶ˆê· í˜•
            if (highRevenueLowCVR.length > 0) {
                insightHTML += `<br><br><strong style="color: #ff9800;">âš ï¸ ê°œì„  ê¸°íšŒ:</strong> `;
                insightHTML += `<strong>${highRevenueLowCVR[0].channel}</strong>ì€ ë§¤ì¶œì€ ë†’ì§€ë§Œ (â‚©${formatNumber(highRevenueLowCVR[0].revenue)}) `;
                insightHTML += `CVRì´ ${highRevenueLowCVR[0].cvr.toFixed(2)}%ë¡œ í‰ê· (${avgCVR.toFixed(2)}%)ë³´ë‹¤ ë‚®ìŠµë‹ˆë‹¤. `;
                insightHTML += `<strong>ëœë”© í˜ì´ì§€ë¥¼ ê°œì„ í•˜ë©´ ë§¤ì¶œì„ í¬ê²Œ ëŠ˜ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤!</strong> `;
            }

            // 3. ì´ˆê¸° ì´íƒˆ ë¬¸ì œ
            if (highEarlyChurn.length > 0) {
                insightHTML += `<br><br><strong style="color: #f44336;">ğŸš¨ ê¸´ê¸‰ ì¡°ì¹˜ í•„ìš”:</strong> `;
                const worstChannel = highEarlyChurn.sort((a, b) => b.activationChurn - a.activationChurn)[0];
                insightHTML += `<strong>${worstChannel.channel}</strong>ì€ ì²« ë‹¨ê³„(ìœ ì…â†’í™œë™)ì—ì„œ ${worstChannel.activationChurn.toFixed(1)}%ê°€ ì´íƒˆí•©ë‹ˆë‹¤. `;
                insightHTML += `ê´‘ê³  ë©”ì‹œì§€ì™€ ëœë”© í˜ì´ì§€ì˜ ì¼ì¹˜ ì—¬ë¶€, ë¡œë”© ì†ë„ë¥¼ ì¦‰ì‹œ ì ê²€í•˜ì„¸ìš”. `;
            } else {
                // ê°€ì¥ ì´íƒˆë¥  ë†’ì€ ë‹¨ê³„ ì•ˆë‚´
                insightHTML += `<br><br><strong style="color: #2196f3;">ğŸ“Š ì „ì²´ ë¶„ì„:</strong> `;
                insightHTML += `ì „ì²´ ì±„ë„ì—ì„œ <strong>${highestChurnStage.stage}</strong> ë‹¨ê³„ì˜ í‰ê·  ì´íƒˆë¥ ì´ ${highestChurnStage.avg.toFixed(1)}%ë¡œ ê°€ì¥ ë†’ìŠµë‹ˆë‹¤. `;
                insightHTML += `ì´ êµ¬ê°„ì— ì§‘ì¤‘ì ìœ¼ë¡œ ê°œì„  ë…¸ë ¥ì„ ê¸°ìš¸ì´ì„¸ìš”. `;
            }

            // 4. ì‹¤í–‰ ê°€ëŠ¥í•œ ì¶”ì²œ
            insightHTML += `<br><br><strong style="color: var(--primary-main);">ğŸ’¡ ì˜¤ëŠ˜ ë°”ë¡œ ì‹¤í–‰:</strong> `;
            if (topCVRChannels[0].cvr > avgCVR * 1.5) {
                insightHTML += `1) <strong>${topCVRChannels[0].channel}</strong> ê´‘ê³ ë¹„ë¥¼ 20-30% ì¦ì•¡í•˜ê³ , `;
            }
            if (highRevenueLowCVR.length > 0) {
                insightHTML += `2) <strong>${highRevenueLowCVR[0].channel}</strong>ì˜ ëœë”© í˜ì´ì§€ A/B í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•˜ê³ , `;
            }
            insightHTML += `3) CVR ${(avgCVR * 0.5).toFixed(2)}% ì´í•˜ ì±„ë„ì€ ì¼ì‹œ ì¤‘ë‹¨ì„ ê²€í† í•˜ì„¸ìš”.`;

            // ì¸ì‚¬ì´íŠ¸ í‘œì‹œ
            const insightElement = document.getElementById('channelTableInsightText');
            if (insightElement) {
                insightElement.innerHTML = insightHTML;
            }
        }

        function updateChannelTable() {
            if (channelData.length === 0) return;

            const tbody = document.getElementById('channelTableBody');
            if (!tbody) return;

            // í˜„ì¬ ì •ë ¬ ê¸°ì¤€ìœ¼ë¡œ ë°ì´í„° ì •ë ¬
            const sortedData = [...channelData].sort((a, b) => {
                const aVal = parseFloat(a[channelTableSort.column]) || 0;
                const bVal = parseFloat(b[channelTableSort.column]) || 0;

                if (channelTableSort.direction === 'desc') {
                    return bVal - aVal;
                } else {
                    return aVal - bVal;
                }
            });

            // ê° ì—´ì˜ ìµœëŒ€ê°’ ê³„ì‚° (ìƒ‰ìƒ ìŠ¤ì¼€ì¼ìš©)
            const maxValues = {
                'ìœ ì…': Math.max(...channelData.map(r => parseFloat(r['ìœ ì…']) || 0)),
                'í™œë™': Math.max(...channelData.map(r => parseFloat(r['í™œë™']) || 0)),
                'ê´€ì‹¬': Math.max(...channelData.map(r => parseFloat(r['ê´€ì‹¬']) || 0)),
                'ê²°ì œì§„í–‰': Math.max(...channelData.map(r => parseFloat(r['ê²°ì œì§„í–‰']) || 0)),
                'êµ¬ë§¤ì™„ë£Œ': Math.max(...channelData.map(r => parseFloat(r['êµ¬ë§¤ì™„ë£Œ']) || 0)),
                'Revenue': Math.max(...channelData.map(r => parseFloat(r['Revenue']) || 0)),
                'CVR': Math.max(...channelData.map(r => parseFloat(r['CVR']) || 0))
            };

            // ìƒ‰ìƒ ìŠ¤ì¼€ì¼ ê³„ì‚° í•¨ìˆ˜
            function getScaleWidth(value, maxValue) {
                if (maxValue === 0) return 0;
                return (value / maxValue) * 100;
            }

            tbody.innerHTML = sortedData.map(row => {
                const acqVal = parseFloat(row['ìœ ì…']) || 0;
                const actVal = parseFloat(row['í™œë™']) || 0;
                const conVal = parseFloat(row['ê´€ì‹¬']) || 0;
                const convVal = parseFloat(row['ê²°ì œì§„í–‰']) || 0;
                const purVal = parseFloat(row['êµ¬ë§¤ì™„ë£Œ']) || 0;
                const revVal = parseFloat(row['Revenue']) || 0;
                const cvrVal = parseFloat(row['CVR']) || 0;

                return `
                <tr>
                    <td>${row['channel']}</td>
                    <td class="has-bg">
                        <div class="cell-bg scale-acquisition" style="width: ${getScaleWidth(acqVal, maxValues['ìœ ì…'])}%"></div>
                        <span>${formatNumber(acqVal)}</span>
                    </td>
                    <td class="has-bg">
                        <div class="cell-bg scale-activation" style="width: ${getScaleWidth(actVal, maxValues['í™œë™'])}%"></div>
                        <span>${formatNumber(actVal)}</span>
                    </td>
                    <td class="has-bg">
                        <div class="cell-bg scale-consideration" style="width: ${getScaleWidth(conVal, maxValues['ê´€ì‹¬'])}%"></div>
                        <span>${formatNumber(conVal)}</span>
                    </td>
                    <td class="has-bg">
                        <div class="cell-bg scale-conversion" style="width: ${getScaleWidth(convVal, maxValues['ê²°ì œì§„í–‰'])}%"></div>
                        <span>${formatNumber(convVal)}</span>
                    </td>
                    <td class="has-bg">
                        <div class="cell-bg scale-purchase" style="width: ${getScaleWidth(purVal, maxValues['êµ¬ë§¤ì™„ë£Œ'])}%"></div>
                        <span>${formatNumber(purVal)}</span>
                    </td>
                    <td class="has-bg">
                        <div class="cell-bg scale-revenue" style="width: ${getScaleWidth(revVal, maxValues['Revenue'])}%"></div>
                        <span>${formatNumber(revVal)}</span>
                    </td>
                    <td class="has-bg">
                        <div class="cell-bg scale-cvr" style="width: ${getScaleWidth(cvrVal, maxValues['CVR'])}%"></div>
                        <span>${formatDecimal(cvrVal)}%</span>
                    </td>
                </tr>
                `;
            }).join('');

            // ë°ì´í„° ë¶„ì„ ë° ì¸ì‚¬ì´íŠ¸ ìƒì„±
            analyzeChannelTableData(channelData);

            // ì •ë ¬ ì•„ì´ì½˜ ì—…ë°ì´íŠ¸
            updateSortIcons();
        }

        // ì •ë ¬ ì•„ì´ì½˜ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateSortIcons() {
            const headers = document.querySelectorAll('#channelTable .sortable-header');
            headers.forEach(th => {
                const column = th.getAttribute('data-column');
                const sortIcon = th.querySelector('.sort-icon');
                const upArrow = th.querySelector('.sort-arrow.up');
                const downArrow = th.querySelector('.sort-arrow.down');

                if (!sortIcon || !upArrow || !downArrow) return;

                if (column === channelTableSort.column) {
                    sortIcon.classList.add('active');
                    if (channelTableSort.direction === 'asc') {
                        upArrow.classList.add('active');
                        downArrow.classList.remove('active');
                    } else {
                        upArrow.classList.remove('active');
                        downArrow.classList.add('active');
                    }
                } else {
                    sortIcon.classList.remove('active');
                    upArrow.classList.remove('active');
                    downArrow.classList.remove('active');
                }
            });
        }

        // í…Œì´ë¸” ì •ë ¬ ì´ë²¤íŠ¸ ì´ˆê¸°í™”
        function setupTableSorting() {
            const headers = document.querySelectorAll('#channelTable .sortable-header');

            headers.forEach(th => {
                // ê¸°ì¡´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±° (ì¤‘ë³µ ë°©ì§€)
                const newTh = th.cloneNode(true);
                th.parentNode.replaceChild(newTh, th);
            });

            // ìƒˆë¡œìš´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            document.querySelectorAll('#channelTable .sortable-header').forEach(th => {
                // í´ë¦­ ì´ë²¤íŠ¸ (ì •ë ¬)
                th.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();

                    const column = this.getAttribute('data-column');

                    // ê°™ì€ ì—´ì„ í´ë¦­í•˜ë©´ ë°©í–¥ í† ê¸€, ë‹¤ë¥¸ ì—´ì´ë©´ descë¡œ ì‹œì‘
                    if (channelTableSort.column === column) {
                        channelTableSort.direction = channelTableSort.direction === 'desc' ? 'asc' : 'desc';
                    } else {
                        channelTableSort.column = column;
                        channelTableSort.direction = 'desc';
                    }

                    updateChannelTable();
                });

                // ë§ˆìš°ìŠ¤ í˜¸ë²„ ì´ë²¤íŠ¸ (íˆ´íŒ ìœ„ì¹˜ ê³„ì‚°)
                const tooltip = th.querySelector('.sort-tooltip');
                if (tooltip) {
                    th.addEventListener('mouseenter', function() {
                        const rect = this.getBoundingClientRect();
                        tooltip.style.left = rect.left + (rect.width / 2) + 'px';
                        tooltip.style.top = (rect.top - 8) + 'px';
                    });
                }
            });
        }

        // ì°¨íŠ¸ ì¸ì‚¬ì´íŠ¸ íˆ´íŒ í‘œì‹œ í•¨ìˆ˜
        function showChartInsightTooltip(tooltipId, insight, recommendation, event) {
            const tooltip = document.getElementById(tooltipId);
            if (!tooltip) return;

            tooltip.innerHTML = `
                <div class="tooltip-insight-section">
                    <div class="tooltip-insight-header">
                        ğŸ’¡ ì¸ì‚¬ì´íŠ¸
                    </div>
                    <p class="tooltip-insight-text">${insight}</p>
                </div>
                <div class="tooltip-recommendation-section">
                    <div class="tooltip-recommendation-header">
                        ğŸ¯ ì¶”ì²œ ì‚¬í•­
                    </div>
                    <p class="tooltip-recommendation-text">${recommendation}</p>
                </div>
            `;

            // position: fixed ì‚¬ìš© - í™”ë©´ ê¸°ì¤€ ì ˆëŒ€ ì¢Œí‘œ
            tooltip.style.left = (event.clientX + 15) + 'px';
            tooltip.style.top = (event.clientY + 15) + 'px';
            tooltip.classList.add('show');
        }

        function hideChartInsightTooltip(tooltipId) {
            const tooltip = document.getElementById(tooltipId);
            if (!tooltip) return;
            tooltip.classList.remove('show');
        }

        // KPI ì°¨íŠ¸ ì¸ì‚¬ì´íŠ¸ ìƒì„±
        function generateKpiInsight(kpiType, data) {
            const insights = {
                cvr: {
                    insight: 'ì „í™˜ìœ¨(CVR)ì´ ë†’ì€ ì±„ë„ì€ ë°©ë¬¸ìë¥¼ ì‹¤ì œ ê³ ê°ìœ¼ë¡œ ë§Œë“œëŠ” ëŠ¥ë ¥ì´ ë›°ì–´ë‚œ ì±„ë„ì…ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ 100ëª…ì´ ë°©ë¬¸í•´ì„œ 5ëª…ì´ êµ¬ë§¤í•˜ë©´ 5%ì…ë‹ˆë‹¤.',
                    recommendation: 'ì „í™˜ìœ¨ì´ ë†’ì€ ì±„ë„ì— ê´‘ê³ ë¹„ë¥¼ ë” íˆ¬ìí•˜ì„¸ìš”. ë°˜ëŒ€ë¡œ ì „í™˜ìœ¨ì´ ë‚®ì€ ì±„ë„ì€ ì›¹ì‚¬ì´íŠ¸ ì²« í™”ë©´ì„ ê³ ê° ì…ì¥ì—ì„œ ê°œì„ í•´ë³´ì„¸ìš”. (ì˜ˆ: êµ¬ë§¤ ë²„íŠ¼ì„ ë” ëˆˆì— ë„ê²Œ ë§Œë“¤ê¸°)'
                },
                acquisition: {
                    insight: 'ë°©ë¬¸ìê°€ ë§ì€ ì±„ë„ì€ ë§ì€ ì‚¬ëŒë“¤ì´ ìš°ë¦¬ ì›¹ì‚¬ì´íŠ¸ë¥¼ ì°¾ì•„ì˜¤ëŠ” ê²½ë¡œì…ë‹ˆë‹¤. í•˜ì§€ë§Œ ë§ë‹¤ê³  ë¬´ì¡°ê±´ ì¢‹ì€ ê²ƒì€ ì•„ë‹™ë‹ˆë‹¤.',
                    recommendation: 'ë°©ë¬¸ìê°€ ë§ì€ ì±„ë„ì˜ ì „í™˜ìœ¨ë„ í•¨ê»˜ í™•ì¸í•˜ì„¸ìš”. ë°©ë¬¸ìëŠ” ë§ì€ë° êµ¬ë§¤ëŠ” ì ë‹¤ë©´, ì—‰ëš±í•œ ì‚¬ëŒë“¤ì´ ë“¤ì–´ì˜¤ê³  ìˆë‹¤ëŠ” ëœ»ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ´ ë• ê´‘ê³  íƒ€ê²Ÿì„ ë” ì •í™•í•˜ê²Œ ì„¤ì •í•˜ì„¸ìš”.'
                },
                activation: {
                    insight: 'í™œì„± ì‚¬ìš©ìê°€ ë§ì€ ì±„ë„ì€ ë‹¨ìˆœ ë°©ë¬¸ì´ ì•„ë‹ˆë¼ ì‹¤ì œë¡œ ìš°ë¦¬ ì‚¬ì´íŠ¸ë¥¼ ì´ìš©í•˜ëŠ” ì‚¬ëŒë“¤ì„ ë§ì´ ë³´ë‚´ê³  ìˆìŠµë‹ˆë‹¤.',
                    recommendation: 'í™œì„± ì‚¬ìš©ìê°€ ë§ì€ ì±„ë„ì´ ì–´ë–¤ íŠ¹ì§•ì´ ìˆëŠ”ì§€ ì‚´í´ë³´ì„¸ìš”. ì˜ˆë¥¼ ë“¤ì–´ íŠ¹ì • ì—°ë ¹ëŒ€ë‚˜ ê´€ì‹¬ì‚¬ë¥¼ ê°€ì§„ ì‚¬ëŒë“¤ì´ë¼ë©´, ë‹¤ë¥¸ ì±„ë„ì—ì„œë„ ê·¸ëŸ° ì‚¬ëŒë“¤ì„ íƒ€ê²ŸíŒ…í•˜ì„¸ìš”.'
                },
                consideration: {
                    insight: 'ê´€ì‹¬ ê³ ê°ì´ ë§ì€ ì±„ë„ì€ êµ¬ë§¤ ì˜í–¥ì´ ë†’ì€ ì¢‹ì€ í’ˆì§ˆì˜ ë°©ë¬¸ìë¥¼ ë³´ë‚´ê³  ìˆìŠµë‹ˆë‹¤.',
                    recommendation: 'ê´€ì‹¬ì€ ë³´ì˜€ì§€ë§Œ êµ¬ë§¤í•˜ì§€ ì•Šì€ ì‚¬ëŒë“¤ì—ê²Œ ì¬ë°©ë¬¸ ê´‘ê³ ë¥¼ í•˜ë©´ íš¨ê³¼ì ì…ë‹ˆë‹¤. ë˜í•œ ì œí’ˆ ì‚¬ì§„ê³¼ ì„¤ëª…ì„ ë” ìì„¸í•˜ê²Œ ê°œì„ í•˜ì„¸ìš”.'
                },
                conversion: {
                    insight: 'ê²°ì œë¥¼ ì‹œë„í•œ ì‚¬ëŒì´ ë§ë‹¤ëŠ” ê²ƒì€ ê±°ì˜ êµ¬ë§¤ ì§ì „ê¹Œì§€ ê°”ë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤. ì´ë“¤ì„ ë†“ì¹˜ëŠ” ê²ƒì€ í° ì†ì‹¤ì…ë‹ˆë‹¤.',
                    recommendation: 'ê²°ì œ ê³¼ì •ì„ ìµœëŒ€í•œ ê°„ë‹¨í•˜ê²Œ ë§Œë“œì„¸ìš”. (ì˜ˆ: íšŒì›ê°€ì… ì—†ì´ êµ¬ë§¤ ê°€ëŠ¥, ë°°ì†¡ë¹„ ì¡°ê¸° ì•ˆë‚´) ì¥ë°”êµ¬ë‹ˆì— ë¬¼ê±´ì„ ë‹´ê³  ë– ë‚œ ì‚¬ëŒì—ê²Œ "ì•„ì§ ì¥ë°”êµ¬ë‹ˆì— ë¬¼ê±´ì´ ë‚¨ì•„ìˆì–´ìš”" ê°™ì€ ì•Œë¦¼ì„ ë³´ë‚´ì„¸ìš”.'
                },
                purchase: {
                    insight: 'ì‹¤ì œ êµ¬ë§¤ ê±´ìˆ˜ê°€ ë§ì€ ì±„ë„ì´ ì§„ì§œ ëˆì„ ë²Œì–´ë‹¤ ì£¼ëŠ” ì±„ë„ì…ë‹ˆë‹¤. ì´ ì±„ë„ë“¤ì´ ê°€ì¥ ì¤‘ìš”í•©ë‹ˆë‹¤.',
                    recommendation: 'êµ¬ë§¤ê°€ ë§ì€ ì±„ë„ì— ê´‘ê³ ë¹„ë¥¼ ìš°ì„ ì ìœ¼ë¡œ íˆ¬ìí•˜ì„¸ìš”. ë˜í•œ ì´ ì±„ë„ì„ í†µí•´ êµ¬ë§¤í•œ ê³ ê°ë“¤ì´ ì¬êµ¬ë§¤ë¥¼ ì–¼ë§ˆë‚˜ í•˜ëŠ”ì§€ë„ ì¶”ì í•˜ë©´ ë” ì¢‹ìŠµë‹ˆë‹¤.'
                },
                revenue: {
                    insight: 'ë§¤ì¶œì´ ë†’ì€ ì±„ë„ì€ íˆ¬ì ëŒ€ë¹„ ìˆ˜ìµì´ ê°€ì¥ ì¢‹ì€ ì±„ë„ì…ë‹ˆë‹¤. ì—¬ê¸°ì„œ ë²ˆ ëˆìœ¼ë¡œ ë‹¤ë¥¸ ì±„ë„ ì‹¤í—˜ë„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
                    recommendation: 'ì´ ì±„ë„ì´ ì™œ ì„±ê³µí–ˆëŠ”ì§€ ë¶„ì„í•˜ì„¸ìš”. (ì–´ë–¤ ìƒí’ˆ? ì–´ë–¤ ê´‘ê³  ë¬¸êµ¬? ì–´ë–¤ ê³ ê°ì¸µ?) ê·¸ë¦¬ê³  ë¹„ìŠ·í•œ ë°©ì‹ìœ¼ë¡œ ìƒˆë¡œìš´ ì±„ë„ì„ ì‹œë„í•´ë³´ì„¸ìš”.'
                }
            };

            return insights[kpiType] || { insight: 'ë°ì´í„° ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤.', recommendation: 'ì§€ì†ì ìœ¼ë¡œ ì„±ê³¼ë¥¼ ëª¨ë‹ˆí„°ë§í•˜ì„¸ìš”.' };
        }

        // ì´íƒˆë¥  ì°¨íŠ¸ ì¸ì‚¬ì´íŠ¸ ìƒì„±
        function generateChurnInsight() {
            return {
                insight: 'ì±„ë„ ì´íƒˆë¥ ì„ ê°œì„ í•˜ë©´ ì „í™˜ìœ¨ì´ ë†’ì•„ì§€ê³  ë§¤ì¶œì´ ì¦ê°€í•©ë‹ˆë‹¤.',
                recommendation: 'ì´íƒˆë¥ ì´ ë†’ì€ ì±„ë„ì¼ìˆ˜ë¡ ê°œì„  ì—¬ì§€ê°€ í¬ë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤. ê·¸ ë‹¨ê³„ë¥¼ ì§‘ì¤‘ì ìœ¼ë¡œ ê°œì„ í•˜ë©´ íš¨ê³¼ê°€ í½ë‹ˆë‹¤.'
            };
        }

        // ë¹„êµ ì°¨íŠ¸ ì¸ì‚¬ì´íŠ¸ ìƒì„±
        function generateCompareInsight() {
            return {
                insight: 'ê° ì±„ë„ì˜ ì „í™˜ìœ¨(CVR), ê³ ê° ìœ ì…, êµ¬ë§¤ ê±´ìˆ˜, ë§¤ì¶œì„ 100ì  ë§Œì ìœ¼ë¡œ í™˜ì‚°í•˜ì—¬ ë¹„êµí•©ë‹ˆë‹¤. ëª¨ë“  ì§€í‘œê°€ ê³¨ê³ ë£¨ ë†’ì€ ì±„ë„ì´ ê°€ì¥ ê· í˜•ìˆëŠ” ì„±ê³¼ë¥¼ ë‚´ê³  ìˆìŠµë‹ˆë‹¤.',
                recommendation: 'í•œ ê°€ì§€ ì§€í‘œë§Œ ì¢‹ì€ ì±„ë„ì€ ê°œì„  ì—¬ì§€ê°€ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ìœ ì…ì€ ë§ì€ë° ì „í™˜ìœ¨ì´ ë‚®ë‹¤ë©´ ê³ ê° íƒ€ê²ŒíŒ…ì„ ê°œì„ í•´ì•¼ í•©ë‹ˆë‹¤. ì „í™˜ìœ¨ì€ ë†’ì€ë° ë§¤ì¶œì´ ë‚®ë‹¤ë©´ ê³ ê°€ ìƒí’ˆ íŒë§¤ë¥¼ ëŠ˜ë ¤ì•¼ í•©ë‹ˆë‹¤.'
            };
        }

        // ì°¨íŠ¸ì— í˜¸ë²„ ì´ë²¤íŠ¸ ì¶”ê°€
        function addChartHoverTooltip(canvasId, tooltipId, insightGenerator) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;

            canvas.addEventListener('mousemove', function(event) {
                const insight = insightGenerator();
                showChartInsightTooltip(tooltipId, insight.insight, insight.recommendation, event);
            });

            canvas.addEventListener('mouseleave', function() {
                hideChartInsightTooltip(tooltipId);
            });
        }

        // í¼ë„ ë·° íƒ€ì… ì „í™˜ - ì œê±°ë¨ (í•­ìƒ daily ë°ì´í„° ì‚¬ìš©)

        // ì‹ ê·œ vs ì¬ë°©ë¬¸ ì°¨íŠ¸ ë·° íƒ€ì… ì „í™˜ (ë…ë¦½ì )
        document.querySelectorAll('.new-vs-returning-view-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const view = this.dataset.view;
                console.log(`[ì‹ ê·œ vs ì¬ë°©ë¬¸] ë·° ì „í™˜: ${newVsReturningView} â†’ ${view}`);

                // ê°™ì€ ê·¸ë£¹ ë‚´ ë²„íŠ¼ë§Œ active ì œê±°
                document.querySelectorAll('.new-vs-returning-view-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');

                newVsReturningView = view;

                // ì‹ ê·œ vs ì¬ë°©ë¬¸ ê´€ë ¨ ì°¨íŠ¸ë“¤ ì—…ë°ì´íŠ¸ (ë‹¤ë¥¸ ì„¹ì…˜ì— ì˜í–¥ ì—†ìŒ)
                updateCustomerTrendChart();
            });
        });

        // ì´íƒˆ ìœ„í—˜ ê¸°ê°„ ì „í™˜ (7ì¼/30ì¼) - ë…ë¦½ì 
        document.querySelectorAll('.churn-period-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const period = this.dataset.period;
                console.log(`[ì´íƒˆ ìœ„í—˜] ê¸°ê°„ ì „í™˜: ${period}`);

                document.querySelectorAll('.churn-period-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');

                updateChurnPredictions(period);
            });
        });

        // ì„±ê³¼ ê°œì„  ê¸°ê°„ ì „í™˜ (7ì¼/30ì¼) - ë…ë¦½ì 
        document.querySelectorAll('.improvement-period-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const period = this.dataset.period;
                console.log(`[ì„±ê³¼ ê°œì„ ] ê¸°ê°„ ì „í™˜: ${period}`);

                document.querySelectorAll('.improvement-period-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');

                updateImprovementPredictions(period);
            });
        });

        // KPI ì°¨íŠ¸ ë²„íŠ¼ ì „í™˜ - ë…ë¦½ì 
        document.querySelectorAll('.channel-kpi-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const kpiType = this.dataset.kpi;
                console.log(`[KPI ì°¨íŠ¸] íƒ€ì… ì „í™˜: ${kpiType}`);

                document.querySelectorAll('.channel-kpi-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');

                updateKpiChart(kpiType);
            });
        });

        // ì´íƒˆë¥  ì°¨íŠ¸ í¼ë„ ë‹¨ê³„ ë²„íŠ¼ ì „í™˜
        document.querySelectorAll('.channel-churn-stage-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const stage = this.dataset.stage;
                console.log(`[ì´íƒˆë¥  ì°¨íŠ¸] í¼ë„ ë‹¨ê³„ ì „í™˜: ${stage}`);

                document.querySelectorAll('.channel-churn-stage-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');

                updateChurnChart(stage, null);
            });
        });

        // ì´íƒˆë¥  ì°¨íŠ¸ ì •ë ¬ ìˆœì„œ ë²„íŠ¼ ì „í™˜
        document.querySelectorAll('.channel-churn-sort-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const sort = this.dataset.sort;
                console.log(`[ì´íƒˆë¥  ì°¨íŠ¸] ì •ë ¬ ìˆœì„œ ì „í™˜: ${sort}`);

                document.querySelectorAll('.channel-churn-sort-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');

                updateChurnChart(null, sort);
            });
        });

        // ì±„ë„ í¼ë„ ì°¨íŠ¸ ë²„íŠ¼ ì „í™˜ - ë…ë¦½ì 
        document.querySelectorAll('.channel-funnel-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const funnelType = this.dataset.funnel;
                console.log(`[ì±„ë„ í¼ë„] íƒ€ì… ì „í™˜: ${funnelType}`);

                document.querySelectorAll('.channel-funnel-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');

                updateCampaignChart(funnelType);
            });
        });

        // í¼ë„ ë¹„êµ ê¸°ëŠ¥
        let isCompareMode = false;
        let leftFunnelData = null;
        let rightFunnelData = null;

        // ë‚ ì§œ ë²”ìœ„ ê°€ì ¸ì˜¤ê¸°
        function getDateRange(data) {
            console.log('=== getDateRange ì‹œì‘ ===');

            if (data.length === 0) {
                console.warn('ë°ì´í„°ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.');
                return { start: '', end: '' };
            }

            console.log(`ì „ì²´ ë°ì´í„° í–‰ ìˆ˜: ${data.length}`);

            // ë‚ ì§œ í•„ë“œ ì¶”ì¶œ
            const dateStrings = data
                .map(row => row['Day'] || row['week'] || row['date'] || row['Date'] || row['ì¼ì'])
                .filter(d => d);

            console.log(`ì¶”ì¶œëœ ë‚ ì§œ ë¬¸ìì—´: ${dateStrings.length}ê°œ`);

            if (dateStrings.length === 0) {
                console.warn('ë‚ ì§œ í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return { start: '', end: '' };
            }

            // Date ê°ì²´ë¡œ ë³€í™˜ í›„ ì •ë ¬
            const sortedDates = dateStrings
                .map(dateStr => new Date(dateStr))
                .filter(date => !isNaN(date.getTime()))
                .sort((a, b) => a - b)
                .map(date => {
                    const year = date.getFullYear();
                    const month = String(date.getMonth() + 1).padStart(2, '0');
                    const day = String(date.getDate()).padStart(2, '0');
                    return `${year}-${month}-${day}`;
                });

            console.log(`ì •ë ¬ëœ ë‚ ì§œ: ${sortedDates.length}ê°œ`);
            console.log(`ì‹œì‘ ë‚ ì§œ: ${sortedDates[0]}`);
            console.log(`ì¢…ë£Œ ë‚ ì§œ: ${sortedDates[sortedDates.length - 1]}`);
            console.log('=== getDateRange ì™„ë£Œ ===\n');

            return {
                start: sortedDates[0],
                end: sortedDates[sortedDates.length - 1]
            };
        }

        // ë‚ ì§œ ë²”ìœ„ë¡œ ë°ì´í„° í•„í„°ë§ (Date ê°ì²´ ê¸°ë°˜ ë¹„êµ)
        function filterDataByDateRange(data, startDate, endDate) {
            if (!startDate || !endDate) {
                console.warn('filterDataByDateRange: ì‹œì‘ì¼ ë˜ëŠ” ì¢…ë£Œì¼ì´ ì—†ìŠµë‹ˆë‹¤', { startDate, endDate });
                return [];
            }

            // ë‚ ì§œ ë¬¸ìì—´ì„ Date ê°ì²´ë¡œ ë³€í™˜
            const start = new Date(startDate);
            const end = new Date(endDate);

            if (isNaN(start.getTime()) || isNaN(end.getTime())) {
                console.error('filterDataByDateRange: ìœ íš¨í•˜ì§€ ì•Šì€ ë‚ ì§œ í˜•ì‹', { startDate, endDate });
                return [];
            }

            const filtered = data.filter(row => {
                const dateStr = row['Day'] || row['week'] || row['date'] || row['Date'] || row['ì¼ì'];
                if (!dateStr) return false;

                // ë‚ ì§œ ë¬¸ìì—´ì„ Date ê°ì²´ë¡œ ë³€í™˜
                const rowDate = new Date(dateStr);

                if (isNaN(rowDate.getTime())) {
                    console.warn('filterDataByDateRange: ìœ íš¨í•˜ì§€ ì•Šì€ í–‰ ë‚ ì§œ', dateStr);
                    return false;
                }

                // Date ê°ì²´ ê¸°ë°˜ ë¹„êµ
                return rowDate >= start && rowDate <= end;
            });

            console.log(`filterDataByDateRange: ${startDate} ~ ${endDate} í•„í„°ë§ ê²°ê³¼: ${filtered.length}ê°œ (ì „ì²´: ${data.length}ê°œ)`);

            return filtered;
        }

        // í¼ë„ ë°ì´í„° ê³„ì‚°
        function calculateFunnelData(data) {
            if (data.length === 0) return [];

            const baseColor = '#535A8C';
            const funnelStages = [
                { name: 'ìœ ì…', key: 'ìœ ì…', color: baseColor },
                { name: 'í™œë™', key: 'í™œë™', color: baseColor },
                { name: 'ê´€ì‹¬', key: 'ê´€ì‹¬', color: baseColor },
                { name: 'ê²°ì œì§„í–‰', key: 'ê²°ì œì§„í–‰', color: baseColor },
                { name: 'êµ¬ë§¤ì™„ë£Œ', key: 'êµ¬ë§¤ì™„ë£Œ', color: baseColor }
            ];

            return funnelStages.map((stage, index) => {
                const total = data.reduce((sum, row) => sum + (parseFloat(row[stage.key]) || 0), 0);
                const prevTotal = index > 0 ? data.reduce((sum, row) => sum + (parseFloat(row[funnelStages[index - 1].key]) || 0), 0) : total;
                const conversionRate = prevTotal > 0 ? (total / prevTotal * 100) : 100;
                const dropOffRate = prevTotal > 0 ? ((prevTotal - total) / prevTotal * 100) : 0;

                return {
                    ...stage,
                    total: Math.round(total),
                    conversionRate: conversionRate.toFixed(1),
                    dropOffRate: dropOffRate.toFixed(1),
                    index: index
                };
            });
        }

        // ì‘ì€ í¼ë„ ë Œë”ë§ (ë¹„êµìš©)
        function renderSmallFunnel(containerId, funnelData) {
            const container = document.getElementById(containerId);
            if (!container) return;

            // ê¸°ì¡´ SVG ì™„ì „ ì œê±° (ì”ìƒ ë°©ì§€)
            container.innerHTML = '';

            // ë°ì´í„° ìœ íš¨ì„± ê²€ì¦
            if (!funnelData || funnelData.length === 0) {
                container.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 450px; color: var(--grey-500); font-size: 13px;">ì„ íƒí•œ ê¸°ê°„ì˜ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }

            // ë°ì´í„°ê°€ ë„ˆë¬´ ì ì€ì§€ í™•ì¸
            const totalUsers = funnelData[0]?.total || 0;
            if (totalUsers === 0) {
                container.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 450px; color: var(--grey-500); font-size: 13px;">ì„ íƒí•œ ê¸°ê°„ì— ìœ ì… ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }

            const margin = { top: 10, right: 20, bottom: 10, left: 20 };
            const width = 400;
            const height = 450 - margin.top - margin.bottom;

            const svg = d3.select(`#${containerId}`)
                .append('svg')
                .attr('width', width + margin.left + margin.right)
                .attr('height', height + margin.top + margin.bottom)
                .append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);

            const maxValue = d3.max(funnelData, d => d.total);
            if (!maxValue || maxValue === 0) {
                container.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 450px; color: var(--grey-500); font-size: 13px;">ë°ì´í„° ê°’ì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤</div>';
                return;
            }

            const stageHeight = height / funnelData.length;
            const spacing = 8;

            funnelData.forEach((stage, i) => {
                const stageColor = d3.color(stage.color).darker(i * 0.25);
                const yPos = i * stageHeight;
                const topWidth = (stage.total / maxValue) * width;
                const bottomWidth = i < funnelData.length - 1
                    ? (funnelData[i + 1].total / maxValue) * width
                    : topWidth * 0.8;

                const xOffset = (width - topWidth) / 2;
                const xOffsetBottom = (width - bottomWidth) / 2;

                const group = svg.append('g')
                    .attr('class', 'funnel-stage-small');

                // ê·¸ë¼ë°ì´ì…˜
                const gradientId = `gradient-small-${containerId}-${i}`;
                const gradient = svg.append('defs')
                    .append('linearGradient')
                    .attr('id', gradientId)
                    .attr('x1', '0%')
                    .attr('y1', '0%')
                    .attr('x2', '0%')
                    .attr('y2', '100%');

                gradient.append('stop')
                    .attr('offset', '0%')
                    .attr('stop-color', stageColor)
                    .attr('stop-opacity', 1);

                gradient.append('stop')
                    .attr('offset', '100%')
                    .attr('stop-color', stageColor)
                    .attr('stop-opacity', 0.75);

                // íŠ¸ë¼í˜ì¦ˆì´ë“œ
                const path = `
                    M ${xOffset} ${yPos}
                    L ${xOffset + topWidth} ${yPos}
                    L ${xOffsetBottom + bottomWidth} ${yPos + stageHeight - spacing}
                    L ${xOffsetBottom} ${yPos + stageHeight - spacing}
                    Z
                `;

                group.append('path')
                    .attr('d', path)
                    .attr('fill', `url(#${gradientId})`)
                    .attr('stroke', stageColor)
                    .attr('stroke-width', 1.5)
                    .attr('opacity', 0.85);

                // í…ìŠ¤íŠ¸
                group.append('text')
                    .attr('x', width / 2)
                    .attr('y', yPos + stageHeight / 2 - 5)
                    .attr('text-anchor', 'middle')
                    .style('fill', 'white')
                    .style('font-size', '11px')
                    .style('font-weight', '600')
                    .text(stage.name);

                group.append('text')
                    .attr('x', width / 2)
                    .attr('y', yPos + stageHeight / 2 + 10)
                    .attr('text-anchor', 'middle')
                    .style('fill', 'white')
                    .style('font-size', '10px')
                    .style('font-weight', '600')
                    .text(stage.total.toLocaleString() + ' users');

                // ì „í™˜ìœ¨/ì´íƒˆë¥ 
                if (i > 0) {
                    const metricsGroup = group.append('text')
                        .attr('x', width / 2)
                        .attr('y', yPos + stageHeight / 2 + 24)
                        .attr('text-anchor', 'middle')
                        .style('font-size', '9px');

                    metricsGroup.append('tspan')
                        .style('fill', '#4ade80')
                        .style('font-weight', '600')
                        .text(`ì „í™˜ ${stage.conversionRate}%`);

                    metricsGroup.append('tspan')
                        .style('fill', 'white')
                        .text(' | ');

                    metricsGroup.append('tspan')
                        .style('fill', '#f87171')
                        .style('font-weight', '600')
                        .text(`ì´íƒˆ ${stage.dropOffRate}%`);
                }
            });
        }

        // ë¹„êµ ì¸ì‚¬ì´íŠ¸ ê³„ì‚° ë° í‘œì‹œ (5ë‹¨ê³„ ëª¨ë‘ ë¹„êµ)
        function updateComparisonInsights() {
            console.log('=== updateComparisonInsights ì‹œì‘ ===');

            if (!leftFunnelData || !rightFunnelData) {
                console.warn('í¼ë„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            if (leftFunnelData.length === 0 || rightFunnelData.length === 0) {
                console.warn('í¼ë„ ë°ì´í„°ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.');
                return;
            }

            // ë‹¨ê³„ë³„ ì•„ì´ì½˜ ë§¤í•‘
            const stageIcons = {
                'ìœ ì…': 'ğŸ‘¥',
                'í™œë™': 'ğŸ”¥',
                'ê´€ì‹¬': 'â¤ï¸',
                'ê²°ì œì§„í–‰': 'ğŸ›’',
                'êµ¬ë§¤ì™„ë£Œ': 'âœ…'
            };

            const insights = [];

            // 5ë‹¨ê³„ ëª¨ë‘ ë¹„êµ
            console.log('5ë‹¨ê³„ ë¹„êµ ì‹œì‘...');
            for (let i = 0; i < leftFunnelData.length; i++) {
                const leftValue = leftFunnelData[i].total;
                const rightValue = rightFunnelData[i].total;
                const changePercent = ((rightValue - leftValue) / leftValue * 100).toFixed(1);
                const changeNum = parseFloat(changePercent);
                const changeColor = changeNum > 0 ? '#10b981' : (changeNum < 0 ? '#ef4444' : '#6b7280');
                const changeIcon = changeNum > 0 ? 'â–²' : (changeNum < 0 ? 'â–¼' : 'â”');

                // ë‹¨ê³„ëª…ì—ì„œ ì˜ë¬¸ ì œê±° (ì˜ˆ: 'ìœ ì… (Acquisition)' -> 'ìœ ì…')
                const stageName = leftFunnelData[i].name.split(' (')[0];
                const stageIcon = stageIcons[stageName] || 'ğŸ“Š';

                console.log(`  [${i}] ${stageName}: ${leftValue} â†’ ${rightValue} (${changePercent}%)`);

                insights.push(`
                    <div style="padding: 10px; background: white; border-radius: 6px; border-left: 3px solid ${changeColor};">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 6px;">
                            <div style="font-size: 13px; font-weight: 600; color: var(--grey-800);">
                                ${stageIcon} ${stageName}
                            </div>
                            <div style="font-size: 12px; font-weight: 700; color: ${changeColor};">
                                ${changeIcon} ${changeNum > 0 ? '+' : ''}${changePercent}%
                            </div>
                        </div>
                        <div style="font-size: 11px; color: var(--grey-500); line-height: 1.4;">
                            ${leftValue.toLocaleString()} â†’ ${rightValue.toLocaleString()}
                        </div>
                    </div>
                `);
            }

            console.log(`ì¸ì‚¬ì´íŠ¸ ${insights.length}ê°œ ìƒì„± ì™„ë£Œ`);

            // ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒìœ¼ë¡œ í‘œì‹œ (2ì—´, ëª¨ë°”ì¼ì—ì„  1ì—´)
            document.getElementById('comparisonContent').innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 8px;">
                    ${insights.join('')}
                </div>
            `;

            console.log('=== updateComparisonInsights ì™„ë£Œ ===\n');
        }

        // ========================================
        // í¼ë„ ì±„ë„ í•„í„° ê¸°ëŠ¥ (channel_daily_funnel.csv ê¸°ë°˜)
        // ========================================
        let funnelFilterActive = false;
        let selectedFunnelChannel = '';

        // ì±„ë„ ëª©ë¡ ë™ì  ìƒì„± (dailyData = channel_daily_funnel.csv)
        function populateFunnelChannelFilter() {
            const select = document.getElementById('funnelChannelFilter');
            if (!select) return;

            // channel_daily_funnel.csv (dailyData)ì—ì„œ ì±„ë„ ëª©ë¡ ì¶”ì¶œ
            const channels = new Set();
            if (dailyData && dailyData.length > 0) {
                dailyData.forEach(row => {
                    const channel = row['channel'] || row['Channel'];
                    if (channel) channels.add(channel);
                });
            }

            // ë“œë¡­ë‹¤ìš´ ì˜µì…˜ ìƒì„±
            select.innerHTML = '<option value="">ì „ì²´ ì±„ë„</option>';
            Array.from(channels).sort().forEach(channel => {
                const option = document.createElement('option');
                option.value = channel;
                option.textContent = channel;
                select.appendChild(option);
            });
        }

        // í•„í„°ë§ëœ ì¼ë³„ ë°ì´í„° ë°˜í™˜ (channel_daily_funnel.csv ê¸°ë°˜)
        function getFilteredDailyData(channel) {
            if (!channel || !dailyData || dailyData.length === 0) {
                return dailyData; // ì „ì²´ ë°ì´í„° ë°˜í™˜
            }

            // í•´ë‹¹ ì±„ë„ì˜ ì¼ë³„ ë°ì´í„°ë§Œ í•„í„°ë§
            return dailyData.filter(row =>
                (row['channel'] || row['Channel']) === channel
            );
        }

        // í•„í„° ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        document.getElementById('funnelFilterBtn').addEventListener('click', function() {
            const btn = this;
            const select = document.getElementById('funnelChannelFilter');

            if (funnelFilterActive) {
                // í•„í„° í•´ì œ
                funnelFilterActive = false;
                selectedFunnelChannel = '';
                btn.textContent = 'í•„í„°';
                btn.style.background = '';
                btn.style.color = '';
                select.style.display = 'none';
                select.value = '';

                // í˜„ì¬ ëª¨ë“œì— ë”°ë¼ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
                if (isCompareMode) {
                    updateCompareFunnels();
                } else {
                    updateFunnelChart();
                }
            } else {
                // í•„í„° í™œì„±í™”
                funnelFilterActive = true;
                btn.textContent = 'í•´ì œ';
                btn.style.background = '#673ab7';
                btn.style.color = 'white';
                populateFunnelChannelFilter();
                select.style.display = 'block';
            }
        });

        // ë“œë¡­ë‹¤ìš´ ë³€ê²½ ì´ë²¤íŠ¸
        document.getElementById('funnelChannelFilter').addEventListener('change', function() {
            selectedFunnelChannel = this.value;

            // í˜„ì¬ ëª¨ë“œì— ë”°ë¼ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            if (isCompareMode) {
                updateCompareFunnels();
            } else {
                updateFunnelChart();
            }
        });

        // ========================================

        // ë¹„êµ ëª¨ë“œ ì „í™˜ (í† ê¸€ ë°©ì‹)
        document.getElementById('funnelCompareBtn').addEventListener('click', function() {
            const btn = this;

            // ì´ë¯¸ ë¹„êµ ëª¨ë“œì¸ ê²½ìš°: ë‹¨ì¼ ë·°ë¡œ ëŒì•„ê°€ê¸°
            if (isCompareMode) {
                console.log('=== ë‹¨ì¼ ë·°ë¡œ ëŒì•„ê°€ê¸° ===');
                isCompareMode = false;
                document.getElementById('singleFunnelView').style.display = 'block';
                document.getElementById('compareFunnelView').style.display = 'none';
                btn.textContent = 'ë¹„êµ';
                updateFunnelChart();
                return;
            }

            // ë¹„êµ ëª¨ë“œ ì§„ì…
            console.log('=== ë¹„êµ ëª¨ë“œ ì‹œì‘ ===');

            // í•­ìƒ daily ë°ì´í„° ì‚¬ìš©
            const data = dailyData;
            console.log(`ì¼ë³„ ë°ì´í„°: ${data.length}ê°œ`);

            if (data.length === 0) {
                alert('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                return;
            }

            isCompareMode = true;
            document.getElementById('singleFunnelView').style.display = 'none';
            document.getElementById('compareFunnelView').style.display = 'block';
            btn.textContent = 'ëŒì•„ê°€ê¸°';

            // ëª¨ë“  ë‚ ì§œ ì¶”ì¶œ ë° ì •ë ¬ (Date ê°ì²´ ê¸°ë°˜)
            const allDateStrings = data
                .map(row => row['Day'] || row['week'] || row['date'] || row['Date'] || row['ì¼ì'])
                .filter(d => d);

            if (allDateStrings.length === 0) {
                alert('ë‚ ì§œ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                isCompareMode = false;
                document.getElementById('singleFunnelView').style.display = 'block';
                document.getElementById('compareFunnelView').style.display = 'none';
                return;
            }

            // ë‚ ì§œ ë¬¸ìì—´ì„ Date ê°ì²´ë¡œ ë³€í™˜í•˜ì—¬ ì •ë ¬
            const sortedDates = allDateStrings
                .map(dateStr => new Date(dateStr))
                .filter(date => !isNaN(date.getTime()))
                .sort((a, b) => a - b)
                .map(date => {
                    const year = date.getFullYear();
                    const month = String(date.getMonth() + 1).padStart(2, '0');
                    const day = String(date.getDate()).padStart(2, '0');
                    return `${year}-${month}-${day}`;
                });

            console.log('ì •ë ¬ëœ ë‚ ì§œ:', sortedDates.length, 'ê°œ');
            console.log('ì²« ë²ˆì§¸ ë‚ ì§œ:', sortedDates[0]);
            console.log('ë§ˆì§€ë§‰ ë‚ ì§œ:', sortedDates[sortedDates.length - 1]);

            const midPoint = Math.floor(sortedDates.length / 2);

            // ê¸°ë³¸ê°’: ì „ë°˜ë¶€ vs í›„ë°˜ë¶€
            const leftStart = sortedDates[0];
            const leftEnd = sortedDates[midPoint - 1] || sortedDates[0];
            const rightStart = sortedDates[midPoint] || sortedDates[0];
            const rightEnd = sortedDates[sortedDates.length - 1];

            console.log('ì„¤ì •í•  ë‚ ì§œ ë²”ìœ„:');
            console.log('ì™¼ìª½:', leftStart, '~', leftEnd);
            console.log('ì˜¤ë¥¸ìª½:', rightStart, '~', rightEnd);

            document.getElementById('leftStartDate').value = leftStart;
            document.getElementById('leftEndDate').value = leftEnd;
            document.getElementById('rightStartDate').value = rightStart;
            document.getElementById('rightEndDate').value = rightEnd;

            console.log('ë¹„êµ í¼ë„ ì—…ë°ì´íŠ¸ í˜¸ì¶œ...');
            updateCompareFunnels();
        });

        // ë‚ ì§œ ë³€ê²½ ì‹œ ì—…ë°ì´íŠ¸ (ë””ë°”ìš´ì‹± ì ìš©)
        let updateTimeout = null;
        ['leftStartDate', 'leftEndDate', 'rightStartDate', 'rightEndDate'].forEach(id => {
            const element = document.getElementById(id);

            // change ì´ë²¤íŠ¸ (ë‚ ì§œ ì„ íƒ ì™„ë£Œ ì‹œ)
            element.addEventListener('change', function() {
                clearTimeout(updateTimeout);
                updateTimeout = setTimeout(() => {
                    updateCompareFunnels();
                }, 300); // 300ms ë””ë°”ìš´ìŠ¤
            });

            // input ì´ë²¤íŠ¸ (ì‹¤ì‹œê°„ ì…ë ¥ ì¤‘)
            element.addEventListener('input', function() {
                clearTimeout(updateTimeout);
                updateTimeout = setTimeout(() => {
                    updateCompareFunnels();
                }, 500); // 500ms ë””ë°”ìš´ìŠ¤
            });
        });

        // ë¹„êµ í¼ë„ ì—…ë°ì´íŠ¸
        function updateCompareFunnels() {
            console.log('=== updateCompareFunnels ì‹œì‘ ===');

            // ì±„ë„ í•„í„° ì ìš©ëœ ë°ì´í„° ì‚¬ìš©
            const data = selectedFunnelChannel ? getFilteredDailyData(selectedFunnelChannel) : dailyData;
            console.log(`ì¼ë³„ ë°ì´í„°: ${data.length}ê°œ${selectedFunnelChannel ? ` (${selectedFunnelChannel} í•„í„° ì ìš©)` : ''}`);

            // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ í™”ë©´ ì´ˆê¸°í™”
            if (data.length === 0) {
                console.warn('ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                document.getElementById('d3FunnelChartLeft').innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 450px; color: var(--grey-500); font-size: 13px;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
                document.getElementById('d3FunnelChartRight').innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 450px; color: var(--grey-500); font-size: 13px;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
                document.getElementById('comparisonContent').innerHTML = '';
                return;
            }

            const leftStart = document.getElementById('leftStartDate').value;
            const leftEnd = document.getElementById('leftEndDate').value;
            const rightStart = document.getElementById('rightStartDate').value;
            const rightEnd = document.getElementById('rightEndDate').value;

            console.log('ì„ íƒëœ ë‚ ì§œ:', {
                'ì™¼ìª½ ì‹œì‘': leftStart,
                'ì™¼ìª½ ì¢…ë£Œ': leftEnd,
                'ì˜¤ë¥¸ìª½ ì‹œì‘': rightStart,
                'ì˜¤ë¥¸ìª½ ì¢…ë£Œ': rightEnd
            });

            // ë‚ ì§œê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìœ¼ë©´ í™”ë©´ ì´ˆê¸°í™”
            if (!leftStart || !leftEnd || !rightStart || !rightEnd) {
                console.warn('ë‚ ì§œ ê°’ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                document.getElementById('d3FunnelChartLeft').innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 450px; color: var(--grey-500); font-size: 13px;">ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</div>';
                document.getElementById('d3FunnelChartRight').innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 450px; color: var(--grey-500); font-size: 13px;">ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</div>';
                document.getElementById('comparisonContent').innerHTML = '';
                return;
            }

            // ë‚ ì§œ ìœ íš¨ì„± ê²€ì‚¬ (ì–‘ìª½ ëª¨ë‘ ì´ˆê¸°í™”)
            if (leftStart > leftEnd) {
                console.error('ì™¼ìª½ ë‚ ì§œ ì˜¤ë¥˜: ì‹œì‘ì¼ì´ ì¢…ë£Œì¼ë³´ë‹¤ ëŠ¦ìŠµë‹ˆë‹¤');
                document.getElementById('d3FunnelChartLeft').innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 450px; color: var(--error-main); font-size: 13px;">ì‹œì‘ì¼ì´ ì¢…ë£Œì¼ë³´ë‹¤ ëŠ¦ìŠµë‹ˆë‹¤</div>';
                document.getElementById('d3FunnelChartRight').innerHTML = '';
                document.getElementById('comparisonContent').innerHTML = '';
                return;
            }
            if (rightStart > rightEnd) {
                console.error('ì˜¤ë¥¸ìª½ ë‚ ì§œ ì˜¤ë¥˜: ì‹œì‘ì¼ì´ ì¢…ë£Œì¼ë³´ë‹¤ ëŠ¦ìŠµë‹ˆë‹¤');
                document.getElementById('d3FunnelChartLeft').innerHTML = '';
                document.getElementById('d3FunnelChartRight').innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 450px; color: var(--error-main); font-size: 13px;">ì‹œì‘ì¼ì´ ì¢…ë£Œì¼ë³´ë‹¤ ëŠ¦ìŠµë‹ˆë‹¤</div>';
                document.getElementById('comparisonContent').innerHTML = '';
                return;
            }

            console.log('ë‚ ì§œ í•„í„°ë§ ì‹œì‘...');
            const leftData = filterDataByDateRange(data, leftStart, leftEnd);
            const rightData = filterDataByDateRange(data, rightStart, rightEnd);

            console.log('í¼ë„ ë°ì´í„° ê³„ì‚° ì‹œì‘...');
            leftFunnelData = calculateFunnelData(leftData);
            rightFunnelData = calculateFunnelData(rightData);

            console.log('ì™¼ìª½ í¼ë„ ë°ì´í„°:', leftFunnelData.length > 0 ? leftFunnelData[0] : 'ì—†ìŒ');
            console.log('ì˜¤ë¥¸ìª½ í¼ë„ ë°ì´í„°:', rightFunnelData.length > 0 ? rightFunnelData[0] : 'ì—†ìŒ');

            // í•­ìƒ ë Œë”ë§ ì‹œë„ (renderSmallFunnel ë‚´ë¶€ì—ì„œ ë°ì´í„° ê²€ì¦)
            console.log('ë Œë”ë§ ì‹œì‘...');
            renderSmallFunnel('d3FunnelChartLeft', leftFunnelData);
            renderSmallFunnel('d3FunnelChartRight', rightFunnelData);

            // ì–‘ìª½ ë°ì´í„°ê°€ ëª¨ë‘ ìœ íš¨í•  ë•Œë§Œ ë¹„êµ ì¸ì‚¬ì´íŠ¸ í‘œì‹œ
            if (leftFunnelData.length > 0 && rightFunnelData.length > 0 &&
                leftFunnelData[0]?.total > 0 && rightFunnelData[0]?.total > 0) {
                console.log('ë¹„êµ ì¸ì‚¬ì´íŠ¸ í‘œì‹œ');
                updateComparisonInsights();
            } else {
                console.warn('ë¹„êµí•  ë°ì´í„°ê°€ ì¶©ë¶„í•˜ì§€ ì•ŠìŒ');
                document.getElementById('comparisonContent').innerHTML = '<div style="text-align: center; color: var(--grey-500); padding: 20px;">ë¹„êµí•  ë°ì´í„°ê°€ ì¶©ë¶„í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤</div>';
            }

            console.log('=== updateCompareFunnels ì™„ë£Œ ===\n');
        }

        // ì ‘ê¸°/í¼ì¹˜ê¸° ê¸°ëŠ¥
        document.querySelectorAll('.collapsible-header').forEach(header => {
            header.addEventListener('click', function() {
                const content = this.nextElementSibling;
                const icon = this.querySelector('.collapsible-toggle-icon');
                const toggleText = this.querySelector('.collapsible-toggle span:first-child');

                if (content.classList.contains('expanded')) {
                    content.classList.remove('expanded');
                    icon.classList.add('collapsed');
                    toggleText.textContent = 'í¼ì¹˜ê¸°';
                } else {
                    content.classList.add('expanded');
                    icon.classList.remove('collapsed');
                    toggleText.textContent = 'ì ‘ê¸°';
                }
            });
        });

        // iframeì—ì„œ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ê³  ì‚¬ì´ë“œë°” ìˆ¨ê¸°ê¸°
        function checkIframeAndHideSidebar() {
            if (window.self !== window.top) {
                // iframe ë‚´ë¶€ì—ì„œ ì‹¤í–‰ ì¤‘
                const sidebar = document.querySelector('.sidebar');
                const mainContent = document.querySelector('.main-content');

                if (sidebar) {
                    sidebar.style.display = 'none';
                }

                if (mainContent) {
                    mainContent.style.marginLeft = '0';
                }
            }
        }

        // í˜ì´ì§€ ë¡œë“œì‹œ ì‹¤í–‰
        // ë²„íŠ¼ ìƒíƒœ í™•ì¸ í•¨ìˆ˜ (ë””ë²„ê¹…ìš©)
        function checkButtonStates() {
            console.log('========================================');
            console.log('=== ë²„íŠ¼ ìƒíƒœ í™•ì¸ ===');
            console.log('========================================');

            const buttonGroups = [
                { name: 'ì‹ ê·œ vs ì¬ë°©ë¬¸ ë²„íŠ¼', selector: '.new-vs-returning-view-btn' },
                { name: 'ì´íƒˆ ìœ„í—˜ ë²„íŠ¼', selector: '.churn-period-btn' },
                { name: 'ì„±ê³¼ ê°œì„  ë²„íŠ¼', selector: '.improvement-period-btn' },
                { name: 'KPI ì°¨íŠ¸ ë²„íŠ¼', selector: '.channel-kpi-btn' },
                { name: 'ì´íƒˆë¥  í¼ë„ ë‹¨ê³„ ë²„íŠ¼', selector: '.channel-churn-stage-btn' },
                { name: 'ì´íƒˆë¥  ì •ë ¬ ë²„íŠ¼', selector: '.channel-churn-sort-btn' },
                { name: 'ì±„ë„ í¼ë„ ë²„íŠ¼', selector: '.channel-funnel-btn' }
            ];

            buttonGroups.forEach(group => {
                const buttons = document.querySelectorAll(group.selector);
                const activeButtons = Array.from(buttons).filter(b => b.classList.contains('active'));

                console.log(`\n[${group.name}]`);
                console.log(`  ì´ ë²„íŠ¼ ìˆ˜: ${buttons.length}`);
                console.log(`  í™œì„±í™”ëœ ë²„íŠ¼: ${activeButtons.length}`);

                if (activeButtons.length > 0) {
                    activeButtons.forEach(btn => {
                        const view = btn.dataset.view || btn.dataset.kpi || btn.dataset.funnel || btn.dataset.period;
                        console.log(`  - "${btn.textContent.trim()}" (${view})`);
                    });
                }
            });

            console.log('\n========================================\n');
        }

        // ========================================
        // ìƒˆë¡œìš´ ì°¨íŠ¸ ë Œë”ë§ í•¨ìˆ˜ë“¤
        // ========================================

        // í†µí•© ì‹ ê·œ/ì¬ë°©ë¬¸ ì¶”ì„¸ ì°¨íŠ¸
        function updateCustomerTrendChart() {
            if (newVsReturningData.length === 0) return;

            const canvas = document.getElementById('customerTrendChart');
            if (!canvas) return;

            // ìœ ì… ë‹¨ê³„ë§Œ í•„í„°ë§
            const acquisitionData = newVsReturningData.filter(row => row['funnel'] === 'ìœ ì…');

            // ë‚ ì§œë³„ë¡œ ì •ë ¬
            const sortedData = acquisitionData.sort((a, b) => {
                const dateA = new Date(a['Day']);
                const dateB = new Date(b['Day']);
                return dateA - dateB;
            });

            // í˜„ì¬ ì„ íƒëœ ë·°ì— ë”°ë¼ ë°ì´í„° ì§‘ê³„
            let aggregatedData = [];

            if (newVsReturningView === 'monthly') {
                // ì›”ë³„ ì§‘ê³„
                const monthlyMap = {};
                sortedData.forEach(row => {
                    const date = new Date(row['Day']);
                    const month = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;

                    if (!monthlyMap[month]) {
                        monthlyMap[month] = {
                            totalUsers: 0,
                            newUsers: 0,
                            returningUsers: 0
                        };
                    }

                    monthlyMap[month].totalUsers += parseFloat(row['Total users']) || 0;
                    monthlyMap[month].newUsers += parseFloat(row['New users']) || 0;
                    monthlyMap[month].returningUsers += parseFloat(row['Returning users']) || 0;
                });

                aggregatedData = Object.entries(monthlyMap).map(([month, data]) => ({
                    label: month,
                    newUserPct: ((data.newUsers / data.totalUsers) * 100).toFixed(2),
                    returnRate: ((data.returningUsers / data.totalUsers) * 100).toFixed(2)
                }));
            } else if (newVsReturningView === 'weekly') {
                // ì£¼ë³„ ì§‘ê³„
                const weeklyMap = new Map();

                sortedData.forEach(row => {
                    const date = new Date(row['Day']);
                    const dayOfWeek = date.getDay();
                    const weekStart = new Date(date);
                    weekStart.setDate(date.getDate() - dayOfWeek);
                    const weekKey = weekStart.toISOString().split('T')[0];

                    if (!weeklyMap.has(weekKey)) {
                        weeklyMap.set(weekKey, {
                            totalUsers: 0,
                            newUsers: 0,
                            returningUsers: 0
                        });
                    }

                    const weekData = weeklyMap.get(weekKey);
                    weekData.totalUsers += parseFloat(row['Total users']) || 0;
                    weekData.newUsers += parseFloat(row['New users']) || 0;
                    weekData.returningUsers += parseFloat(row['Returning users']) || 0;
                });

                aggregatedData = Array.from(weeklyMap.entries())
                    .sort((a, b) => a[0].localeCompare(b[0]))
                    .map(([week, data]) => ({
                        label: week,
                        newUserPct: data.totalUsers > 0 ? ((data.newUsers / data.totalUsers) * 100).toFixed(2) : 0,
                        returnRate: data.totalUsers > 0 ? ((data.returningUsers / data.totalUsers) * 100).toFixed(2) : 0
                    }));
            } else {
                // ì¼ë³„ (ê¸°ë³¸)
                aggregatedData = sortedData.map(row => ({
                    label: row['Day'],
                    newUserPct: parseFloat(row['New user %']).toFixed(2),
                    returnRate: (100 - parseFloat(row['New user %'])).toFixed(2)
                }));
            }

            if (customerTrendChart) {
                customerTrendChart.destroy();
            }

            customerTrendChart = new Chart(canvas, {
                type: 'line',
                data: {
                    labels: aggregatedData.map(d => d.label),
                    datasets: [
                        {
                            label: 'ì‹ ê·œ ê³ ê° ë¹„ìœ¨ (%)',
                            data: aggregatedData.map(d => d.newUserPct),
                            borderColor: '#2196f3',
                            backgroundColor: 'rgba(33, 150, 243, 0.1)',
                            tension: 0.3,
                            fill: true,
                            pointRadius: 3,
                            pointHoverRadius: 6,
                            yAxisID: 'y'
                        },
                        {
                            label: 'ì¬ë°©ë¬¸ìœ¨ (%)',
                            data: aggregatedData.map(d => d.returnRate),
                            borderColor: '#673ab7',
                            backgroundColor: 'rgba(103, 58, 183, 0.1)',
                            tension: 0.3,
                            fill: true,
                            pointRadius: 3,
                            pointHoverRadius: 6,
                            yAxisID: 'y'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${context.parsed.y}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            },
                            title: {
                                display: true,
                                text: 'ë¹„ìœ¨ (%)'
                            }
                        },
                        x: {
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45
                            }
                        }
                    }
                }
            });

            // íˆ´íŒ ì„¤ì •
            setupCustomerTrendTooltip();
        }

        // í†µí•© ê³ ê° ì¶”ì„¸ ì°¨íŠ¸ ì¸ì‚¬ì´íŠ¸ ìƒì„±
        function generateCustomerTrendInsight() {
            return {
                insight: 'ì‹ ê·œ ê³ ê° ë¹„ìœ¨ê³¼ ì¬ë°©ë¬¸ìœ¨ì˜ ê· í˜•ì„ í™•ì¸í•˜ì„¸ìš”. ì‹ ê·œ ë¹„ìœ¨ì´ ë†’ìœ¼ë©´ ì„±ì¥ ì¤‘ì´ë©°, ì¬ë°©ë¬¸ìœ¨ì´ ë†’ìœ¼ë©´ ì¶©ì„±ë„ê°€ ë†’ìŠµë‹ˆë‹¤.',
                recommendation: 'ì´ìƒì ìœ¼ë¡œëŠ” ê¾¸ì¤€í•œ ì‹ ê·œ ìœ ì…(30-40%)ê³¼ ë†’ì€ ì¬ë°©ë¬¸ìœ¨(60-70%)ì„ ìœ ì§€í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. ë‘ ì§€í‘œê°€ í•¨ê»˜ ì„±ì¥í•˜ëŠ” ê²ƒì´ ê±´ê°•í•œ ë¹„ì¦ˆë‹ˆìŠ¤ì˜ ì‹ í˜¸ì…ë‹ˆë‹¤.'
            };
        }

        // í†µí•© ê³ ê° ì¶”ì„¸ ì°¨íŠ¸ íˆ´íŒ ì„¤ì •
        function setupCustomerTrendTooltip() {
            const canvas = document.getElementById('customerTrendChart');
            const container = canvas ? canvas.parentElement : null;
            if (!container) return;

            if (!container.dataset.tooltipSetup) {
                container.dataset.tooltipSetup = 'true';

                container.addEventListener('mouseenter', function(event) {
                    const insight = generateCustomerTrendInsight();
                    showChartInsightTooltip('customerTrendTooltip', insight.insight, insight.recommendation, event);
                });

                container.addEventListener('mousemove', function(event) {
                    const tooltip = document.getElementById('customerTrendTooltip');
                    if (tooltip && tooltip.classList.contains('show')) {
                        tooltip.style.left = (event.clientX + 15) + 'px';
                        tooltip.style.top = (event.clientY + 15) + 'px';
                    }
                });

                container.addEventListener('mouseleave', function() {
                    hideChartInsightTooltip('customerTrendTooltip');
                });
            }
        }

        // 2. ì‹ ê·œ vs ì¬ë°©ë¬¸ ê³ ê° ì „í™˜ìœ¨ ë¹„êµ ì°¨íŠ¸
        function updateNewVsReturningConversionChart() {
            if (newVsReturningConversionData.length === 0) return;

            const canvas = document.getElementById('newVsReturningConversionChart');
            if (!canvas) return;

            const labels = newVsReturningConversionData.map(row => row['funnel_stage']);
            const newUserCVR = newVsReturningConversionData.map(row => parseFloat(row['New user CVR']) || 0);
            const returningUserCVR = newVsReturningConversionData.map(row => parseFloat(row['Returning user CVR']) || 0);

            // ì¸ì‚¬ì´íŠ¸ ë¶„ì„ ë° í‘œì‹œ
            analyzeConversionGap(labels, newUserCVR, returningUserCVR);

            if (newVsReturningConversionChart) {
                newVsReturningConversionChart.destroy();
            }

            newVsReturningConversionChart = new Chart(canvas, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'ì‹ ê·œ ê³ ê° ì „í™˜ìœ¨ (%)',
                            data: newUserCVR,
                            backgroundColor: 'rgba(255, 152, 0, 0.7)',
                            borderColor: '#ff9800',
                            borderWidth: 2,
                            borderRadius: 6,
                            barThickness: 'flex',
                            maxBarThickness: 60
                        },
                        {
                            label: 'ì¬ë°©ë¬¸ ê³ ê° ì „í™˜ìœ¨ (%)',
                            data: returningUserCVR,
                            backgroundColor: 'rgba(103, 58, 183, 0.7)',
                            borderColor: '#673ab7',
                            borderWidth: 2,
                            borderRadius: 6,
                            barThickness: 'flex',
                            maxBarThickness: 60
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                font: {
                                    size: 13,
                                    weight: '600'
                                },
                                padding: 15,
                                usePointStyle: true,
                                pointStyle: 'rectRounded'
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            padding: 12,
                            titleFont: {
                                size: 14,
                                weight: 'bold'
                            },
                            bodyFont: {
                                size: 13
                            },
                            callbacks: {
                                title: function(context) {
                                    return context[0].label + ' ë‹¨ê³„';
                                },
                                label: function(context) {
                                    const value = context.parsed.y.toFixed(2);
                                    return `${context.dataset.label}: ${value}%`;
                                },
                                afterBody: function(context) {
                                    if (context.length === 2) {
                                        const newValue = context[0].parsed.y;
                                        const returningValue = context[1].parsed.y;
                                        const gap = Math.abs(returningValue - newValue);
                                        const higherGroup = returningValue > newValue ? 'ì¬ë°©ë¬¸ ê³ ê°' : 'ì‹ ê·œ ê³ ê°';
                                        return [
                                            '',
                                            `ğŸ“Š ì „í™˜ìœ¨ ì°¨ì´: ${gap.toFixed(2)}%p`,
                                            `${higherGroup}ì´ ë” ë†’ìŒ`
                                        ];
                                    }
                                    return '';
                                }
                            }
                        },
                        datalabels: {
                            display: true,
                            anchor: 'end',
                            align: 'top',
                            offset: 4,
                            formatter: function(value, context) {
                                return value.toFixed(1) + '%';
                            },
                            font: {
                                size: 11,
                                weight: 'bold'
                            },
                            color: function(context) {
                                return context.datasetIndex === 0 ? '#f57c00' : '#673ab7';
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                },
                                font: {
                                    size: 12
                                }
                            },
                            title: {
                                display: true,
                                text: 'ì „í™˜ìœ¨ (%)',
                                font: {
                                    size: 13,
                                    weight: '600'
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                font: {
                                    size: 12,
                                    weight: '500'
                                }
                            }
                        }
                    }
                },
                plugins: [ChartDataLabels]
            });

            // ì¸ì‚¬ì´íŠ¸ íˆ´íŒ ì„¤ì •
            setupConversionChartTooltip();
        }

        // ì „í™˜ìœ¨ ì°¨ì´ ë¶„ì„ í•¨ìˆ˜
        function analyzeConversionGap(labels, newUserCVR, returningUserCVR) {
            if (labels.length === 0 || newUserCVR.length === 0 || returningUserCVR.length === 0) {
                return;
            }

            // ê° ë‹¨ê³„ë³„ ì°¨ì´ ê³„ì‚°
            const gaps = labels.map((label, i) => ({
                stage: label,
                newCVR: newUserCVR[i],
                returningCVR: returningUserCVR[i],
                gap: returningUserCVR[i] - newUserCVR[i],
                gapPercent: ((returningUserCVR[i] - newUserCVR[i]) / newUserCVR[i] * 100)
            }));

            // ê°€ì¥ ì°¨ì´ê°€ í° ë‹¨ê³„ ì°¾ê¸°
            const maxGap = gaps.reduce((max, item) => item.gap > max.gap ? item : max, gaps[0]);
            const minGap = gaps.reduce((min, item) => item.gap < min.gap ? item : min, gaps[0]);

            // í‰ê·  ì‹ ê·œ/ì¬ë°©ë¬¸ ì „í™˜ìœ¨
            const avgNew = newUserCVR.reduce((sum, val) => sum + val, 0) / newUserCVR.length;
            const avgReturning = returningUserCVR.reduce((sum, val) => sum + val, 0) / returningUserCVR.length;
            const avgGap = avgReturning - avgNew;

            // ì¸ì‚¬ì´íŠ¸ í…ìŠ¤íŠ¸ ìƒì„±
            let insightHTML = '';

            if (avgReturning > avgNew) {
                const ratio = (avgReturning / avgNew).toFixed(1);
                insightHTML += `ì¬ë°©ë¬¸ ê³ ê°ì˜ í‰ê·  ì „í™˜ìœ¨ì€ <strong style="color: #673ab7;">${avgReturning.toFixed(1)}%</strong>ë¡œ, `;
                insightHTML += `ì‹ ê·œ ê³ ê°(<strong style="color: #ff9800;">${avgNew.toFixed(1)}%</strong>)ë³´ë‹¤ <strong style="color: var(--success-main);">${ratio}ë°° ë†’ìŠµë‹ˆë‹¤</strong>. `;
            } else {
                insightHTML += `ì‹ ê·œ ê³ ê°ê³¼ ì¬ë°©ë¬¸ ê³ ê°ì˜ ì „í™˜ìœ¨ì´ ë¹„ìŠ·í•©ë‹ˆë‹¤. `;
            }

            if (maxGap.gap > 5) {
                insightHTML += `<br><strong>íŠ¹íˆ "${maxGap.stage}" ë‹¨ê³„</strong>ì—ì„œ ì¬ë°©ë¬¸ ê³ ê°ì´ ${maxGap.gap.toFixed(1)}%p ë” ë†’ìŠµë‹ˆë‹¤. `;

                // ë‹¨ê³„ë³„ ë§ì¶¤ ì¶”ì²œ
                if (maxGap.stage.includes('ìœ ì…') || maxGap.stage.includes('í™œë™')) {
                    insightHTML += `ì‹ ê·œ ê³ ê°ì´ ì´ ë‹¨ê³„ì—ì„œ ì´íƒˆí•˜ì§€ ì•Šë„ë¡ <strong>ì²« í™”ë©´ì„ ê°„ê²°í•˜ê²Œ</strong> ë§Œë“¤ê³  <strong>ë¡œë”© ì†ë„ë¥¼ ê°œì„ </strong>í•˜ì„¸ìš”.`;
                } else if (maxGap.stage.includes('ê´€ì‹¬')) {
                    insightHTML += `ì‹ ê·œ ê³ ê°ì—ê²Œ <strong>ì œí’ˆ ë¦¬ë·°ì™€ ê³ ê° í›„ê¸°</strong>ë¥¼ ê°•ì¡°í•˜ì—¬ ì‹ ë¢°ë¥¼ êµ¬ì¶•í•˜ì„¸ìš”.`;
                } else if (maxGap.stage.includes('ê²°ì œ') || maxGap.stage.includes('êµ¬ë§¤')) {
                    insightHTML += `ì‹ ê·œ ê³ ê°ë„ ì‰½ê²Œ êµ¬ë§¤í•  ìˆ˜ ìˆë„ë¡ <strong>ê²ŒìŠ¤íŠ¸ ì²´í¬ì•„ì›ƒ</strong>ê³¼ <strong>ê°„í¸ ê²°ì œ</strong>ë¥¼ ë„ì…í•˜ì„¸ìš”.`;
                }
            } else {
                insightHTML += `ëª¨ë“  ë‹¨ê³„ì—ì„œ ë¹„ìŠ·í•œ íŒ¨í„´ì„ ë³´ì…ë‹ˆë‹¤. ì‹ ê·œ ê³ ê°ê³¼ ì¬ë°©ë¬¸ ê³ ê° ëª¨ë‘ì—ê²Œ íš¨ê³¼ì ì¸ ì „ëµì„ ìœ ì§€í•˜ì„¸ìš”.`;
            }

            // í•µì‹¬ ì¶”ì²œì‚¬í•­
            insightHTML += `<br><br><strong style="color: var(--primary-main);">ğŸ’¡ í•µì‹¬ ì „ëµ:</strong> `;
            if (avgGap > 10) {
                insightHTML += `ì¬ë°©ë¬¸ìœ¨ì„ ë†’ì´ëŠ” ê²ƒì´ ê°€ì¥ íš¨ê³¼ì ì…ë‹ˆë‹¤. ì´ë©”ì¼ ë§ˆì¼€íŒ…, ë¦¬íƒ€ê²ŸíŒ… ê´‘ê³ , ì¿ í° ì œê³µìœ¼ë¡œ ì¬ë°©ë¬¸ì„ ìœ ë„í•˜ì„¸ìš”.`;
            } else if (avgNew < 3) {
                insightHTML += `ì‹ ê·œ ê³ ê° ì „í™˜ìœ¨ì´ ë‚®ìŠµë‹ˆë‹¤. ëœë”©í˜ì´ì§€ ê°œì„ ê³¼ ì²« êµ¬ë§¤ í• ì¸ í˜œíƒ ì œê³µì„ ê³ ë ¤í•˜ì„¸ìš”.`;
            } else {
                insightHTML += `ê· í˜•ì¡íŒ ì„±ê³¼ë¥¼ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤. ì§€ì†ì ì¸ A/B í…ŒìŠ¤íŠ¸ë¡œ ë‘ ê·¸ë£¹ ëª¨ë‘ì˜ ì „í™˜ìœ¨ì„ ê°œì„ í•˜ì„¸ìš”.`;
            }

            // ì¸ì‚¬ì´íŠ¸ í‘œì‹œ
            const insightElement = document.getElementById('conversionInsightText');
            if (insightElement) {
                insightElement.innerHTML = insightHTML;
            }
        }

        // ì „í™˜ìœ¨ ë¹„êµ ì°¨íŠ¸ ì¸ì‚¬ì´íŠ¸ ìƒì„±
        function generateConversionInsight() {
            return {
                insight: 'ì‹ ê·œ ê³ ê°ê³¼ ì¬ë°©ë¬¸ ê³ ê°ì˜ ì „í™˜ìœ¨ ì°¨ì´ëŠ” ê³ ê° ê²½í—˜ì˜ ì§ˆì„ ë³´ì—¬ì£¼ëŠ” ì¤‘ìš”í•œ ì§€í‘œì…ë‹ˆë‹¤. ì¬ë°©ë¬¸ ê³ ê°ì´ ë†’ë‹¤ë©´ ë¸Œëœë“œ ì¶©ì„±ë„ê°€ ì¢‹ë‹¤ëŠ” ëœ»ì´ê³ , ì‹ ê·œ ê³ ê°ì´ ë‚®ë‹¤ë©´ ì²«ì¸ìƒ ê°œì„ ì´ í•„ìš”í•©ë‹ˆë‹¤.',
                recommendation: 'ì°¨ì´ê°€ í° ë‹¨ê³„ë¥¼ ì§‘ì¤‘ ê°œì„ í•˜ì„¸ìš”. ì˜ˆë¥¼ ë“¤ì–´, ì¬ë°©ë¬¸ ê³ ê°ë§Œ êµ¬ë§¤ìœ¨ì´ ë†’ë‹¤ë©´ ì‹ ê·œ ê³ ê°ì„ ìœ„í•œ "ì²« êµ¬ë§¤ 10% í• ì¸" ê°™ì€ ì¸ì„¼í‹°ë¸Œë¥¼ ì œê³µí•˜ê±°ë‚˜, ì¬ë°©ë¬¸ ê³ ê°ì—ê²ŒëŠ” VIP í˜œíƒì„ ì œê³µí•˜ì—¬ ì¶©ì„±ë„ë¥¼ ë” ë†’ì´ì„¸ìš”.'
            };
        }

        // ì „í™˜ìœ¨ ë¹„êµ ì°¨íŠ¸ íˆ´íŒ ì„¤ì •
        function setupConversionChartTooltip() {
            const canvas = document.getElementById('newVsReturningConversionChart');
            const container = canvas ? canvas.parentElement : null;
            if (!container) return;

            if (!container.dataset.tooltipSetup) {
                container.dataset.tooltipSetup = 'true';

                container.addEventListener('mouseenter', function(event) {
                    const insight = generateConversionInsight();
                    showChartInsightTooltip('customerTrendTooltip', insight.insight, insight.recommendation, event);
                });

                container.addEventListener('mousemove', function(event) {
                    const tooltip = document.getElementById('customerTrendTooltip');
                    if (tooltip && tooltip.classList.contains('show')) {
                        tooltip.style.left = (event.clientX + 15) + 'px';
                        tooltip.style.top = (event.clientY + 15) + 'px';
                    }
                });

                container.addEventListener('mouseleave', function() {
                    hideChartInsightTooltip('customerTrendTooltip');
                });
            }
        }

        // 3. ì±„ë„ í’ˆì§ˆ ë§¤íŠ¸ë¦­ìŠ¤ ì°¨íŠ¸ (Scatter)
        function updateChannelMatrixChart() {
            if (channelEngagementData.length === 0) return;

            const canvas = document.getElementById('channelMatrixChart');
            if (!canvas) return;

            // ë°ì´í„° ì¤€ë¹„
            const data = channelEngagementData.map(row => ({
                x: parseFloat(row['Bounce rate']) || 0,
                y: parseFloat(row['Return rate']) || 0,
                channel: row['channel']
            }));

            // í‰ê· ê°’ ê³„ì‚° (ê¸°ì¤€ì„ ìš©)
            const avgBounceRate = data.reduce((sum, d) => sum + d.x, 0) / data.length;
            const avgReturnRate = data.reduce((sum, d) => sum + d.y, 0) / data.length;

            // ì‚¬ë¶„ë©´ë³„ë¡œ ë°ì´í„° ë¶„ë¦¬
            const starChannels = [];
            const growthChannels = [];
            const stableChannels = [];
            const problemChannels = [];

            data.forEach(d => {
                if (d.x < avgBounceRate && d.y > avgReturnRate) {
                    starChannels.push(d);
                } else if (d.x >= avgBounceRate && d.y > avgReturnRate) {
                    growthChannels.push(d);
                } else if (d.x < avgBounceRate && d.y <= avgReturnRate) {
                    stableChannels.push(d);
                } else {
                    problemChannels.push(d);
                }
            });

            if (channelMatrixChart) {
                channelMatrixChart.destroy();
            }

            channelMatrixChart = new Chart(canvas, {
                type: 'scatter',
                data: {
                    datasets: [
                        {
                            label: 'â­ ìŠ¤íƒ€ ì±„ë„',
                            data: starChannels,
                            backgroundColor: '#00c853',
                            borderColor: '#00a344',
                            borderWidth: 2,
                            pointRadius: 10,
                            pointHoverRadius: 14
                        },
                        {
                            label: 'ğŸ“ˆ ì„±ì¥ ì±„ë„',
                            data: growthChannels,
                            backgroundColor: '#2196f3',
                            borderColor: '#1976d2',
                            borderWidth: 2,
                            pointRadius: 10,
                            pointHoverRadius: 14
                        },
                        {
                            label: 'ğŸ”’ ì•ˆì • ì±„ë„',
                            data: stableChannels,
                            backgroundColor: '#9e9e9e',
                            borderColor: '#757575',
                            borderWidth: 2,
                            pointRadius: 10,
                            pointHoverRadius: 14
                        },
                        {
                            label: 'âš ï¸ ë¬¸ì œ ì±„ë„',
                            data: problemChannels,
                            backgroundColor: '#ff5722',
                            borderColor: '#e64a19',
                            borderWidth: 2,
                            pointRadius: 10,
                            pointHoverRadius: 14
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                font: {
                                    size: 12,
                                    weight: 'bold'
                                },
                                padding: 15,
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            callbacks: {
                                title: function(tooltipItems) {
                                    const item = tooltipItems[0];
                                    return item.raw.channel;
                                },
                                label: function(context) {
                                    return [
                                        `ì´íƒˆë¥ : ${context.raw.x.toFixed(2)}%`,
                                        `ì¬ë°©ë¬¸ìœ¨: ${context.raw.y.toFixed(2)}%`,
                                        `ë¶„ë¥˜: ${context.dataset.label}`
                                    ];
                                }
                            }
                        },
                        annotation: {
                            annotations: {
                                // í‰ê·  ê¸°ì¤€ì„ 
                                vline: {
                                    type: 'line',
                                    xMin: avgBounceRate,
                                    xMax: avgBounceRate,
                                    borderColor: 'rgba(0, 0, 0, 0.3)',
                                    borderWidth: 2,
                                    borderDash: [5, 5],
                                    label: {
                                        content: 'í‰ê·  ì´íƒˆë¥ ',
                                        enabled: true,
                                        position: 'start'
                                    }
                                },
                                hline: {
                                    type: 'line',
                                    yMin: avgReturnRate,
                                    yMax: avgReturnRate,
                                    borderColor: 'rgba(0, 0, 0, 0.3)',
                                    borderWidth: 2,
                                    borderDash: [5, 5],
                                    label: {
                                        content: 'í‰ê·  ì¬ë°©ë¬¸ìœ¨',
                                        enabled: true,
                                        position: 'start'
                                    }
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'ì´íƒˆë¥  (%) â†’',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'â† ì¬ë°©ë¬¸ìœ¨ (%)',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });
        }

        // ì°¸ì—¬ë„ ë¶„ì„ í•¨ìˆ˜
        function analyzeEngagementRates(allData, top10Data, top10Rates) {
            if (allData.length === 0) return;

            // ì „ì²´ í‰ê·  ì°¸ì—¬ë„
            const avgEngagement = allData.reduce((sum, row) => sum + (parseFloat(row['Engagement rate']) || 0), 0) / allData.length;

            // ìµœê³ /ìµœì € ì°¸ì—¬ë„ ì±„ë„
            const highest = allData[0];
            const lowest = allData[allData.length - 1];

            // ì°¸ì—¬ë„ ë²”ìœ„ ë¶„ë¥˜
            const highEngagement = allData.filter(row => parseFloat(row['Engagement rate']) >= 60);
            const mediumEngagement = allData.filter(row => {
                const rate = parseFloat(row['Engagement rate']);
                return rate >= 40 && rate < 60;
            });
            const lowEngagement = allData.filter(row => parseFloat(row['Engagement rate']) < 40);

            // TOP 10ì˜ í‰ê·  ì°¸ì—¬ë„
            const top10Avg = top10Rates.reduce((sum, rate) => sum + rate, 0) / top10Rates.length;

            // ì¸ì‚¬ì´íŠ¸ í…ìŠ¤íŠ¸ ìƒì„±
            let insightHTML = '';

            // ì „ì²´ ìƒí™© ìš”ì•½
            insightHTML += `ì „ì²´ ì±„ë„ì˜ í‰ê·  ì°¸ì—¬ë„ëŠ” <strong style="color: #9c27b0;">${avgEngagement.toFixed(1)}%</strong>ì…ë‹ˆë‹¤. `;

            if (avgEngagement >= 60) {
                insightHTML += `<strong style="color: var(--success-main);">ë§¤ìš° ìš°ìˆ˜í•œ</strong> ìˆ˜ì¤€ì…ë‹ˆë‹¤! `;
            } else if (avgEngagement >= 40) {
                insightHTML += `í‰ê· ì ì¸ ìˆ˜ì¤€ì´ë©° ê°œì„  ì—¬ì§€ê°€ ìˆìŠµë‹ˆë‹¤. `;
            } else {
                insightHTML += `<strong style="color: var(--error-main);">ì£¼ì˜ê°€ í•„ìš”í•œ</strong> ìˆ˜ì¤€ì…ë‹ˆë‹¤. `;
            }

            // ìµœê³ /ìµœì € ì±„ë„ ì •ë³´
            insightHTML += `<br>ê°€ì¥ ë†’ì€ ì°¸ì—¬ë„ëŠ” <strong>${highest['channel']}</strong> (${parseFloat(highest['Engagement rate']).toFixed(1)}%)ì´ê³ , `;
            insightHTML += `ê°€ì¥ ë‚®ì€ ì°¸ì—¬ë„ëŠ” <strong>${lowest['channel']}</strong> (${parseFloat(lowest['Engagement rate']).toFixed(1)}%)ì…ë‹ˆë‹¤. `;

            // ë²”ìœ„ë³„ ë¶„í¬
            insightHTML += `<br><br><strong style="color: var(--primary-main);">ğŸ“Š ì±„ë„ ë¶„í¬:</strong> `;
            if (highEngagement.length > 0) {
                insightHTML += `<strong style="color: var(--success-main);">${highEngagement.length}ê°œ ì±„ë„</strong>ì´ ìš°ìˆ˜(60% ì´ìƒ), `;
            }
            if (mediumEngagement.length > 0) {
                insightHTML += `<strong style="color: #ff9800;">${mediumEngagement.length}ê°œ ì±„ë„</strong>ì´ ë³´í†µ(40-60%), `;
            }
            if (lowEngagement.length > 0) {
                insightHTML += `<strong style="color: var(--error-main);">${lowEngagement.length}ê°œ ì±„ë„</strong>ì´ ì €ì¡°(40% ë¯¸ë§Œ)ì…ë‹ˆë‹¤. `;
            }

            // í•µì‹¬ ì¶”ì²œì‚¬í•­
            insightHTML += `<br><br><strong style="color: var(--primary-main);">ğŸ’¡ í•µì‹¬ ì „ëµ:</strong> `;

            if (highEngagement.length >= allData.length * 0.3) {
                // 30% ì´ìƒì´ ê³ ì°¸ì—¬ë„
                insightHTML += `ìš°ìˆ˜í•œ ì±„ë„ì´ ë§ìŠµë‹ˆë‹¤! ì´ë“¤ ì±„ë„ì˜ ê³µí†µì ì„ ë¶„ì„í•˜ì—¬ ë‹¤ë¥¸ ì±„ë„ì—ë„ ì ìš©í•˜ì„¸ìš”. `;
                insightHTML += `íŠ¹íˆ <strong>${highest['channel']}</strong>ì˜ ì„±ê³µ ìš”ì¸ì„ ìì„¸íˆ ì—°êµ¬í•˜ì„¸ìš”.`;
            } else if (lowEngagement.length >= allData.length * 0.3) {
                // 30% ì´ìƒì´ ì €ì°¸ì—¬ë„
                insightHTML += `ì°¸ì—¬ë„ê°€ ë‚®ì€ ì±„ë„ì´ ë§ìŠµë‹ˆë‹¤. <strong>ì¦‰ì‹œ ê´‘ê³  íƒ€ê²ŸíŒ…ê³¼ ëœë”© í˜ì´ì§€ë¥¼ ì¬ê²€í† </strong>í•˜ì„¸ìš”. `;
                insightHTML += `ì €ì°¸ì—¬ë„ ì±„ë„ì˜ ì˜ˆì‚°ì„ ê³ ì°¸ì—¬ë„ ì±„ë„ë¡œ ì¬ë°°ë¶„í•˜ëŠ” ê²ƒì„ ê³ ë ¤í•˜ì„¸ìš”.`;
            } else {
                // ì¤‘ê°„ ìˆ˜ì¤€ ë§ìŒ
                insightHTML += `ëŒ€ë¶€ë¶„ ì±„ë„ì´ ê°œì„  ê°€ëŠ¥í•œ ìƒíƒœì…ë‹ˆë‹¤. `;
                insightHTML += `<strong>A/B í…ŒìŠ¤íŠ¸ë¥¼ í†µí•´ ëœë”© í˜ì´ì§€ë¥¼ ìµœì í™”</strong>í•˜ê³ , íƒ€ê²Ÿ ì˜¤ë””ì–¸ìŠ¤ë¥¼ ì„¸ë¶„í™”í•˜ì—¬ ì°¸ì—¬ë„ë¥¼ ë†’ì´ì„¸ìš”.`;
            }

            // êµ¬ì²´ì  ì˜ˆì‹œ
            if (top10Avg - avgEngagement > 10) {
                insightHTML += `<br><br><strong>âš ï¸ ì£¼ì˜:</strong> ìƒìœ„ 10ê°œ ì±„ë„ì˜ í‰ê·  ì°¸ì—¬ë„(${top10Avg.toFixed(1)}%)ê°€ ì „ì²´ í‰ê· ë³´ë‹¤ ${(top10Avg - avgEngagement).toFixed(1)}%p ë†’ìŠµë‹ˆë‹¤. `;
                insightHTML += `ë‚˜ë¨¸ì§€ ì±„ë„ë“¤ì˜ í’ˆì§ˆì´ ë‚®ìœ¼ë¯€ë¡œ, ì €ì„±ê³¼ ì±„ë„ì„ ì •ë¦¬í•˜ê±°ë‚˜ ê°œì„ í•˜ëŠ” ê²ƒì´ ì‹œê¸‰í•©ë‹ˆë‹¤.`;
            }

            // ì¸ì‚¬ì´íŠ¸ í‘œì‹œ
            const insightElement = document.getElementById('engagementInsightText');
            if (insightElement) {
                insightElement.innerHTML = insightHTML;
            }
        }

        // 4. ì±„ë„ë³„ ì°¸ì—¬ë„ ë¶„ì„ ì°¨íŠ¸
        function updateChannelEngagementChart() {
            if (channelEngagementData.length === 0) return;

            const canvas = document.getElementById('channelEngagementChart');
            if (!canvas) return;

            // ì°¸ì—¬ìœ¨ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬
            const sortedData = [...channelEngagementData].sort((a, b) => {
                return parseFloat(b['Engagement rate']) - parseFloat(a['Engagement rate']);
            });

            // ìƒìœ„ 10ê°œ ì±„ë„ë§Œ í‘œì‹œ
            const top10 = sortedData.slice(0, 10);

            const labels = top10.map(row => row['channel']);
            const engagementRates = top10.map(row => parseFloat(row['Engagement rate']) || 0);

            // ì°¸ì—¬ë„ ì¸ì‚¬ì´íŠ¸ ë¶„ì„ ë° í‘œì‹œ
            analyzeEngagementRates(sortedData, top10, engagementRates);

            // ìƒ‰ìƒ ê·¸ë¼ë°ì´ì…˜ (ë†’ì„ìˆ˜ë¡ ì§„í•œ ìƒ‰)
            const colors = engagementRates.map(rate => {
                const intensity = Math.min(rate / 100, 1);
                return `rgba(103, 58, 183, ${0.3 + intensity * 0.5})`;
            });

            if (channelEngagementChart) {
                channelEngagementChart.destroy();
            }

            channelEngagementChart = new Chart(canvas, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ì°¸ì—¬ìœ¨ (%)',
                        data: engagementRates,
                        backgroundColor: colors,
                        borderColor: '#673ab7',
                        borderWidth: 2
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `ì°¸ì—¬ìœ¨: ${context.parsed.x.toFixed(2)}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });

            // ì°¸ì—¬ë„ ì°¨íŠ¸ ì¸ì‚¬ì´íŠ¸ íˆ´íŒ ì„¤ì •
            setupEngagementChartTooltip();
        }

        // ì°¸ì—¬ë„ ì°¨íŠ¸ ì¸ì‚¬ì´íŠ¸ ìƒì„±
        function generateEngagementInsight() {
            return {
                insight: 'ì°¸ì—¬ë„ëŠ” ì±„ë„ì˜ í’ˆì§ˆì„ í‰ê°€í•˜ëŠ” ê°€ì¥ ì¤‘ìš”í•œ ì§€í‘œì…ë‹ˆë‹¤. ë†’ì€ ì°¸ì—¬ë„ëŠ” íƒ€ê²ŸíŒ…ì´ ì •í™•í•˜ê³  ëœë”© í˜ì´ì§€ê°€ ë§¤ë ¥ì ì´ë¼ëŠ” ëœ»ì´ë©°, ì „í™˜ìœ¨ í–¥ìƒìœ¼ë¡œ ì´ì–´ì§‘ë‹ˆë‹¤.',
                recommendation: 'ì°¸ì—¬ë„ ìƒìœ„ ì±„ë„ì— ì˜ˆì‚°ì„ ì§‘ì¤‘í•˜ì„¸ìš”. ì°¸ì—¬ë„ 60% ì´ìƒì€ ìš°ìˆ˜, 40-60%ëŠ” ë³´í†µ, 40% ë¯¸ë§Œì€ ê°œì„  í•„ìš”ì…ë‹ˆë‹¤. ì°¸ì—¬ë„ê°€ ë‚®ì€ ì±„ë„ì€ ê´‘ê³  íƒ€ê²ŸíŒ…ê³¼ ëœë”© í˜ì´ì§€ë¥¼ ì¦‰ì‹œ ì¬ê²€í† í•˜ê±°ë‚˜ ì˜ˆì‚°ì„ ì¤„ì´ëŠ” ê²ƒì„ ê³ ë ¤í•˜ì„¸ìš”.'
            };
        }

        // ì°¸ì—¬ë„ ì°¨íŠ¸ íˆ´íŒ ì„¤ì •
        function setupEngagementChartTooltip() {
            const canvas = document.getElementById('channelEngagementChart');
            const container = canvas ? canvas.parentElement : null;
            if (!container) return;

            if (!container.dataset.tooltipSetup) {
                container.dataset.tooltipSetup = 'true';

                container.addEventListener('mouseenter', function(event) {
                    const insight = generateEngagementInsight();
                    showChartInsightTooltip('churnChartTooltip', insight.insight, insight.recommendation, event);
                });

                container.addEventListener('mousemove', function(event) {
                    const tooltip = document.getElementById('churnChartTooltip');
                    if (tooltip && tooltip.classList.contains('show')) {
                        tooltip.style.left = (event.clientX + 15) + 'px';
                        tooltip.style.top = (event.clientY + 15) + 'px';
                    }
                });

                container.addEventListener('mouseleave', function() {
                    hideChartInsightTooltip('churnChartTooltip');
                });
            }
        }

        // ========================================
        // íƒ­ ì „í™˜ ê¸°ëŠ¥
        // ========================================

        function initTabSwitching() {
            // 1. ë°ì´í„° ê¸°ë°˜ ì˜ì‚¬ê²°ì • ë„êµ¬ íƒ­
            document.querySelectorAll('.decision-tool-tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.decision-tool-tab-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');

                    const targetTab = this.dataset.tab;
                    document.querySelectorAll('.decision-tool-tab-content').forEach(content => {
                        content.style.display = 'none';
                        content.classList.remove('active');
                    });

                    let selectedTab = null;
                    if (targetTab === 'summary') selectedTab = document.getElementById('summaryTab');
                    else if (targetTab === 'urgent') selectedTab = document.getElementById('urgentTab');
                    else if (targetTab === 'clustering') selectedTab = document.getElementById('clusteringTab');
                    else if (targetTab === 'budget') selectedTab = document.getElementById('budgetTab');
                    else if (targetTab === 'crm_guide') selectedTab = document.getElementById('crmGuideTab');

                    if (selectedTab) {
                        selectedTab.style.display = 'block';
                        selectedTab.classList.add('active');
                    }
                });
            });

            // 2. ì±„ë„ë³„ ë¶„ì„ íƒ­
            document.querySelectorAll('.channel-analysis-tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.channel-analysis-tab-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');

                    const targetTab = this.dataset.tab;
                    document.querySelectorAll('.channel-analysis-tab-content').forEach(content => {
                        content.style.display = 'none';
                        content.classList.remove('active');
                    });

                    let selectedTab = null;
                    if (targetTab === 'table') selectedTab = document.getElementById('tableTab');
                    else if (targetTab === 'kpi') selectedTab = document.getElementById('kpiTab');
                    else if (targetTab === 'balance') selectedTab = document.getElementById('balanceTab');
                    else if (targetTab === 'top10') selectedTab = document.getElementById('top10Tab');

                    if (selectedTab) {
                        selectedTab.style.display = 'block';
                        selectedTab.classList.add('active');
                    }
                });
            });

            // 3. ê³ ê° ì¬ë°©ë¬¸ ë° ì´íƒˆ ë¶„ì„ íƒ­
            document.querySelectorAll('.customer-analysis-tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.customer-analysis-tab-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');

                    const targetTab = this.dataset.tab;
                    document.querySelectorAll('.customer-analysis-tab-content').forEach(content => {
                        content.style.display = 'none';
                        content.classList.remove('active');
                    });

                    let selectedTab = null;
                    if (targetTab === 'trend') selectedTab = document.getElementById('trendTab');
                    else if (targetTab === 'conversion') selectedTab = document.getElementById('conversionTab');
                    else if (targetTab === 'churn') selectedTab = document.getElementById('churnTab');
                    else if (targetTab === 'matrix') selectedTab = document.getElementById('matrixTab');
                    else if (targetTab === 'engagement') selectedTab = document.getElementById('engagementTab');

                    if (selectedTab) {
                        selectedTab.style.display = 'block';
                        selectedTab.classList.add('active');
                    }
                });
            });
        }

        // ========================================
        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë° ì´ˆê¸°í™”
        // ========================================

        document.addEventListener('DOMContentLoaded', function() {
            checkIframeAndHideSidebar();

            // í…Œì´ë¸” ì •ë ¬ ê¸°ëŠ¥ ì´ˆê¸°í™”
            setupTableSorting();

            // íƒ­ ì „í™˜ ê¸°ëŠ¥ ì´ˆê¸°í™”
            initTabSwitching();

            // í˜ì´ì§€ ë¡œë“œ í›„ 2ì´ˆ ë’¤ ë²„íŠ¼ ìƒíƒœ í™•ì¸
            setTimeout(() => {
                checkButtonStates();
            }, 2000);
        });

        // ì´ˆê¸° ë°ì´í„° ë¡œë“œ
        loadData();

        // iframe ì²´í¬ (DOMContentLoaded ì´ì „ì—ë„ ì‹¤í–‰)
        checkIframeAndHideSidebar();
    </script>
</body>
</html>
