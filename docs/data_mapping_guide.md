# 데이터 매핑 가이드

마케팅 데이터 분석 시 사용되는 성별, 연령 등 차원 데이터의 통합 매핑 규칙을 정의합니다.

---

## 1. 성별 (Gender) 매핑

### 1.1 매핑 테이블

| 통합값 | 매핑 대상 | 비고 |
|--------|----------|------|
| **남성** | `남성`, `남자`, `MALE`, `male` | 한글/영문 대소문자 통합 |
| **여성** | `여성`, `여자`, `FEMALE`, `female` | 한글/영문 대소문자 통합 |
| **알 수 없음** | `알 수 없음`, `UNDETERMINED` | 미식별 데이터 |

### 1.2 코드 예시

```python
gender_map = {
    # 남성 통합
    'MALE': '남성',
    'male': '남성',
    '남자': '남성',
    # 여성 통합
    'FEMALE': '여성',
    'female': '여성',
    '여자': '여성',
    # 알 수 없음 통합
    'UNDETERMINED': '알 수 없음'
}

df['성별_통합'] = df['성별'].replace(gender_map)
```

### 1.3 적용 파일
- `scripts/multi_analysis_prophet_forecast.py` (8. 성별 다중 지표 예측 섹션)

---

## 2. 연령 (Age) 매핑

### 2.1 매핑 테이블

| 통합값 | 매핑 대상 | 비고 |
|--------|----------|------|
| **14세 미만** | `14세 미만` | 변경 없음 |
| **14세 ~ 18세** | `14세 ~ 18세` | 변경 없음 |
| **19세 ~ 24세** | `19세 ~ 24세`, `AGE_RANGE_18_24` | 영문 코드 통합 |
| **25세 ~ 34세** | `25세 ~ 29세`, `30세 ~ 34세`, `AGE_RANGE_25_34` | 10세 단위 통합 |
| **35세 ~ 44세** | `35세 ~ 39세`, `40세 ~ 44세`, `AGE_RANGE_35_44` | 10세 단위 통합 |
| **45세 ~ 54세** | `45세 ~ 49세`, `50세 ~ 54세`, `AGE_RANGE_45_54` | 10세 단위 통합 |
| **55세 ~ 64세** | `55세 ~ 59세`, `AGE_RANGE_55_64` | 10세 단위 통합 |
| **65세 이상** | `60세 ~ 99세`, `AGE_RANGE_65_UP` | 고연령대 통합 |
| **알 수 없음** | `알 수 없음`, `AGE_RANGE_UNDETERMINED` | 미식별 데이터 |

### 2.2 코드 예시

```python
age_map = {
    # 영문 → 한글 변환
    'AGE_RANGE_18_24': '19세 ~ 24세',
    'AGE_RANGE_25_34': '25세 ~ 34세',
    'AGE_RANGE_35_44': '35세 ~ 44세',
    'AGE_RANGE_45_54': '45세 ~ 54세',
    'AGE_RANGE_55_64': '55세 ~ 64세',
    'AGE_RANGE_65_UP': '65세 이상',
    'AGE_RANGE_UNDETERMINED': '알 수 없음',
    # 한글 세부 연령대 → 10세 단위 통합
    '25세 ~ 29세': '25세 ~ 34세',
    '30세 ~ 34세': '25세 ~ 34세',
    '35세 ~ 39세': '35세 ~ 44세',
    '40세 ~ 44세': '35세 ~ 44세',
    '45세 ~ 49세': '45세 ~ 54세',
    '50세 ~ 54세': '45세 ~ 54세',
    '55세 ~ 59세': '55세 ~ 64세',
    '60세 ~ 99세': '65세 이상'
}

df['연령_통합'] = df['연령'].replace(age_map)
```

### 2.3 적용 파일
- `scripts/multi_analysis_prophet_forecast.py` (9. 연령별 다중 지표 예측 섹션)

---

## 3. 매핑 적용 효과

### 3.1 데이터 통합 전후 비교

| 차원 | 통합 전 | 통합 후 | 개선 효과 |
|------|--------|--------|----------|
| 성별 (남성) | 27일 + 31일 (분리) | 58일 (통합) | 학습 데이터 2배 증가 |
| 성별 (여성) | 27일 + 31일 (분리) | 58일 (통합) | 학습 데이터 2배 증가 |
| 연령 (25~34세) | 27일 + 31일 (분리) | 58일 (통합) | 학습 데이터 2배 증가 |

### 3.2 Prophet 예측 정확도 향상
- 학습 데이터 증가로 시계열 패턴 학습 개선
- 주간 계절성 더 정확하게 반영
- 결측치(NaN) 발생 감소

---

## 4. 데이터 소스별 형식

### 4.1 플랫폼별 데이터 형식

| 플랫폼 | 성별 형식 | 연령 형식 |
|--------|----------|----------|
| **메타 (Facebook/Instagram)** | `남성`, `여성`, `알 수 없음` | `19세 ~ 24세`, `25세 ~ 29세` 등 (한글) |
| **구글 (Google Ads)** | `MALE`, `FEMALE`, `UNDETERMINED` | `AGE_RANGE_18_24`, `AGE_RANGE_25_34` 등 (영문) |
| **네이버** | `남자`, `여자` | - |

### 4.2 통합 필요성
- 여러 플랫폼 데이터를 통합 분석할 때 동일한 기준으로 집계 필요
- Prophet 예측 시 충분한 학습 데이터 확보

---

## 5. 주의사항

### 5.1 매핑 순서
```python
# 올바른 순서: 영문 먼저, 한글 세부 연령대 나중에
df['연령_통합'] = df['연령'].replace(age_map)
```

### 5.2 원본 데이터 보존
```python
# 통합 전 원본 컬럼 유지
df['성별_원본'] = df['성별']
df['성별_통합'] = df['성별'].replace(gender_map)
```

### 5.3 새로운 값 발생 시
- 매핑되지 않은 새 값은 그대로 유지됨
- 정기적으로 미매핑 값 확인 필요:
```python
unmapped = df[~df['성별'].isin(gender_map.keys()) & (df['성별'] != '-')]['성별'].unique()
print(f"미매핑 성별 값: {unmapped}")
```

---

## 6. 변경 이력

| 날짜 | 버전 | 변경 내용 |
|------|------|----------|
| 2025-11-25 | v1.0 | 최초 작성 - 성별/연령 매핑 규칙 정의 |

---

## 7. 관련 파일

| 파일 경로 | 설명 |
|----------|------|
| `scripts/multi_analysis_prophet_forecast.py` | Prophet 시계열 예측 (매핑 적용) |
| `scripts/segment_processor.py` | 세그먼트 처리 모듈 |
| `scripts/process_marketing_data.py` | 마케팅 데이터 처리 |
| `data/type/prophet_forecast_by_gender.csv` | 성별별 예측 결과 |
| `data/type/prophet_forecast_by_age.csv` | 연령별 예측 결과 |
