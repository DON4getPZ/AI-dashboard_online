# Funnel Insight Script Upgrade Guide (`generate_funnel_data.py`)

> **ëª©ì :** ë…ë¦½ì ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” í¼ë„ ë¶„ì„ ìŠ¤í¬ë¦½íŠ¸(`generate_funnel_data.py`)ì˜ ì¸ì‚¬ì´íŠ¸ ìƒì„± ë¡œì§ì„ ê³ ë„í™”í•©ë‹ˆë‹¤.
> **í•µì‹¬:** ì •ì  ì„ê³„ê°’ ëŒ€ì‹  **ë™ì  ìƒëŒ€ í‰ê°€(Quantile)**ì™€ **ì±„ë„ ì¹´í…Œê³ ë¦¬(Context)**ë¥¼ ê²°í•©í•˜ì—¬ ì „ë¬¸ì ì¸ ë§ˆì¼€íŒ… ì§„ë‹¨ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

---

## 1. í•µì‹¬ ê°œì„  ë°©í–¥

| êµ¬ë¶„ | ê¸°ì¡´ (Legacy) | ë³€ê²½ (Advanced) |
| :--- | :--- | :--- |
| **íŒë‹¨ ê¸°ì¤€** | ì ˆëŒ€ í‰ê°€ (ì˜ˆ: ì „í™˜ìœ¨ < 50%) | **ìƒëŒ€ í‰ê°€** (ì˜ˆ: íŠ¸ë˜í”½ ìƒìœ„ 20%, RPV í•˜ìœ„ 40%) |
| **í‰ê°€ ì§€í‘œ** | ìœ ì…, ì „í™˜ìœ¨ | ìœ ì…, ì „í™˜ìœ¨ + **RPV(ë°©ë¬¸ë‹¹ ê°€ì¹˜), ë§¤ì¶œ ê¸°ì—¬ë„** |
| **ì§„ë‹¨ ê¹Šì´** | ë‹¨ìˆœ ê²½ê³  (Bad/Good) | **ë§ˆì´í¬ë¡œ ì„¸ê·¸ë¨¼íŠ¸** (ì˜ˆ: ëˆ ë‚­ë¹„í˜•, íƒ€ê²Ÿ ë¯¸ìŠ¤í˜•, VIPí˜•) |
| **ì•¡ì…˜ ì œì•ˆ** | ì¼ë°˜ì  ì¡°ì–¸ | **ì¹´í…Œê³ ë¦¬ë³„ ì „ë¬¸ ì²˜ë°©** (SA, DA, SNS, CRM, PR, Organic) |
| **ë°ì´í„° ì²˜ë¦¬** | ë¬¸ìì—´ ë§¤ì¹­ ë¡œì§ í˜¼ì¬ | **ì „ì²˜ë¦¬ëœ `category` ì»¬ëŸ¼ í™œìš© (ë¶€í•˜ ìµœì†Œí™”)** |

---

## 2. ë‚´ë¶€ ì§€í‘œ ì •ì˜ (Internal Metrics)

DB ì˜ì¡´ì„± ì—†ì´ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì‹œì ì— `df` ë‚´ë¶€ì—ì„œ ê³„ì‚°í•˜ì—¬ íŒë‹¨ ê·¼ê±°ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.

### 2.1 íŒŒìƒ ì§€í‘œ
1.  **RPV (Revenue Per Visitor):** `Revenue / Acquisition`
    * ëª©ì : ì „í™˜ìœ¨ì€ ë‚®ì§€ë§Œ ê°ë‹¨ê°€ê°€ ë†’ì€ **'VIP ì±„ë„'**ì„ ì˜¤íŒ(Dogë¡œ ë¶„ë¥˜)í•˜ì§€ ì•Šê¸° ìœ„í•¨.
2.  **Log RPV Score:** `np.log1p(RPV)`
    * ëª©ì : ë§¤ì¶œ ë°ì´í„°ì˜ ê·¹ë‹¨ì  í¸ì°¨(Skewness)ë¥¼ ë³´ì •í•˜ì—¬ ì±„ë„ ê°„ ê³µì •í•œ ë¹„êµ ìˆ˜í–‰.
3.  **Traffic Rank:** `df['acquisition'].rank(pct=True)`
    * ëª©ì : í•´ë‹¹ ì±„ë„ì˜ íŠ¸ë˜í”½ì´ ì „ì²´ ì¤‘ ìƒìœ„ ëª‡ %ì¸ì§€ íŒë‹¨.

### 2.2 ë™ì  ì„ê³„ê°’ (Dynamic Thresholds)
ì „ì²´ ì±„ë„ ë°ì´í„°ë¥¼ ê¸°ì¤€ìœ¼ë¡œ 'ë§ë‹¤/ì ë‹¤', 'ë†’ë‹¤/ë‚®ë‹¤'ì˜ ê¸°ì¤€ì„ ì„ ë™ì ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.

* `traffic_high`: ìœ ì…ëŸ‰ ìƒìœ„ 20% (Quantile 0.8)
* `traffic_low`: ìœ ì…ëŸ‰ í•˜ìœ„ 50% (Quantile 0.5)
* `rpv_high`: RPV ìƒìœ„ 20% (Quantile 0.8)
* `rpv_low`: RPV í•˜ìœ„ 40% (Quantile 0.4)

---

## 3. ì¹´í…Œê³ ë¦¬ë³„ ë§ì¶¤ ì²˜ë°© (Category Advice Map)

ì „ì²˜ë¦¬ ë‹¨ê³„ì—ì„œ ìƒì„±ëœ `category` ì»¬ëŸ¼(6ê°œ ìœ í˜•)ì„ í™œìš©í•˜ì—¬ ì „ë¬¸ì ì¸ ì•¡ì…˜ ì•„ì´í…œì„ ì œê³µí•©ë‹ˆë‹¤.

| Category | Activation Issue (ìœ ì… ë‹¨ê³„) | Conversion Issue (êµ¬ë§¤ ë‹¨ê³„) |
| :--- | :--- | :--- |
| **SA** (ê²€ìƒ‰) | í‚¤ì›Œë“œ ì˜ë„(Intent)ì™€ ëœë”©í˜ì´ì§€ ë¶ˆì¼ì¹˜ | ìƒì„¸í˜ì´ì§€ ìƒë‹¨ì— 'ê²½ìŸì‚¬ ë¹„êµ ìš°ìœ„í‘œ' ë°°ì¹˜ |
| **DA** (ë°°ë„ˆ) | Fat Finger(ì˜¤í´ë¦­) ë˜ëŠ” ì €í’ˆì§ˆ ì§€ë©´ ë…¸ì¶œ | ë¦¬íƒ€ê²ŸíŒ… ì‹œ Burn Pixel(êµ¬ë§¤ì ì œì™¸) ì ìš© í™•ì¸ |
| **SNS** (ì†Œì…œ) | ê´‘ê³  ì†Œì¬(Clickbait)ì™€ ëœë”©í˜ì´ì§€ í†¤ì•¤ë§¤ë„ˆ ë¶ˆì¼ì¹˜ | ê¸´ê¸‰ì„±(Urgency) íŠ¸ë¦¬ê±°(í•œì •ìˆ˜ëŸ‰, ë§ˆê°ì„ë°•) í™œìš© |
| **CRM** (ê³ ê°) | ë©”ì‹œì§€ ì œëª©ì˜ ì•½ì†ê³¼ ë³¸ë¬¸ í˜œíƒ ë¶ˆì¼ì¹˜ | ì‹ ê·œ í˜œíƒ ëŒ€ì‹  'ì¬êµ¬ë§¤/ë“±ê¸‰ë³„ í˜œíƒ' ì œì•ˆ |
| **PR** (í™ë³´) | ê¸°ì‚¬/ì´ìŠˆ ë‚´ìš©ê³¼ ì—°ê²°ëœ ì „ìš© ëœë”©í˜ì´ì§€ ë¶€ì¬ | ì–¸ë¡  ë³´ë„ ë‚´ìš© ë° ê³µì‹ ì‹ ë¢° ë§ˆí¬(Trustmark) ê°•ì¡° |
| **Organic** | í˜ì´ì§€ ë¡œë”© ì†ë„ ì €í•˜ ë˜ëŠ” ëª¨ë°”ì¼ UX ë¬¸ì œ | íšŒì›ê°€ì… ì ˆì°¨ ê°„ì†Œí™” (ì†Œì…œ ë¡œê·¸ì¸ ìƒë‹¨ ë°°ì¹˜) |

---

## 4. ë§ˆì´í¬ë¡œ ì„¸ê·¸ë¨¼í…Œì´ì…˜ ë¡œì§ (Micro-Segmentation)

ë°ì´í„°ë¥¼ 4ê°€ì§€ ì„¸ë¶€ ìœ í˜•ìœ¼ë¡œ ë¶„ë¥˜í•˜ì—¬ Alertì„ ìƒì„±í•©ë‹ˆë‹¤.

### â‘  Hidden VIP (ìˆ¨ì€ í°ì†)
* **ì¡°ê±´:** `ì „í™˜ìœ¨ < 1.0%` (ë‚®ìŒ) **AND** `RPV >= ìƒìœ„ 20%` (ë†’ìŒ)
* **ì§„ë‹¨:** ì „í™˜ì€ ë“œë¬¼ì§€ë§Œ, í•œ ë²ˆ êµ¬ë§¤ ì‹œ ê°ë‹¨ê°€ê°€ ë§¤ìš° ë†’ì€ ì±„ë„.
* **Severity:** **Opportunity** (Blue/Green)

### â‘¡ Traffic Waste (ë°‘ ë¹ ì§„ ë…)
* **ì¡°ê±´:** `íŠ¸ë˜í”½ >= ìƒìœ„ 20%` (ë§ìŒ) **AND** `í™œë™ ì „í™˜ìœ¨ < 40%` (ë‚®ìŒ) **AND** `RPV < í•˜ìœ„ 40%` (ë‚®ìŒ)
* **ì§„ë‹¨:** ì‚¬ëŒë§Œ ë§ì´ ì˜¤ê³  ì‹¤ì†ì´ ì—†ìŒ. ì˜ˆì‚° ëˆ„ìˆ˜ì˜ ì£¼ë²”.
* **Severity:** **High** (Red)

### â‘¢ Checkout Friction (ê²°ì œ ì¥ë²½)
* **ì¡°ê±´:** `ì¥ë°”êµ¬ë‹ˆ ìœ ì € > 50ëª…` **AND** `ì¥ë°”êµ¬ë‹ˆâ†’êµ¬ë§¤ ì „í™˜ìœ¨ < 10%`
* **ì§„ë‹¨:** êµ¬ë§¤ ì˜ì‚¬ëŠ” ìˆìœ¼ë‚˜ ê²°ì œ ê³¼ì •ì—ì„œ ì´íƒˆ. (ê¸°ìˆ ì  ì˜¤ë¥˜ ê°€ëŠ¥ì„± í¬í•¨)
* **Severity:** **Critical** (Flash Red)

### â‘£ Rising Star (ì„±ì¥ ì—”ì§„)
* **ì¡°ê±´:** `íŠ¸ë˜í”½ < í•˜ìœ„ 50%` (ì ìŒ) **AND** `í™œë™ ì „í™˜ìœ¨ > 70%` (ë§¤ìš° ë†’ìŒ)
* **ì§„ë‹¨:** ê·œëª¨ëŠ” ì‘ì§€ë§Œ ë°˜ì‘ë¥ ì´ ì••ë„ì ì„. ì˜ˆì‚° ì¦ì•¡ ì‹œ ê³ ì„±ì¥ ì˜ˆìƒ.
* **Severity:** **Opportunity** (Green)

---

## 5. êµ¬í˜„ ì½”ë“œ (generate_funnel_data.py)

```python
import pandas as pd
import numpy as np

class FunnelInsightGenerator:
    def __init__(self):
        pass

    def _calculate_internal_metrics(self, df):
        """
        [ì§€í‘œ ê³„ì‚°] RPV, Log Score, Traffic Rank ë“± íŒŒìƒ ë³€ìˆ˜ ìƒì„±
        """
        # RPV (Revenue Per Visitor) ê³„ì‚° (ZeroDivision ë°©ì§€)
        df['rpv'] = df.apply(
            lambda x: x['revenue'] / x['acquisition'] if x['acquisition'] > 0 else 0, 
            axis=1
        )
        
        # Log RPV ê³„ì‚° (ì™œë„ ë³´ì •, ë‚´ë¶€ íŒë‹¨ìš©)
        df['rpv_log'] = np.log1p(df['rpv'])
        
        return df

    def _get_dynamic_thresholds(self, df):
        """
        [ë™ì  ì„ê³„ê°’] í˜„ì¬ ë°ì´í„°ì…‹ì˜ ë¶„í¬(Quantile)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê¸°ì¤€ì„  ì„¤ì •
        """
        return {
            'traffic_high': df['acquisition'].quantile(0.8), # ìƒìœ„ 20% íŠ¸ë˜í”½
            'traffic_low': df['acquisition'].quantile(0.5),  # í•˜ìœ„ 50% íŠ¸ë˜í”½
            'rpv_high': df['rpv'].quantile(0.8),             # ìƒìœ„ 20% ì•Œì§œ ì±„ë„
            'rpv_low': df['rpv'].quantile(0.4)               # í•˜ìœ„ 40% ì €íš¨ìœ¨ ì±„ë„
        }

    def _get_category_advice(self, category, issue_type):
        """
        [ì „ë¬¸ê°€ ì§„ë‹¨] Categoryë³„ ë§ì¶¤ ì•¡ì…˜ ê°€ì´ë“œ ë°˜í™˜ (O(1) Lookup)
        """
        advice_map = {
            'SA': {
                'activation': "ê²€ìƒ‰ í‚¤ì›Œë“œì˜ 'ì˜ë„(Intent)'ì™€ ëœë”©í˜ì´ì§€ ë‚´ìš©ì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. T&D(Title & Description)ë¥¼ ì ê²€í•˜ì„¸ìš”.",
                'conversion': "ê°€ê²© ë¹„êµ ì¤‘ì¸ ê³ ê´€ì—¬ ìœ ì €ì…ë‹ˆë‹¤. ìƒë‹¨ì— 'ê²½ìŸì‚¬ ëŒ€ë¹„ ê°•ì  ë¹„êµí‘œ'ë¥¼ ë°°ì¹˜í•˜ì„¸ìš”."
            },
            'DA': {
                'activation': "Fat Finger(ì˜¤í´ë¦­) ë¹„ìœ¨ì´ ë†’ê±°ë‚˜ ê²Œì¬ ì§€ë©´ í’ˆì§ˆì´ ë‚®ìŠµë‹ˆë‹¤. ì•±/ê²Œì„ ë“± ì €íš¨ìœ¨ ì§€ë©´ì„ ì œì™¸í•˜ì„¸ìš”.",
                'conversion': "ì´ë¯¸ êµ¬ë§¤í•œ ìƒí’ˆì´ ë…¸ì¶œë˜ê³  ìˆìŠµë‹ˆë‹¤. ë¦¬íƒ€ê²ŸíŒ… ëª¨ìˆ˜ì— Burn Pixel(êµ¬ë§¤ì ì œì™¸)ì„ ì ìš©í•˜ì„¸ìš”."
            },
            'SNS': {
                'activation': "ê´‘ê³  ì†Œì¬(Hook)ì™€ ëœë”©í˜ì´ì§€(Body)ì˜ í†¤ì•¤ë§¤ë„ˆê°€ ë‹¤ë¦…ë‹ˆë‹¤. ë‚šì‹œì„± ì†Œì¬ ì—¬ë¶€ë¥¼ ì ê²€í•˜ì„¸ìš”.",
                'conversion': "ì¶©ë™ êµ¬ë§¤ ì„±í–¥ì´ ê°•í•©ë‹ˆë‹¤. 'ë§ˆê° ì„ë°•', 'í•œì • ìˆ˜ëŸ‰' ë“± ê¸´ê¸‰ì„±(Urgency) íŠ¸ë¦¬ê±°ë¥¼ í™œìš©í•˜ì„¸ìš”."
            },
            'CRM': {
                'activation': "ë©”ì‹œì§€ ì œëª©(Title)ì˜ ì•½ì†ì´ ë³¸ë¬¸ì—ì„œ ì§€ì¼œì§€ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. í˜œíƒì„ ì²« í™”ë©´ì— ì¦‰ì‹œ ë…¸ì¶œí•˜ì„¸ìš”.",
                'conversion': "ê¸°ì¡´ ê³ ê°ì…ë‹ˆë‹¤. ì‹ ê·œ ê°€ì… í˜œíƒë³´ë‹¤ëŠ” 'ë“±ê¸‰ë³„ í˜œíƒ'ì´ë‚˜ 'ì¬êµ¬ë§¤ í• ì¸'ì„ ì œì•ˆí•˜ì„¸ìš”."
            },
            'PR': {
                'activation': "ê¸°ì‚¬/ì½˜í…ì¸  ë‚´ìš©ì„ ê¸°ëŒ€í•˜ê³  ì™”ìœ¼ë‚˜ ì •ë³´ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. í•´ë‹¹ ì´ìŠˆ ì „ìš© ëœë”©í˜ì´ì§€ë¥¼ ì—°ê²°í•˜ì„¸ìš”.",
                'conversion': "ì‹ ë¢° ê¸°ë°˜ ìœ ì…ì…ë‹ˆë‹¤. ì–¸ë¡  ë³´ë„ ë‚´ìš©ì´ë‚˜ ê³µì‹ ì¸ì¦ ë§ˆí¬(Trustmark)ë¥¼ ê°•ì¡°í•˜ì„¸ìš”."
            },
            'Organic': {
                'activation': "í˜ì´ì§€ ë¡œë”© ì†ë„ê°€ ëŠë¦¬ê±°ë‚˜ ëª¨ë°”ì¼ ê°€ë…ì„±ì´ ë–¨ì–´ì§‘ë‹ˆë‹¤. Core Web Vitalsë¥¼ ì ê²€í•˜ì„¸ìš”.",
                'conversion': "íšŒì›ê°€ì… ì ˆì°¨ê°€ ë³µì¡í•©ë‹ˆë‹¤. ê°„í¸ ë¡œê·¸ì¸(ì†Œì…œ) ë²„íŠ¼ì„ ìƒë‹¨ìœ¼ë¡œ ë°°ì¹˜í•˜ì„¸ìš”."
            }
        }
        
        default_msg = "ìƒì„¸ ë¡œê·¸ ë¶„ì„ì„ í†µí•´ ì´íƒˆ ì›ì¸ì„ íŒŒì•…í•˜ê³  UXë¥¼ ê°œì„ í•˜ì„¸ìš”."
        # ì•ˆì „í•œ ì¡°íšŒë¥¼ ìœ„í•´ get ì‚¬ìš© (ëŒ€ì†Œë¬¸ì ì´ìŠˆ ë°©ì§€ë¥¼ ìœ„í•´ categoryëŠ” ë¡œì§ ì§„ì… ì „ ì²˜ë¦¬ ê¶Œì¥)
        return advice_map.get(category, {}).get(issue_type, default_msg)

    def generate_micro_alerts(self, df):
        """
        [ë©”ì¸ ë¡œì§] ë°ì´í„° ë¶„ì„ ë° ë§ˆì´í¬ë¡œ ì„¸ê·¸ë¨¼íŠ¸ Alert ìƒì„±
        """
        # 1. ì§€í‘œ ê³„ì‚° ë° ì„ê³„ê°’ ì„¤ì •
        df = self._calculate_internal_metrics(df)
        th = self._get_dynamic_thresholds(df)
        
        alerts = []

        for _, row in df.iterrows():
            # ì „ì²˜ë¦¬ëœ Category ì»¬ëŸ¼ ì‚¬ìš© (ì—†ìœ¼ë©´ Unknown ì²˜ë¦¬)
            category = row.get('category', 'Unknown')
            channel = row['channel_name']
            
            # ì§€í‘œ ì¶”ì¶œ
            acq = row['acquisition']
            act_rate = row['activation_rate']   # ìœ ì… -> í™œë™ ì „í™˜ìœ¨
            cvr = row['overall_conversion_rate'] # ì „ì²´ êµ¬ë§¤ ì „í™˜ìœ¨
            rpv = row['rpv']
            
            # ì˜ˆìƒ ì†ì‹¤ ìœ ì € (Impact ì‚°ì¶œìš©)
            avg_act = df['activation_rate'].mean()
            loss_users = int(acq * (avg_act - act_rate) / 100) if act_rate < avg_act else 0

            # ----------------------------------------------------------------
            # [Logic A] Hidden VIP (ì €ì „í™˜/ê³ ê°€ì¹˜) -> Opportunity
            # ----------------------------------------------------------------
            if (cvr < 1.0) and (rpv >= th['rpv_high']):
                alerts.append({
                    'type': 'opportunity',
                    'sub_type': 'vip_segment',
                    'severity': 'opportunity', # Front: Blue/Green Color
                    'title': f"ğŸ‘‘ {channel}: VIP ì±„ë„ ë°œê²¬ ({category})",
                    'message': f"ì „í™˜ìœ¨ì€ ë‚®ì§€ë§Œ, ê°ë‹¨ê°€ê°€ ë†’ì•„ ë°©ë¬¸ë‹¹ {int(rpv):,}ì›ì˜ ê°€ì¹˜ë¥¼ ì°½ì¶œí•©ë‹ˆë‹¤.",
                    'action': "ì „í™˜ìœ¨ë³´ë‹¤ëŠ” ROAS ìœ ì§€ì— ì§‘ì¤‘í•˜ì„¸ìš”. ì„£ë¶ˆë¦¬ ì˜ˆì‚°ì„ ì¤„ì´ì§€ ë§ˆì„¸ìš”.",
                    'metrics': {'rpv': int(rpv), 'cvr': cvr}
                })
                continue # VIPëŠ” ì•„ë˜ ê²½ê³  ë¡œì§ ê±´ë„ˆëœ€

            # ----------------------------------------------------------------
            # [Logic B] Traffic Waste (ê³ ìœ ì…/ì €íš¨ìœ¨) -> High Alert
            # ----------------------------------------------------------------
            if (acq >= th['traffic_high']) and (act_rate < 40) and (rpv < th['rpv_low']):
                advice = self._get_category_advice(category, 'activation')
                
                alerts.append({
                    'type': 'problem',
                    'sub_type': 'traffic_leak',
                    'severity': 'high', # Front: Red Color
                    'title': f"ğŸ’¸ {channel}: ì˜ˆì‚° ëˆ„ìˆ˜ ê²½ê³ ",
                    'message': f"[{category}] ìœ ì…ì€ ë§ì§€ë§Œ(Top 20%) ì‹¤ì†ì´ ì—†ìŠµë‹ˆë‹¤. ì˜ˆìƒ ì†ì‹¤ ìœ ì €: {loss_users:,}ëª…",
                    'diagnosis': f"[{category}] ì±„ë„ íŠ¹ì„±ì— ë§ì§€ ì•ŠëŠ” ëœë”©í˜ì´ì§€ ì „ëµì…ë‹ˆë‹¤.",
                    'action': advice,
                    'metrics': {'acquisition': acq, 'potential_loss': loss_users}
                })

            # ----------------------------------------------------------------
            # [Logic C] Checkout Friction (ê²°ì œ ì´íƒˆ) -> Critical Alert
            # ----------------------------------------------------------------
            cart_users = row['consideration']
            cart_rate = row['cart_conversion_rate']
            
            if (cart_users > 50) and (cart_rate < 10):
                advice = self._get_category_advice(category, 'conversion')
                
                alerts.append({
                    'type': 'problem',
                    'sub_type': 'checkout_friction',
                    'severity': 'critical', # Front: Flash Red
                    'title': f"ğŸš§ {channel}: ê²°ì œ ì¥ë²½ ê°ì§€",
                    'message': f"ì¥ë°”êµ¬ë‹ˆ ì „í™˜ìœ¨ì´ {cart_rate:.1f}%ë¡œ ë§¤ìš° ë‚®ìŠµë‹ˆë‹¤. (í‰ê·  ëŒ€ë¹„ -{(10-cart_rate):.1f}%)",
                    'diagnosis': f"[{category}] ìœ ì €ì˜ êµ¬ë§¤ ê²°ì •ì„ ë§‰ëŠ” ìš”ì†Œê°€ ìˆìŠµë‹ˆë‹¤.",
                    'action': advice,
                    'metrics': {'cart_conversion': cart_rate}
                })

            # ----------------------------------------------------------------
            # [Logic D] Rising Star (ì„±ì¥ ê¸°íšŒ) -> Opportunity
            # ----------------------------------------------------------------
            elif (acq < th['traffic_low']) and (act_rate > 70):
                alerts.append({
                    'type': 'opportunity',
                    'sub_type': 'growth_engine',
                    'severity': 'opportunity', # Front: Green
                    'title': f"ğŸš€ {channel}: ì„±ì¥ ì—”ì§„ ì í™”",
                    'message': f"ë°©ë¬¸ìì˜ {act_rate:.1f}%ê°€ ë°˜ì‘í•˜ëŠ” ì•Œì§œ ì±„ë„ì…ë‹ˆë‹¤. ì˜ˆì‚° ì¦ì•¡ ì‹œ ì„±ì¥ì´ í™•ì‹¤ì‹œë©ë‹ˆë‹¤.",
                    'action': "íŠ¸ë˜í”½ ë³¼ë¥¨ì„ í™•ë³´í•˜ì—¬ ë§¤ì¶œ ê·œëª¨ë¥¼ í‚¤ìš°ì„¸ìš”.",
                    'metrics': {'activation_rate': act_rate}
                })

        return alerts