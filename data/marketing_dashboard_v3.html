<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÎßàÏºÄÌåÖ ÎåÄÏãúÎ≥¥Îìú</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Chart.js Datalabels Plugin -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <style>
        :root {
            /* Berry Theme Colors */
            --primary-main: #673ab7;
            --primary-light: #ede7f6;
            --primary-dark: #5e35b1;
            --secondary-main: #2196f3;
            --secondary-light: #e3f2fd;
            --success-main: #00c853;
            --success-light: #b9f6ca;
            --warning-main: #ffab00;
            --warning-light: #fff8e1;
            --error-main: #ff1744;
            --error-light: #ffeaea;
            --grey-50: #fafafa;
            --grey-100: #f5f5f5;
            --grey-200: #eeeeee;
            --grey-300: #e0e0e0;
            --grey-500: #9e9e9e;
            --grey-700: #616161;
            --grey-900: #212121;
            --paper: #ffffff;
            --background: #f8fafc;
            --sidebar-bg: #ffffff;
            --sidebar-width: 260px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Roboto', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--background);
            color: var(--grey-900);
            line-height: 1.5;
        }

        /* Î†àÏù¥ÏïÑÏõÉ Íµ¨Ï°∞ */
        .app-wrapper {
            display: flex;
            min-height: 100vh;
        }

        /* ÏÇ¨Ïù¥ÎìúÎ∞î */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--sidebar-bg);
            border-right: 1px solid var(--grey-200);
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
        }

        .sidebar-header {
            padding: 24px 20px;
            border-bottom: 1px solid var(--grey-200);
        }

        .sidebar-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
        }

        .sidebar-logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary-main) 0%, var(--primary-dark) 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sidebar-logo-icon svg {
            width: 24px;
            height: 24px;
            fill: white;
        }

        .sidebar-logo-text {
            font-size: 18px;
            font-weight: 700;
            color: var(--grey-900);
        }

        .sidebar-logo-subtitle {
            font-size: 11px;
            color: var(--grey-500);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Simplebar Ïä§ÌÉÄÏùº ÎûòÌçº */
        .simplebar-content-wrapper {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .simplebar-content-wrapper::-webkit-scrollbar {
            width: 6px;
        }

        .simplebar-content-wrapper::-webkit-scrollbar-track {
            background: transparent;
        }

        .simplebar-content-wrapper::-webkit-scrollbar-thumb {
            background: var(--grey-300);
            border-radius: 3px;
        }

        .simplebar-content-wrapper::-webkit-scrollbar-thumb:hover {
            background: var(--grey-500);
        }

        .sidebar-content {
            padding: 16px 12px;
        }

        /* ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò Í∑∏Î£π */
        .nav-group {
            margin-bottom: 16px;
        }

        .nav-group-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--grey-500);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 8px 16px;
            margin-bottom: 4px;
        }

        /* ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò ÏïÑÏù¥ÌÖú */
        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            color: var(--grey-700);
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .nav-item:hover {
            background: var(--grey-100);
            color: var(--primary-main);
        }

        .nav-item.active {
            background: var(--primary-light);
            color: var(--primary-main);
        }

        .nav-item-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nav-item-icon svg {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }

        .nav-item-text {
            flex: 1;
        }

        .nav-item-badge {
            background: var(--primary-main);
            color: white;
            font-size: 10px;
            font-weight: 600;
            padding: 2px 8px;
            border-radius: 10px;
        }

        /* Î©îÏù∏ Ïª®ÌÖêÏ∏† ÏòÅÏó≠ */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 24px;
            min-height: 100vh;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        /* Ìó§Îçî */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
        }

        h1 {
            font-size: 24px;
            font-weight: 700;
            color: var(--grey-900);
            margin: 0;
        }

        .header-subtitle {
            font-size: 14px;
            color: var(--grey-500);
            margin-top: 4px;
        }

        /* Ïπ¥Îìú Í≥µÌÜµ Ïä§ÌÉÄÏùº */
        .card {
            background: var(--paper);
            border-radius: 12px;
            box-shadow: 0 2px 14px 0 rgba(32, 40, 45, 0.08);
            transition: box-shadow 0.3s ease;
        }

        .card:hover {
            box-shadow: 0 4px 20px 0 rgba(32, 40, 45, 0.12);
        }

        /* ÌïÑÌÑ∞ ÏÑπÏÖò */
        .filter-section {
            padding: 20px 24px;
            margin-bottom: 24px;
        }

        .filter-header {
            font-size: 16px;
            font-weight: 600;
            color: var(--grey-900);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-header::before {
            content: '';
            width: 4px;
            height: 20px;
            background: var(--primary-main);
            border-radius: 2px;
        }

        .filter-row {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            margin-bottom: 16px;
        }

        .filter-row:last-child {
            margin-bottom: 0;
        }

        /* ÌÜµÌï© ÌïÑÌÑ∞ Ïª®ÌÖåÏù¥ÎÑà */
        .filter-inline-container {
            display: flex;
            align-items: flex-start;
            gap: 48px;
            flex-wrap: wrap;
        }

        /* Í∏∞Í∞Ñ ÏÑ†ÌÉù ÏòÅÏó≠ */
        .filter-date-section {
            display: flex;
            flex-direction: column;
            gap: 37px;
        }

        .filter-date-section .filter-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--grey-900);
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }

        .filter-date-section .filter-label::before {
            content: '';
            width: 4px;
            height: 18px;
            background: var(--primary-main);
            border-radius: 2px;
        }

        /* ÌïÑÌÑ∞ ÏÑ§Ï†ï ÏòÅÏó≠ */
        .filter-setting-section {
            display: flex;
            flex-direction: column;
            gap: 12px;
            flex: 1;
        }

        .filter-setting-section .filter-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--grey-900);
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }

        .filter-setting-section .filter-label::before {
            content: '';
            width: 4px;
            height: 18px;
            background: var(--primary-main);
            border-radius: 2px;
        }

        .filter-setting-section .filter-items {
            display: flex;
            align-items: flex-end;
            gap: 16px;
            flex: 1;
        }

        .filter-setting-section .filter-group {
            flex: 1;
            min-width: 0;
        }

        /* Ï†ëÍ∏∞/ÌéºÏπòÍ∏∞ ÏÑπÏÖò */
        .collapsible-section {
            margin-bottom: 24px;
        }

        .collapsible-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            user-select: none;
            padding: 16px 20px;
            background: var(--paper);
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: box-shadow 0.2s ease;
        }

        .collapsible-header:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
        }

        .collapsible-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 16px;
            font-weight: 600;
            color: var(--grey-900);
        }

        .collapsible-title::before {
            content: '';
            width: 4px;
            height: 20px;
            background: var(--primary-main);
            border-radius: 2px;
        }

        .collapsible-guide {
            font-size: 12px;
            font-weight: 400;
            color: var(--grey-500);
            margin-left: 8px;
        }

        .collapsible-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: var(--primary-light);
            color: var(--primary-main);
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.15s ease, color 0.15s ease;
        }

        .collapsible-toggle:hover {
            background: var(--primary-main);
            color: white;
        }

        .filter-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .filter-section-header .filter-header {
            margin-bottom: 0;
        }

        .reset-btn {
            padding: 8px 16px;
            border: none;
            background: var(--paper);
            color: var(--grey-700);
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .reset-btn:hover {
            background: var(--primary-light);
            color: var(--primary-main);
        }

        .reset-btn:active {
            transform: scale(0.97);
            box-shadow: 0 1px 4px rgba(0,0,0,0.1);
        }

        .collapsible-toggle-icon {
            transition: transform 0.2s ease;
            transform: rotate(180deg);
        }

        .collapsible-toggle-icon.collapsed {
            transform: rotate(0deg);
        }

        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            opacity: 0;
            transition: max-height 0.3s ease, opacity 0.2s ease, padding 0.3s ease;
        }

        .collapsible-content.expanded {
            max-height: 2000px;
            opacity: 1;
            padding-top: 16px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            min-width: 160px;
            flex: 1;
        }

        .filter-group label {
            font-size: 12px;
            font-weight: 500;
            color: var(--grey-700);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .filter-group select,
        .filter-group input {
            padding: 10px 14px;
            border: 1px solid var(--grey-300);
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            background: var(--paper);
            color: var(--grey-900);
            transition: all 0.2s ease;
        }

        .filter-group select:hover,
        .filter-group input:hover {
            border-color: var(--primary-main);
        }

        .filter-group select:focus,
        .filter-group input:focus {
            outline: none;
            border-color: var(--primary-main);
            box-shadow: 0 0 0 3px var(--primary-light);
        }

        /* Í∏∞Í∞Ñ ÏÑ†ÌÉù */
        .date-range {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .date-range input[type="date"] {
            padding: 10px 14px;
            border: 1px solid var(--grey-300);
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            background: var(--paper);
            color: var(--grey-900);
            transition: all 0.2s ease;
        }

        .date-range input[type="date"]:hover {
            border-color: var(--primary-main);
        }

        .date-range input[type="date"]:focus {
            outline: none;
            border-color: var(--primary-main);
            box-shadow: 0 0 0 3px var(--primary-light);
        }

        .date-range span {
            color: var(--grey-500);
            font-weight: 500;
        }

        /* KPI Í∑∏Î¶¨Îìú - ÏóÖÍ∑∏Î†àÏù¥Îìú ÎîîÏûêÏù∏ */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .kpi-card {
            background: var(--paper);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            position: relative;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .kpi-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.1);
        }

        .kpi-card.highlight {
            border-left: 4px solid var(--primary-main);
        }

        .kpi-section {
            margin-bottom: 24px;
        }

        .kpi-grid-primary {
            margin-bottom: 24px;
        }

        .kpi-grid-secondary {
            display: none;
            margin-top: 16px;
        }

        .kpi-section.show-all .kpi-grid-secondary {
            display: grid;
        }

        .kpi-card.secondary {
            background: var(--grey-50);
        }

        .kpi-card.secondary .kpi-icon {
            background: var(--grey-200);
        }

        /* ÌÜµÌï© KPI ÏÑπÏÖò */
        .kpi-unified-section {
            margin-bottom: 24px;
        }

        .kpi-controls-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .kpi-tab-section {
            display: flex;
            gap: 8px;
        }

        .kpi-tab {
            padding: 10px 24px;
            border: none;
            background: var(--paper);
            color: var(--grey-700);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .kpi-tab:hover {
            background: var(--primary-light);
            color: var(--primary-main);
        }

        .kpi-tab.active {
            background: var(--primary-main);
            color: white;
            box-shadow: 0 4px 12px rgba(103, 58, 183, 0.4);
        }

        .kpi-tab-content {
            display: none;
        }

        .kpi-tab-content.active {
            display: block;
        }

        .kpi-view-toggle {
            display: flex;
            gap: 8px;
        }

        .kpi-view-btn {
            padding: 10px 24px;
            border: none;
            background: var(--paper);
            color: var(--grey-700);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .kpi-view-btn:hover {
            background: var(--primary-light);
            color: var(--primary-main);
        }

        .kpi-view-btn.active {
            background: var(--primary-main);
            color: white;
            box-shadow: 0 4px 12px rgba(103, 58, 183, 0.4);
        }

        .kpi-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .kpi-title {
            font-size: 13px;
            color: var(--grey-600);
            font-weight: 600;
        }

        .kpi-icon {
            width: 36px;
            height: 36px;
            background: var(--grey-100);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-main);
            font-size: 16px;
        }

        .kpi-value {
            font-size: 26px;
            font-weight: 700;
            color: var(--grey-900);
            margin-bottom: 8px;
        }

        .kpi-value.highlight-value {
            color: var(--primary-main);
        }

        .kpi-trend {
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 6px;
            flex-wrap: wrap;
        }

        .kpi-trend.up { color: var(--success); }
        .kpi-trend.down { color: var(--error); }
        .kpi-trend.neutral { color: var(--grey-500); }

        .kpi-trend svg {
            width: 14px;
            height: 14px;
        }

        .kpi-trend .trend-value {
            font-weight: 600;
        }

        .kpi-trend .trend-pp {
            display: inline-flex;
            align-items: center;
            padding: 2px 6px;
            font-size: 11px;
            font-weight: 600;
            border-radius: 4px;
            background: var(--grey-100);
            color: var(--grey-600);
        }

        .kpi-trend .trend-pp.positive {
            color: var(--success);
            background: rgba(76, 175, 80, 0.1);
        }

        .kpi-trend .trend-pp.negative {
            color: var(--error);
            background: rgba(244, 67, 54, 0.1);
        }

        .kpi-card .trend-detail {
            font-size: 11px;
            color: var(--grey-500);
            margin-top: 6px;
        }

        .kpi-card .trend-detail .prev-label {
            margin-right: 4px;
        }

        .kpi-card .trend-detail .prev-value {
            font-weight: 600;
            color: var(--grey-700);
        }

        .kpi-card .trend-wrapper {
            margin-top: 4px;
            display: flex;
            align-items: center;
            gap: 4px;
            flex-wrap: wrap;
        }

        .kpi-card .trend-row {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .kpi-card .trend {
            display: inline-flex;
            align-items: center;
            gap: 1px;
            font-size: 9px;
            font-weight: 600;
            padding: 1px 4px;
            border-radius: 8px;
        }

        .kpi-card .trend-pp {
            display: inline-flex;
            align-items: center;
            gap: 1px;
            font-size: 9px;
            font-weight: 600;
            padding: 1px 4px;
            border-radius: 8px;
            background: var(--grey-100);
            color: var(--grey-700);
        }

        .kpi-card .trend-pp.positive {
            color: var(--success-main);
            background: var(--success-light);
        }

        .kpi-card .trend-pp.negative {
            color: var(--error-main);
            background: var(--error-light);
        }

        .kpi-card .trend.up {
            color: var(--success-main);
            background: var(--success-light);
        }

        .kpi-card .trend.down {
            color: var(--error-main);
            background: var(--error-light);
        }

        .kpi-card .trend svg {
            width: 8px;
            height: 8px;
        }

        .kpi-card .trend-detail {
            font-size: 9px;
            color: var(--grey-500);
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .kpi-card .trend-detail .prev-value {
            font-size: 11px;
            font-weight: 600;
            color: var(--grey-700);
        }

        .kpi-card .trend-detail .prev-label {
            font-size: 8px;
            font-weight: 500;
            color: var(--grey-500);
        }

        /* Ï∞®Ìä∏ Ïª®Ìä∏Î°§ */
        .chart-controls {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }


        /* Ï∞®Ìä∏ ÏÑπÏÖò */
        .chart-section {
            margin-bottom: 24px;
            padding: 24px;
        }

        .chart-header {
            font-size: 16px;
            font-weight: 600;
            color: var(--grey-900);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chart-header::before {
            content: '';
            width: 4px;
            height: 20px;
            background: var(--secondary-main);
            border-radius: 2px;
        }

        .chart-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-section-header .chart-header {
            margin-bottom: 0;
        }

        .data-label-toggle {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            border: none;
            background: var(--paper);
            color: var(--grey-700);
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            font-family: inherit;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .data-label-toggle:hover {
            background: var(--primary-light);
            color: var(--primary-main);
        }

        .data-label-toggle.active {
            background: var(--primary-main);
            color: white;
            box-shadow: 0 4px 12px rgba(103, 58, 183, 0.4);
        }

        .data-label-toggle .toggle-checkbox {
            font-size: 14px;
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        /* Îç∞Ïù¥ÌÑ∞ ÌÖåÏù¥Î∏î */
        .table-section {
            overflow: hidden;
        }

        .table-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--grey-200);
            font-size: 16px;
            font-weight: 600;
            color: var(--grey-900);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .table-header::before {
            content: '';
            width: 4px;
            height: 20px;
            background: var(--success-main);
            border-radius: 2px;
        }

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 14px 16px;
            text-align: right;
            font-size: 14px;
        }

        th {
            background: var(--grey-50);
            font-weight: 600;
            color: var(--grey-700);
            border-bottom: 2px solid var(--grey-200);
            position: sticky;
            top: 0;
            white-space: nowrap;
        }

        td {
            border-bottom: 1px solid var(--grey-100);
            color: var(--grey-900);
        }

        th:first-child,
        td:first-child {
            text-align: left;
            position: sticky;
            left: 0;
            background: var(--paper);
            font-weight: 500;
        }

        th:first-child {
            background: var(--grey-50);
            z-index: 2;
        }

        tbody tr {
            transition: background 0.2s ease;
        }

        tbody tr:hover {
            background: var(--grey-50);
        }

        tbody tr:hover td:first-child {
            background: var(--grey-50);
        }

        .positive {
            color: var(--success-main);
            font-weight: 600;
        }

        .negative {
            color: var(--error-main);
            font-weight: 600;
        }

        /* Î°úÎî© */
        .loading {
            text-align: center;
            padding: 60px 40px;
            color: var(--grey-500);
        }

        /* Ìï©Í≥Ñ Ìñâ */
        .total-row {
            font-weight: 600;
            background: var(--primary-light) !important;
        }

        .total-row td {
            border-top: 2px solid var(--primary-main);
            color: var(--primary-dark);
        }

        .total-row td:first-child {
            background: var(--primary-light) !important;
        }

        /* Îçî Î≥¥Í∏∞ Î≤ÑÌäº */
        .show-more-container {
            padding: 16px 24px;
            text-align: center;
            border-top: 1px solid var(--grey-200);
        }

        .show-more-btn {
            padding: 10px 32px;
            background: var(--grey-100);
            color: var(--grey-700);
            border: 1px solid var(--grey-300);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.2s ease;
        }

        .show-more-btn:hover {
            background: var(--primary-light);
            color: var(--primary-main);
            border-color: var(--primary-main);
        }

        .hidden-row {
            display: none;
        }

        /* Ïä§ÌÅ¨Î°§Î∞î Ïä§ÌÉÄÏùº */
        .table-container::-webkit-scrollbar {
            height: 8px;
        }

        .table-container::-webkit-scrollbar-track {
            background: var(--grey-100);
            border-radius: 4px;
        }

        .table-container::-webkit-scrollbar-thumb {
            background: var(--grey-300);
            border-radius: 4px;
        }

        .table-container::-webkit-scrollbar-thumb:hover {
            background: var(--grey-500);
        }

        /* Î∞òÏùëÌòï */
        @media (max-width: 1200px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 10px;
            }

            .filter-row {
                flex-direction: column;
            }

            .filter-group {
                width: 100%;
            }

            .kpi-card {
                min-width: 120px;
                padding: 6px 10px;
            }

            .kpi-card .value {
                font-size: 16px;
            }

            .chart-container {
                height: 250px;
            }

            .chart-controls {
                flex-direction: column;
                align-items: flex-start;
            }
        }

        @media (max-width: 480px) {
            .kpi-card {
                min-width: 100px;
            }

            .kpi-card .value {
                font-size: 15px;
            }

            .kpi-card .trend-detail {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="app-wrapper">
        <!-- ÏÇ¨Ïù¥ÎìúÎ∞î -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <a href="#" class="sidebar-logo">
                    <div class="sidebar-logo-icon">
                        <svg viewBox="0 0 24 24">
                            <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/>
                        </svg>
                    </div>
                    <div>
                        <div class="sidebar-logo-text">Analytics</div>
                        <div class="sidebar-logo-subtitle">Dashboard</div>
                    </div>
                </a>
            </div>

            <div class="simplebar-content-wrapper">
                <div class="sidebar-content">
                    <!-- ÎåÄÏãúÎ≥¥Îìú Í∑∏Î£π -->
                    <div class="nav-group">
                        <div class="nav-group-title">ÎåÄÏãúÎ≥¥Îìú</div>
                        <a href="#" class="nav-item active">
                            <div class="nav-item-icon">
                                <svg viewBox="0 0 24 24">
                                    <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zM7 10h2v7H7zm4-3h2v10h-2zm4 6h2v4h-2z"/>
                                </svg>
                            </div>
                            <span class="nav-item-text">Í¥ëÍ≥† ÏÑ±Í≥º ÎåÄÏãúÎ≥¥Îìú</span>
                        </a>
                        <a href="creative_analysis.html" class="nav-item">
                            <div class="nav-item-icon">
                                <svg viewBox="0 0 24 24">
                                    <path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/>
                                </svg>
                            </div>
                            <span class="nav-item-text">ÏÜåÏû¨Î≥Ñ ÎåÄÏãúÎ≥¥Îìú</span>
                        </a>
                    </div>

                    <!-- Î∂ÑÏÑù Í∑∏Î£π -->
                    <div class="nav-group">
                        <div class="nav-group-title">Î∂ÑÏÑù</div>
                        <a href="timeseries_analysis.html" class="nav-item">
                            <div class="nav-item-icon">
                                <svg viewBox="0 0 24 24">
                                    <path d="M23 8c0 1.1-.9 2-2 2-.18 0-.35-.02-.51-.07l-3.56 3.55c.05.16.07.34.07.52 0 1.1-.9 2-2 2s-2-.9-2-2c0-.18.02-.36.07-.52l-2.55-2.55c-.16.05-.34.07-.52.07s-.36-.02-.52-.07l-4.55 4.56c.05.16.07.33.07.51 0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2c.18 0 .35.02.51.07l4.56-4.55C8.02 9.36 8 9.18 8 9c0-1.1.9-2 2-2s2 .9 2 2c0 .18-.02.36-.07.52l2.55 2.55c.16-.05.34-.07.52-.07s.36.02.52.07l3.55-3.56C19.02 8.35 19 8.18 19 8c0-1.1.9-2 2-2s2 .9 2 2z"/>
                                </svg>
                            </div>
                            <span class="nav-item-text">ÏãúÍ≥ÑÏó¥ Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑù</span>
                        </a>
                        <a href="#" class="nav-item">
                            <div class="nav-item-icon">
                                <svg viewBox="0 0 24 24">
                                    <path d="M11 2v20c-5.07-.5-9-4.79-9-10s3.93-9.5 9-10zm2.03 0v8.99H22c-.47-4.74-4.24-8.52-8.97-8.99zm0 11.01V22c4.74-.47 8.5-4.25 8.97-8.99h-8.97z"/>
                                </svg>
                            </div>
                            <span class="nav-item-text">Ï±ÑÎÑêÎ≥Ñ ÎπÑÍµê</span>
                        </a>
                        <a href="funnel_dashboard.html" class="nav-item">
                            <div class="nav-item-icon">
                                <svg viewBox="0 0 24 24">
                                    <path d="M4.25 5.61C6.27 8.2 10 13 10 13v6c0 .55.45 1 1 1h2c.55 0 1-.45 1-1v-6s3.73-4.8 5.75-7.39C20.26 4.95 19.79 4 18.95 4H5.04c-.83 0-1.31.95-.79 1.61z"/>
                                </svg>
                            </div>
                            <span class="nav-item-text">ÌçºÎÑê ÎåÄÏãúÎ≥¥Îìú</span>
                        </a>
                    </div>

                    <!-- ÏßÄÏõê Í∑∏Î£π -->
                    <div class="nav-group">
                        <div class="nav-group-title">ÏßÄÏõê</div>
                        <a href="Qna.html" class="nav-item">
                            <div class="nav-item-icon">
                                <svg viewBox="0 0 24 24">
                                    <path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/>
                                </svg>
                            </div>
                            <span class="nav-item-text">FAQ & Î¨∏ÏùòÌïòÍ∏∞</span>
                        </a>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Î©îÏù∏ Ïª®ÌÖêÏ∏† -->
        <main class="main-content">
            <div class="container">
                <!-- Ìó§Îçî -->
                <div class="header">
                    <div>
                        <h1>ÎßàÏºÄÌåÖ ÏÑ±Í≥º ÎåÄÏãúÎ≥¥Îìú</h1>
                        <div class="header-subtitle">Í¥ëÍ≥† Ï∫†ÌéòÏù∏ ÏÑ±Í≥º Î∂ÑÏÑù Î∞è KPI Î™®ÎãàÌÑ∞ÎßÅ</div>
                    </div>
                </div>

                <!-- ÌïÑÌÑ∞ ÏÑ§Ï†ï (Ï†ëÍ∏∞/ÌéºÏπòÍ∏∞) -->
                <div class="collapsible-section">
                    <div class="collapsible-header" id="filterCollapsibleHeader">
                        <div class="collapsible-title">ÌïÑÌÑ∞ ÏÑ§Ï†ï <span class="collapsible-guide">* ÌéºÏ≥êÏÑú ÏÑ∏Î∂Ä ÏÑ±Í≥ºÎ•º ÌïÑÌÑ∞ÎßÅÌï† Ïàò ÏûàÏñ¥Ïöî</span></div>
                        <button class="collapsible-toggle">
                            <span>ÌéºÏπòÍ∏∞</span>
                            <span class="collapsible-toggle-icon collapsed">‚ñº</span>
                        </button>
                    </div>
                    <div class="collapsible-content" id="filterCollapsibleContent">
                        <!-- Í∏∞Í∞Ñ ÏÑ†ÌÉù + Í∏∞Î≥∏ ÌïÑÌÑ∞ -->
                        <div class="filter-section card" style="margin-bottom: 16px;">
                            <div class="filter-section-header">
                                <div class="filter-header">Í∏∞Í∞Ñ Î∞è Í∏∞Î≥∏ ÌïÑÌÑ∞</div>
                                <button class="reset-btn" onclick="resetBasicFilters()">Ï¥àÍ∏∞Ìôî</button>
                            </div>
                            <div class="filter-inline-container">
                                <!-- Í∏∞Í∞Ñ ÏÑ†ÌÉù -->
                                <div class="filter-date-section">
                                    <div class="filter-label">Í∏∞Í∞Ñ ÏÑ†ÌÉù</div>
                                    <div class="date-range">
                                        <input type="date" id="startDate">
                                        <span>~</span>
                                        <input type="date" id="endDate">
                                    </div>
                                </div>
                                <!-- Í∏∞Î≥∏ ÌïÑÌÑ∞ -->
                                <div class="filter-setting-section">
                                    <div class="filter-label">Í∏∞Î≥∏ ÌïÑÌÑ∞</div>
                                    <div class="filter-items">
                                        <div class="filter-group">
                                            <label>Ïú†ÌòïÍµ¨Î∂Ñ</label>
                                            <select id="filterType">
                                                <option value="">Ï†ÑÏ≤¥</option>
                                            </select>
                                        </div>
                                        <div class="filter-group">
                                            <label>Î∏åÎûúÎìúÎ™Ö</label>
                                            <select id="filterBrand">
                                                <option value="">Ï†ÑÏ≤¥</option>
                                            </select>
                                        </div>
                                        <div class="filter-group">
                                            <label>ÏÉÅÌíàÎ™Ö</label>
                                            <select id="filterProduct">
                                                <option value="">Ï†ÑÏ≤¥</option>
                                            </select>
                                        </div>
                                        <div class="filter-group">
                                            <label>ÌîÑÎ°úÎ™®ÏÖò</label>
                                            <select id="filterPromotion">
                                                <option value="">Ï†ÑÏ≤¥</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- ÏÑ∏Î∂Ä ÌïÑÌÑ∞ -->
                        <div class="filter-section card">
                            <div class="filter-section-header">
                                <div class="filter-header">ÏÑ∏Î∂Ä ÌïÑÌÑ∞</div>
                                <button class="reset-btn" onclick="resetDetailFilters()">Ï¥àÍ∏∞Ìôî</button>
                            </div>
                            <div class="filter-row">
                                <div class="filter-group">
                                    <label>Ï∫†ÌéòÏù∏</label>
                                    <select id="filterCampaign">
                                        <option value="">Ï†ÑÏ≤¥</option>
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <label>ÏÑ∏Ìä∏Ïù¥Î¶Ñ</label>
                                    <select id="filterSetName">
                                        <option value="">Ï†ÑÏ≤¥</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ÌÜµÌï© KPI ÏÑπÏÖò -->
                <div class="kpi-unified-section">
                    <!-- Í∏∞Í∞Ñ ÌÉ≠ + Ï£ºÏöî/ÏÑ∏Î∂Ä ÏÑ±Í≥º ÌÜ†Í∏Ä (Í∞ôÏùÄ Ìñâ) -->
                    <div class="kpi-controls-row">
                        <!-- Í∏∞Í∞Ñ ÌÉ≠ -->
                        <div class="kpi-tab-section">
                            <button class="kpi-tab active" data-kpi-tab="total">Ï†ÑÏ≤¥</button>
                            <button class="kpi-tab" data-kpi-tab="monthly">ÏõîÎ≥Ñ</button>
                            <button class="kpi-tab" data-kpi-tab="weekly">Ï£ºÎ≥Ñ</button>
                            <button class="kpi-tab" data-kpi-tab="daily">ÏùºÎ≥Ñ</button>
                        </div>
                        <!-- Ï£ºÏöî/ÏÑ∏Î∂Ä ÏÑ±Í≥º ÌÜ†Í∏Ä -->
                        <div class="kpi-view-toggle">
                            <button class="kpi-view-btn active" data-kpi-view="primary">Ï£ºÏöî ÏÑ±Í≥º</button>
                            <button class="kpi-view-btn" data-kpi-view="all">ÏÑ∏Î∂Ä ÏÑ±Í≥º</button>
                        </div>
                    </div>

                    <!-- Ï†ÑÏ≤¥ ÌÉ≠ ÏΩòÌÖêÏ∏† (ÏöîÏïΩ Îç∞Ïù¥ÌÑ∞) -->
                    <div class="kpi-tab-content active" id="kpiTabTotal">
                        <div class="kpi-section">
                            <section class="kpi-grid kpi-grid-primary">
                                <div class="kpi-card">
                                    <div class="kpi-header">
                                        <span class="kpi-title">Ï¥ù ÎπÑÏö©</span>
                                        <div class="kpi-icon">üí∞</div>
                                    </div>
                                    <div class="kpi-value" id="summaryTotalCost">-</div>
                                    <div class="kpi-trend neutral">
                                        <span>Ï†ÑÏ≤¥ Í∏∞Í∞Ñ Ìï©Í≥Ñ</span>
                                    </div>
                                </div>
                                <div class="kpi-card highlight">
                                    <div class="kpi-header">
                                        <span class="kpi-title">ROAS</span>
                                        <div class="kpi-icon">üìà</div>
                                    </div>
                                    <div class="kpi-value highlight-value" id="summaryTotalROAS">-</div>
                                    <div class="kpi-trend neutral">
                                        <span>Í¥ëÍ≥† ÏàòÏùµÎ•†</span>
                                    </div>
                                </div>
                                <div class="kpi-card">
                                    <div class="kpi-header">
                                        <span class="kpi-title">CPA</span>
                                        <div class="kpi-icon">üéØ</div>
                                    </div>
                                    <div class="kpi-value" id="summaryAvgCPA">-</div>
                                    <div class="kpi-trend neutral">
                                        <span>Ï†ÑÌôòÎãπ ÎπÑÏö©</span>
                                    </div>
                                </div>
                                <div class="kpi-card">
                                    <div class="kpi-header">
                                        <span class="kpi-title">CPC</span>
                                        <div class="kpi-icon">üñ±Ô∏è</div>
                                    </div>
                                    <div class="kpi-value" id="summaryAvgCPC">-</div>
                                    <div class="kpi-trend neutral">
                                        <span>ÌÅ¥Î¶≠Îãπ ÎπÑÏö©</span>
                                    </div>
                                </div>
                                <div class="kpi-card">
                                    <div class="kpi-header">
                                        <span class="kpi-title">CPM</span>
                                        <div class="kpi-icon">üëÅÔ∏è</div>
                                    </div>
                                    <div class="kpi-value" id="summaryAvgCPM">-</div>
                                    <div class="kpi-trend neutral">
                                        <span>ÎÖ∏Ï∂úÎãπ ÎπÑÏö©</span>
                                    </div>
                                </div>
                            </section>
                            <section class="kpi-grid kpi-grid-secondary">
                                <div class="kpi-card secondary">
                                    <div class="kpi-header">
                                        <span class="kpi-title">Ï¥ù ÎÖ∏Ï∂ú</span>
                                        <div class="kpi-icon">üëÄ</div>
                                    </div>
                                    <div class="kpi-value" id="summaryTotalImpressions">-</div>
                                    <div class="kpi-trend neutral">
                                        <span>Ìöå</span>
                                    </div>
                                </div>
                                <div class="kpi-card secondary">
                                    <div class="kpi-header">
                                        <span class="kpi-title">Ï¥ù ÌÅ¥Î¶≠</span>
                                        <div class="kpi-icon">üëÜ</div>
                                    </div>
                                    <div class="kpi-value" id="summaryTotalClicks">-</div>
                                    <div class="kpi-trend neutral">
                                        <span>Ìöå</span>
                                    </div>
                                </div>
                                <div class="kpi-card secondary">
                                    <div class="kpi-header">
                                        <span class="kpi-title">Ï¥ù Ï†ÑÌôòÏàò</span>
                                        <div class="kpi-icon">‚úÖ</div>
                                    </div>
                                    <div class="kpi-value" id="summaryTotalConversions">-</div>
                                    <div class="kpi-trend neutral">
                                        <span>Í±¥</span>
                                    </div>
                                </div>
                                <div class="kpi-card secondary">
                                    <div class="kpi-header">
                                        <span class="kpi-title">Ï¥ù Ï†ÑÌôòÍ∞í</span>
                                        <div class="kpi-icon">üíµ</div>
                                    </div>
                                    <div class="kpi-value" id="summaryTotalConversionValue">-</div>
                                    <div class="kpi-trend neutral">
                                        <span>Ïõê</span>
                                    </div>
                                </div>
                            </section>
                        </div>
                    </div>

                    <!-- Í∏∞Í∞ÑÎ≥Ñ ÌÉ≠ ÏΩòÌÖêÏ∏† (ÏùºÎ≥Ñ/Ï£ºÎ≥Ñ/ÏõîÎ≥Ñ - Ìä∏Î†åÎìú Ìè¨Ìï®) -->
                    <div class="kpi-tab-content" id="kpiTabPeriod">
                        <div class="kpi-section">
                            <section class="kpi-grid kpi-grid-primary">
                                <div class="kpi-card">
                                    <div class="kpi-header">
                                        <span class="kpi-title">ÎπÑÏö©</span>
                                        <div class="kpi-icon">üí∞</div>
                                    </div>
                                    <div class="kpi-value" id="totalCost">-</div>
                                    <div class="kpi-trend" id="trendCost">
                                        <span class="trend-value">-</span>
                                        <span class="trend-pp" id="trendCostPP"></span>
                                    </div>
                                    <div class="trend-detail" id="trendCostDetail"></div>
                                </div>
                                <div class="kpi-card highlight">
                                    <div class="kpi-header">
                                        <span class="kpi-title">ROAS</span>
                                        <div class="kpi-icon">üìà</div>
                                    </div>
                                    <div class="kpi-value highlight-value" id="totalROAS">-</div>
                                    <div class="kpi-trend" id="trendROAS">
                                        <span class="trend-value">-</span>
                                        <span class="trend-pp" id="trendROASPP"></span>
                                    </div>
                                    <div class="trend-detail" id="trendROASDetail"></div>
                                </div>
                                <div class="kpi-card">
                                    <div class="kpi-header">
                                        <span class="kpi-title">CPA</span>
                                        <div class="kpi-icon">üéØ</div>
                                    </div>
                                    <div class="kpi-value" id="avgCPA">-</div>
                                    <div class="kpi-trend" id="trendCPA">
                                        <span class="trend-value">-</span>
                                        <span class="trend-pp" id="trendCPAPP"></span>
                                    </div>
                                    <div class="trend-detail" id="trendCPADetail"></div>
                                </div>
                                <div class="kpi-card">
                                    <div class="kpi-header">
                                        <span class="kpi-title">CPC</span>
                                        <div class="kpi-icon">üñ±Ô∏è</div>
                                    </div>
                                    <div class="kpi-value" id="avgCPC">-</div>
                                    <div class="kpi-trend" id="trendCPC">
                                        <span class="trend-value">-</span>
                                        <span class="trend-pp" id="trendCPCPP"></span>
                                    </div>
                                    <div class="trend-detail" id="trendCPCDetail"></div>
                                </div>
                                <div class="kpi-card">
                                    <div class="kpi-header">
                                        <span class="kpi-title">CPM</span>
                                        <div class="kpi-icon">üëÅÔ∏è</div>
                                    </div>
                                    <div class="kpi-value" id="avgCPM">-</div>
                                    <div class="kpi-trend" id="trendCPM">
                                        <span class="trend-value">-</span>
                                        <span class="trend-pp" id="trendCPMPP"></span>
                                    </div>
                                    <div class="trend-detail" id="trendCPMDetail"></div>
                                </div>
                            </section>
                            <section class="kpi-grid kpi-grid-secondary">
                                <div class="kpi-card secondary">
                                    <div class="kpi-header">
                                        <span class="kpi-title">ÎÖ∏Ï∂ú</span>
                                        <div class="kpi-icon">üëÄ</div>
                                    </div>
                                    <div class="kpi-value" id="totalImpressions">-</div>
                                    <div class="kpi-trend" id="trendImpressions">
                                        <span class="trend-value">-</span>
                                        <span class="trend-pp" id="trendImpressionsPP"></span>
                                    </div>
                                    <div class="trend-detail" id="trendImpressionsDetail"></div>
                                </div>
                                <div class="kpi-card secondary">
                                    <div class="kpi-header">
                                        <span class="kpi-title">ÌÅ¥Î¶≠</span>
                                        <div class="kpi-icon">üëÜ</div>
                                    </div>
                                    <div class="kpi-value" id="totalClicks">-</div>
                                    <div class="kpi-trend" id="trendClicks">
                                        <span class="trend-value">-</span>
                                        <span class="trend-pp" id="trendClicksPP"></span>
                                    </div>
                                    <div class="trend-detail" id="trendClicksDetail"></div>
                                </div>
                                <div class="kpi-card secondary">
                                    <div class="kpi-header">
                                        <span class="kpi-title">Ï†ÑÌôòÏàò</span>
                                        <div class="kpi-icon">‚úÖ</div>
                                    </div>
                                    <div class="kpi-value" id="totalConversions">-</div>
                                    <div class="kpi-trend" id="trendConversions">
                                        <span class="trend-value">-</span>
                                        <span class="trend-pp" id="trendConversionsPP"></span>
                                    </div>
                                    <div class="trend-detail" id="trendConversionsDetail"></div>
                                </div>
                                <div class="kpi-card secondary">
                                    <div class="kpi-header">
                                        <span class="kpi-title">Ï†ÑÌôòÍ∞í</span>
                                        <div class="kpi-icon">üíµ</div>
                                    </div>
                                    <div class="kpi-value" id="totalConversionValue">-</div>
                                    <div class="kpi-trend" id="trendConversionValue">
                                        <span class="trend-value">-</span>
                                        <span class="trend-pp" id="trendConversionValuePP"></span>
                                    </div>
                                    <div class="trend-detail" id="trendConversionValueDetail"></div>
                                </div>
                            </section>
                        </div>
                    </div>
                </div>

                <!-- Ï∞®Ìä∏ ÏÑπÏÖò -->
                <div class="chart-section card">
                    <div class="chart-section-header">
                        <div class="chart-header">ÏÑ±Í≥º ÏßÄÌëú Ï∂îÏù¥</div>
                        <button class="data-label-toggle" id="dataLabelToggle">
                            <span class="toggle-checkbox">‚òê</span>
                            <span>Îç∞Ïù¥ÌÑ∞ ÎùºÎ≤®</span>
                        </button>
                    </div>
                    <div class="chart-controls">
                        <div class="chart-toggle-group" style="display: flex; gap: 8px; flex-wrap: wrap;">
                            <button type="button" class="data-label-toggle active" data-chart-toggle="chartCost">
                                <span class="toggle-checkbox">‚úì</span>
                                <span>ÎπÑÏö©</span>
                            </button>
                            <button type="button" class="data-label-toggle" data-chart-toggle="chartCPM">
                                <span class="toggle-checkbox">‚òê</span>
                                <span>CPM</span>
                            </button>
                            <button type="button" class="data-label-toggle" data-chart-toggle="chartCPC">
                                <span class="toggle-checkbox">‚òê</span>
                                <span>CPC</span>
                            </button>
                            <button type="button" class="data-label-toggle" data-chart-toggle="chartCPA">
                                <span class="toggle-checkbox">‚òê</span>
                                <span>CPA</span>
                            </button>
                            <button type="button" class="data-label-toggle active" data-chart-toggle="chartROAS">
                                <span class="toggle-checkbox">‚úì</span>
                                <span>ROAS</span>
                            </button>
                        </div>
                        <!-- Ïà®Í≤®ÏßÑ Ï≤¥ÌÅ¨Î∞ïÏä§ (Í∏∞Ï°¥ Í∏∞Îä• Ïú†ÏßÄÏö©) -->
                        <div style="display: none;">
                            <input type="checkbox" id="chartCost" checked>
                            <input type="checkbox" id="chartCPM">
                            <input type="checkbox" id="chartCPC">
                            <input type="checkbox" id="chartCPA">
                            <input type="checkbox" id="chartROAS" checked>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="trendChart"></canvas>
                    </div>
                </div>

                <!-- Îç∞Ïù¥ÌÑ∞ ÌÖåÏù¥Î∏î -->
                <div class="table-section card">
                    <div class="table-header">ÏÉÅÏÑ∏ Îç∞Ïù¥ÌÑ∞</div>
                    <div class="table-container">
                        <table id="dataTable">
                            <thead>
                                <tr>
                                    <th>Í∏∞Í∞Ñ</th>
                                    <th>ÎπÑÏö©</th>
                                    <th>ÎÖ∏Ï∂ú</th>
                                    <th>CPM</th>
                                    <th>ÌÅ¥Î¶≠</th>
                                    <th>CPC</th>
                                    <th>Ï†ÑÌôòÏàò</th>
                                    <th>CPA</th>
                                    <th>Ï†ÑÌôòÍ∞í</th>
                                    <th>ROAS</th>
                                </tr>
                            </thead>
                            <tbody id="tableBody">
                                <tr>
                                    <td colspan="10" class="loading">Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="show-more-container" id="showMoreContainer" style="display: none;">
                        <button class="show-more-btn" id="showMoreBtn">Îçî Î≥¥Í∏∞ (<span id="hiddenCount">0</span>Í∞ú)</button>
                    </div>
                    <div class="show-more-container" id="collapseContainer" style="display: none;">
                        <button class="show-more-btn" id="collapseBtn">Ï†ëÍ∏∞</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Chart.js Datalabels ÌîåÎü¨Í∑∏Ïù∏ Îì±Î°ù
        Chart.register(ChartDataLabels);

        // Ï†ÑÏó≠ Î≥ÄÏàò
        let allData = [];
        let currentView = 'monthly';
        let showDataLabels = false;
        let filters = {
            type: '',
            brand: '',
            product: '',
            promotion: '',
            startDate: '',
            endDate: '',
            campaign: '',
            setName: ''
        };
        let trendChart = null;

        // CSV ÌååÏùº Î™©Î°ù
        const csvFiles = [
            'raw/raw_data.csv'
        ];

        // CSV ÌååÏã± Ìï®Ïàò (RFC 4180 Ìò∏Ìôò)
        function parseCSV(text) {
            const lines = text.trim().split('\n');

            // RFC 4180 Ìò∏Ìôò CSV ÌååÏã±
            function parseLine(line) {
                const result = [];
                let current = '';
                let inQuotes = false;

                for (let i = 0; i < line.length; i++) {
                    const char = line[i];
                    const nextChar = line[i + 1];

                    if (char === '"') {
                        if (inQuotes && nextChar === '"') {
                            // Ïó∞ÏÜçÎêú Îî∞Ïò¥ÌëúÎäî Ïù¥Ïä§ÏºÄÏù¥ÌîÑÎêú Îî∞Ïò¥Ìëú
                            current += '"';
                            i++; // Îã§Ïùå Îî∞Ïò¥Ìëú Í±¥ÎÑàÎõ∞Í∏∞
                        } else {
                            // Îî∞Ïò¥Ìëú ÏãúÏûë/Ï¢ÖÎ£å
                            inQuotes = !inQuotes;
                        }
                    } else if (char === ',' && !inQuotes) {
                        // Îî∞Ïò¥Ìëú Î∞ñÏùò ÏâºÌëúÎäî Íµ¨Î∂ÑÏûê
                        result.push(current);
                        current = '';
                    } else {
                        current += char;
                    }
                }

                // ÎßàÏßÄÎßâ ÌïÑÎìú Ï∂îÍ∞Ä
                result.push(current);
                return result;
            }

            const headers = parseLine(lines[0]).map(h => h.trim());

            return lines.slice(1).map(line => {
                const values = parseLine(line);
                const obj = {};
                headers.forEach((header, index) => {
                    obj[header] = values[index] ? values[index].trim() : '';
                });
                return obj;
            });
        }

        // Îç∞Ïù¥ÌÑ∞ Î°úÎìú
        async function loadData() {
            const promises = csvFiles.map(file =>
                fetch(file)
                    .then(response => {
                        if (!response.ok) throw new Error(`Failed to load ${file}`);
                        return response.text();
                    })
                    .then(text => parseCSV(text))
                    .catch(err => {
                        console.warn(`Could not load ${file}:`, err);
                        return [];
                    })
            );

            const results = await Promise.all(promises);
            allData = results.flat();

            // unique Í∞íÏúºÎ°ú ÌïÑÌÑ∞ ÏòµÏÖò ÏÑ§Ï†ï
            populateFilters();

            // ÎÇ†Ïßú Î≤îÏúÑ ÏÑ§Ï†ï
            setDateRange();

            // ÏÑ∏Î∂Ä ÌïÑÌÑ∞ ÏòµÏÖò ÏÑ§Ï†ï
            updateDetailFilters();

            // Ï¥àÍ∏∞ Îç∞Ïù¥ÌÑ∞ ÌëúÏãú
            updateDashboard();
        }

        // ÌïÑÌÑ∞ ÏòµÏÖò ÏÑ§Ï†ï (Ïú†ÌòïÍµ¨Î∂ÑÎßå Ï¥àÍ∏∞Ìôî, ÎÇòÎ®∏ÏßÄÎäî Í≥ÑÏ∏µ Íµ¨Ï°∞Î°ú ÏóÖÎç∞Ïù¥Ìä∏)
        function populateFilters() {
            const types = [...new Set(allData.map(d => d['Ïú†ÌòïÍµ¨Î∂Ñ']))].filter(Boolean).sort();
            populateSelect('filterType', types);

            // Î∏åÎûúÎìúÎ™Ö, ÏÉÅÌíàÎ™Ö, ÌîÑÎ°úÎ™®ÏÖòÏùÄ Í≥ÑÏ∏µ Íµ¨Ï°∞Î°ú ÏóÖÎç∞Ïù¥Ìä∏
            updateBrandFilter();
        }

        // Î∏åÎûúÎìúÎ™Ö ÌïÑÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏ (Ïú†ÌòïÍµ¨Î∂ÑÏùò ÌïòÏúÑ ÏÜçÏÑ±)
        function updateBrandFilter() {
            const filteredData = allData.filter(row => {
                if (filters.type && row['Ïú†ÌòïÍµ¨Î∂Ñ'] !== filters.type) return false;
                return true;
            });

            const brands = [...new Set(filteredData.map(d => d['Î∏åÎûúÎìúÎ™Ö']))].filter(Boolean).sort();
            const currentBrand = filters.brand;
            const brandSelect = document.getElementById('filterBrand');

            brandSelect.innerHTML = '<option value="">Ï†ÑÏ≤¥</option>';
            brands.forEach(opt => {
                const option = document.createElement('option');
                option.value = opt;
                option.textContent = opt;
                brandSelect.appendChild(option);
            });

            if (brands.includes(currentBrand)) {
                brandSelect.value = currentBrand;
            } else {
                filters.brand = '';
                brandSelect.value = '';
            }

            // ÏÉÅÌíàÎ™Ö ÏóÖÎç∞Ïù¥Ìä∏ (Î∏åÎûúÎìúÎ™ÖÏóê Ï¢ÖÏÜç)
            updateProductFilter();
        }

        // ÏÉÅÌíàÎ™Ö ÌïÑÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏ (Î∏åÎûúÎìúÎ™ÖÏùò ÌïòÏúÑ ÏÜçÏÑ±)
        function updateProductFilter() {
            const filteredData = allData.filter(row => {
                if (filters.type && row['Ïú†ÌòïÍµ¨Î∂Ñ'] !== filters.type) return false;
                if (filters.brand && row['Î∏åÎûúÎìúÎ™Ö'] !== filters.brand) return false;
                return true;
            });

            const products = [...new Set(filteredData.map(d => d['ÏÉÅÌíàÎ™Ö']))].filter(Boolean).sort();
            const currentProduct = filters.product;
            const productSelect = document.getElementById('filterProduct');

            productSelect.innerHTML = '<option value="">Ï†ÑÏ≤¥</option>';
            products.forEach(opt => {
                const option = document.createElement('option');
                option.value = opt;
                option.textContent = opt;
                productSelect.appendChild(option);
            });

            if (products.includes(currentProduct)) {
                productSelect.value = currentProduct;
            } else {
                filters.product = '';
                productSelect.value = '';
            }

            // ÌîÑÎ°úÎ™®ÏÖò ÏóÖÎç∞Ïù¥Ìä∏ (ÏÉÅÌíàÎ™ÖÏóê Ï¢ÖÏÜç)
            updatePromotionFilter();
        }

        // ÌîÑÎ°úÎ™®ÏÖò ÌïÑÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏ (ÏÉÅÌíàÎ™ÖÏùò ÌïòÏúÑ ÏÜçÏÑ±)
        function updatePromotionFilter() {
            const filteredData = allData.filter(row => {
                if (filters.type && row['Ïú†ÌòïÍµ¨Î∂Ñ'] !== filters.type) return false;
                if (filters.brand && row['Î∏åÎûúÎìúÎ™Ö'] !== filters.brand) return false;
                if (filters.product && row['ÏÉÅÌíàÎ™Ö'] !== filters.product) return false;
                return true;
            });

            const promotions = [...new Set(filteredData.map(d => d['ÌîÑÎ°úÎ™®ÏÖò']))].filter(Boolean).sort();
            const currentPromotion = filters.promotion;
            const promotionSelect = document.getElementById('filterPromotion');

            promotionSelect.innerHTML = '<option value="">Ï†ÑÏ≤¥</option>';
            promotions.forEach(opt => {
                const option = document.createElement('option');
                option.value = opt;
                option.textContent = opt;
                promotionSelect.appendChild(option);
            });

            if (promotions.includes(currentPromotion)) {
                promotionSelect.value = currentPromotion;
            } else {
                filters.promotion = '';
                promotionSelect.value = '';
            }
        }

        function populateSelect(id, options) {
            const select = document.getElementById(id);
            options.forEach(opt => {
                const option = document.createElement('option');
                option.value = opt;
                option.textContent = opt;
                select.appendChild(option);
            });
        }

        // ÏÑ∏Î∂Ä ÌïÑÌÑ∞ ÏòµÏÖò ÎèôÏ†Å ÏóÖÎç∞Ïù¥Ìä∏ (Í∏∞Ï°¥ ÌïÑÌÑ∞ Ï°∞Í±¥ÏùÑ ÎßåÏ°±ÌïòÎäî Îç∞Ïù¥ÌÑ∞ÏóêÏÑúÎßå Ï∂îÏ∂ú)
        function updateDetailFilters() {
            // Í∏∞Ï°¥ ÌïÑÌÑ∞ Ï°∞Í±¥ÏùÑ ÎßåÏ°±ÌïòÎäî Îç∞Ïù¥ÌÑ∞ ÌïÑÌÑ∞ÎßÅ
            const filteredData = allData.filter(row => {
                // Í∏∞Í∞Ñ Ï°∞Í±¥
                if (filters.startDate || filters.endDate) {
                    const rowDate = new Date(row['Ïùº Íµ¨Î∂Ñ']);
                    if (isNaN(rowDate)) return false;
                    if (filters.startDate && rowDate < new Date(filters.startDate)) return false;
                    if (filters.endDate && rowDate > new Date(filters.endDate)) return false;
                }

                // Í∏∞Î≥∏ ÌïÑÌÑ∞ Ï°∞Í±¥
                if (filters.type && row['Ïú†ÌòïÍµ¨Î∂Ñ'] !== filters.type) return false;
                if (filters.brand && row['Î∏åÎûúÎìúÎ™Ö'] !== filters.brand) return false;
                if (filters.product && row['ÏÉÅÌíàÎ™Ö'] !== filters.product) return false;
                if (filters.promotion && row['ÌîÑÎ°úÎ™®ÏÖò'] !== filters.promotion) return false;

                return true;
            });

            // Ï∫†ÌéòÏù∏ unique Í∞í Ï∂îÏ∂ú
            const campaigns = [...new Set(filteredData.map(d => d['Ï∫†ÌéòÏù∏']))].filter(Boolean).sort();

            // Í∏∞Ï°¥ ÏÑ†ÌÉùÍ∞í Ï†ÄÏû•
            const currentCampaign = filters.campaign;

            // Ï∫†ÌéòÏù∏ ÎìúÎ°≠Îã§Ïö¥ Ï¥àÍ∏∞Ìôî Î∞è Ïû¨ÏÑ§Ï†ï
            const campaignSelect = document.getElementById('filterCampaign');

            campaignSelect.innerHTML = '<option value="">Ï†ÑÏ≤¥</option>';

            campaigns.forEach(opt => {
                const option = document.createElement('option');
                option.value = opt;
                option.textContent = opt;
                campaignSelect.appendChild(option);
            });

            // Í∏∞Ï°¥ ÏÑ†ÌÉùÍ∞íÏù¥ ÏÉà ÏòµÏÖòÏóê Ï°¥Ïû¨ÌïòÎ©¥ Ïú†ÏßÄ, ÏïÑÎãàÎ©¥ Ï¥àÍ∏∞Ìôî
            if (campaigns.includes(currentCampaign)) {
                campaignSelect.value = currentCampaign;
            } else {
                filters.campaign = '';
                campaignSelect.value = '';
            }

            // ÏÑ∏Ìä∏Ïù¥Î¶Ñ ÏóÖÎç∞Ïù¥Ìä∏ (Ï∫†ÌéòÏù∏Ïóê Ï¢ÖÏÜç)
            updateSetNameFilter();
        }

        // ÏÑ∏Ìä∏Ïù¥Î¶Ñ ÌïÑÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏ (Ï∫†ÌéòÏù∏Ïùò ÌïòÏúÑ ÏÜçÏÑ±)
        function updateSetNameFilter() {
            // Í∏∞Ï°¥ ÌïÑÌÑ∞ Ï°∞Í±¥ + Ï∫†ÌéòÏù∏ Ï°∞Í±¥ÏùÑ ÎßåÏ°±ÌïòÎäî Îç∞Ïù¥ÌÑ∞ ÌïÑÌÑ∞ÎßÅ
            const filteredData = allData.filter(row => {
                // Í∏∞Í∞Ñ Ï°∞Í±¥
                if (filters.startDate || filters.endDate) {
                    const rowDate = new Date(row['Ïùº Íµ¨Î∂Ñ']);
                    if (isNaN(rowDate)) return false;
                    if (filters.startDate && rowDate < new Date(filters.startDate)) return false;
                    if (filters.endDate && rowDate > new Date(filters.endDate)) return false;
                }

                // Í∏∞Î≥∏ ÌïÑÌÑ∞ Ï°∞Í±¥
                if (filters.type && row['Ïú†ÌòïÍµ¨Î∂Ñ'] !== filters.type) return false;
                if (filters.brand && row['Î∏åÎûúÎìúÎ™Ö'] !== filters.brand) return false;
                if (filters.product && row['ÏÉÅÌíàÎ™Ö'] !== filters.product) return false;
                if (filters.promotion && row['ÌîÑÎ°úÎ™®ÏÖò'] !== filters.promotion) return false;

                // Ï∫†ÌéòÏù∏ Ï°∞Í±¥ (ÏÑ∏Ìä∏Ïù¥Î¶ÑÏùÄ Ï∫†ÌéòÏù∏Ïùò ÌïòÏúÑ ÏÜçÏÑ±)
                if (filters.campaign && row['Ï∫†ÌéòÏù∏'] !== filters.campaign) return false;

                return true;
            });

            // ÏÑ∏Ìä∏Ïù¥Î¶Ñ unique Í∞í Ï∂îÏ∂ú
            const setNames = [...new Set(filteredData.map(d => d['ÏÑ∏Ìä∏Ïù¥Î¶Ñ']))].filter(Boolean).sort();

            // Í∏∞Ï°¥ ÏÑ†ÌÉùÍ∞í Ï†ÄÏû•
            const currentSetName = filters.setName;

            // ÏÑ∏Ìä∏Ïù¥Î¶Ñ ÎìúÎ°≠Îã§Ïö¥ Ï¥àÍ∏∞Ìôî Î∞è Ïû¨ÏÑ§Ï†ï
            const setNameSelect = document.getElementById('filterSetName');

            setNameSelect.innerHTML = '<option value="">Ï†ÑÏ≤¥</option>';

            setNames.forEach(opt => {
                const option = document.createElement('option');
                option.value = opt;
                option.textContent = opt;
                setNameSelect.appendChild(option);
            });

            // Í∏∞Ï°¥ ÏÑ†ÌÉùÍ∞íÏù¥ ÏÉà ÏòµÏÖòÏóê Ï°¥Ïû¨ÌïòÎ©¥ Ïú†ÏßÄ, ÏïÑÎãàÎ©¥ Ï¥àÍ∏∞Ìôî
            if (setNames.includes(currentSetName)) {
                setNameSelect.value = currentSetName;
            } else {
                filters.setName = '';
                setNameSelect.value = '';
            }
        }

        // Í∏∞Í∞Ñ Î∞è Í∏∞Î≥∏ ÌïÑÌÑ∞ Ï¥àÍ∏∞Ìôî
        function resetBasicFilters() {
            // ÎÇ†Ïßú Î≤îÏúÑ Ï¥àÍ∏∞Ìôî (Ï†ÑÏ≤¥ Í∏∞Í∞ÑÏúºÎ°ú)
            setDateRange();

            // Í∏∞Î≥∏ ÌïÑÌÑ∞ Ï¥àÍ∏∞Ìôî
            filters.type = '';
            filters.brand = '';
            filters.product = '';
            filters.promotion = '';

            document.getElementById('filterType').value = '';
            document.getElementById('filterBrand').value = '';
            document.getElementById('filterProduct').value = '';
            document.getElementById('filterPromotion').value = '';

            // Í≥ÑÏ∏µ Íµ¨Ï°∞ ÌïÑÌÑ∞ Îã§Ïãú Î°úÎìú
            updateBrandFilter();

            // ÏÑ∏Î∂Ä ÌïÑÌÑ∞ÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
            updateDetailFilters();

            // ÎåÄÏãúÎ≥¥Îìú Í∞±Ïã†
            updateDashboard();
        }

        // ÏÑ∏Î∂Ä ÌïÑÌÑ∞ Ï¥àÍ∏∞Ìôî
        function resetDetailFilters() {
            filters.campaign = '';
            filters.setName = '';

            document.getElementById('filterCampaign').value = '';
            document.getElementById('filterSetName').value = '';

            // ÎåÄÏãúÎ≥¥Îìú Í∞±Ïã†
            updateDashboard();
        }

        // ÎÇ†Ïßú Î≤îÏúÑ ÏÑ§Ï†ï
        function setDateRange() {
            const dates = allData
                .map(d => d['Ïùº Íµ¨Î∂Ñ'])
                .filter(Boolean)
                .map(d => new Date(d))
                .filter(d => !isNaN(d));

            if (dates.length > 0) {
                const minDate = new Date(Math.min(...dates));
                const maxDate = new Date(Math.max(...dates));

                document.getElementById('startDate').value = formatDateForInput(minDate);
                document.getElementById('endDate').value = formatDateForInput(maxDate);

                filters.startDate = formatDateForInput(minDate);
                filters.endDate = formatDateForInput(maxDate);
            }
        }

        function formatDateForInput(date) {
            return date.toISOString().split('T')[0];
        }

        // Îç∞Ïù¥ÌÑ∞ ÌïÑÌÑ∞ÎßÅ
        function filterData() {
            return allData.filter(row => {
                // Í∏∞Î≥∏ ÌïÑÌÑ∞ Ï°∞Í±¥ ÌôïÏù∏
                if (filters.type && row['Ïú†ÌòïÍµ¨Î∂Ñ'] !== filters.type) return false;
                if (filters.brand && row['Î∏åÎûúÎìúÎ™Ö'] !== filters.brand) return false;
                if (filters.product && row['ÏÉÅÌíàÎ™Ö'] !== filters.product) return false;
                if (filters.promotion && row['ÌîÑÎ°úÎ™®ÏÖò'] !== filters.promotion) return false;

                // ÎÇ†Ïßú Î≤îÏúÑ ÌôïÏù∏
                if (filters.startDate || filters.endDate) {
                    const rowDate = new Date(row['Ïùº Íµ¨Î∂Ñ']);
                    if (isNaN(rowDate)) return false;

                    if (filters.startDate && rowDate < new Date(filters.startDate)) return false;
                    if (filters.endDate && rowDate > new Date(filters.endDate)) return false;
                }

                // ÏÑ∏Î∂Ä ÌïÑÌÑ∞ Ï°∞Í±¥ ÌôïÏù∏
                if (filters.campaign && row['Ï∫†ÌéòÏù∏'] !== filters.campaign) return false;
                if (filters.setName && row['ÏÑ∏Ìä∏Ïù¥Î¶Ñ'] !== filters.setName) return false;

                return true;
            });
        }

        // Îç∞Ïù¥ÌÑ∞ ÏßëÍ≥Ñ
        function aggregateData(data) {
            const groupKey = {
                'daily': 'Ïùº Íµ¨Î∂Ñ',
                'weekly': 'Ï£º Íµ¨Î∂Ñ',
                'monthly': 'Ïõî Íµ¨Î∂Ñ'
            }[currentView];

            const groups = {};

            data.forEach(row => {
                const key = row[groupKey];
                if (!key) return;

                if (!groups[key]) {
                    groups[key] = {
                        period: key,
                        ÎπÑÏö©: 0,
                        ÎÖ∏Ï∂ú: 0,
                        ÌÅ¥Î¶≠: 0,
                        Ï†ÑÌôòÏàò: 0,
                        Ï†ÑÌôòÍ∞í: 0
                    };
                }

                groups[key].ÎπÑÏö© += parseFloat(row['ÎπÑÏö©']) || 0;
                groups[key].ÎÖ∏Ï∂ú += parseFloat(row['ÎÖ∏Ï∂ú']) || 0;
                groups[key].ÌÅ¥Î¶≠ += parseFloat(row['ÌÅ¥Î¶≠']) || 0;
                groups[key].Ï†ÑÌôòÏàò += parseFloat(row['Ï†ÑÌôòÏàò']) || 0;
                groups[key].Ï†ÑÌôòÍ∞í += parseFloat(row['Ï†ÑÌôòÍ∞í']) || 0;
            });

            // KPI Í≥ÑÏÇ∞
            return Object.values(groups).map(g => ({
                ...g,
                CPM: g.ÎÖ∏Ï∂ú > 0 ? (g.ÎπÑÏö© / g.ÎÖ∏Ï∂ú * 1000) : 0,
                CPC: g.ÌÅ¥Î¶≠ > 0 ? (g.ÎπÑÏö© / g.ÌÅ¥Î¶≠) : 0,
                CPA: g.Ï†ÑÌôòÏàò > 0 ? (g.ÎπÑÏö© / g.Ï†ÑÌôòÏàò) : 0,
                ROAS: g.ÎπÑÏö© > 0 ? (g.Ï†ÑÌôòÍ∞í / g.ÎπÑÏö© * 100) : 0
            })).sort((a, b) => {
                // ÎÇ†ÏßúÏàú Ï†ïÎ†¨
                const dateA = new Date(a.period.replace(/\. /g, '-').replace(/\./g, ''));
                const dateB = new Date(b.period.replace(/\. /g, '-').replace(/\./g, ''));
                return dateA - dateB;
            });
        }

        // ÎåÄÏãúÎ≥¥Îìú ÏóÖÎç∞Ïù¥Ìä∏
        function updateDashboard() {
            const filteredData = filterData();
            const aggregatedData = aggregateData(filteredData);

            // KPI ÏóÖÎç∞Ïù¥Ìä∏
            updateKPIs(aggregatedData);

            // Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
            updateChart(aggregatedData);

            // ÌÖåÏù¥Î∏î ÏóÖÎç∞Ïù¥Ìä∏
            updateTable(aggregatedData);
        }

        // Ï∞®Ìä∏ Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
        let currentChartData = [];

        // Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
        function updateChart(data) {
            currentChartData = data;
            renderChart();
        }

        // Ï∞®Ìä∏ Î†åÎçîÎßÅ
        function renderChart() {
            const ctx = document.getElementById('trendChart').getContext('2d');

            // Í∏∞Ï°¥ Ï∞®Ìä∏ Ï†úÍ±∞
            if (trendChart) {
                trendChart.destroy();
            }

            const data = currentChartData;
            const labels = data.map(d => d.period);

            // Ï≤¥ÌÅ¨Î∞ïÏä§ ÏÉÅÌÉú ÌôïÏù∏
            const showCost = document.getElementById('chartCost').checked;
            const showCPM = document.getElementById('chartCPM').checked;
            const showCPC = document.getElementById('chartCPC').checked;
            const showCPA = document.getElementById('chartCPA').checked;
            const showROAS = document.getElementById('chartROAS').checked;

            // YÏ∂ï Í≤∞Ï†ï Î°úÏßÅ (Î™®Îì† Ï°∞Ìï© Í≥†Î†§)
            // Ïö∞ÏÑ†ÏàúÏúÑ: ÎπÑÏö© > CPM > CPC > CPA > ROAS
            // Ï≤´ Î≤àÏß∏ ÏßÄÌëúÎäî ÏôºÏ™Ω, ÎÇòÎ®∏ÏßÄÎäî Ïò§Î•∏Ï™Ω
            const hasCostMetric = showCost;
            const hasCpmMetric = showCPM;
            const hasCpcMetric = showCPC;
            const hasCpaMetric = showCPA;

            // Ïò§Î•∏Ï™Ω Ï∂ï ÏÇ¨Ïö© Ïó¨Î∂Ä Í≤∞Ï†ï (2Í∞ú Ïù¥ÏÉÅ ÏßÄÌëú ÏÑ†ÌÉù Ïãú)
            const selectedCount = (showCost ? 1 : 0) + (showCPM ? 1 : 0) + (showCPC ? 1 : 0) + (showCPA ? 1 : 0) + (showROAS ? 1 : 0);
            const useRightAxis = selectedCount >= 2;

            const datasets = [];

            if (showCost) {
                datasets.push({
                    label: 'ÎπÑÏö©',
                    data: data.map(d => d.ÎπÑÏö©),
                    backgroundColor: 'rgba(103, 58, 183, 0.7)',
                    borderColor: 'rgba(103, 58, 183, 1)',
                    borderWidth: 1,
                    borderRadius: 4,
                    yAxisID: 'y',
                    order: 4
                });
            }

            if (showCPM) {
                datasets.push({
                    label: 'CPM',
                    data: data.map(d => d.CPM),
                    type: 'line',
                    borderColor: 'rgba(255, 171, 0, 1)',
                    backgroundColor: 'rgba(255, 171, 0, 0.1)',
                    borderWidth: 2,
                    pointBackgroundColor: 'rgba(255, 171, 0, 1)',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2,
                    pointRadius: 3,
                    pointHoverRadius: 5,
                    fill: false,
                    tension: 0.4,
                    yAxisID: hasCostMetric ? 'y1' : 'y',
                    order: 3
                });
            }

            if (showCPC) {
                datasets.push({
                    label: 'CPC',
                    data: data.map(d => d.CPC),
                    type: 'line',
                    borderColor: 'rgba(33, 150, 243, 1)',
                    backgroundColor: 'rgba(33, 150, 243, 0.1)',
                    borderWidth: 2,
                    pointBackgroundColor: 'rgba(33, 150, 243, 1)',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2,
                    pointRadius: 3,
                    pointHoverRadius: 5,
                    fill: false,
                    tension: 0.4,
                    yAxisID: (hasCostMetric || hasCpmMetric) ? 'y1' : 'y',
                    order: 3
                });
            }

            if (showCPA) {
                datasets.push({
                    label: 'CPA',
                    data: data.map(d => d.CPA),
                    type: 'line',
                    borderColor: 'rgba(255, 152, 0, 1)',
                    backgroundColor: 'rgba(255, 152, 0, 0.1)',
                    borderWidth: 2,
                    pointBackgroundColor: 'rgba(255, 152, 0, 1)',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2,
                    pointRadius: 3,
                    pointHoverRadius: 5,
                    fill: false,
                    tension: 0.4,
                    yAxisID: (hasCostMetric || hasCpmMetric || hasCpcMetric) ? 'y1' : 'y',
                    order: 2
                });
            }

            if (showROAS) {
                datasets.push({
                    label: 'ROAS (%)',
                    data: data.map(d => d.ROAS),
                    type: 'line',
                    borderColor: 'rgba(0, 200, 83, 1)',
                    backgroundColor: 'rgba(0, 200, 83, 0.1)',
                    borderWidth: 3,
                    pointBackgroundColor: 'rgba(0, 200, 83, 1)',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2,
                    pointRadius: 4,
                    pointHoverRadius: 6,
                    fill: true,
                    tension: 0.4,
                    yAxisID: (hasCostMetric || hasCpmMetric || hasCpcMetric || hasCpaMetric) ? 'y1' : 'y',
                    order: 1
                });
            }

            // Ïò§Î•∏Ï™Ω YÏ∂ï ÌëúÏãú Ïó¨Î∂ÄÏôÄ ÌÉÄÏù¥ÌãÄ Í≤∞Ï†ï
            const showY1 = useRightAxis;

            // Ïò§Î•∏Ï™Ω YÏ∂ï ÌÉÄÏù¥ÌãÄ Í≤∞Ï†ï
            const y1Title = (function() {
                const rightMetrics = [];
                if (hasCostMetric && showCPM) rightMetrics.push('CPM');
                if ((hasCostMetric || hasCpmMetric) && showCPC) rightMetrics.push('CPC');
                if ((hasCostMetric || hasCpmMetric || hasCpcMetric) && showCPA) rightMetrics.push('CPA');
                if ((hasCostMetric || hasCpmMetric || hasCpcMetric || hasCpaMetric) && showROAS) rightMetrics.push('ROAS');

                if (rightMetrics.length === 0) return '';
                if (rightMetrics.includes('ROAS') && rightMetrics.length === 1) return 'ROAS (%)';
                if (rightMetrics.includes('ROAS')) return rightMetrics.join('/');
                return rightMetrics.join('/') + ' (Ïõê)';
            })();

            trendChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            align: 'end',
                            labels: {
                                usePointStyle: true,
                                padding: 20,
                                font: {
                                    family: "'Inter', sans-serif",
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(33, 33, 33, 0.9)',
                            titleFont: {
                                family: "'Inter', sans-serif",
                                size: 13
                            },
                            bodyFont: {
                                family: "'Inter', sans-serif",
                                size: 12
                            },
                            padding: 12,
                            cornerRadius: 8,
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.dataset.label === 'ROAS (%)') {
                                        label += Math.round(context.parsed.y) + '%';
                                    } else {
                                        label += formatNumber(context.parsed.y) + 'Ïõê';
                                    }
                                    return label;
                                }
                            }
                        },
                        datalabels: {
                            display: showDataLabels,
                            anchor: function(context) {
                                // bar Ï∞®Ìä∏Îäî end, line Ï∞®Ìä∏Îäî end
                                return 'end';
                            },
                            align: function(context) {
                                // bar Ï∞®Ìä∏Îäî top, line Ï∞®Ìä∏Îäî top
                                return 'top';
                            },
                            offset: 4,
                            font: {
                                family: "'Inter', sans-serif",
                                size: 11,
                                weight: '600'
                            },
                            color: function(context) {
                                // Îç∞Ïù¥ÌÑ∞ÏÖãÏùò ÏÉâÏÉÅ ÏÇ¨Ïö©
                                return context.dataset.borderColor || context.dataset.backgroundColor;
                            },
                            formatter: function(value, context) {
                                if (context.dataset.label === 'ROAS (%)') {
                                    return Math.round(value) + '%';
                                } else {
                                    // Î™®Îì† Ïà´ÏûêÎ•º ÏΩ§ÎßàÎ°ú Íµ¨Î∂ÑÌïòÏó¨ ÌëúÏãú
                                    return formatNumber(Math.round(value));
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                font: {
                                    family: "'Inter', sans-serif",
                                    size: 11
                                },
                                maxRotation: 45,
                                minRotation: 45
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: (function() {
                                    if (showCost) return 'ÎπÑÏö© (Ïõê)';
                                    if (showCPM) return 'CPM (Ïõê)';
                                    if (showCPC) return 'CPC (Ïõê)';
                                    if (showCPA) return 'CPA (Ïõê)';
                                    if (showROAS) return 'ROAS (%)';
                                    return 'Í∏àÏï° (Ïõê)';
                                })(),
                                font: {
                                    family: "'Inter', sans-serif",
                                    size: 12
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            ticks: {
                                font: {
                                    family: "'Inter', sans-serif",
                                    size: 11
                                },
                                callback: function(value) {
                                    // ROASÎßå ÏÑ†ÌÉùÎêú Í≤ΩÏö∞ % ÌëúÏãú
                                    if (!showCost && !showCPM && !showCPC && !showCPA && showROAS) {
                                        return value + '%';
                                    }
                                    if (value >= 1000000) {
                                        return (value / 1000000).toFixed(1) + 'M';
                                    } else if (value >= 1000) {
                                        return (value / 1000).toFixed(0) + 'K';
                                    }
                                    return value;
                                }
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: showY1,
                            position: 'right',
                            title: {
                                display: true,
                                text: y1Title,
                                font: {
                                    family: "'Inter', sans-serif",
                                    size: 12
                                }
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                            ticks: {
                                font: {
                                    family: "'Inter', sans-serif",
                                    size: 11
                                },
                                callback: function(value) {
                                    // Ïò§Î•∏Ï™Ω Ï∂ïÏóê ROASÎßå ÏûàÎäî Í≤ΩÏö∞ % ÌëúÏãú
                                    const rightMetrics = [];
                                    if (hasCostMetric && showCPM) rightMetrics.push('CPM');
                                    if ((hasCostMetric || hasCpmMetric) && showCPC) rightMetrics.push('CPC');
                                    if ((hasCostMetric || hasCpmMetric || hasCpcMetric) && showCPA) rightMetrics.push('CPA');
                                    if ((hasCostMetric || hasCpmMetric || hasCpcMetric || hasCpaMetric) && showROAS) rightMetrics.push('ROAS');

                                    if (rightMetrics.includes('ROAS') && rightMetrics.length === 1) {
                                        return value + '%';
                                    } else if (!rightMetrics.includes('ROAS')) {
                                        return formatNumber(value);
                                    }
                                    return value;
                                }
                            }
                        }
                    }
                }
            });
        }

        // KPI ÏóÖÎç∞Ïù¥Ìä∏
        function updateKPIs(data) {
            // 1. Ïã†Í∑ú KPI Î∞ïÏä§ - Ï†ÑÏ≤¥ Ìï©Í≥Ñ
            const totals = data.reduce((acc, row) => {
                acc.ÎπÑÏö© += row.ÎπÑÏö©;
                acc.ÎÖ∏Ï∂ú += row.ÎÖ∏Ï∂ú;
                acc.ÌÅ¥Î¶≠ += row.ÌÅ¥Î¶≠;
                acc.Ï†ÑÌôòÏàò += row.Ï†ÑÌôòÏàò;
                acc.Ï†ÑÌôòÍ∞í += row.Ï†ÑÌôòÍ∞í;
                return acc;
            }, { ÎπÑÏö©: 0, ÎÖ∏Ï∂ú: 0, ÌÅ¥Î¶≠: 0, Ï†ÑÌôòÏàò: 0, Ï†ÑÌôòÍ∞í: 0 });

            const totalCPM = totals.ÎÖ∏Ï∂ú > 0 ? (totals.ÎπÑÏö© / totals.ÎÖ∏Ï∂ú * 1000) : 0;
            const totalCPC = totals.ÌÅ¥Î¶≠ > 0 ? (totals.ÎπÑÏö© / totals.ÌÅ¥Î¶≠) : 0;
            const totalCPA = totals.Ï†ÑÌôòÏàò > 0 ? (totals.ÎπÑÏö© / totals.Ï†ÑÌôòÏàò) : 0;
            const totalROASValue = totals.ÎπÑÏö© > 0 ? (totals.Ï†ÑÌôòÍ∞í / totals.ÎπÑÏö© * 100) : 0;

            // Ïã†Í∑ú KPI Î∞ïÏä§ (Ï¥ùÌï©Í≥Ñ) ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('summaryTotalCost').textContent = formatNumber(totals.ÎπÑÏö©);
            document.getElementById('summaryTotalImpressions').textContent = formatNumber(totals.ÎÖ∏Ï∂ú);
            document.getElementById('summaryAvgCPM').textContent = formatNumber(totalCPM);
            document.getElementById('summaryTotalClicks').textContent = formatNumber(totals.ÌÅ¥Î¶≠);
            document.getElementById('summaryAvgCPC').textContent = formatNumber(totalCPC);
            document.getElementById('summaryTotalConversions').textContent = formatNumber(totals.Ï†ÑÌôòÏàò);
            document.getElementById('summaryAvgCPA').textContent = formatNumber(totalCPA);
            document.getElementById('summaryTotalConversionValue').textContent = formatNumber(totals.Ï†ÑÌôòÍ∞í);
            document.getElementById('summaryTotalROAS').textContent = formatROAS(totalROASValue);

            // 2. Í∏∞Ï°¥ KPI Î∞ïÏä§ - ÏµúÏã† Í∏∞Í∞Ñ Îç∞Ïù¥ÌÑ∞
            if (data.length >= 1) {
                const lastPeriodData = data[data.length - 1];
                const lastCPM = lastPeriodData.ÎÖ∏Ï∂ú > 0 ? (lastPeriodData.ÎπÑÏö© / lastPeriodData.ÎÖ∏Ï∂ú * 1000) : 0;
                const lastCPC = lastPeriodData.ÌÅ¥Î¶≠ > 0 ? (lastPeriodData.ÎπÑÏö© / lastPeriodData.ÌÅ¥Î¶≠) : 0;
                const lastCPA = lastPeriodData.Ï†ÑÌôòÏàò > 0 ? (lastPeriodData.ÎπÑÏö© / lastPeriodData.Ï†ÑÌôòÏàò) : 0;
                const lastROAS = lastPeriodData.ÎπÑÏö© > 0 ? (lastPeriodData.Ï†ÑÌôòÍ∞í / lastPeriodData.ÎπÑÏö© * 100) : 0;

                document.getElementById('totalCost').textContent = formatNumber(lastPeriodData.ÎπÑÏö©);
                document.getElementById('totalImpressions').textContent = formatNumber(lastPeriodData.ÎÖ∏Ï∂ú);
                document.getElementById('avgCPM').textContent = formatNumber(lastCPM);
                document.getElementById('totalClicks').textContent = formatNumber(lastPeriodData.ÌÅ¥Î¶≠);
                document.getElementById('avgCPC').textContent = formatNumber(lastCPC);
                document.getElementById('totalConversions').textContent = formatNumber(lastPeriodData.Ï†ÑÌôòÏàò);
                document.getElementById('avgCPA').textContent = formatNumber(lastCPA);
                document.getElementById('totalConversionValue').textContent = formatNumber(lastPeriodData.Ï†ÑÌôòÍ∞í);
                document.getElementById('totalROAS').textContent = formatROAS(lastROAS);
            } else {
                document.getElementById('totalCost').textContent = '-';
                document.getElementById('totalImpressions').textContent = '-';
                document.getElementById('avgCPM').textContent = '-';
                document.getElementById('totalClicks').textContent = '-';
                document.getElementById('avgCPC').textContent = '-';
                document.getElementById('totalConversions').textContent = '-';
                document.getElementById('avgCPA').textContent = '-';
                document.getElementById('totalConversionValue').textContent = '-';
                document.getElementById('totalROAS').textContent = '-';
            }

            // Ï¶ùÍ∞êÏú® Í≥ÑÏÇ∞ (ÎßàÏßÄÎßâ Í∏∞Í∞Ñ vs ÏßÅÏ†Ñ Í∏∞Í∞Ñ ÎπÑÍµê)
            // ÌÖåÏù¥Î∏î ÏµúÌïòÎã®Ïù¥ ÏµúÏã† Îç∞Ïù¥ÌÑ∞, Í∑∏ ÏúÑÍ∞Ä Ïù¥Ï†Ñ Îç∞Ïù¥ÌÑ∞
            if (data.length >= 2) {
                // ÎßàÏßÄÎßâ Í∏∞Í∞ÑÍ≥º ÏßÅÏ†Ñ Í∏∞Í∞Ñ (ÌÖåÏù¥Î∏î ÏàúÏÑú Í∏∞Ï§Ä)
                const lastPeriodData = data[data.length - 1];
                const prevPeriodData = data[data.length - 2];

                const calcMetrics = (row) => {
                    return {
                        ÎπÑÏö©: row.ÎπÑÏö©,
                        ÎÖ∏Ï∂ú: row.ÎÖ∏Ï∂ú,
                        ÌÅ¥Î¶≠: row.ÌÅ¥Î¶≠,
                        Ï†ÑÌôòÏàò: row.Ï†ÑÌôòÏàò,
                        Ï†ÑÌôòÍ∞í: row.Ï†ÑÌôòÍ∞í,
                        CPM: row.ÎÖ∏Ï∂ú > 0 ? (row.ÎπÑÏö© / row.ÎÖ∏Ï∂ú * 1000) : 0,
                        CPC: row.ÌÅ¥Î¶≠ > 0 ? (row.ÎπÑÏö© / row.ÌÅ¥Î¶≠) : 0,
                        CPA: row.Ï†ÑÌôòÏàò > 0 ? (row.ÎπÑÏö© / row.Ï†ÑÌôòÏàò) : 0,
                        ROAS: row.ÎπÑÏö© > 0 ? (row.Ï†ÑÌôòÍ∞í / row.ÎπÑÏö© * 100) : 0
                    };
                };

                const first = calcMetrics(prevPeriodData);  // Ïù¥Ï†Ñ Í∏∞Í∞Ñ
                const second = calcMetrics(lastPeriodData); // ÌòÑÏû¨ Í∏∞Í∞Ñ (ÎßàÏßÄÎßâ)

                const calcChange = (newVal, oldVal) => {
                    if (oldVal === 0) return newVal > 0 ? 100 : 0;
                    return ((newVal - oldVal) / oldVal * 100);
                };

                // Ï¶ùÍ∞êÏú® ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò
                const updateTrend = (id, change, oldValue, newValue, isGoodWhenUp = true, isPercentage = false) => {
                    const el = document.getElementById(id);
                    const ppEl = document.getElementById(id + 'PP');
                    const detailEl = document.getElementById(id + 'Detail');
                    if (!el) return;

                    const isUp = change >= 0;
                    const isGood = isGoodWhenUp ? isUp : !isUp;

                    // kpi-trend ÌÅ¥ÎûòÏä§ ÏóÖÎç∞Ïù¥Ìä∏
                    el.className = `kpi-trend ${isGood ? 'up' : 'down'}`;

                    // trend-value ÏóÖÎç∞Ïù¥Ìä∏
                    const trendValueEl = el.querySelector('.trend-value');
                    if (trendValueEl) {
                        const arrow = isUp ? '‚Üë' : '‚Üì';
                        trendValueEl.textContent = `${arrow} ${Math.abs(Math.round(change))}%`;
                    }

                    // trend-pp ÏóÖÎç∞Ïù¥Ìä∏ (%p ÎòêÎäî ÏàòÏπò Ï∞®Ïù¥)
                    if (ppEl) {
                        if (isPercentage) {
                            // ROAS Îì± ÌçºÏÑºÌä∏ ÏßÄÌëú: %pÎ°ú ÌëúÏãú
                            const pp = newValue - oldValue;
                            const ppSign = pp >= 0 ? '+' : '';
                            ppEl.textContent = `${ppSign}${Math.round(pp)}%p`;
                            ppEl.className = `trend-pp ${pp >= 0 ? 'positive' : 'negative'}`;
                        } else {
                            // ÏùºÎ∞ò Ïà´Ïûê: Ï∞®Ïù¥Í∞í ÌëúÏãú
                            const diff = newValue - oldValue;
                            const diffSign = diff >= 0 ? '+' : '';
                            ppEl.textContent = `${diffSign}${formatNumber(diff)}`;
                            ppEl.className = `trend-pp ${isGood ? 'positive' : 'negative'}`;
                        }
                    }

                    // ÏÉÅÏÑ∏ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏ (Ïù¥Ï†Ñ Í∞í)
                    if (detailEl) {
                        if (isPercentage) {
                            detailEl.innerHTML = `<span class="prev-label">Ïù¥Ï†Ñ</span><span class="prev-value">${Math.round(oldValue)}%</span>`;
                        } else {
                            detailEl.innerHTML = `<span class="prev-label">Ïù¥Ï†Ñ</span><span class="prev-value">${formatNumber(oldValue)}</span>`;
                        }
                    }
                };

                // ÎπÑÏö©, ÎÖ∏Ï∂ú, ÌÅ¥Î¶≠, Ï†ÑÌôòÏàò, Ï†ÑÌôòÍ∞íÏùÄ Ï¶ùÍ∞ÄÍ∞Ä Ï¢ãÏùå
                updateTrend('trendCost', calcChange(second.ÎπÑÏö©, first.ÎπÑÏö©), first.ÎπÑÏö©, second.ÎπÑÏö©, true, false);
                updateTrend('trendImpressions', calcChange(second.ÎÖ∏Ï∂ú, first.ÎÖ∏Ï∂ú), first.ÎÖ∏Ï∂ú, second.ÎÖ∏Ï∂ú, true, false);
                updateTrend('trendClicks', calcChange(second.ÌÅ¥Î¶≠, first.ÌÅ¥Î¶≠), first.ÌÅ¥Î¶≠, second.ÌÅ¥Î¶≠, true, false);
                updateTrend('trendConversions', calcChange(second.Ï†ÑÌôòÏàò, first.Ï†ÑÌôòÏàò), first.Ï†ÑÌôòÏàò, second.Ï†ÑÌôòÏàò, true, false);
                updateTrend('trendConversionValue', calcChange(second.Ï†ÑÌôòÍ∞í, first.Ï†ÑÌôòÍ∞í), first.Ï†ÑÌôòÍ∞í, second.Ï†ÑÌôòÍ∞í, true, false);
                updateTrend('trendROAS', calcChange(second.ROAS, first.ROAS), first.ROAS, second.ROAS, true, true);

                // CPM, CPC, CPAÎäî Í∞êÏÜåÍ∞Ä Ï¢ãÏùå
                updateTrend('trendCPM', calcChange(second.CPM, first.CPM), first.CPM, second.CPM, false, false);
                updateTrend('trendCPC', calcChange(second.CPC, first.CPC), first.CPC, second.CPC, false, false);
                updateTrend('trendCPA', calcChange(second.CPA, first.CPA), first.CPA, second.CPA, false, false);
            } else {
                // Îç∞Ïù¥ÌÑ∞Í∞Ä Î∂ÄÏ°±Ìï† Îïå Î™®Îì† trend ÏöîÏÜå Ï¥àÍ∏∞Ìôî
                const resetTrend = (id) => {
                    const el = document.getElementById(id);
                    const ppEl = document.getElementById(id + 'PP');
                    const detailEl = document.getElementById(id + 'Detail');

                    if (el) {
                        el.className = 'kpi-trend neutral';
                        const trendValueEl = el.querySelector('.trend-value');
                        if (trendValueEl) {
                            trendValueEl.textContent = '-';
                        }
                    }
                    if (ppEl) {
                        ppEl.textContent = '';
                        ppEl.className = 'trend-pp';
                    }
                    if (detailEl) {
                        detailEl.innerHTML = '';
                    }
                };

                // Î™®Îì† KPI trend ÏöîÏÜå Ï¥àÍ∏∞Ìôî
                resetTrend('trendCost');
                resetTrend('trendImpressions');
                resetTrend('trendClicks');
                resetTrend('trendConversions');
                resetTrend('trendConversionValue');
                resetTrend('trendROAS');
                resetTrend('trendCPM');
                resetTrend('trendCPC');
                resetTrend('trendCPA');
            }
        }

        // ÌÖåÏù¥Î∏î ÏóÖÎç∞Ïù¥Ìä∏
        const TABLE_ROW_LIMIT = 10;
        let isTableExpanded = false;

        function updateTable(data) {
            const tbody = document.getElementById('tableBody');
            const showMoreContainer = document.getElementById('showMoreContainer');
            const hiddenCountSpan = document.getElementById('hiddenCount');

            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="10" class="loading">Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</td></tr>';
                showMoreContainer.style.display = 'none';
                return;
            }

            // Ìï©Í≥Ñ Í≥ÑÏÇ∞
            const totals = data.reduce((acc, row) => {
                acc.ÎπÑÏö© += row.ÎπÑÏö©;
                acc.ÎÖ∏Ï∂ú += row.ÎÖ∏Ï∂ú;
                acc.ÌÅ¥Î¶≠ += row.ÌÅ¥Î¶≠;
                acc.Ï†ÑÌôòÏàò += row.Ï†ÑÌôòÏàò;
                acc.Ï†ÑÌôòÍ∞í += row.Ï†ÑÌôòÍ∞í;
                return acc;
            }, { ÎπÑÏö©: 0, ÎÖ∏Ï∂ú: 0, ÌÅ¥Î¶≠: 0, Ï†ÑÌôòÏàò: 0, Ï†ÑÌôòÍ∞í: 0 });

            const hiddenCount = Math.max(0, data.length - TABLE_ROW_LIMIT);

            let html = data.map((row, index) => `
                <tr class="${!isTableExpanded && index >= TABLE_ROW_LIMIT ? 'hidden-row' : ''}">
                    <td>${row.period}</td>
                    <td>${formatNumber(row.ÎπÑÏö©)}</td>
                    <td>${formatNumber(row.ÎÖ∏Ï∂ú)}</td>
                    <td>${formatNumber(row.CPM)}</td>
                    <td>${formatNumber(row.ÌÅ¥Î¶≠)}</td>
                    <td>${formatNumber(row.CPC)}</td>
                    <td>${formatNumber(row.Ï†ÑÌôòÏàò)}</td>
                    <td>${formatNumber(row.CPA)}</td>
                    <td>${formatNumber(row.Ï†ÑÌôòÍ∞í)}</td>
                    <td class="${row.ROAS >= 100 ? 'positive' : 'negative'}">${formatROAS(row.ROAS)}</td>
                </tr>
            `).join('');

            // Ìï©Í≥Ñ Ìñâ Ï∂îÍ∞Ä
            const totalCPM = totals.ÎÖ∏Ï∂ú > 0 ? (totals.ÎπÑÏö© / totals.ÎÖ∏Ï∂ú * 1000) : 0;
            const totalCPC = totals.ÌÅ¥Î¶≠ > 0 ? (totals.ÎπÑÏö© / totals.ÌÅ¥Î¶≠) : 0;
            const totalCPA = totals.Ï†ÑÌôòÏàò > 0 ? (totals.ÎπÑÏö© / totals.Ï†ÑÌôòÏàò) : 0;
            const totalROAS = totals.ÎπÑÏö© > 0 ? (totals.Ï†ÑÌôòÍ∞í / totals.ÎπÑÏö© * 100) : 0;

            html += `
                <tr class="total-row">
                    <td>Ìï©Í≥Ñ</td>
                    <td>${formatNumber(totals.ÎπÑÏö©)}</td>
                    <td>${formatNumber(totals.ÎÖ∏Ï∂ú)}</td>
                    <td>${formatNumber(totalCPM)}</td>
                    <td>${formatNumber(totals.ÌÅ¥Î¶≠)}</td>
                    <td>${formatNumber(totalCPC)}</td>
                    <td>${formatNumber(totals.Ï†ÑÌôòÏàò)}</td>
                    <td>${formatNumber(totalCPA)}</td>
                    <td>${formatNumber(totals.Ï†ÑÌôòÍ∞í)}</td>
                    <td class="${totalROAS >= 100 ? 'positive' : 'negative'}">${formatROAS(totalROAS)}</td>
                </tr>
            `;

            tbody.innerHTML = html;

            // Îçî Î≥¥Í∏∞ Î≤ÑÌäº ÌëúÏãú/Ïà®ÍπÄ
            if (hiddenCount > 0 && !isTableExpanded) {
                showMoreContainer.style.display = 'block';
                hiddenCountSpan.textContent = hiddenCount;
            } else {
                showMoreContainer.style.display = 'none';
            }
        }

        // Îçî Î≥¥Í∏∞ Î≤ÑÌäº ÌÅ¥Î¶≠ Ìï∏Îì§Îü¨
        function expandTableRows() {
            isTableExpanded = true;
            const hiddenRows = document.querySelectorAll('#tableBody .hidden-row');
            const showMoreContainer = document.getElementById('showMoreContainer');
            const collapseContainer = document.getElementById('collapseContainer');

            hiddenRows.forEach(row => {
                row.classList.remove('hidden-row');
            });

            showMoreContainer.style.display = 'none';
            collapseContainer.style.display = 'block';
        }

        // Ï†ëÍ∏∞ Î≤ÑÌäº ÌÅ¥Î¶≠ Ìï∏Îì§Îü¨
        function collapseTableRows() {
            isTableExpanded = false;
            const tbody = document.getElementById('tableBody');
            const rows = tbody.querySelectorAll('tr:not(.total-row)');
            const showMoreContainer = document.getElementById('showMoreContainer');
            const collapseContainer = document.getElementById('collapseContainer');
            const hiddenCountSpan = document.getElementById('hiddenCount');

            rows.forEach((row, index) => {
                if (index >= TABLE_ROW_LIMIT) {
                    row.classList.add('hidden-row');
                }
            });

            const hiddenCount = Math.max(0, rows.length - TABLE_ROW_LIMIT);
            if (hiddenCount > 0) {
                showMoreContainer.style.display = 'block';
                hiddenCountSpan.textContent = hiddenCount;
            }
            collapseContainer.style.display = 'none';
        }

        // Ïà´Ïûê Ìè¨Îß∑ - #,###;;-;@ ÌòïÏãù (0ÏùÄ '-'Î°ú ÌëúÏãú)
        function formatNumber(num) {
            if (num === 0 || num === null || num === undefined) return '-';
            return Math.round(num).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }

        // ROAS Ìè¨Îß∑ - 0%;;-;@ ÌòïÏãù (0ÏùÄ '-'Î°ú ÌëúÏãú, %Îäî Ï†ïÏàò)
        function formatROAS(num) {
            if (num === 0 || num === null || num === undefined) return '-';
            return Math.round(num) + '%';
        }

        // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
        document.addEventListener('DOMContentLoaded', () => {
            loadData();

            // ÌïÑÌÑ∞ ÏÑπÏÖò Ï†ëÍ∏∞/ÌéºÏπòÍ∏∞
            document.querySelectorAll('.collapsible-header').forEach(header => {
                header.addEventListener('click', function() {
                    const section = this.parentElement;
                    const content = section.querySelector('.collapsible-content');
                    const toggleBtn = section.querySelector('.collapsible-toggle');
                    const toggleIcon = section.querySelector('.collapsible-toggle-icon');
                    const toggleText = toggleBtn.querySelector('span:first-child');

                    if (content.classList.contains('expanded')) {
                        content.classList.remove('expanded');
                        toggleIcon.classList.add('collapsed');
                        toggleText.textContent = 'ÌéºÏπòÍ∏∞';
                    } else {
                        content.classList.add('expanded');
                        toggleIcon.classList.remove('collapsed');
                        toggleText.textContent = 'Ï†ëÍ∏∞';
                    }
                });
            });

            // Í∏∞Î≥∏ ÌïÑÌÑ∞ Î≥ÄÍ≤Ω Ïù¥Î≤§Ìä∏ (Í≥ÑÏ∏µ Íµ¨Ï°∞: Ïú†ÌòïÍµ¨Î∂Ñ ‚Üí Î∏åÎûúÎìúÎ™Ö ‚Üí ÏÉÅÌíàÎ™Ö ‚Üí ÌîÑÎ°úÎ™®ÏÖò)
            document.getElementById('filterType').addEventListener('change', e => {
                filters.type = e.target.value;
                // Ïú†ÌòïÍµ¨Î∂Ñ Î≥ÄÍ≤Ω Ïãú ÌïòÏúÑ ÌïÑÌÑ∞ Î™®Îëê ÏóÖÎç∞Ïù¥Ìä∏
                updateBrandFilter();
                updateDetailFilters();
                updateDashboard();
            });

            document.getElementById('filterBrand').addEventListener('change', e => {
                filters.brand = e.target.value;
                // Î∏åÎûúÎìúÎ™Ö Î≥ÄÍ≤Ω Ïãú ÌïòÏúÑ ÌïÑÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏
                updateProductFilter();
                updateDetailFilters();
                updateDashboard();
            });

            document.getElementById('filterProduct').addEventListener('change', e => {
                filters.product = e.target.value;
                // ÏÉÅÌíàÎ™Ö Î≥ÄÍ≤Ω Ïãú ÌïòÏúÑ ÌïÑÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏
                updatePromotionFilter();
                updateDetailFilters();
                updateDashboard();
            });

            document.getElementById('filterPromotion').addEventListener('change', e => {
                filters.promotion = e.target.value;
                updateDetailFilters();
                updateDashboard();
            });

            document.getElementById('startDate').addEventListener('change', e => {
                filters.startDate = e.target.value;
                updateDetailFilters();
                updateDashboard();
            });

            document.getElementById('endDate').addEventListener('change', e => {
                filters.endDate = e.target.value;
                updateDetailFilters();
                updateDashboard();
            });

            // ÏÑ∏Î∂Ä ÌïÑÌÑ∞ Î≥ÄÍ≤Ω Ïù¥Î≤§Ìä∏
            document.getElementById('filterCampaign').addEventListener('change', e => {
                filters.campaign = e.target.value;
                // Ï∫†ÌéòÏù∏ Î≥ÄÍ≤Ω Ïãú ÏÑ∏Ìä∏Ïù¥Î¶Ñ ÌïÑÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏ (ÌïòÏúÑ ÏÜçÏÑ±)
                updateSetNameFilter();
                updateDashboard();
            });

            document.getElementById('filterSetName').addEventListener('change', e => {
                filters.setName = e.target.value;
                updateDashboard();
            });

            // KPI ÌÉ≠ Î≤ÑÌäº (Ï†ÑÏ≤¥/ÏùºÎ≥Ñ/Ï£ºÎ≥Ñ/ÏõîÎ≥Ñ)
            document.querySelectorAll('.kpi-tab').forEach(btn => {
                btn.addEventListener('click', () => {
                    // ÌÉ≠ Î≤ÑÌäº ÌôúÏÑ±Ìôî ÌÜ†Í∏Ä
                    document.querySelectorAll('.kpi-tab').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');

                    const tabType = btn.dataset.kpiTab;
                    const totalContent = document.getElementById('kpiTabTotal');
                    const periodContent = document.getElementById('kpiTabPeriod');

                    if (tabType === 'total') {
                        // Ï†ÑÏ≤¥ ÌÉ≠: ÏöîÏïΩ Îç∞Ïù¥ÌÑ∞ ÌëúÏãú
                        totalContent.classList.add('active');
                        periodContent.classList.remove('active');
                    } else {
                        // ÏùºÎ≥Ñ/Ï£ºÎ≥Ñ/ÏõîÎ≥Ñ ÌÉ≠: Í∏∞Í∞ÑÎ≥Ñ Îç∞Ïù¥ÌÑ∞ ÌëúÏãú
                        totalContent.classList.remove('active');
                        periodContent.classList.add('active');

                        // currentView ÏóÖÎç∞Ïù¥Ìä∏ Î∞è ÎåÄÏãúÎ≥¥Îìú Í∞±Ïã†
                        currentView = tabType;
                        updateDashboard();
                    }
                });
            });

            // KPI Ï£ºÏöî/ÏÑ∏Î∂Ä ÏÑ±Í≥º ÌÜ†Í∏Ä Î≤ÑÌäº
            document.querySelectorAll('.kpi-unified-section .kpi-view-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    // Î≤ÑÌäº ÌôúÏÑ±Ìôî ÌÜ†Í∏Ä
                    document.querySelectorAll('.kpi-unified-section .kpi-view-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');

                    // Î™®Îì† kpi-sectionÏóê show-all ÌÜ†Í∏Ä (Ï†ÑÏ≤¥ ÌÉ≠ + Í∏∞Í∞ÑÎ≥Ñ ÌÉ≠)
                    document.querySelectorAll('.kpi-unified-section .kpi-section').forEach(section => {
                        if (btn.dataset.kpiView === 'all') {
                            section.classList.add('show-all');
                        } else {
                            section.classList.remove('show-all');
                        }
                    });
                });
            });

            // Ï∞®Ìä∏ ÌÜ†Í∏Ä Î≤ÑÌäº Ïù¥Î≤§Ìä∏ (data-label-toggle Ïä§ÌÉÄÏùº)
            document.querySelectorAll('.chart-toggle-group .data-label-toggle').forEach(btn => {
                btn.addEventListener('click', function() {
                    const checkboxId = this.dataset.chartToggle;
                    const checkbox = document.getElementById(checkboxId);
                    const toggleCheckbox = this.querySelector('.toggle-checkbox');

                    // ÌÜ†Í∏Ä ÏÉÅÌÉú Ï†ÑÌôò
                    checkbox.checked = !checkbox.checked;

                    if (checkbox.checked) {
                        this.classList.add('active');
                        toggleCheckbox.textContent = '‚úì';
                    } else {
                        this.classList.remove('active');
                        toggleCheckbox.textContent = '‚òê';
                    }

                    renderChart();
                });
            });

            // Îç∞Ïù¥ÌÑ∞ ÎùºÎ≤® ÌÜ†Í∏Ä Î≤ÑÌäº Ïù¥Î≤§Ìä∏
            document.getElementById('dataLabelToggle').addEventListener('click', function() {
                showDataLabels = !showDataLabels;
                const toggleCheckbox = this.querySelector('.toggle-checkbox');

                if (showDataLabels) {
                    this.classList.add('active');
                    toggleCheckbox.textContent = '‚òë';
                } else {
                    this.classList.remove('active');
                    toggleCheckbox.textContent = '‚òê';
                }

                renderChart();
            });

            // Îçî Î≥¥Í∏∞ Î≤ÑÌäº Ïù¥Î≤§Ìä∏
            document.getElementById('showMoreBtn').addEventListener('click', expandTableRows);

            // Ï†ëÍ∏∞ Î≤ÑÌäº Ïù¥Î≤§Ìä∏
            document.getElementById('collapseBtn').addEventListener('click', collapseTableRows);
        });
    </script>
</body>
</html>
