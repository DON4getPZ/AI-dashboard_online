<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì±„ë„ë³„ ë¶„ì„ ëŒ€ì‹œë³´ë“œ - ë¸Œëœë“œ/ìƒí’ˆ/í”„ë¡œëª¨ì…˜ ì¸ì‚¬ì´íŠ¸</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <!-- D3.js -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        :root {
            /* Berry Theme Colors */
            --primary-main: #673ab7;
            --primary-light: #ede7f6;
            --primary-dark: #5e35b1;
            --secondary-main: #2196f3;
            --secondary-light: #e3f2fd;
            --success-main: #00c853;
            --success-light: #b9f6ca;
            --warning-main: #ffab00;
            --warning-light: #fff8e1;
            --error-main: #ff1744;
            --error-light: #ffeaea;
            --grey-50: #fafafa;
            --grey-100: #f5f5f5;
            --grey-200: #eeeeee;
            --grey-300: #e0e0e0;
            --grey-500: #9e9e9e;
            --grey-600: #757575;
            --grey-700: #616161;
            --grey-900: #212121;
            --paper: #ffffff;
            --background: #f8fafc;
            --sidebar-bg: #ffffff;
            --sidebar-width: 260px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Roboto', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--background);
            color: var(--grey-900);
            line-height: 1.5;
        }

        /* ë ˆì´ì•„ì›ƒ êµ¬ì¡° */
        .app-wrapper {
            display: flex;
            min-height: 100vh;
        }

        /* ì‚¬ì´ë“œë°” */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--sidebar-bg);
            border-right: 1px solid var(--grey-200);
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
        }

        .sidebar-header {
            padding: 24px 20px;
            border-bottom: 1px solid var(--grey-200);
        }

        .sidebar-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
        }

        .sidebar-logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary-main) 0%, var(--primary-dark) 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sidebar-logo-icon svg {
            width: 24px;
            height: 24px;
            stroke: white;
            fill: none;
            stroke-width: 2;
        }

        .sidebar-logo-text {
            display: flex;
            flex-direction: column;
        }

        .sidebar-logo-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--grey-900);
            line-height: 1;
        }

        .sidebar-logo-subtitle {
            font-size: 11px;
            color: var(--grey-500);
            margin-top: 4px;
        }

        .simplebar-content-wrapper {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .simplebar-content-wrapper::-webkit-scrollbar {
            width: 6px;
        }

        .simplebar-content-wrapper::-webkit-scrollbar-track {
            background: transparent;
        }

        .simplebar-content-wrapper::-webkit-scrollbar-thumb {
            background: var(--grey-300);
            border-radius: 3px;
        }

        .sidebar-content {
            padding: 16px 12px;
        }

        .nav-group {
            margin-bottom: 16px;
        }

        .nav-group-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--grey-500);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 0 8px;
            margin-bottom: 4px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 10px 12px;
            color: var(--grey-700);
            text-decoration: none;
            transition: all 0.2s;
            cursor: pointer;
            border-radius: 8px;
            margin-bottom: 2px;
        }

        .nav-item:hover {
            background-color: var(--grey-100);
            color: var(--primary-main);
        }

        .nav-item.active {
            background-color: var(--primary-light);
            color: var(--primary-main);
            font-weight: 500;
        }

        .nav-item-icon {
            width: 20px;
            height: 20px;
            margin-right: 10px;
        }

        .nav-item-icon svg {
            width: 100%;
            height: 100%;
            fill: currentColor;
        }

        .nav-item-text {
            font-size: 14px;
        }

        .nav-section {
            margin-bottom: 24px;
        }

        .nav-section-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--grey-500);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 0 12px;
            margin-bottom: 8px;
        }

        /* ì ‘ê¸°/í¼ì¹˜ê¸° ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
        .collapsible-section {
            margin-bottom: 24px;
        }

        .collapsible-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            background: var(--paper);
            border-radius: 12px;
            cursor: pointer;
            user-select: none;
            transition: box-shadow 0.2s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            border: 1px solid var(--grey-200);
        }

        .collapsible-header:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
        }

        .collapsible-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 18px;
            font-weight: 600;
            color: var(--grey-900);
        }

        .collapsible-icon {
            font-size: 24px;
        }

        .collapsible-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: var(--primary-light);
            color: var(--primary-main);
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.15s ease, color 0.15s ease;
        }

        .collapsible-toggle:hover {
            background: var(--primary-main);
            color: white;
        }

        .collapsible-toggle-icon {
            transition: transform 0.2s ease;
            transform: rotate(180deg);
        }

        .collapsible-toggle-icon.collapsed {
            transform: rotate(0deg);
        }

        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            opacity: 0;
            padding: 0 24px;
            transition: max-height 0.3s ease, opacity 0.2s ease, padding 0.3s ease;
        }

        .collapsible-content.expanded {
            max-height: 5000px;
            opacity: 1;
            padding: 24px;
        }

        /* ì¸ë¼ì¸ ì ‘ê¸°/í¼ì¹˜ê¸° í† ê¸€ (í†µì¼ëœ ìŠ¤íƒ€ì¼) */
        .inline-toggle {
            padding: 10px 16px;
            background: var(--primary-light);
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid var(--grey-200);
            transition: all 0.2s ease;
            margin-top: 12px;
        }

        .inline-toggle:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            background: var(--primary-main);
        }

        .inline-toggle:hover .inline-toggle-label,
        .inline-toggle:hover .inline-toggle-action {
            color: white;
        }

        .inline-toggle-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--primary-main);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .inline-toggle-badge {
            padding: 2px 8px;
            background: white;
            color: var(--primary-main);
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .inline-toggle-action {
            font-size: 12px;
            color: var(--primary-main);
            display: flex;
            align-items: center;
            gap: 4px;
            font-weight: 500;
        }

        /* ê²½ê³  ìŠ¤íƒ€ì¼ í† ê¸€ (ë¹¨ê°•) */
        .inline-toggle.warning-style {
            background: linear-gradient(135deg, #ffebee 0%, #fff5f5 100%);
            border-color: #ffcdd2;
        }

        .inline-toggle.warning-style .inline-toggle-label {
            color: #d32f2f;
        }

        .inline-toggle.warning-style .inline-toggle-badge {
            background: #ffcdd2;
            color: #c62828;
        }

        .inline-toggle.warning-style .inline-toggle-action {
            color: #d32f2f;
        }

        .inline-toggle.warning-style:hover {
            background: #ef5350;
        }

        /* ì£¼ì˜ ìŠ¤íƒ€ì¼ í† ê¸€ (ì£¼í™©) */
        .inline-toggle.caution-style {
            background: linear-gradient(135deg, #fff3e0 0%, #fff8f0 100%);
            border-color: #ffe0b2;
        }

        .inline-toggle.caution-style .inline-toggle-label {
            color: #e65100;
        }

        .inline-toggle.caution-style .inline-toggle-badge {
            background: #ffe0b2;
            color: #e65100;
        }

        .inline-toggle.caution-style .inline-toggle-action {
            color: #e65100;
        }

        .inline-toggle.caution-style:hover {
            background: #ff9800;
        }

        .inline-toggle-content {
            display: none;
            padding: 12px 0;
            margin-top: 8px;
        }

        .inline-toggle-content.expanded {
            display: block;
        }

        /* ë” ë³´ê¸°/ì ‘ê¸° ë²„íŠ¼ (ê°„ì†Œí™”) */
        .show-more-btn {
            padding: 8px 20px;
            background: var(--grey-100);
            color: var(--grey-700);
            border: 1px solid var(--grey-300);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            font-size: 12px;
            font-family: inherit;
            transition: all 0.2s ease;
        }

        .show-more-btn:hover {
            background: var(--primary-light);
            color: var(--primary-main);
            border-color: var(--primary-main);
        }

        .show-more-btn.warning-style {
            background: #fff5f5;
            color: #d32f2f;
            border-color: #ffcdd2;
        }

        .show-more-btn.warning-style:hover {
            background: #ffebee;
            border-color: #ef5350;
        }

        .show-more-btn.caution-style {
            background: #fff8f0;
            color: #e65100;
            border-color: #ffe0b2;
        }

        .show-more-btn.caution-style:hover {
            background: #fff3e0;
            border-color: #ff9800;
        }

        /* ë·° íƒ€ì… ì„ íƒ ì„¹ì…˜ */
        .view-type-section {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .view-btn {
            padding: 10px 20px;
            background: var(--grey-100);
            color: var(--grey-700);
            border: 1px solid var(--grey-300);
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .view-btn:hover {
            background: var(--grey-200);
            border-color: var(--grey-400);
        }

        .view-btn.active {
            background: var(--primary-main);
            color: white;
            border-color: var(--primary-main);
        }

        /* ê¸°ê°„ í•„í„° ì ìš©/ë¯¸ì ìš© íƒ­ ìŠ¤íƒ€ì¼ */
        .decision-tool-tab-btn.period-filter-disabled {
            background: #f5f5f5;
            border-color: #bdbdbd;
            border-style: dashed;
        }

        .decision-tool-tab-btn.period-filter-disabled:hover {
            background: #eeeeee;
            border-color: #9e9e9e;
        }

        .decision-tool-tab-btn.period-filter-disabled.active {
            background: #78909c;
            color: white;
            border-color: #78909c;
            border-style: solid;
        }

        /* íƒ­ ì»¨í…ì¸  ìŠ¤íƒ€ì¼ */
        .trend-analysis-tab-content {
            display: none;
        }

        .trend-analysis-tab-content.active {
            display: block;
        }

        /* ë©”ì¸ ì»¨í…ì¸  */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 24px;
            max-width: 1600px;
            margin-right: auto;
        }

        .dashboard-header {
            margin-bottom: 32px;
        }

        .dashboard-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--grey-900);
            margin-bottom: 8px;
        }

        .dashboard-subtitle {
            font-size: 14px;
            color: var(--grey-600);
        }

        /* ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .card {
            background: var(--paper);
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            border: 1px solid var(--grey-200);
            margin-bottom: 24px;
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--grey-900);
        }

        .card-subtitle {
            font-size: 12px;
            color: var(--grey-500);
            margin-top: 4px;
        }

        /* KPI ì¹´ë“œ - 2í–‰ ë ˆì´ì•„ì›ƒ */
        .kpi-wrapper {
            margin-bottom: 24px;
        }

        .kpi-row {
            display: grid;
            gap: 16px;
            margin-bottom: 16px;
        }

        .kpi-row:last-child {
            margin-bottom: 0;
        }

        .kpi-row-primary {
            grid-template-columns: repeat(5, 1fr);
        }

        .kpi-row-secondary {
            grid-template-columns: repeat(4, 1fr);
        }

        .kpi-card {
            padding: 20px;
            position: relative;
            overflow: hidden;
            border-radius: 16px;
            background: linear-gradient(135deg, var(--paper) 0%, var(--grey-50) 100%);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            transition: box-shadow 0.2s ease, transform 0.2s ease;
        }

        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            border-radius: 16px 0 0 16px;
        }

        .kpi-card:hover {
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
            transform: translateY(-2px);
        }

        /* Primary KPIs ìƒ‰ìƒ */
        .kpi-row-primary .kpi-card:nth-child(1)::before { background: linear-gradient(180deg, #673ab7 0%, #9c27b0 100%); }
        .kpi-row-primary .kpi-card:nth-child(2)::before { background: linear-gradient(180deg, #ffab00 0%, #ff8f00 100%); }
        .kpi-row-primary .kpi-card:nth-child(3)::before { background: linear-gradient(180deg, #2196f3 0%, #1976d2 100%); }
        .kpi-row-primary .kpi-card:nth-child(4)::before { background: linear-gradient(180deg, #ff9800 0%, #f57c00 100%); }
        .kpi-row-primary .kpi-card:nth-child(5)::before { background: linear-gradient(180deg, #00c853 0%, #00a152 100%); }

        /* Secondary KPIs ìƒ‰ìƒ */
        .kpi-row-secondary .kpi-card:nth-child(1)::before { background: linear-gradient(180deg, #00bcd4 0%, #0097a7 100%); }
        .kpi-row-secondary .kpi-card:nth-child(2)::before { background: linear-gradient(180deg, #e91e63 0%, #c2185b 100%); }
        .kpi-row-secondary .kpi-card:nth-child(3)::before { background: linear-gradient(180deg, #4caf50 0%, #388e3c 100%); }
        .kpi-row-secondary .kpi-card:nth-child(4)::before { background: linear-gradient(180deg, #9c27b0 0%, #7b1fa2 100%); }

        .kpi-card h3 {
            font-size: 11px;
            font-weight: 600;
            color: var(--grey-500);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .kpi-card .value {
            font-size: 28px;
            font-weight: 700;
            color: var(--grey-900);
            line-height: 1.1;
            margin-bottom: 4px;
        }

        .kpi-card .unit {
            font-size: 11px;
            color: var(--grey-500);
            font-weight: 500;
        }

        /* ì˜ì‚¬ê²°ì • ë„êµ¬ íƒ­ */
        .decision-tool-tab-content {
            display: none;
        }
        .decision-tool-tab-content.active {
            display: block;
        }

        /* ì¸ì‚¬ì´íŠ¸ ì¹´ë“œ */
        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .insight-card {
            padding: 16px;
            border-radius: 8px;
            border-left: 4px solid;
        }

        .insight-card.high {
            background: var(--error-light);
            border-left-color: var(--error-main);
        }

        .insight-card.medium {
            background: var(--warning-light);
            border-left-color: var(--warning-main);
        }

        .insight-card.low {
            background: var(--success-light);
            border-left-color: var(--success-main);
        }

        .insight-card.opportunity {
            background: var(--secondary-light);
            border-left-color: var(--secondary-main);
        }

        .insight-type {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
            color: var(--grey-600);
        }

        .insight-message {
            font-size: 14px;
            color: var(--grey-900);
            font-weight: 500;
            margin-bottom: 8px;
        }

        .insight-value {
            font-size: 12px;
            color: var(--grey-600);
        }

        /* ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ */
        .chart-container {
            position: relative;
            height: 400px;
            margin-top: 20px;
        }

        .chart-container.small {
            height: 300px;
        }

        /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
        }

        .data-table th {
            text-align: left;
            padding: 12px;
            font-size: 12px;
            font-weight: 600;
            color: var(--grey-600);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid var(--grey-200);
            background: var(--grey-50);
        }

        .data-table td {
            padding: 12px;
            font-size: 14px;
            color: var(--grey-900);
            border-bottom: 1px solid var(--grey-200);
        }

        .data-table tr:hover {
            background: var(--grey-50);
        }

        /* Badge */
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge.high {
            background: var(--error-light);
            color: var(--error-main);
        }

        .badge.medium {
            background: var(--warning-light);
            color: var(--warning-main);
        }

        .badge.low {
            background: var(--success-light);
            color: var(--success-main);
        }

        /* Tooltip */
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 13px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 10000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            max-width: 300px;
        }

        .tooltip.show {
            opacity: 1;
        }

        .tooltip-title {
            font-weight: 600;
            margin-bottom: 6px;
            font-size: 14px;
        }

        .tooltip-content {
            font-size: 12px;
            line-height: 1.6;
        }

        .tooltip-value {
            font-weight: 600;
            color: var(--success-light);
        }

        /* ì¹´ë“œ í˜¸ë²„ íˆ´íŒ (funnel_dashboard ìŠ¤íƒ€ì¼ ì°¸ê³ ) */
        .card-hover-tooltip {
            position: fixed;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.18);
            z-index: 10001;
            max-width: 320px;
            min-width: 240px;
            display: none;
            pointer-events: none;
            border: 2px solid var(--primary-main);
            overflow: hidden;
        }

        .card-hover-tooltip.show {
            display: block;
        }

        .card-tooltip-header {
            padding: 12px 16px;
            background: linear-gradient(135deg, var(--primary-light) 0%, #e8f5e9 100%);
            border-bottom: 1px solid var(--grey-200);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card-tooltip-header-icon {
            font-size: 18px;
        }

        .card-tooltip-header-title {
            font-size: 13px;
            font-weight: 700;
            color: var(--primary-main);
        }

        .card-tooltip-insight {
            padding: 12px 16px;
            background: linear-gradient(135deg, #fff9e6 0%, #fffbf0 100%);
            border-bottom: 1px solid #ffd54f;
        }

        .card-tooltip-insight-label {
            font-size: 10px;
            font-weight: 600;
            color: #f57c00;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .card-tooltip-insight-text {
            font-size: 12px;
            color: var(--grey-800);
            line-height: 1.6;
        }

        .card-tooltip-recommendation {
            padding: 12px 16px;
            background: white;
        }

        .card-tooltip-recommendation-label {
            font-size: 10px;
            font-weight: 600;
            color: var(--primary-main);
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .card-tooltip-recommendation-text {
            font-size: 12px;
            color: var(--grey-700);
            line-height: 1.6;
        }

        /* í˜¸ë²„ ê°€ëŠ¥í•œ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .hoverable-card {
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .hoverable-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        /* ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ */
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 24px;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 1400px) {
            .grid-3 {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .main-content {
                margin-left: 0;
            }

            .grid-2, .grid-3 {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 1400px) {
            .kpi-row-primary {
                grid-template-columns: repeat(3, 1fr);
            }
            .kpi-row-secondary {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 16px;
            }

            .kpi-row-primary,
            .kpi-row-secondary {
                grid-template-columns: repeat(2, 1fr);
            }

            .kpi-card .value {
                font-size: 24px;
            }

            .insights-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .kpi-row-primary,
            .kpi-row-secondary {
                grid-template-columns: 1fr;
            }
        }

        /* ë¡œë”© ìƒíƒœ */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 200px;
            color: var(--grey-500);
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--grey-200);
            border-top-color: var(--primary-main);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* íƒ­ ìŠ¤íƒ€ì¼ */
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            border-bottom: 2px solid var(--grey-200);
        }

        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            color: var(--grey-600);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
            transition: all 0.2s;
        }

        .tab:hover {
            color: var(--primary-main);
        }

        .tab.active {
            color: var(--primary-main);
            border-bottom-color: var(--primary-main);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* í…Œì´ë¸” ì •ë ¬ ê¸°ëŠ¥ */
        .sortable-header {
            cursor: pointer;
            user-select: none;
            position: relative;
            padding-right: 24px !important;
            transition: background 0.2s ease;
        }

        .sortable-header:hover {
            background: var(--grey-100);
        }

        .sort-icon {
            position: absolute;
            right: 6px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 2px;
            opacity: 0.3;
            transition: opacity 0.2s ease;
        }

        .sortable-header:hover .sort-icon {
            opacity: 0.6;
        }

        .sort-icon.active {
            opacity: 1;
        }

        .sort-arrow {
            width: 0;
            height: 0;
            border-left: 4px solid transparent;
            border-right: 4px solid transparent;
        }

        .sort-arrow.up {
            border-bottom: 4px solid var(--grey-600);
        }

        .sort-arrow.down {
            border-top: 4px solid var(--grey-600);
        }

        .sort-arrow.active {
            border-bottom-color: var(--primary-main);
            border-top-color: var(--primary-main);
        }
    </style>
</head>
<body>
    <div class="app-wrapper">
        <!-- ì‚¬ì´ë“œë°” -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <a href="#" class="sidebar-logo">
                    <div class="sidebar-logo-icon">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M3 3h7v7H3V3z" stroke="currentColor" stroke-width="2"/>
                            <path d="M14 3h7v7h-7V3z" stroke="currentColor" stroke-width="2"/>
                            <path d="M14 14h7v7h-7v-7z" stroke="currentColor" stroke-width="2"/>
                            <path d="M3 14h7v7H3v-7z" stroke="currentColor" stroke-width="2"/>
                        </svg>
                    </div>
                    <div class="sidebar-logo-text">
                        <span class="sidebar-logo-title">ì±„ë„ë³„ ë¶„ì„</span>
                        <span class="sidebar-logo-subtitle">Brand Â· Product Â· Promotion</span>
                    </div>
                </a>
            </div>

            <div class="simplebar-content-wrapper">
                <div class="sidebar-content">
                    <!-- ëŒ€ì‹œë³´ë“œ ê·¸ë£¹ -->
                    <div class="nav-group">
                        <div class="nav-group-title">ëŒ€ì‹œë³´ë“œ</div>
                        <a href="marketing_dashboard_v3.html" class="nav-item">
                            <div class="nav-item-icon">
                                <svg viewBox="0 0 24 24">
                                    <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zM7 10h2v7H7zm4-3h2v10h-2zm4 6h2v4h-2z"/>
                                </svg>
                            </div>
                            <span class="nav-item-text">ê´‘ê³  ì„±ê³¼ ëŒ€ì‹œë³´ë“œ</span>
                        </a>
                        <a href="funnel_dashboard.html" class="nav-item">
                            <div class="nav-item-icon">
                                <svg viewBox="0 0 24 24">
                                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                                </svg>
                            </div>
                            <span class="nav-item-text">AARRR í¼ë„ ë¶„ì„</span>
                        </a>
                    </div>

                    <!-- ë¶„ì„ ê·¸ë£¹ -->
                    <div class="nav-group">
                        <div class="nav-group-title">ë¶„ì„</div>
                        <a href="#" class="nav-item active">
                            <div class="nav-item-icon">
                                <svg viewBox="0 0 24 24">
                                    <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/>
                                </svg>
                            </div>
                            <span class="nav-item-text">ì±„ë„ë³„ ë¶„ì„</span>
                        </a>
                        <a href="creative_analysis.html" class="nav-item">
                            <div class="nav-item-icon">
                                <svg viewBox="0 0 24 24">
                                    <path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/>
                                </svg>
                            </div>
                            <span class="nav-item-text">ê´‘ê³  ì†Œì¬ë³„ ë¶„ì„</span>
                        </a>
                        <a href="timeseries_analysis.html" class="nav-item">
                            <div class="nav-item-icon">
                                <svg viewBox="0 0 24 24">
                                    <path d="M23 8c0 1.1-.9 2-2 2-.18 0-.35-.02-.51-.07l-3.56 3.55c.05.16.07.34.07.52 0 1.1-.9 2-2 2s-2-.9-2-2c0-.18.02-.36.07-.52l-2.55-2.55c-.16.05-.34.07-.52.07s-.36-.02-.52-.07l-4.55 4.56c.05.16.07.33.07.51 0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2c.18 0 .35.02.51.07l4.56-4.55C8.02 9.36 8 9.18 8 9c0-1.1.9-2 2-2s2 .9 2 2c0 .18-.02.36-.07.52l2.55 2.55c.16-.05.34-.07.52-.07s.36.02.52.07l3.55-3.56C19.02 8.35 19 8.18 19 8c0-1.1.9-2 2-2s2 .9 2 2z"/>
                                </svg>
                            </div>
                            <span class="nav-item-text">ì‹œê³„ì—´ ë°ì´í„° ë¶„ì„</span>
                        </a>
                    </div>
                </div>
            </div>
        </aside>

        <!-- ë©”ì¸ ì»¨í…ì¸  -->
        <main class="main-content">
            <!-- ëŒ€ì‹œë³´ë“œ í—¤ë” -->
            <div class="dashboard-header">
                <h1 class="dashboard-title">ì±„ë„ë³„ ë¶„ì„ ëŒ€ì‹œë³´ë“œ</h1>
                <p class="dashboard-subtitle" id="period-info">ë°ì´í„° ë¡œë”© ì¤‘...</p>
            </div>

            <!-- ì „ì²´ ê°œìš” ì„¹ì…˜ (í•­ìƒ í‘œì‹œ) -->
            <div>
                <!-- KPI ì¹´ë“œ -->
                <div class="kpi-wrapper" id="kpi-wrapper">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                    </div>
                </div>

                <!-- ë°ì´í„° ê¸°ë°˜ ì˜ì‚¬ê²°ì • ë„êµ¬ -->
                <div class="collapsible-section" style="margin-bottom: 24px;">
                    <div class="collapsible-header">
                        <div class="collapsible-title">
                            <span class="collapsible-icon">ğŸ”¬</span>
                            <span>ë°ì´í„° ê¸°ë°˜ ì˜ì‚¬ê²°ì • ë„êµ¬</span>
                        </div>
                        <button class="collapsible-toggle">
                            <span>í¼ì¹˜ê¸°</span>
                            <span class="collapsible-toggle-icon collapsed">â–¼</span>
                        </button>
                    </div>
                    <div class="collapsible-content">

                        <!-- ìŠ¤í† ë¦¬ ê¸°ë°˜ ì¸íŠ¸ë¡œ -->
                        <div style="margin-bottom: 20px; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 16px; color: white;">
                            <div style="display: flex; align-items: flex-start; gap: 16px;">
                                <div style="font-size: 40px; line-height: 1;">ğŸ“Š</div>
                                <div style="flex: 1;">
                                    <div style="font-size: 16px; font-weight: 700; margin-bottom: 6px;">ì˜¤ëŠ˜ì˜ ê´‘ê³  ì„±ê³¼, í•œëˆˆì— íŒŒì•…í•˜ì„¸ìš”</div>
                                    <div style="font-size: 13px; opacity: 0.9; line-height: 1.6;">
                                        AIê°€ 30ì¼ ì´í›„ ë°ì´í„°ë¥¼ ì˜ˆì¸¡í–ˆì–´ìš”. ì•„ë˜ íƒ­ì—ì„œ <strong>ì§€ê¸ˆ í•´ì•¼ í•  ì¼</strong>ì„ í™•ì¸í•˜ì„¸ìš”.
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ê¸°ê°„ í•„í„° ë²„íŠ¼ -->
                        <div style="margin-bottom: 12px; padding: 12px 16px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 10px; border: 1px solid #dee2e6;">
                            <div style="display: flex; align-items: center; gap: 12px; flex-wrap: wrap;">
                                <span style="font-size: 12px; font-weight: 600; color: #495057;">ğŸ“… ë¶„ì„ ê¸°ê°„:</span>
                                <div style="display: flex; gap: 6px; flex-wrap: wrap;">
                                    <button class="period-filter-btn active" data-period="full" onclick="switchPeriod('full')"
                                            style="padding: 6px 14px; font-size: 11px; font-weight: 600; border: 1px solid #1a73e8; border-radius: 20px; cursor: pointer; transition: all 0.2s; background: #1a73e8; color: white;">
                                        ì „ì²´ ê¸°ê°„
                                    </button>
                                    <button class="period-filter-btn" data-period="180d" onclick="switchPeriod('180d')"
                                            style="padding: 6px 14px; font-size: 11px; font-weight: 600; border: 1px solid #dee2e6; border-radius: 20px; cursor: pointer; transition: all 0.2s; background: white; color: #495057;">
                                        ìµœê·¼ 180ì¼
                                    </button>
                                    <button class="period-filter-btn" data-period="90d" onclick="switchPeriod('90d')"
                                            style="padding: 6px 14px; font-size: 11px; font-weight: 600; border: 1px solid #dee2e6; border-radius: 20px; cursor: pointer; transition: all 0.2s; background: white; color: #495057;">
                                        ìµœê·¼ 90ì¼
                                    </button>
                                </div>
                                <span id="periodDateRange" style="font-size: 11px; color: #6c757d; margin-left: auto;"></span>
                            </div>
                        </div>

                        <!-- ë©”ì¸ íƒ­ ë²„íŠ¼ (ì»´íŒ©íŠ¸) -->
                        <div class="view-type-section" style="margin-bottom: 16px; flex-wrap: wrap; gap: 6px; align-items: center;">
                            <button class="view-btn decision-tool-tab-btn period-filter-enabled active" data-tab="summary" style="padding: 8px 14px; font-size: 12px;" title="ì„ íƒí•œ ê¸°ê°„ í•„í„°ê°€ ì ìš©ë©ë‹ˆë‹¤">
                                ğŸ“‹ ì˜¤ëŠ˜ì˜ ìš”ì•½
                            </button>
                            <button class="view-btn decision-tool-tab-btn period-filter-enabled" data-tab="opportunity" style="padding: 8px 14px; font-size: 12px;" title="ì„ íƒí•œ ê¸°ê°„ í•„í„°ê°€ ì ìš©ë©ë‹ˆë‹¤">
                                ğŸ¯ ì„±ê³¼ ê¸°íšŒ
                            </button>
                            <button class="view-btn decision-tool-tab-btn period-filter-enabled" data-tab="warning" style="padding: 8px 14px; font-size: 12px;" title="ì„ íƒí•œ ê¸°ê°„ í•„í„°ê°€ ì ìš©ë©ë‹ˆë‹¤">
                                âš ï¸ ì£¼ì˜ í•„ìš”
                            </button>
                            <button class="view-btn decision-tool-tab-btn period-filter-enabled" data-tab="targeting" style="padding: 8px 14px; font-size: 12px;" title="ì„ íƒí•œ ê¸°ê°„ í•„í„°ê°€ ì ìš©ë©ë‹ˆë‹¤">
                                ğŸ‘¥ íƒ€ê²Ÿ ë¶„ì„
                            </button>
                            <button class="view-btn decision-tool-tab-btn period-filter-enabled" data-tab="forecast" style="padding: 8px 14px; font-size: 12px;" title="ì„ íƒí•œ ê¸°ê°„ í•„í„°ê°€ ì ìš©ë©ë‹ˆë‹¤">
                                ğŸ”® AI ì˜ˆì¸¡
                            </button>
                            <button class="view-btn decision-tool-tab-btn period-filter-disabled" data-tab="dayAnalysis" style="padding: 8px 14px; font-size: 12px; position: relative;" title="ì „ì²´ ê¸°ê°„ ë°ì´í„°ë§Œ ì‚¬ìš©ë©ë‹ˆë‹¤ (ê¸°ê°„ í•„í„° ë¯¸ì ìš©)">
                                ğŸ“Š ê³„ì ˆì„± ë¶„ì„
                                <span style="position: absolute; top: -6px; right: -6px; background: #78909c; color: white; font-size: 8px; padding: 2px 4px; border-radius: 8px; font-weight: 600;">ì „ì²´</span>
                            </button>
                            <!-- ë²”ë¡€ -->
                            <div style="margin-left: auto; display: flex; align-items: center; gap: 12px; font-size: 10px; color: #6c757d;">
                                <span style="display: flex; align-items: center; gap: 4px;">
                                    <span style="width: 8px; height: 8px; background: #1a73e8; border-radius: 2px;"></span>
                                    ê¸°ê°„ í•„í„° ì ìš©
                                </span>
                                <span style="display: flex; align-items: center; gap: 4px;">
                                    <span style="width: 8px; height: 8px; background: #78909c; border-radius: 2px;"></span>
                                    ì „ì²´ ê¸°ê°„ ê³ ì •
                                </span>
                            </div>
                        </div>

                        <!-- íƒ­ 0: ì˜¤ëŠ˜ì˜ ìš”ì•½ (ìƒˆë¡œìš´ ë©”ì¸ íƒ­) -->
                        <div class="decision-tool-tab-content active" id="summaryTab">
                            <div id="summaryContent">
                                <p style="color: var(--grey-500); padding: 20px;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                            </div>
                        </div>

                        <!-- íƒ­ 1: ì„±ê³¼ ê¸°íšŒ ë¶„ì„ -->
                        <div class="decision-tool-tab-content" id="opportunityTab" style="display: none;">
                            <div id="opportunityContent">
                                <p style="color: var(--grey-500); padding: 20px;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                            </div>
                        </div>

                        <!-- íƒ­ 2: ì£¼ì˜ í•„ìš” (ê²½ê³ ) -->
                        <div class="decision-tool-tab-content" id="warningTab" style="display: none;">
                            <div id="warningContent">
                                <p style="color: var(--grey-500); padding: 20px;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                            </div>
                        </div>

                        <!-- íƒ­ 3: íƒ€ê²Ÿ ë¶„ì„ -->
                        <div class="decision-tool-tab-content" id="targetingTab" style="display: none;">
                            <div id="targetingContent">
                                <p style="color: var(--grey-500); padding: 20px;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                            </div>
                        </div>

                        <!-- íƒ­ 4: ìš”ì¼ë³„ ë¶„ì„ -->
                        <div class="decision-tool-tab-content" id="dayAnalysisTab" style="display: none;">
                            <!-- ì „ì²´ ê¸°ê°„ ì•ˆë‚´ ë°°ë„ˆ -->
                            <div style="display: flex; align-items: center; gap: 8px; padding: 10px 16px; background: linear-gradient(135deg, #eceff1 0%, #cfd8dc 100%); border-bottom: 1px solid #b0bec5;">
                                <span style="font-size: 14px;">ğŸ”’</span>
                                <span style="font-size: 11px; color: #546e7a; font-weight: 500;">
                                    ì´ íƒ­ì€ <strong style="color: #37474f;">ì „ì²´ ê¸°ê°„</strong> ë°ì´í„°ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ì¥ê¸° íŠ¸ë Œë“œ ë¶„ì„ì„ ìœ„í•´ ê¸°ê°„ í•„í„°ê°€ ì ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                                </span>
                            </div>
                            <!-- ì„œë¸Œíƒ­ ë²„íŠ¼ -->
                            <div style="display: flex; flex-wrap: wrap; gap: 8px; padding: 16px; background: #f8f9fa; border-bottom: 1px solid #e9ecef;">
                                <button class="day-analysis-subtab active" data-day-tab="quarterlyTrend"
                                        style="padding: 8px 16px; font-size: 12px; font-weight: 600; border: none; border-radius: 20px; cursor: pointer; transition: all 0.2s; background: #78909c; color: white;">
                                    ğŸ“ˆ ë¶„ê¸°ë³„ ì¶”ì´
                                </button>
                                <button class="day-analysis-subtab" data-day-tab="dayConversion"
                                        style="padding: 8px 16px; font-size: 12px; font-weight: 600; border: 1px solid #b0bec5; border-radius: 20px; cursor: pointer; transition: all 0.2s; background: white; color: #546e7a;">
                                    ğŸ“… ìš”ì¼ë³„ ë¶„ì„
                                </button>
                                <button class="day-analysis-subtab" data-day-tab="channelDay"
                                        style="padding: 8px 16px; font-size: 12px; font-weight: 600; border: 1px solid #b0bec5; border-radius: 20px; cursor: pointer; transition: all 0.2s; background: white; color: #546e7a;">
                                    ğŸ“Š ì±„ë„ë³„ ìš”ì¼
                                </button>
                            </div>

                            <!-- ë¶„ê¸°ë³„ ì¶”ì´ ë·° -->
                            <div class="day-analysis-tab-content active" id="quarterlyTrendView">
                                <!-- ì¢…í•© ê³„ì ˆì„± ì¸ì‚¬ì´íŠ¸ -->
                                <div style="padding: 20px 24px; background: linear-gradient(135deg, #e3f2fd 0%, #f5faff 100%); border-bottom: 1px solid #e9ecef;">
                                    <div style="font-size: 14px; color: #1565c0; font-weight: 600; margin-bottom: 12px;">ğŸ“Š ê³„ì ˆì„± ë¶„ì„ ì¸ì‚¬ì´íŠ¸</div>
                                    <div style="font-size: 13px; color: #424242; line-height: 1.8;" id="quarterlySeasonalityInsightText">ë¡œë”© ì¤‘...</div>
                                </div>

                                <!-- ë¶„ê¸°ë³„ KPI ì¹´ë“œ -->
                                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; padding: 16px 20px; background: #fafafa;">
                                    <div id="quarterlyKpiCards" style="display: contents;"></div>
                                </div>

                                <!-- ë¶„ê¸°ë³„ ì¶”ì´ ì°¨íŠ¸ -->
                                <div class="card" style="margin: 16px; border-radius: 12px;">
                                    <div style="padding: 16px 20px; border-bottom: 1px solid #e9ecef;">
                                        <h4 style="font-size: 14px; font-weight: 600; color: var(--grey-800); margin: 0;">ë¶„ê¸°ë³„ ì£¼ìš” ì§€í‘œ ì¶”ì´</h4>
                                        <p style="font-size: 12px; color: var(--grey-600); margin: 4px 0 0 0;">ë¶„ê¸°ë³„ ë¹„ìš©, ROAS, CPA ë³€í™”ë¥¼ í•œëˆˆì— í™•ì¸í•˜ì„¸ìš”</p>
                                    </div>
                                    <div style="padding: 20px;">
                                        <canvas id="quarterlyTrendChart" height="280"></canvas>
                                    </div>
                                </div>

                                <!-- ë¶„ê¸°ë³„ ìƒì„¸ í…Œì´ë¸” -->
                                <div class="card" style="margin: 16px; border-radius: 12px;">
                                    <div style="padding: 16px 20px; border-bottom: 1px solid #e9ecef;">
                                        <h4 style="font-size: 14px; font-weight: 600; color: var(--grey-800); margin: 0;">ë¶„ê¸°ë³„ ìƒì„¸ ì„±ê³¼</h4>
                                    </div>
                                    <div style="padding: 16px 20px; overflow-x: auto;">
                                        <table class="data-table" id="quarterlyTable" style="margin-top: 0;">
                                            <thead>
                                                <tr>
                                                    <th style="min-width: 100px; text-align: center;">ë¶„ê¸°</th>
                                                    <th style="min-width: 120px; text-align: right;">í‰ê·  ë¹„ìš©</th>
                                                    <th style="min-width: 100px; text-align: right;">ROAS</th>
                                                    <th style="min-width: 100px; text-align: right;">CPA</th>
                                                    <th style="min-width: 100px; text-align: right;">ì „í™˜ìˆ˜</th>
                                                    <th style="min-width: 120px; text-align: right;">ì „í™˜ê°’</th>
                                                    <th style="min-width: 100px;">ì„±ê³¼ ìˆ˜ì¤€</th>
                                                </tr>
                                            </thead>
                                            <tbody id="quarterlyTableBody">
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <!-- ìš”ì¼ë³„ ì „í™˜ ë·° -->
                            <div class="day-analysis-tab-content" id="dayConversionView" style="display: none;">
                                <!-- ìì—°ì–´ ì¸ì‚¬ì´íŠ¸ -->
                                <div style="padding: 20px 24px; background: linear-gradient(135deg, #fff8e1 0%, #fffef5 100%); border-bottom: 1px solid #e9ecef;">
                                    <div style="font-size: 14px; color: #f57c00; font-weight: 600; margin-bottom: 8px;">ğŸ’¡ ìš”ì¼ë³„ ì„±ê³¼ ì¸ì‚¬ì´íŠ¸</div>
                                    <div style="font-size: 13px; color: #424242; line-height: 1.7;" id="seasonalityInsightText">ë¡œë”© ì¤‘...</div>
                                </div>

                                <div class="card" style="margin: 16px; border-radius: 12px;">
                                    <div style="padding: 16px 20px; border-bottom: 1px solid #e9ecef;">
                                        <h4 style="font-size: 14px; font-weight: 600; color: var(--grey-800); margin: 0;">ìš”ì¼ë³„ ì„±ê³¼ ë¶„ì„</h4>
                                        <p style="font-size: 12px; color: var(--grey-600); margin: 4px 0 0 0;">ì–´ë–¤ ìš”ì¼ì— ê´‘ê³  íš¨ìœ¨ì´ ê°€ì¥ ì¢‹ì€ì§€ í™•ì¸í•˜ì„¸ìš” (í—¤ë” í´ë¦­ìœ¼ë¡œ ì •ë ¬)</p>
                                    </div>
                                    <div style="padding: 16px 20px; overflow-x: auto;">
                                        <table class="data-table" id="seasonalityTable" style="margin-top: 0;">
                                            <thead>
                                                <tr>
                                                    <th style="min-width: 100px; text-align: center;">ìš”ì¼</th>
                                                    <th class="sortable-header" data-table="seasonality" data-column="roas" style="min-width: 100px; text-align: right;">
                                                        ROAS
                                                        <div class="sort-icon active"><div class="sort-arrow up"></div><div class="sort-arrow down active"></div></div>
                                                    </th>
                                                    <th class="sortable-header" data-table="seasonality" data-column="cpa" style="min-width: 100px; text-align: right;">
                                                        CPA
                                                        <div class="sort-icon"><div class="sort-arrow up"></div><div class="sort-arrow down"></div></div>
                                                    </th>
                                                    <th class="sortable-header" data-table="seasonality" data-column="cost" style="min-width: 120px; text-align: right;">
                                                        ê´‘ê³ ë¹„
                                                        <div class="sort-icon"><div class="sort-arrow up"></div><div class="sort-arrow down"></div></div>
                                                    </th>
                                                    <th class="sortable-header" data-table="seasonality" data-column="conversions" style="min-width: 80px; text-align: right;">
                                                        ì „í™˜ìˆ˜
                                                        <div class="sort-icon"><div class="sort-arrow up"></div><div class="sort-arrow down"></div></div>
                                                    </th>
                                                    <th class="sortable-header" data-table="seasonality" data-column="revenue" style="min-width: 120px; text-align: right;">
                                                        ì „í™˜ê°’
                                                        <div class="sort-icon"><div class="sort-arrow up"></div><div class="sort-arrow down"></div></div>
                                                    </th>
                                                    <th style="min-width: 120px;">ì„±ê³¼ ìˆ˜ì¤€</th>
                                                </tr>
                                            </thead>
                                            <tbody id="seasonalityTableBody">
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <!-- ì±„ë„ë³„ ìš”ì¼ ë·° -->
                            <div class="day-analysis-tab-content" id="channelDayView" style="display: none;">
                                <!-- ìì—°ì–´ ì¸ì‚¬ì´íŠ¸ (ê°•í™”) -->
                                <div style="padding: 20px 24px; background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); border-bottom: 1px solid #a5d6a7;">
                                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
                                        <span style="font-size: 20px;">ğŸ“Š</span>
                                        <div style="font-size: 15px; color: #1b5e20; font-weight: 700;">ì±„ë„ë³„ ìš”ì¼ ì„±ê³¼ ë¶„ì„</div>
                                    </div>
                                    <div style="font-size: 13px; color: #2e7d32; line-height: 1.8; background: rgba(255,255,255,0.7); padding: 12px 16px; border-radius: 8px;" id="seasonalityCategoryInsightText">ë¡œë”© ì¤‘...</div>
                                </div>

                                <!-- ì±„ë„ë³„ KPI ì¹´ë“œ -->
                                <div id="channelDayKpiCards" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px; padding: 20px 24px; background: #fafafa;">
                                    <!-- ë™ì ìœ¼ë¡œ ì±„ë„ ì¹´ë“œ ìƒì„± -->
                                </div>

                                <!-- ì±„ë„ë³„ ìš”ì¼ ROAS ë¹„êµ ì°¨íŠ¸ -->
                                <div class="card" style="margin: 0 16px 16px 16px; border-radius: 12px;">
                                    <div style="padding: 16px 20px; border-bottom: 1px solid #e9ecef;">
                                        <h4 style="font-size: 14px; font-weight: 600; color: var(--grey-800); margin: 0;">ğŸ“ˆ ì±„ë„ë³„ ìš”ì¼ ROAS ë¹„êµ</h4>
                                        <p style="font-size: 12px; color: var(--grey-600); margin: 4px 0 0 0;">ê° ì±„ë„ì˜ ìš”ì¼ë³„ ROASë¥¼ ë¹„êµí•˜ì—¬ ìµœì ì˜ ê´‘ê³  ì§‘í–‰ ìš”ì¼ì„ íŒŒì•…í•˜ì„¸ìš”</p>
                                    </div>
                                    <div style="padding: 20px; height: 350px;">
                                        <canvas id="channelDayRoasChart"></canvas>
                                    </div>
                                </div>

                                <!-- ì±„ë„ë³„ ìƒì„¸ í…Œì´ë¸” -->
                                <div class="card" style="margin: 0 16px 16px 16px; border-radius: 12px;">
                                    <div style="padding: 16px 20px; border-bottom: 1px solid #e9ecef; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px;">
                                        <div>
                                            <h4 style="font-size: 14px; font-weight: 600; color: var(--grey-800); margin: 0;">ğŸ“‹ ìš”ì¼ë³„ ìƒì„¸ ì„±ê³¼</h4>
                                            <p style="font-size: 12px; color: var(--grey-600); margin: 4px 0 0 0;">ì±„ë„ì„ ì„ íƒí•˜ì—¬ ìš”ì¼ë³„ ì„±ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”</p>
                                        </div>
                                        <select id="channelDaySelector" style="padding: 8px 12px; border: 1px solid #dee2e6; border-radius: 8px; font-size: 13px; background: white; cursor: pointer; min-width: 160px;">
                                            <!-- ë™ì ìœ¼ë¡œ ì±„ë„ ì˜µì…˜ ìƒì„± -->
                                        </select>
                                    </div>
                                    <div style="padding: 16px 20px; overflow-x: auto;">
                                        <table class="data-table" id="seasonalityCategoryTable" style="margin-top: 0;">
                                            <thead>
                                                <tr>
                                                    <th style="min-width: 80px; text-align: center;">ìš”ì¼</th>
                                                    <th style="min-width: 110px; text-align: right;">í‰ê·  ë¹„ìš©</th>
                                                    <th style="min-width: 110px; text-align: right;">í‰ê·  ì „í™˜ê°’</th>
                                                    <th style="min-width: 90px; text-align: right;">ROAS</th>
                                                    <th style="min-width: 100px; text-align: right;">CPA</th>
                                                    <th style="min-width: 80px; text-align: center;">ì„±ê³¼</th>
                                                </tr>
                                            </thead>
                                            <tbody id="seasonalityCategoryTableBody">
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- íƒ­ 5: AI ì˜ˆì¸¡ (Prophet) -->
                        <div class="decision-tool-tab-content" id="forecastTab" style="display: none;">
                            <div id="forecastContent">
                                <p style="color: var(--grey-500); padding: 20px;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ì„±ê³¼ ì¶”ì´ ë¶„ì„ (í†µí•© íƒ­) -->
                <div class="collapsible-section">
                    <div class="collapsible-header">
                        <div class="collapsible-title">
                            <span class="collapsible-icon">ğŸ“ˆ</span>
                            <span>ì„±ê³¼ ì¶”ì´ ë¶„ì„ - ì‹œê°„ì— ë”°ë¥¸ ì„±ê³¼ ë³€í™”ë¥¼ í™•ì¸í•˜ì„¸ìš”</span>
                        </div>
                        <button class="collapsible-toggle">
                            <span>í¼ì¹˜ê¸°</span>
                            <span class="collapsible-toggle-icon collapsed">â–¼</span>
                        </button>
                    </div>
                    <div class="collapsible-content">
                        <!-- íƒ­ ë²„íŠ¼ -->
                        <div class="view-type-section" style="margin-bottom: 24px;">
                            <button class="view-btn trend-analysis-tab-btn active" data-tab="timeseries">ê´‘ê³ ì„¸íŠ¸ ì¶”ì´</button>
                            <button class="view-btn trend-analysis-tab-btn" data-tab="gender">ì„±ë³„ ì¶”ì´</button>
                            <button class="view-btn trend-analysis-tab-btn" data-tab="age">ì—°ë ¹ ì¶”ì´</button>
                            <button class="view-btn trend-analysis-tab-btn" data-tab="platform">í”Œë«í¼ ì¶”ì´</button>
                            <button class="view-btn trend-analysis-tab-btn" data-tab="device-platform">ê¸°ê¸°í”Œë«í¼ ì¶”ì´</button>
                            <button class="view-btn trend-analysis-tab-btn" data-tab="device-type">ê¸°ê¸° ì¶”ì´</button>
                            <button class="view-btn trend-analysis-tab-btn" data-tab="age-gender-pivot">ì„±ë³„ ì—°ë ¹ PIVOT</button>
                        </div>

                        <!-- íƒ­ 1: ê´‘ê³ ì„¸íŠ¸ ì¶”ì´ -->
                        <div class="trend-analysis-tab-content active" id="timeseriesTab">
                            <!-- ì»´íŒ©íŠ¸ ì„¤ëª… ì„¹ì…˜ -->
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                                <!-- ë¶„ì„ ëª©ì  ì¹´ë“œ -->
                                <div style="padding: 14px 16px; background: linear-gradient(135deg, #e3f2fd 0%, #f0f7ff 100%); border-radius: 8px; border-left: 4px solid #2196f3; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                                        <span style="font-size: 16px;">ğŸ“Š</span>
                                        <strong style="color: #1976d2; font-size: 13px;">ì´ ë¶„ì„ì˜ ëª©ì </strong>
                                    </div>
                                    <p style="margin: 0; font-size: 12px; color: #424242; line-height: 1.6;">
                                        ì‹œê°„ì— ë”°ë¥¸ <strong style="color: #1565c0;">ê´‘ê³ ì„¸íŠ¸ë³„ ì„±ê³¼ ë³€í™”</strong>ë¥¼ ì¶”ì í•˜ì—¬<br>
                                        íŠ¸ë Œë“œì™€ íŒ¨í„´ì„ í•œëˆˆì— íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
                                    </p>
                                </div>

                                <!-- ì‚¬ìš© ë°©ë²• ì¹´ë“œ -->
                                <div style="padding: 14px 16px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8f4 100%); border-radius: 8px; border-left: 4px solid #4caf50; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                                        <span style="font-size: 16px;">ğŸ’¡</span>
                                        <strong style="color: #388e3c; font-size: 13px;">ì‚¬ìš© ë°©ë²•</strong>
                                    </div>
                                    <div style="font-size: 12px; color: #424242; line-height: 1.6;">
                                        <div style="display: flex; align-items: start; gap: 8px; margin-bottom: 4px;">
                                            <span style="display: inline-flex; align-items: center; justify-content: center; width: 18px; height: 18px; background: #4caf50; color: white; border-radius: 50%; font-size: 10px; font-weight: 600; flex-shrink: 0;">1</span>
                                            <span>ë“œë¡­ë‹¤ìš´ì—ì„œ ì›í•˜ëŠ” í•„í„° ì„ íƒ</span>
                                        </div>
                                        <div style="display: flex; align-items: start; gap: 8px;">
                                            <span style="display: inline-flex; align-items: center; justify-content: center; width: 18px; height: 18px; background: #4caf50; color: white; border-radius: 50%; font-size: 10px; font-weight: 600; flex-shrink: 0;">2</span>
                                            <span>ì°¨íŠ¸ì—ì„œ ì¶”ì´ íŒ¨í„´ í™•ì¸</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card">
                                <!-- ìƒë‹¨ í—¤ë” ë° ì»¨íŠ¸ë¡¤ -->
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid var(--grey-200); padding-bottom: 16px;">
                                    <div>
                                        <div class="card-title" style="margin-bottom: 4px;">ì‹œê°„ì— ë”°ë¥¸ ê´‘ê³ ì„¸íŠ¸ ì„±ê³¼ ì¶”ì´</div>
                                        <p style="color: var(--grey-600); font-size: 13px; margin: 0;">
                                            ì‹œê°„ì— ë”°ë¥¸ ê° ì„¸ê·¸ë¨¼íŠ¸ì˜ ì„±ê³¼ ë³€í™”ë¥¼ ì¶”ì í•˜ì—¬ íŠ¸ë Œë“œë¥¼ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                                        </p>
                                    </div>
                                    <!-- ì§‘ê³„ ë‹¨ìœ„ ì„ íƒ ë²„íŠ¼ -->
                                    <div class="view-type-section" style="margin-bottom: 0;">
                                        <button class="view-btn timeseries-period-btn active" data-period="daily">ì¼ë³„</button>
                                        <button class="view-btn timeseries-period-btn" data-period="weekly">ì£¼ë³„</button>
                                        <button class="view-btn timeseries-period-btn" data-period="monthly">ì›”ë³„</button>
                                    </div>
                                </div>

                                <!-- ì§€í‘œ ì„ íƒ ë° ê¸°ê°„ ì„ íƒ -->
                                <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 20px; margin-bottom: 20px;">
                                    <!-- ì§€í‘œ ì„ íƒ -->
                                    <div style="flex: 0 0 auto;">
                                        <div style="font-size: 13px; font-weight: 600; color: var(--grey-700); margin-bottom: 12px;">ğŸ“ˆ ì§€í‘œ ì„ íƒ</div>
                                        <select id="timeseriesMetricDropdown" style="min-width: 200px; padding: 10px 12px; border: 1px solid var(--grey-300); border-radius: 6px; background: white; font-size: 13px; color: var(--grey-800); cursor: pointer; transition: all 0.2s;">
                                            <option value="roas">ROAS</option>
                                            <option value="cost">ë¹„ìš©</option>
                                            <option value="revenue">ì „í™˜ê°’</option>
                                            <option value="conversions">ì „í™˜ìˆ˜</option>
                                            <option value="impressions">ë…¸ì¶œìˆ˜</option>
                                            <option value="clicks">í´ë¦­ìˆ˜</option>
                                            <option value="cpm">CPM</option>
                                            <option value="cpc">CPC</option>
                                            <option value="cpa">CPA</option>
                                            <option value="ctr">CTR</option>
                                            <option value="cvr">ì „í™˜ìœ¨</option>
                                        </select>
                                    </div>

                                    <!-- ê¸°ê°„ ì„ íƒ -->
                                    <div style="flex: 0 0 auto; margin-left: auto;">
                                        <div style="font-size: 13px; font-weight: 600; color: var(--grey-700); margin-bottom: 12px;">ğŸ“… ê¸°ê°„ ì„ íƒ</div>
                                        <div style="display: flex; align-items: center; gap: 10px;">
                                            <input type="date" id="timeseriesStartDate" style="padding: 10px 12px; border: 1px solid var(--grey-300); border-radius: 6px; background: white; font-size: 13px; color: var(--grey-800); cursor: pointer; transition: all 0.2s;">
                                            <span style="color: var(--grey-600); font-weight: 500;">~</span>
                                            <input type="date" id="timeseriesEndDate" style="padding: 10px 12px; border: 1px solid var(--grey-300); border-radius: 6px; background: white; font-size: 13px; color: var(--grey-800); cursor: pointer; transition: all 0.2s;">
                                        </div>
                                    </div>
                                </div>

                                <!-- ë“œë¡­ë‹¤ìš´ í˜•íƒœ í•„í„° -->
                                <div style="margin-bottom: 20px; padding: 16px; background: var(--grey-50); border-radius: 8px; border: 1px solid var(--grey-200);">
                                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 14px;">
                                        <div style="font-size: 13px; font-weight: 600; color: var(--grey-700);">ğŸ“Š ë¶„ë¥˜ ê¸°ì¤€</div>
                                        <div style="font-size: 12px; color: #2e7d32; font-weight: 600;">
                                            ğŸ¯ <span id="filteredAdsetCount">0</span>ê°œ ê´‘ê³ ì„¸íŠ¸
                                        </div>
                                    </div>

                                    <!-- ë“œë¡­ë‹¤ìš´ ë²„íŠ¼ë“¤ -->
                                    <div style="display: flex; gap: 12px; align-items: flex-start; flex-wrap: wrap;">
                                        <!-- ì±„ë„ë³„ ë“œë¡­ë‹¤ìš´ -->
                                        <div style="position: relative; min-width: 180px; flex: 1;">
                                            <button type="button" class="filter-dropdown-btn" data-filter="channel" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; color: var(--grey-800); cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; text-align: left;">
                                                <span style="font-weight: 500;">ì±„ë„_ì „ì²´</span>
                                                <span style="display: flex; align-items: center; gap: 6px;">
                                                    <span class="selected-count" style="font-size: 11px; color: var(--grey-500);"></span>
                                                    <span style="font-size: 10px;">â–¼</span>
                                                </span>
                                            </button>
                                            <div class="filter-dropdown-list" data-filter="channel" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                                <div style="padding: 8px;">
                                                    <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px; z-index: 1;">
                                                        <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px; border-radius: 4px; transition: background 0.2s;">
                                                            <input type="checkbox" class="filter-select-all" data-filter="channel" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                                                            ì „ì²´ ì„ íƒ
                                                        </label>
                                                    </div>
                                                    <div id="filterChannelList" class="filter-checkbox-list"></div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- ì œí’ˆë³„ ë“œë¡­ë‹¤ìš´ -->
                                        <div style="position: relative; min-width: 180px; flex: 1;">
                                            <button type="button" class="filter-dropdown-btn" data-filter="product" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; color: var(--grey-800); cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; text-align: left;">
                                                <span style="font-weight: 500;">ì œí’ˆ_ì „ì²´</span>
                                                <span style="display: flex; align-items: center; gap: 6px;">
                                                    <span class="selected-count" style="font-size: 11px; color: var(--grey-500);"></span>
                                                    <span style="font-size: 10px;">â–¼</span>
                                                </span>
                                            </button>
                                            <div class="filter-dropdown-list" data-filter="product" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                                <div style="padding: 8px;">
                                                    <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px; z-index: 1;">
                                                        <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px; border-radius: 4px; transition: background 0.2s;">
                                                            <input type="checkbox" class="filter-select-all" data-filter="product" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                                                            ì „ì²´ ì„ íƒ
                                                        </label>
                                                    </div>
                                                    <div id="filterProductList" class="filter-checkbox-list"></div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- ë¸Œëœë“œë³„ ë“œë¡­ë‹¤ìš´ -->
                                        <div style="position: relative; min-width: 180px; flex: 1;">
                                            <button type="button" class="filter-dropdown-btn" data-filter="brand" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; color: var(--grey-800); cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; text-align: left;">
                                                <span style="font-weight: 500;">ë¸Œëœë“œ_ì „ì²´</span>
                                                <span style="display: flex; align-items: center; gap: 6px;">
                                                    <span class="selected-count" style="font-size: 11px; color: var(--grey-500);"></span>
                                                    <span style="font-size: 10px;">â–¼</span>
                                                </span>
                                            </button>
                                            <div class="filter-dropdown-list" data-filter="brand" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                                <div style="padding: 8px;">
                                                    <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px; z-index: 1;">
                                                        <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px; border-radius: 4px; transition: background 0.2s;">
                                                            <input type="checkbox" class="filter-select-all" data-filter="brand" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                                                            ì „ì²´ ì„ íƒ
                                                        </label>
                                                    </div>
                                                    <div id="filterBrandList" class="filter-checkbox-list"></div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- í”„ë¡œëª¨ì…˜ë³„ ë“œë¡­ë‹¤ìš´ -->
                                        <div style="position: relative; min-width: 180px; flex: 1;">
                                            <button type="button" class="filter-dropdown-btn" data-filter="promotion" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; color: var(--grey-800); cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; text-align: left;">
                                                <span style="font-weight: 500;">í”„ë¡œëª¨ì…˜_ì „ì²´</span>
                                                <span style="display: flex; align-items: center; gap: 6px;">
                                                    <span class="selected-count" style="font-size: 11px; color: var(--grey-500);"></span>
                                                    <span style="font-size: 10px;">â–¼</span>
                                                </span>
                                            </button>
                                            <div class="filter-dropdown-list" data-filter="promotion" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                                <div style="padding: 8px;">
                                                    <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px; z-index: 1;">
                                                        <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px; border-radius: 4px; transition: background 0.2s;">
                                                            <input type="checkbox" class="filter-select-all" data-filter="promotion" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                                                            ì „ì²´ ì„ íƒ
                                                        </label>
                                                    </div>
                                                    <div id="filterPromotionList" class="filter-checkbox-list"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- ê´‘ê³ ì„¸íŠ¸ ë¯¸ë¦¬ë³´ê¸° -->
                                    <div id="filteredAdsetPreview" style="margin-top: 12px; padding: 10px 12px; background: white; border-radius: 6px; border: 1px solid var(--grey-200); display: none;">
                                        <div id="filteredAdsetList" style="font-size: 11px; color: var(--grey-600); max-height: 100px; overflow-y: auto; line-height: 1.6;">
                                        </div>
                                    </div>
                                </div>

                                <!-- íŠ¸ë Œë“œ ì°¨íŠ¸ -->
                                <div class="chart-container">
                                    <canvas id="timeseriesTrendChart"></canvas>
                                </div>

                                <!-- íŠ¸ë Œë“œ ë¶„ì„ íŒ (ì°¨íŠ¸ í•˜ë‹¨) -->
                                <div style="margin-top: 20px; padding: 16px; background: linear-gradient(135deg, #e3f2fd 0%, #f1f8fc 100%); border-radius: 10px; border-left: 4px solid #2196f3;">
                                    <div style="font-size: 13px; font-weight: 600; color: #2196f3; margin-bottom: 8px;">
                                        ğŸ’¡ íŠ¸ë Œë“œ ë¶„ì„ íŒ
                                    </div>
                                    <div style="font-size: 13px; color: var(--grey-800); line-height: 1.6;">
                                        ìƒìŠ¹ ì¶”ì„¸ë¥¼ ë³´ì´ëŠ” ê´‘ê³ ì„¸íŠ¸ëŠ” ì˜ˆì‚°ì„ í™•ëŒ€í•˜ê³ , í•˜ë½ ì¶”ì„¸ë¥¼ ë³´ì´ëŠ” ê´‘ê³ ì„¸íŠ¸ëŠ” ì›ì¸ì„ ë¶„ì„í•˜ì—¬ ê°œì„ í•˜ì„¸ìš”.
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- íƒ­ 2: ì„±ë³„ ì¶”ì´ -->
                        <div class="trend-analysis-tab-content" id="genderTab" style="display: none;">
                            <!-- ì»´íŒ©íŠ¸ ì„¤ëª… ì„¹ì…˜ -->
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                                <!-- ë¶„ì„ ëª©ì  ì¹´ë“œ -->
                                <div style="padding: 14px 16px; background: linear-gradient(135deg, #e3f2fd 0%, #f0f7ff 100%); border-radius: 8px; border-left: 4px solid #2196f3; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                                        <span style="font-size: 16px;">ğŸ“Š</span>
                                        <strong style="color: #1976d2; font-size: 13px;">ì´ ë¶„ì„ì˜ ëª©ì </strong>
                                    </div>
                                    <p style="margin: 0; font-size: 12px; color: #424242; line-height: 1.6;">
                                        ì‹œê°„ì— ë”°ë¥¸ <strong style="color: #1565c0;">ê° ì„±ë³„ì˜ ì„±ê³¼ ë³€í™”</strong>ë¥¼ ì¶”ì í•˜ì—¬<br>
                                        íƒ€ê²ŸíŒ… ì „ëµì„ ìµœì í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
                                    </p>
                                </div>

                                <!-- ì‚¬ìš© ë°©ë²• ì¹´ë“œ -->
                                <div style="padding: 14px 16px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8f4 100%); border-radius: 8px; border-left: 4px solid #4caf50; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                                        <span style="font-size: 16px;">ğŸ’¡</span>
                                        <strong style="color: #388e3c; font-size: 13px;">ì‚¬ìš© ë°©ë²•</strong>
                                    </div>
                                    <div style="font-size: 12px; color: #424242; line-height: 1.6;">
                                        <div style="display: flex; align-items: start; gap: 8px; margin-bottom: 4px;">
                                            <span style="display: inline-flex; align-items: center; justify-content: center; width: 18px; height: 18px; background: #4caf50; color: white; border-radius: 50%; font-size: 10px; font-weight: 600; flex-shrink: 0;">1</span>
                                            <span>ë“œë¡­ë‹¤ìš´ì—ì„œ ì„±ë³„ ì„ íƒ (ìµœëŒ€ 5ê°œ)</span>
                                        </div>
                                        <div style="display: flex; align-items: start; gap: 8px;">
                                            <span style="display: inline-flex; align-items: center; justify-content: center; width: 18px; height: 18px; background: #4caf50; color: white; border-radius: 50%; font-size: 10px; font-weight: 600; flex-shrink: 0;">2</span>
                                            <span>ì§‘ê³„ ë‹¨ìœ„ ë³€ê²½ ë° ì°¨íŠ¸ í™•ì¸</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card">
                                <!-- í•„í„° íƒ€ì… ì„ íƒ (ìƒë‹¨) -->
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid var(--grey-200); padding-bottom: 16px;">
                                    <div>
                                        <div class="card-title" style="margin-bottom: 4px;">ì‹œê°„ì— ë”°ë¥¸ ì„±ë³„ ì„±ê³¼ ì¶”ì´</div>
                                        <p style="color: var(--grey-600); font-size: 13px; margin: 0;">
                                            ì‹œê°„ì— ë”°ë¥¸ ê° ì„±ë³„ì˜ ì„±ê³¼ ë³€í™”ë¥¼ ì¶”ì í•˜ì—¬ íŠ¸ë Œë“œë¥¼ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                                        </p>
                                    </div>
                                    <!-- ì§‘ê³„ ë‹¨ìœ„ ì„ íƒ ë²„íŠ¼ -->
                                    <div class="view-type-section" style="margin-bottom: 0;">
                                        <button class="view-btn gender-period-btn active" data-period="daily">ì¼ë³„</button>
                                        <button class="view-btn gender-period-btn" data-period="weekly">ì£¼ë³„</button>
                                        <button class="view-btn gender-period-btn" data-period="monthly">ì›”ë³„</button>
                                    </div>
                                </div>

                                <!-- ì§€í‘œ ì„ íƒ ë° ê¸°ê°„ ì„ íƒ -->
                                <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 20px; margin-bottom: 20px;">
                                    <!-- ì§€í‘œ ì„ íƒ -->
                                    <div style="flex: 0 0 auto;">
                                        <div style="font-size: 13px; font-weight: 600; color: var(--grey-700); margin-bottom: 12px;">ğŸ“ˆ ì§€í‘œ ì„ íƒ</div>
                                        <select id="genderMetricDropdown" style="min-width: 200px; padding: 10px 12px; border: 1px solid var(--grey-300); border-radius: 6px; background: white; font-size: 13px; color: var(--grey-800); cursor: pointer; transition: all 0.2s;">
                                            <option value="roas">ROAS</option>
                                            <option value="cost">ë¹„ìš©</option>
                                            <option value="revenue">ì „í™˜ê°’</option>
                                            <option value="conversions">ì „í™˜ìˆ˜</option>
                                            <option value="impressions">ë…¸ì¶œìˆ˜</option>
                                            <option value="clicks">í´ë¦­ìˆ˜</option>
                                            <option value="cpm">CPM</option>
                                            <option value="cpc">CPC</option>
                                            <option value="cpa">CPA</option>
                                            <option value="ctr">CTR</option>
                                            <option value="cvr">ì „í™˜ìœ¨</option>
                                        </select>
                                    </div>

                                    <!-- ê¸°ê°„ ì„ íƒ -->
                                    <div style="flex: 0 0 auto; margin-left: auto;">
                                        <div style="font-size: 13px; font-weight: 600; color: var(--grey-700); margin-bottom: 12px;">ğŸ“… ê¸°ê°„ ì„ íƒ</div>
                                        <div style="display: flex; align-items: center; gap: 10px;">
                                            <input type="date" id="genderStartDate" style="padding: 10px 12px; border: 1px solid var(--grey-300); border-radius: 6px; background: white; font-size: 13px; color: var(--grey-800); cursor: pointer; transition: all 0.2s;">
                                            <span style="color: var(--grey-600); font-weight: 500;">~</span>
                                            <input type="date" id="genderEndDate" style="padding: 10px 12px; border: 1px solid var(--grey-300); border-radius: 6px; background: white; font-size: 13px; color: var(--grey-800); cursor: pointer; transition: all 0.2s;">
                                        </div>
                                    </div>
                                </div>

                                <!-- ë“œë¡­ë‹¤ìš´ í˜•íƒœ í•„í„° -->
                                <div style="margin-bottom: 20px; padding: 16px; background: var(--grey-50); border-radius: 8px; border: 1px solid var(--grey-200);">
                                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 14px;">
                                        <div style="font-size: 13px; font-weight: 600; color: var(--grey-700);">ğŸ“Š ë¶„ë¥˜ ê¸°ì¤€</div>
                                        <div style="font-size: 12px; color: #2e7d32; font-weight: 600;">
                                            ğŸ¯ <span id="filteredGenderCount">0</span>ê°œ ì„±ë³„
                                        </div>
                                    </div>

                                    <!-- ë“œë¡­ë‹¤ìš´ ë²„íŠ¼ë“¤ -->
                                    <div style="display: flex; gap: 12px; align-items: flex-start; flex-wrap: wrap;">
                                        <!-- ì±„ë„ë³„ ë“œë¡­ë‹¤ìš´ -->
                                        <div style="position: relative; min-width: 180px; flex: 1;">
                                            <button type="button" class="gender-filter-dropdown-btn" data-filter="channel" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; color: var(--grey-800); cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; text-align: left;">
                                                <span style="font-weight: 500;">ì±„ë„_ì „ì²´</span>
                                                <span style="display: flex; align-items: center; gap: 6px;">
                                                    <span class="gender-selected-count" style="font-size: 11px; color: var(--grey-500);"></span>
                                                    <span style="font-size: 10px;">â–¼</span>
                                                </span>
                                            </button>
                                            <div class="gender-filter-dropdown-list" data-filter="channel" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                                <div style="padding: 8px;">
                                                    <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px; z-index: 1;">
                                                        <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px; border-radius: 4px; transition: background 0.2s;">
                                                            <input type="checkbox" class="gender-filter-select-all" data-filter="channel" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                                                            ì „ì²´ ì„ íƒ
                                                        </label>
                                                    </div>
                                                    <div id="genderFilterChannelList" class="gender-filter-checkbox-list"></div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- ì œí’ˆë³„ ë“œë¡­ë‹¤ìš´ -->
                                        <div style="position: relative; min-width: 180px; flex: 1;">
                                            <button type="button" class="gender-filter-dropdown-btn" data-filter="product" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; color: var(--grey-800); cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; text-align: left;">
                                                <span style="font-weight: 500;">ì œí’ˆ_ì „ì²´</span>
                                                <span style="display: flex; align-items: center; gap: 6px;">
                                                    <span class="gender-selected-count" style="font-size: 11px; color: var(--grey-500);"></span>
                                                    <span style="font-size: 10px;">â–¼</span>
                                                </span>
                                            </button>
                                            <div class="gender-filter-dropdown-list" data-filter="product" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                                <div style="padding: 8px;">
                                                    <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px; z-index: 1;">
                                                        <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px; border-radius: 4px; transition: background 0.2s;">
                                                            <input type="checkbox" class="gender-filter-select-all" data-filter="product" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                                                            ì „ì²´ ì„ íƒ
                                                        </label>
                                                    </div>
                                                    <div id="genderFilterProductList" class="gender-filter-checkbox-list"></div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- ë¸Œëœë“œë³„ ë“œë¡­ë‹¤ìš´ -->
                                        <div style="position: relative; min-width: 180px; flex: 1;">
                                            <button type="button" class="gender-filter-dropdown-btn" data-filter="brand" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; color: var(--grey-800); cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; text-align: left;">
                                                <span style="font-weight: 500;">ë¸Œëœë“œ_ì „ì²´</span>
                                                <span style="display: flex; align-items: center; gap: 6px;">
                                                    <span class="gender-selected-count" style="font-size: 11px; color: var(--grey-500);"></span>
                                                    <span style="font-size: 10px;">â–¼</span>
                                                </span>
                                            </button>
                                            <div class="gender-filter-dropdown-list" data-filter="brand" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                                <div style="padding: 8px;">
                                                    <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px; z-index: 1;">
                                                        <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px; border-radius: 4px; transition: background 0.2s;">
                                                            <input type="checkbox" class="gender-filter-select-all" data-filter="brand" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                                                            ì „ì²´ ì„ íƒ
                                                        </label>
                                                    </div>
                                                    <div id="genderFilterBrandList" class="gender-filter-checkbox-list"></div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- í”„ë¡œëª¨ì…˜ë³„ ë“œë¡­ë‹¤ìš´ -->
                                        <div style="position: relative; min-width: 180px; flex: 1;">
                                            <button type="button" class="gender-filter-dropdown-btn" data-filter="promotion" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; color: var(--grey-800); cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; text-align: left;">
                                                <span style="font-weight: 500;">í”„ë¡œëª¨ì…˜_ì „ì²´</span>
                                                <span style="display: flex; align-items: center; gap: 6px;">
                                                    <span class="gender-selected-count" style="font-size: 11px; color: var(--grey-500);"></span>
                                                    <span style="font-size: 10px;">â–¼</span>
                                                </span>
                                            </button>
                                            <div class="gender-filter-dropdown-list" data-filter="promotion" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                                <div style="padding: 8px;">
                                                    <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px; z-index: 1;">
                                                        <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px; border-radius: 4px; transition: background 0.2s;">
                                                            <input type="checkbox" class="gender-filter-select-all" data-filter="promotion" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                                                            ì „ì²´ ì„ íƒ
                                                        </label>
                                                    </div>
                                                    <div id="genderFilterPromotionList" class="gender-filter-checkbox-list"></div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- ê´‘ê³ ì„¸íŠ¸ë³„ ë“œë¡­ë‹¤ìš´ -->
                                        <div style="position: relative; min-width: 180px; flex: 1;">
                                            <button type="button" class="gender-filter-dropdown-btn" data-filter="adset" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; color: var(--grey-800); cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; text-align: left;">
                                                <span style="font-weight: 500;">ê´‘ê³ ì„¸íŠ¸_ì „ì²´</span>
                                                <span style="display: flex; align-items: center; gap: 6px;">
                                                    <span class="gender-selected-count" style="font-size: 11px; color: var(--grey-500);"></span>
                                                    <span style="font-size: 10px;">â–¼</span>
                                                </span>
                                            </button>
                                            <div class="gender-filter-dropdown-list" data-filter="adset" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                                <div style="padding: 8px;">
                                                    <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px; z-index: 1;">
                                                        <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px; border-radius: 4px; transition: background 0.2s;">
                                                            <input type="checkbox" class="gender-filter-select-all" data-filter="adset" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                                                            ì „ì²´ ì„ íƒ
                                                        </label>
                                                    </div>
                                                    <div id="genderFilterAdsetList" class="gender-filter-checkbox-list"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- íŠ¸ë Œë“œ ì°¨íŠ¸ -->
                                <div class="chart-container">
                                    <canvas id="genderTrendChart"></canvas>
                                </div>

                                <!-- íŠ¸ë Œë“œ ë¶„ì„ íŒ (ì°¨íŠ¸ í•˜ë‹¨) -->
                                <div style="margin-top: 20px; padding: 16px; background: linear-gradient(135deg, #e3f2fd 0%, #f1f8fc 100%); border-radius: 10px; border-left: 4px solid #2196f3;">
                                    <div style="font-size: 13px; font-weight: 600; color: #2196f3; margin-bottom: 8px;">
                                        ğŸ’¡ íŠ¸ë Œë“œ ë¶„ì„ íŒ
                                    </div>
                                    <div style="font-size: 13px; color: var(--grey-800); line-height: 1.6;">
                                        ìƒìŠ¹ ì¶”ì„¸ë¥¼ ë³´ì´ëŠ” ì„±ë³„ íƒ€ê²Ÿì€ ì˜ˆì‚°ì„ í™•ëŒ€í•˜ê³ , í•˜ë½ ì¶”ì„¸ë¥¼ ë³´ì´ëŠ” ê²½ìš° ì›ì¸ì„ ë¶„ì„í•˜ì—¬ ê°œì„ í•˜ì„¸ìš”.
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- íƒ­ 3: ì—°ë ¹ ì¶”ì´ -->
                        <div class="trend-analysis-tab-content" id="ageTab" style="display: none;">
                            <!-- ì»´íŒ©íŠ¸ ì„¤ëª… ì„¹ì…˜ -->
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                                <!-- ë¶„ì„ ëª©ì  ì¹´ë“œ -->
                                <div style="padding: 14px 16px; background: linear-gradient(135deg, #e3f2fd 0%, #f0f7ff 100%); border-radius: 8px; border-left: 4px solid #2196f3; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                                        <span style="font-size: 16px;">ğŸ“Š</span>
                                        <strong style="color: #1976d2; font-size: 13px;">ì´ ë¶„ì„ì˜ ëª©ì </strong>
                                    </div>
                                    <p style="margin: 0; font-size: 12px; color: #424242; line-height: 1.6;">
                                        ì‹œê°„ì— ë”°ë¥¸ <strong style="color: #1565c0;">ê° ì—°ë ¹ëŒ€ì˜ ì„±ê³¼ ë³€í™”</strong>ë¥¼ ì¶”ì í•˜ì—¬<br>
                                        íƒ€ê²ŸíŒ… ì „ëµì„ ìµœì í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
                                    </p>
                                </div>

                                <!-- ì‚¬ìš© ë°©ë²• ì¹´ë“œ -->
                                <div style="padding: 14px 16px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8f4 100%); border-radius: 8px; border-left: 4px solid #4caf50; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                                        <span style="font-size: 16px;">ğŸ’¡</span>
                                        <strong style="color: #388e3c; font-size: 13px;">ì‚¬ìš© ë°©ë²•</strong>
                                    </div>
                                    <div style="font-size: 12px; color: #424242; line-height: 1.6;">
                                        <div style="display: flex; align-items: start; gap: 8px; margin-bottom: 4px;">
                                            <span style="display: inline-flex; align-items: center; justify-content: center; width: 18px; height: 18px; background: #4caf50; color: white; border-radius: 50%; font-size: 10px; font-weight: 600; flex-shrink: 0;">1</span>
                                            <span>ë“œë¡­ë‹¤ìš´ì—ì„œ ì—°ë ¹ëŒ€ ì„ íƒ (ìµœëŒ€ 5ê°œ)</span>
                                        </div>
                                        <div style="display: flex; align-items: start; gap: 8px;">
                                            <span style="display: inline-flex; align-items: center; justify-content: center; width: 18px; height: 18px; background: #4caf50; color: white; border-radius: 50%; font-size: 10px; font-weight: 600; flex-shrink: 0;">2</span>
                                            <span>ì§‘ê³„ ë‹¨ìœ„ ë³€ê²½ ë° ì°¨íŠ¸ í™•ì¸</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card">
                                <!-- í•„í„° íƒ€ì… ì„ íƒ (ìƒë‹¨) -->
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid var(--grey-200); padding-bottom: 16px;">
                                    <div>
                                        <div class="card-title" style="margin-bottom: 4px;">ì‹œê°„ì— ë”°ë¥¸ ì—°ë ¹ëŒ€ ì„±ê³¼ ì¶”ì´</div>
                                        <p style="color: var(--grey-600); font-size: 13px; margin: 0;">
                                            ì‹œê°„ì— ë”°ë¥¸ ê° ì—°ë ¹ëŒ€ì˜ ì„±ê³¼ ë³€í™”ë¥¼ ì¶”ì í•˜ì—¬ íŠ¸ë Œë“œë¥¼ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                                        </p>
                                    </div>
                                    <!-- ì§‘ê³„ ë‹¨ìœ„ ì„ íƒ ë²„íŠ¼ -->
                                    <div class="view-type-section" style="margin-bottom: 0;">
                                        <button class="view-btn age-period-btn active" data-period="daily">ì¼ë³„</button>
                                        <button class="view-btn age-period-btn" data-period="weekly">ì£¼ë³„</button>
                                        <button class="view-btn age-period-btn" data-period="monthly">ì›”ë³„</button>
                                    </div>
                                </div>

                                <!-- ì§€í‘œ ì„ íƒ ë° ê¸°ê°„ ì„ íƒ -->
                                <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 20px; margin-bottom: 20px;">
                                    <!-- ì§€í‘œ ì„ íƒ -->
                                    <div style="flex: 0 0 auto;">
                                        <div style="font-size: 13px; font-weight: 600; color: var(--grey-700); margin-bottom: 12px;">ğŸ“ˆ ì§€í‘œ ì„ íƒ</div>
                                        <select id="ageMetricDropdown" style="min-width: 200px; padding: 10px 12px; border: 1px solid var(--grey-300); border-radius: 6px; background: white; font-size: 13px; color: var(--grey-800); cursor: pointer; transition: all 0.2s;">
                                            <option value="roas">ROAS</option>
                                            <option value="cost">ë¹„ìš©</option>
                                            <option value="revenue">ì „í™˜ê°’</option>
                                            <option value="conversions">ì „í™˜ìˆ˜</option>
                                            <option value="impressions">ë…¸ì¶œìˆ˜</option>
                                            <option value="clicks">í´ë¦­ìˆ˜</option>
                                            <option value="cpm">CPM</option>
                                            <option value="cpc">CPC</option>
                                            <option value="cpa">CPA</option>
                                            <option value="ctr">CTR</option>
                                            <option value="cvr">ì „í™˜ìœ¨</option>
                                        </select>
                                    </div>

                                    <!-- ê¸°ê°„ ì„ íƒ -->
                                    <div style="flex: 0 0 auto; margin-left: auto;">
                                        <div style="font-size: 13px; font-weight: 600; color: var(--grey-700); margin-bottom: 12px;">ğŸ“… ê¸°ê°„ ì„ íƒ</div>
                                        <div style="display: flex; align-items: center; gap: 10px;">
                                            <input type="date" id="ageStartDate" style="padding: 10px 12px; border: 1px solid var(--grey-300); border-radius: 6px; background: white; font-size: 13px; color: var(--grey-800); cursor: pointer; transition: all 0.2s;">
                                            <span style="color: var(--grey-600); font-weight: 500;">~</span>
                                            <input type="date" id="ageEndDate" style="padding: 10px 12px; border: 1px solid var(--grey-300); border-radius: 6px; background: white; font-size: 13px; color: var(--grey-800); cursor: pointer; transition: all 0.2s;">
                                        </div>
                                    </div>
                                </div>

                                <!-- ë“œë¡­ë‹¤ìš´ í˜•íƒœ í•„í„° -->
                                <div style="margin-bottom: 20px; padding: 16px; background: var(--grey-50); border-radius: 8px; border: 1px solid var(--grey-200);">
                                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 14px;">
                                        <div style="font-size: 13px; font-weight: 600; color: var(--grey-700);">ğŸ“Š ë¶„ë¥˜ ê¸°ì¤€</div>
                                        <div style="font-size: 12px; color: #2e7d32; font-weight: 600;">
                                            ğŸ¯ <span id="filteredAgeCount">0</span>ê°œ ì—°ë ¹ëŒ€
                                        </div>
                                    </div>

                                    <!-- ë“œë¡­ë‹¤ìš´ ë²„íŠ¼ë“¤ -->
                                    <div style="display: flex; gap: 12px; align-items: flex-start; flex-wrap: wrap;">
                                        <!-- ì±„ë„ë³„ ë“œë¡­ë‹¤ìš´ -->
                                        <div style="position: relative; min-width: 180px; flex: 1;">
                                            <button type="button" class="age-filter-dropdown-btn" data-filter="channel" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; color: var(--grey-800); cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; text-align: left;">
                                                <span style="font-weight: 500;">ì±„ë„_ì „ì²´</span>
                                                <span style="display: flex; align-items: center; gap: 6px;">
                                                    <span class="age-selected-count" style="font-size: 11px; color: var(--grey-500);"></span>
                                                    <span style="font-size: 10px;">â–¼</span>
                                                </span>
                                            </button>
                                            <div class="age-filter-dropdown-list" data-filter="channel" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                                <div style="padding: 8px;">
                                                    <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px; z-index: 1;">
                                                        <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px; border-radius: 4px; transition: background 0.2s;">
                                                            <input type="checkbox" class="age-filter-select-all" data-filter="channel" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                                                            ì „ì²´ ì„ íƒ
                                                        </label>
                                                    </div>
                                                    <div id="ageFilterChannelList" class="age-filter-checkbox-list"></div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- ì œí’ˆë³„ ë“œë¡­ë‹¤ìš´ -->
                                        <div style="position: relative; min-width: 180px; flex: 1;">
                                            <button type="button" class="age-filter-dropdown-btn" data-filter="product" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; color: var(--grey-800); cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; text-align: left;">
                                                <span style="font-weight: 500;">ì œí’ˆ_ì „ì²´</span>
                                                <span style="display: flex; align-items: center; gap: 6px;">
                                                    <span class="age-selected-count" style="font-size: 11px; color: var(--grey-500);"></span>
                                                    <span style="font-size: 10px;">â–¼</span>
                                                </span>
                                            </button>
                                            <div class="age-filter-dropdown-list" data-filter="product" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                                <div style="padding: 8px;">
                                                    <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px; z-index: 1;">
                                                        <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px; border-radius: 4px; transition: background 0.2s;">
                                                            <input type="checkbox" class="age-filter-select-all" data-filter="product" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                                                            ì „ì²´ ì„ íƒ
                                                        </label>
                                                    </div>
                                                    <div id="ageFilterProductList" class="age-filter-checkbox-list"></div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- ë¸Œëœë“œë³„ ë“œë¡­ë‹¤ìš´ -->
                                        <div style="position: relative; min-width: 180px; flex: 1;">
                                            <button type="button" class="age-filter-dropdown-btn" data-filter="brand" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; color: var(--grey-800); cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; text-align: left;">
                                                <span style="font-weight: 500;">ë¸Œëœë“œ_ì „ì²´</span>
                                                <span style="display: flex; align-items: center; gap: 6px;">
                                                    <span class="age-selected-count" style="font-size: 11px; color: var(--grey-500);"></span>
                                                    <span style="font-size: 10px;">â–¼</span>
                                                </span>
                                            </button>
                                            <div class="age-filter-dropdown-list" data-filter="brand" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                                <div style="padding: 8px;">
                                                    <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px; z-index: 1;">
                                                        <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px; border-radius: 4px; transition: background 0.2s;">
                                                            <input type="checkbox" class="age-filter-select-all" data-filter="brand" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                                                            ì „ì²´ ì„ íƒ
                                                        </label>
                                                    </div>
                                                    <div id="ageFilterBrandList" class="age-filter-checkbox-list"></div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- í”„ë¡œëª¨ì…˜ë³„ ë“œë¡­ë‹¤ìš´ -->
                                        <div style="position: relative; min-width: 180px; flex: 1;">
                                            <button type="button" class="age-filter-dropdown-btn" data-filter="promotion" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; color: var(--grey-800); cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; text-align: left;">
                                                <span style="font-weight: 500;">í”„ë¡œëª¨ì…˜_ì „ì²´</span>
                                                <span style="display: flex; align-items: center; gap: 6px;">
                                                    <span class="age-selected-count" style="font-size: 11px; color: var(--grey-500);"></span>
                                                    <span style="font-size: 10px;">â–¼</span>
                                                </span>
                                            </button>
                                            <div class="age-filter-dropdown-list" data-filter="promotion" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                                <div style="padding: 8px;">
                                                    <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px; z-index: 1;">
                                                        <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px; border-radius: 4px; transition: background 0.2s;">
                                                            <input type="checkbox" class="age-filter-select-all" data-filter="promotion" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                                                            ì „ì²´ ì„ íƒ
                                                        </label>
                                                    </div>
                                                    <div id="ageFilterPromotionList" class="age-filter-checkbox-list"></div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- ê´‘ê³ ì„¸íŠ¸ë³„ ë“œë¡­ë‹¤ìš´ -->
                                        <div style="position: relative; min-width: 180px; flex: 1;">
                                            <button type="button" class="age-filter-dropdown-btn" data-filter="adset" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; color: var(--grey-800); cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; text-align: left;">
                                                <span style="font-weight: 500;">ê´‘ê³ ì„¸íŠ¸_ì „ì²´</span>
                                                <span style="display: flex; align-items: center; gap: 6px;">
                                                    <span class="age-selected-count" style="font-size: 11px; color: var(--grey-500);"></span>
                                                    <span style="font-size: 10px;">â–¼</span>
                                                </span>
                                            </button>
                                            <div class="age-filter-dropdown-list" data-filter="adset" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                                <div style="padding: 8px;">
                                                    <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px; z-index: 1;">
                                                        <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px; border-radius: 4px; transition: background 0.2s;">
                                                            <input type="checkbox" class="age-filter-select-all" data-filter="adset" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                                                            ì „ì²´ ì„ íƒ
                                                        </label>
                                                    </div>
                                                    <div id="ageFilterAdsetList" class="age-filter-checkbox-list"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- ì°¨íŠ¸ -->
                                <div class="chart-container">
                                    <canvas id="ageTrendChart"></canvas>
                                </div>

                                <!-- íŠ¸ë Œë“œ ë¶„ì„ íŒ (ì°¨íŠ¸ í•˜ë‹¨) -->
                                <div style="margin-top: 20px; padding: 16px; background: linear-gradient(135deg, #e3f2fd 0%, #f1f8fc 100%); border-radius: 10px; border-left: 4px solid #2196f3;">
                                    <div style="font-size: 13px; font-weight: 600; color: #2196f3; margin-bottom: 8px;">
                                        ğŸ’¡ íŠ¸ë Œë“œ ë¶„ì„ íŒ
                                    </div>
                                    <div style="font-size: 13px; color: var(--grey-800); line-height: 1.6;">
                                        ìƒìŠ¹ ì¶”ì„¸ë¥¼ ë³´ì´ëŠ” ì—°ë ¹ëŒ€ íƒ€ê²Ÿì€ ì˜ˆì‚°ì„ í™•ëŒ€í•˜ê³ , í•˜ë½ ì¶”ì„¸ë¥¼ ë³´ì´ëŠ” ê²½ìš° ì›ì¸ì„ ë¶„ì„í•˜ì—¬ ê°œì„ í•˜ì„¸ìš”.
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- íƒ­ 4: í”Œë«í¼ ì¶”ì´ -->
                        <div class="trend-analysis-tab-content" id="platformTab" style="display: none;">
                            <!-- ì»´íŒ©íŠ¸ ì„¤ëª… ì„¹ì…˜ -->
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                                <!-- ë¶„ì„ ëª©ì  ì¹´ë“œ -->
                                <div style="padding: 14px 16px; background: linear-gradient(135deg, #e3f2fd 0%, #f0f7ff 100%); border-radius: 8px; border-left: 4px solid #2196f3; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                                        <span style="font-size: 16px;">ğŸ“Š</span>
                                        <strong style="color: #1976d2; font-size: 13px;">ì´ ë¶„ì„ì˜ ëª©ì </strong>
                                    </div>
                                    <p style="margin: 0; font-size: 12px; color: #424242; line-height: 1.6;">
                                        ì‹œê°„ì— ë”°ë¥¸ <strong style="color: #1565c0;">ê° í”Œë«í¼ì˜ ì„±ê³¼ ë³€í™”</strong>ë¥¼ ì¶”ì í•˜ì—¬<br>
                                        í”Œë«í¼ë³„ ì „ëµì„ ìµœì í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
                                    </p>
                                </div>

                                <!-- ì‚¬ìš© ë°©ë²• ì¹´ë“œ -->
                                <div style="padding: 14px 16px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8f4 100%); border-radius: 8px; border-left: 4px solid #4caf50; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                                        <span style="font-size: 16px;">ğŸ’¡</span>
                                        <strong style="color: #388e3c; font-size: 13px;">ì‚¬ìš© ë°©ë²•</strong>
                                    </div>
                                    <div style="font-size: 12px; color: #424242; line-height: 1.6;">
                                        <div style="display: flex; align-items: start; gap: 8px; margin-bottom: 4px;">
                                            <span style="display: inline-flex; align-items: center; justify-content: center; width: 18px; height: 18px; background: #4caf50; color: white; border-radius: 50%; font-size: 10px; font-weight: 600; flex-shrink: 0;">1</span>
                                            <span>ë“œë¡­ë‹¤ìš´ì—ì„œ í”Œë«í¼ ì„ íƒ (ìµœëŒ€ 5ê°œ)</span>
                                        </div>
                                        <div style="display: flex; align-items: start; gap: 8px;">
                                            <span style="display: inline-flex; align-items: center; justify-content: center; width: 18px; height: 18px; background: #4caf50; color: white; border-radius: 50%; font-size: 10px; font-weight: 600; flex-shrink: 0;">2</span>
                                            <span>ì§‘ê³„ ë‹¨ìœ„ ë³€ê²½ ë° ì°¨íŠ¸ í™•ì¸</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card">
                                <!-- í•„í„° íƒ€ì… ì„ íƒ (ìƒë‹¨) -->
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid var(--grey-200); padding-bottom: 16px;">
                                    <div>
                                        <div class="card-title" style="margin-bottom: 4px;">ì‹œê°„ì— ë”°ë¥¸ í”Œë«í¼ ì„±ê³¼ ì¶”ì´</div>
                                        <p style="color: var(--grey-600); font-size: 13px; margin: 0;">
                                            ì‹œê°„ì— ë”°ë¥¸ ê° í”Œë«í¼ì˜ ì„±ê³¼ ë³€í™”ë¥¼ ì¶”ì í•˜ì—¬ íŠ¸ë Œë“œë¥¼ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                                        </p>
                                    </div>
                                    <!-- ì§‘ê³„ ë‹¨ìœ„ ì„ íƒ ë²„íŠ¼ -->
                                    <div class="view-type-section" style="margin-bottom: 0;">
                                        <button class="view-btn platform-period-btn active" data-period="daily">ì¼ë³„</button>
                                        <button class="view-btn platform-period-btn" data-period="weekly">ì£¼ë³„</button>
                                        <button class="view-btn platform-period-btn" data-period="monthly">ì›”ë³„</button>
                                    </div>
                                </div>

                                <!-- ì§€í‘œ ì„ íƒ ë° ê¸°ê°„ ì„ íƒ -->
                                <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 20px; margin-bottom: 20px;">
                                    <!-- ì§€í‘œ ì„ íƒ -->
                                    <div style="flex: 0 0 auto;">
                                        <div style="font-size: 13px; font-weight: 600; color: var(--grey-700); margin-bottom: 12px;">ğŸ“ˆ ì§€í‘œ ì„ íƒ</div>
                                        <select id="platformMetricDropdown" style="min-width: 200px; padding: 10px 12px; border: 1px solid var(--grey-300); border-radius: 6px; background: white; font-size: 13px; color: var(--grey-800); cursor: pointer; transition: all 0.2s;">
                                            <option value="roas">ROAS</option>
                                            <option value="cost">ë¹„ìš©</option>
                                            <option value="revenue">ì „í™˜ê°’</option>
                                            <option value="conversions">ì „í™˜ìˆ˜</option>
                                            <option value="impressions">ë…¸ì¶œìˆ˜</option>
                                            <option value="clicks">í´ë¦­ìˆ˜</option>
                                            <option value="cpm">CPM</option>
                                            <option value="cpc">CPC</option>
                                            <option value="cpa">CPA</option>
                                            <option value="ctr">CTR</option>
                                            <option value="cvr">ì „í™˜ìœ¨</option>
                                        </select>
                                    </div>

                                    <!-- ê¸°ê°„ ì„ íƒ -->
                                    <div style="flex: 0 0 auto; margin-left: auto;">
                                        <div style="font-size: 13px; font-weight: 600; color: var(--grey-700); margin-bottom: 12px;">ğŸ“… ê¸°ê°„ ì„ íƒ</div>
                                        <div style="display: flex; align-items: center; gap: 10px;">
                                            <input type="date" id="platformStartDate" style="padding: 10px 12px; border: 1px solid var(--grey-300); border-radius: 6px; background: white; font-size: 13px; color: var(--grey-800); cursor: pointer; transition: all 0.2s;">
                                            <span style="color: var(--grey-600); font-weight: 500;">~</span>
                                            <input type="date" id="platformEndDate" style="padding: 10px 12px; border: 1px solid var(--grey-300); border-radius: 6px; background: white; font-size: 13px; color: var(--grey-800); cursor: pointer; transition: all 0.2s;">
                                        </div>
                                    </div>
                                </div>

                                <!-- ë“œë¡­ë‹¤ìš´ í˜•íƒœ í•„í„° -->
                                <div style="margin-bottom: 20px; padding: 16px; background: var(--grey-50); border-radius: 8px; border: 1px solid var(--grey-200);">
                                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 14px;">
                                        <div style="font-size: 13px; font-weight: 600; color: var(--grey-700);">ğŸ“Š ë¶„ë¥˜ ê¸°ì¤€</div>
                                        <div style="font-size: 12px; color: #2e7d32; font-weight: 600;">
                                            ğŸ¯ <span id="filteredPlatformCount">0</span>ê°œ í”Œë«í¼
                                        </div>
                                    </div>

                                    <!-- ë“œë¡­ë‹¤ìš´ ë²„íŠ¼ë“¤ -->
                                    <div style="display: flex; gap: 12px; align-items: flex-start; flex-wrap: wrap;">
                                        <!-- ì±„ë„ë³„ ë“œë¡­ë‹¤ìš´ -->
                                        <div style="position: relative; min-width: 180px; flex: 1;">
                                            <button type="button" class="platform-filter-dropdown-btn" data-filter="channel" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; color: var(--grey-800); cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; text-align: left;">
                                                <span style="font-weight: 500;">ì±„ë„_ì „ì²´</span>
                                                <span style="display: flex; align-items: center; gap: 6px;">
                                                    <span class="platform-selected-count" style="font-size: 11px; color: var(--grey-500);"></span>
                                                    <span style="font-size: 10px;">â–¼</span>
                                                </span>
                                            </button>
                                            <div class="platform-filter-dropdown-list" data-filter="channel" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                                <div style="padding: 8px;">
                                                    <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px; z-index: 1;">
                                                        <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px; border-radius: 4px; transition: background 0.2s;">
                                                            <input type="checkbox" class="platform-filter-select-all" data-filter="channel" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                                                            ì „ì²´ ì„ íƒ
                                                        </label>
                                                    </div>
                                                    <div id="platformFilterChannelList" class="platform-filter-checkbox-list"></div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- ì œí’ˆë³„ ë“œë¡­ë‹¤ìš´ -->
                                        <div style="position: relative; min-width: 180px; flex: 1;">
                                            <button type="button" class="platform-filter-dropdown-btn" data-filter="product" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; color: var(--grey-800); cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; text-align: left;">
                                                <span style="font-weight: 500;">ì œí’ˆ_ì „ì²´</span>
                                                <span style="display: flex; align-items: center; gap: 6px;">
                                                    <span class="platform-selected-count" style="font-size: 11px; color: var(--grey-500);"></span>
                                                    <span style="font-size: 10px;">â–¼</span>
                                                </span>
                                            </button>
                                            <div class="platform-filter-dropdown-list" data-filter="product" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                                <div style="padding: 8px;">
                                                    <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px; z-index: 1;">
                                                        <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px; border-radius: 4px; transition: background 0.2s;">
                                                            <input type="checkbox" class="platform-filter-select-all" data-filter="product" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                                                            ì „ì²´ ì„ íƒ
                                                        </label>
                                                    </div>
                                                    <div id="platformFilterProductList" class="platform-filter-checkbox-list"></div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- ë¸Œëœë“œë³„ ë“œë¡­ë‹¤ìš´ -->
                                        <div style="position: relative; min-width: 180px; flex: 1;">
                                            <button type="button" class="platform-filter-dropdown-btn" data-filter="brand" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; color: var(--grey-800); cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; text-align: left;">
                                                <span style="font-weight: 500;">ë¸Œëœë“œ_ì „ì²´</span>
                                                <span style="display: flex; align-items: center; gap: 6px;">
                                                    <span class="platform-selected-count" style="font-size: 11px; color: var(--grey-500);"></span>
                                                    <span style="font-size: 10px;">â–¼</span>
                                                </span>
                                            </button>
                                            <div class="platform-filter-dropdown-list" data-filter="brand" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                                <div style="padding: 8px;">
                                                    <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px; z-index: 1;">
                                                        <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px; border-radius: 4px; transition: background 0.2s;">
                                                            <input type="checkbox" class="platform-filter-select-all" data-filter="brand" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                                                            ì „ì²´ ì„ íƒ
                                                        </label>
                                                    </div>
                                                    <div id="platformFilterBrandList" class="platform-filter-checkbox-list"></div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- í”„ë¡œëª¨ì…˜ë³„ ë“œë¡­ë‹¤ìš´ -->
                                        <div style="position: relative; min-width: 180px; flex: 1;">
                                            <button type="button" class="platform-filter-dropdown-btn" data-filter="promotion" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; color: var(--grey-800); cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; text-align: left;">
                                                <span style="font-weight: 500;">í”„ë¡œëª¨ì…˜_ì „ì²´</span>
                                                <span style="display: flex; align-items: center; gap: 6px;">
                                                    <span class="platform-selected-count" style="font-size: 11px; color: var(--grey-500);"></span>
                                                    <span style="font-size: 10px;">â–¼</span>
                                                </span>
                                            </button>
                                            <div class="platform-filter-dropdown-list" data-filter="promotion" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                                <div style="padding: 8px;">
                                                    <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px; z-index: 1;">
                                                        <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px; border-radius: 4px; transition: background 0.2s;">
                                                            <input type="checkbox" class="platform-filter-select-all" data-filter="promotion" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                                                            ì „ì²´ ì„ íƒ
                                                        </label>
                                                    </div>
                                                    <div id="platformFilterPromotionList" class="platform-filter-checkbox-list"></div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- ê´‘ê³ ì„¸íŠ¸ë³„ ë“œë¡­ë‹¤ìš´ -->
                                        <div style="position: relative; min-width: 180px; flex: 1;">
                                            <button type="button" class="platform-filter-dropdown-btn" data-filter="adset" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; color: var(--grey-800); cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; text-align: left;">
                                                <span style="font-weight: 500;">ê´‘ê³ ì„¸íŠ¸_ì „ì²´</span>
                                                <span style="display: flex; align-items: center; gap: 6px;">
                                                    <span class="platform-selected-count" style="font-size: 11px; color: var(--grey-500);"></span>
                                                    <span style="font-size: 10px;">â–¼</span>
                                                </span>
                                            </button>
                                            <div class="platform-filter-dropdown-list" data-filter="adset" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                                <div style="padding: 8px;">
                                                    <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px; z-index: 1;">
                                                        <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px; border-radius: 4px; transition: background 0.2s;">
                                                            <input type="checkbox" class="platform-filter-select-all" data-filter="adset" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                                                            ì „ì²´ ì„ íƒ
                                                        </label>
                                                    </div>
                                                    <div id="platformFilterAdsetList" class="platform-filter-checkbox-list"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- íŠ¸ë Œë“œ ì°¨íŠ¸ -->
                                <div class="chart-container">
                                    <canvas id="platformTrendChart"></canvas>
                                </div>

                                <!-- íŠ¸ë Œë“œ ë¶„ì„ íŒ (ì°¨íŠ¸ í•˜ë‹¨) -->
                                <div style="margin-top: 20px; padding: 16px; background: linear-gradient(135deg, #e3f2fd 0%, #f1f8fc 100%); border-radius: 10px; border-left: 4px solid #2196f3;">
                                    <div style="font-size: 13px; font-weight: 600; color: #2196f3; margin-bottom: 8px;">
                                        ğŸ’¡ íŠ¸ë Œë“œ ë¶„ì„ íŒ
                                    </div>
                                    <div style="font-size: 13px; color: var(--grey-800); line-height: 1.6;">
                                        ìƒìŠ¹ ì¶”ì„¸ë¥¼ ë³´ì´ëŠ” í”Œë«í¼ì— ì˜ˆì‚°ì„ ì§‘ì¤‘í•˜ê³ , í•˜ë½ ì¶”ì„¸ë¥¼ ë³´ì´ëŠ” í”Œë«í¼ì˜ ë¬¸ì œì ì„ íŒŒì•…í•˜ì—¬ ê°œì„ í•˜ì„¸ìš”.
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- íƒ­ 5: ê¸°ê¸°í”Œë«í¼ ì¶”ì´ -->
                        <div class="trend-analysis-tab-content" id="devicePlatformTab" style="display: none;">
                            <!-- ì»´íŒ©íŠ¸ ì„¤ëª… ì„¹ì…˜ -->
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                                <!-- ë¶„ì„ ëª©ì  ì¹´ë“œ -->
                                <div style="padding: 14px 16px; background: linear-gradient(135deg, #e3f2fd 0%, #f0f7ff 100%); border-radius: 8px; border-left: 4px solid #2196f3; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                                        <span style="font-size: 16px;">ğŸ“Š</span>
                                        <strong style="color: #1976d2; font-size: 13px;">ì´ ë¶„ì„ì˜ ëª©ì </strong>
                                    </div>
                                    <p style="margin: 0; font-size: 12px; color: #424242; line-height: 1.6;">
                                        ì‹œê°„ì— ë”°ë¥¸ <strong style="color: #1565c0;">ê° ê¸°ê¸°í”Œë«í¼ì˜ ì„±ê³¼ ë³€í™”</strong>ë¥¼ ì¶”ì í•˜ì—¬<br>
                                        í”Œë«í¼ë³„ ì „ëµì„ ìµœì í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
                                    </p>
                                </div>

                                <!-- ì‚¬ìš© ë°©ë²• ì¹´ë“œ -->
                                <div style="padding: 14px 16px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8f4 100%); border-radius: 8px; border-left: 4px solid #4caf50; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                                        <span style="font-size: 16px;">ğŸ’¡</span>
                                        <strong style="color: #388e3c; font-size: 13px;">ì‚¬ìš© ë°©ë²•</strong>
                                    </div>
                                    <div style="font-size: 12px; color: #424242; line-height: 1.6;">
                                        <div style="display: flex; align-items: start; gap: 8px; margin-bottom: 4px;">
                                            <span style="display: inline-flex; align-items: center; justify-content: center; width: 18px; height: 18px; background: #4caf50; color: white; border-radius: 50%; font-size: 10px; font-weight: 600; flex-shrink: 0;">1</span>
                                            <span>ë“œë¡­ë‹¤ìš´ì—ì„œ ê¸°ê¸°í”Œë«í¼ ì„ íƒ (ìµœëŒ€ 5ê°œ)</span>
                                        </div>
                                        <div style="display: flex; align-items: start; gap: 8px;">
                                            <span style="display: inline-flex; align-items: center; justify-content: center; width: 18px; height: 18px; background: #4caf50; color: white; border-radius: 50%; font-size: 10px; font-weight: 600; flex-shrink: 0;">2</span>
                                            <span>ì§‘ê³„ ë‹¨ìœ„ ë³€ê²½ ë° ì°¨íŠ¸ í™•ì¸</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card">
                                <!-- í•„í„° íƒ€ì… ì„ íƒ (ìƒë‹¨) -->
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid var(--grey-200); padding-bottom: 16px;">
                                    <div>
                                        <div class="card-title" style="margin-bottom: 4px;">ì‹œê°„ì— ë”°ë¥¸ ê¸°ê¸°í”Œë«í¼ ì„±ê³¼ ì¶”ì´</div>
                                        <p style="color: var(--grey-600); font-size: 13px; margin: 0;">
                                            ì‹œê°„ì— ë”°ë¥¸ ê° ê¸°ê¸°í”Œë«í¼ì˜ ì„±ê³¼ ë³€í™”ë¥¼ ì¶”ì í•˜ì—¬ íŠ¸ë Œë“œë¥¼ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                                        </p>
                                    </div>
                                    <!-- ì§‘ê³„ ë‹¨ìœ„ ì„ íƒ ë²„íŠ¼ -->
                                    <div class="view-type-section" style="margin-bottom: 0;">
                                        <button class="view-btn device-platform-period-btn active" data-period="daily">ì¼ë³„</button>
                                        <button class="view-btn device-platform-period-btn" data-period="weekly">ì£¼ë³„</button>
                                        <button class="view-btn device-platform-period-btn" data-period="monthly">ì›”ë³„</button>
                                    </div>
                                </div>

                                <!-- ì§€í‘œ ì„ íƒ ë° ê¸°ê°„ ì„ íƒ -->
                                <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 20px; margin-bottom: 20px;">
                                    <!-- ì§€í‘œ ì„ íƒ -->
                                    <div style="flex: 0 0 auto;">
                                        <div style="font-size: 13px; font-weight: 600; color: var(--grey-700); margin-bottom: 12px;">ğŸ“ˆ ì§€í‘œ ì„ íƒ</div>
                                        <select id="devicePlatformMetricDropdown" style="min-width: 200px; padding: 10px 12px; border: 1px solid var(--grey-300); border-radius: 6px; background: white; font-size: 13px; color: var(--grey-800); cursor: pointer; transition: all 0.2s;">
                                            <option value="roas">ROAS</option>
                                            <option value="cost">ë¹„ìš©</option>
                                            <option value="revenue">ì „í™˜ê°’</option>
                                            <option value="conversions">ì „í™˜ìˆ˜</option>
                                            <option value="impressions">ë…¸ì¶œìˆ˜</option>
                                            <option value="clicks">í´ë¦­ìˆ˜</option>
                                            <option value="cpm">CPM</option>
                                            <option value="cpc">CPC</option>
                                            <option value="cpa">CPA</option>
                                            <option value="ctr">CTR</option>
                                            <option value="cvr">ì „í™˜ìœ¨</option>
                                        </select>
                                    </div>

                                    <!-- ê¸°ê°„ ì„ íƒ -->
                                    <div style="flex: 0 0 auto; margin-left: auto;">
                                        <div style="font-size: 13px; font-weight: 600; color: var(--grey-700); margin-bottom: 12px;">ğŸ“… ê¸°ê°„ ì„ íƒ</div>
                                        <div style="display: flex; align-items: center; gap: 10px;">
                                            <input type="date" id="devicePlatformStartDate" style="padding: 10px 12px; border: 1px solid var(--grey-300); border-radius: 6px; background: white; font-size: 13px; color: var(--grey-800); cursor: pointer; transition: all 0.2s;">
                                            <span style="color: var(--grey-600); font-weight: 500;">~</span>
                                            <input type="date" id="devicePlatformEndDate" style="padding: 10px 12px; border: 1px solid var(--grey-300); border-radius: 6px; background: white; font-size: 13px; color: var(--grey-800); cursor: pointer; transition: all 0.2s;">
                                        </div>
                                    </div>
                                </div>

                                <!-- ë“œë¡­ë‹¤ìš´ í˜•íƒœ í•„í„° -->
                                <div style="margin-bottom: 20px; padding: 16px; background: var(--grey-50); border-radius: 8px; border: 1px solid var(--grey-200);">
                                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 14px;">
                                        <div style="font-size: 13px; font-weight: 600; color: var(--grey-700);">ğŸ“Š ë¶„ë¥˜ ê¸°ì¤€</div>
                                        <div style="font-size: 12px; color: #2e7d32; font-weight: 600;">
                                            ğŸ¯ <span id="filteredDevicePlatformCount">0</span>ê°œ ê¸°ê¸°í”Œë«í¼
                                        </div>
                                    </div>

                                    <!-- ë“œë¡­ë‹¤ìš´ ë²„íŠ¼ë“¤ -->
                                    <div style="display: flex; gap: 12px; align-items: flex-start; flex-wrap: wrap;">
                                        <!-- ì±„ë„ë³„ ë“œë¡­ë‹¤ìš´ -->
                                        <div style="position: relative; min-width: 180px; flex: 1;">
                                            <button type="button" class="deviceplatform-filter-dropdown-btn" data-filter="channel" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; color: var(--grey-800); cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; text-align: left;">
                                                <span style="font-weight: 500;">ì±„ë„_ì „ì²´</span>
                                                <span style="display: flex; align-items: center; gap: 6px;">
                                                    <span class="deviceplatform-selected-count" style="font-size: 11px; color: var(--grey-500);"></span>
                                                    <span style="font-size: 10px;">â–¼</span>
                                                </span>
                                            </button>
                                            <div class="deviceplatform-filter-dropdown-list" data-filter="channel" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                                <div style="padding: 8px;">
                                                    <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px; z-index: 1;">
                                                        <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px; border-radius: 4px; transition: background 0.2s;">
                                                            <input type="checkbox" class="deviceplatform-filter-select-all" data-filter="channel" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                                                            ì „ì²´ ì„ íƒ
                                                        </label>
                                                    </div>
                                                    <div id="deviceplatformFilterChannelList" class="deviceplatform-filter-checkbox-list"></div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- ì œí’ˆë³„ ë“œë¡­ë‹¤ìš´ -->
                                        <div style="position: relative; min-width: 180px; flex: 1;">
                                            <button type="button" class="deviceplatform-filter-dropdown-btn" data-filter="product" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; color: var(--grey-800); cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; text-align: left;">
                                                <span style="font-weight: 500;">ì œí’ˆ_ì „ì²´</span>
                                                <span style="display: flex; align-items: center; gap: 6px;">
                                                    <span class="deviceplatform-selected-count" style="font-size: 11px; color: var(--grey-500);"></span>
                                                    <span style="font-size: 10px;">â–¼</span>
                                                </span>
                                            </button>
                                            <div class="deviceplatform-filter-dropdown-list" data-filter="product" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                                <div style="padding: 8px;">
                                                    <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px; z-index: 1;">
                                                        <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px; border-radius: 4px; transition: background 0.2s;">
                                                            <input type="checkbox" class="deviceplatform-filter-select-all" data-filter="product" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                                                            ì „ì²´ ì„ íƒ
                                                        </label>
                                                    </div>
                                                    <div id="deviceplatformFilterProductList" class="deviceplatform-filter-checkbox-list"></div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- ë¸Œëœë“œë³„ ë“œë¡­ë‹¤ìš´ -->
                                        <div style="position: relative; min-width: 180px; flex: 1;">
                                            <button type="button" class="deviceplatform-filter-dropdown-btn" data-filter="brand" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; color: var(--grey-800); cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; text-align: left;">
                                                <span style="font-weight: 500;">ë¸Œëœë“œ_ì „ì²´</span>
                                                <span style="display: flex; align-items: center; gap: 6px;">
                                                    <span class="deviceplatform-selected-count" style="font-size: 11px; color: var(--grey-500);"></span>
                                                    <span style="font-size: 10px;">â–¼</span>
                                                </span>
                                            </button>
                                            <div class="deviceplatform-filter-dropdown-list" data-filter="brand" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                                <div style="padding: 8px;">
                                                    <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px; z-index: 1;">
                                                        <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px; border-radius: 4px; transition: background 0.2s;">
                                                            <input type="checkbox" class="deviceplatform-filter-select-all" data-filter="brand" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                                                            ì „ì²´ ì„ íƒ
                                                        </label>
                                                    </div>
                                                    <div id="deviceplatformFilterBrandList" class="deviceplatform-filter-checkbox-list"></div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- í”„ë¡œëª¨ì…˜ë³„ ë“œë¡­ë‹¤ìš´ -->
                                        <div style="position: relative; min-width: 180px; flex: 1;">
                                            <button type="button" class="deviceplatform-filter-dropdown-btn" data-filter="promotion" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; color: var(--grey-800); cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; text-align: left;">
                                                <span style="font-weight: 500;">í”„ë¡œëª¨ì…˜_ì „ì²´</span>
                                                <span style="display: flex; align-items: center; gap: 6px;">
                                                    <span class="deviceplatform-selected-count" style="font-size: 11px; color: var(--grey-500);"></span>
                                                    <span style="font-size: 10px;">â–¼</span>
                                                </span>
                                            </button>
                                            <div class="deviceplatform-filter-dropdown-list" data-filter="promotion" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                                <div style="padding: 8px;">
                                                    <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px; z-index: 1;">
                                                        <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px; border-radius: 4px; transition: background 0.2s;">
                                                            <input type="checkbox" class="deviceplatform-filter-select-all" data-filter="promotion" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                                                            ì „ì²´ ì„ íƒ
                                                        </label>
                                                    </div>
                                                    <div id="deviceplatformFilterPromotionList" class="deviceplatform-filter-checkbox-list"></div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- ê´‘ê³ ì„¸íŠ¸ë³„ ë“œë¡­ë‹¤ìš´ -->
                                        <div style="position: relative; min-width: 180px; flex: 1;">
                                            <button type="button" class="deviceplatform-filter-dropdown-btn" data-filter="adset" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; color: var(--grey-800); cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; text-align: left;">
                                                <span style="font-weight: 500;">ê´‘ê³ ì„¸íŠ¸_ì „ì²´</span>
                                                <span style="display: flex; align-items: center; gap: 6px;">
                                                    <span class="deviceplatform-selected-count" style="font-size: 11px; color: var(--grey-500);"></span>
                                                    <span style="font-size: 10px;">â–¼</span>
                                                </span>
                                            </button>
                                            <div class="deviceplatform-filter-dropdown-list" data-filter="adset" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                                <div style="padding: 8px;">
                                                    <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px; z-index: 1;">
                                                        <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px; border-radius: 4px; transition: background 0.2s;">
                                                            <input type="checkbox" class="deviceplatform-filter-select-all" data-filter="adset" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                                                            ì „ì²´ ì„ íƒ
                                                        </label>
                                                    </div>
                                                    <div id="deviceplatformFilterAdsetList" class="deviceplatform-filter-checkbox-list"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- íŠ¸ë Œë“œ ì°¨íŠ¸ -->
                                <div class="chart-container">
                                    <canvas id="devicePlatformTrendChart"></canvas>
                                </div>

                                <!-- íŠ¸ë Œë“œ ë¶„ì„ íŒ (ì°¨íŠ¸ í•˜ë‹¨) -->
                                <div style="margin-top: 20px; padding: 16px; background: linear-gradient(135deg, #e3f2fd 0%, #f1f8fc 100%); border-radius: 10px; border-left: 4px solid #2196f3;">
                                    <div style="font-size: 13px; font-weight: 600; color: #2196f3; margin-bottom: 8px;">
                                        ğŸ’¡ íŠ¸ë Œë“œ ë¶„ì„ íŒ
                                    </div>
                                    <div style="font-size: 13px; color: var(--grey-800); line-height: 1.6;">
                                        ìƒìŠ¹ ì¶”ì„¸ë¥¼ ë³´ì´ëŠ” ê¸°ê¸°í”Œë«í¼ì— ì˜ˆì‚°ì„ ì§‘ì¤‘í•˜ê³ , í•˜ë½ ì¶”ì„¸ë¥¼ ë³´ì´ëŠ” ê¸°ê¸°í”Œë«í¼ì˜ ë¬¸ì œì ì„ íŒŒì•…í•˜ì—¬ ê°œì„ í•˜ì„¸ìš”.
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- íƒ­ 6: ê¸°ê¸° ì¶”ì´ -->
                        <div class="trend-analysis-tab-content" id="deviceTypeTab" style="display: none;">
                            <!-- ì»´íŒ©íŠ¸ ì„¤ëª… ì„¹ì…˜ -->
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                                <!-- ë¶„ì„ ëª©ì  ì¹´ë“œ -->
                                <div style="padding: 14px 16px; background: linear-gradient(135deg, #e3f2fd 0%, #f0f7ff 100%); border-radius: 8px; border-left: 4px solid #2196f3; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                                        <span style="font-size: 16px;">ğŸ“Š</span>
                                        <strong style="color: #1976d2; font-size: 13px;">ì´ ë¶„ì„ì˜ ëª©ì </strong>
                                    </div>
                                    <p style="margin: 0; font-size: 12px; color: #424242; line-height: 1.6;">
                                        ì‹œê°„ì— ë”°ë¥¸ <strong style="color: #1565c0;">ê° ê¸°ê¸°ì˜ ì„±ê³¼ ë³€í™”</strong>ë¥¼ ì¶”ì í•˜ì—¬<br>
                                        ë””ë°”ì´ìŠ¤ë³„ ì „ëµì„ ìµœì í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
                                    </p>
                                </div>

                                <!-- ì‚¬ìš© ë°©ë²• ì¹´ë“œ -->
                                <div style="padding: 14px 16px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8f4 100%); border-radius: 8px; border-left: 4px solid #4caf50; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                                        <span style="font-size: 16px;">ğŸ’¡</span>
                                        <strong style="color: #388e3c; font-size: 13px;">ì‚¬ìš© ë°©ë²•</strong>
                                    </div>
                                    <div style="font-size: 12px; color: #424242; line-height: 1.6;">
                                        <div style="display: flex; align-items: start; gap: 8px; margin-bottom: 4px;">
                                            <span style="display: inline-flex; align-items: center; justify-content: center; width: 18px; height: 18px; background: #4caf50; color: white; border-radius: 50%; font-size: 10px; font-weight: 600; flex-shrink: 0;">1</span>
                                            <span>ë“œë¡­ë‹¤ìš´ì—ì„œ ê¸°ê¸° ì„ íƒ (ìµœëŒ€ 5ê°œ)</span>
                                        </div>
                                        <div style="display: flex; align-items: start; gap: 8px;">
                                            <span style="display: inline-flex; align-items: center; justify-content: center; width: 18px; height: 18px; background: #4caf50; color: white; border-radius: 50%; font-size: 10px; font-weight: 600; flex-shrink: 0;">2</span>
                                            <span>ì§‘ê³„ ë‹¨ìœ„ ë³€ê²½ ë° ì°¨íŠ¸ í™•ì¸</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card">
                                <!-- í•„í„° íƒ€ì… ì„ íƒ (ìƒë‹¨) -->
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid var(--grey-200); padding-bottom: 16px;">
                                    <div>
                                        <div class="card-title" style="margin-bottom: 4px;">ì‹œê°„ì— ë”°ë¥¸ ê¸°ê¸° ì„±ê³¼ ì¶”ì´</div>
                                        <p style="color: var(--grey-600); font-size: 13px; margin: 0;">
                                            ì‹œê°„ì— ë”°ë¥¸ ê° ê¸°ê¸°ì˜ ì„±ê³¼ ë³€í™”ë¥¼ ì¶”ì í•˜ì—¬ íŠ¸ë Œë“œë¥¼ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                                        </p>
                                    </div>
                                    <!-- ì§‘ê³„ ë‹¨ìœ„ ì„ íƒ ë²„íŠ¼ -->
                                    <div class="view-type-section" style="margin-bottom: 0;">
                                        <button class="view-btn device-type-period-btn active" data-period="daily">ì¼ë³„</button>
                                        <button class="view-btn device-type-period-btn" data-period="weekly">ì£¼ë³„</button>
                                        <button class="view-btn device-type-period-btn" data-period="monthly">ì›”ë³„</button>
                                    </div>
                                </div>

                                <!-- ì§€í‘œ ì„ íƒ ë° ê¸°ê°„ ì„ íƒ -->
                                <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 20px; margin-bottom: 20px;">
                                    <!-- ì§€í‘œ ì„ íƒ -->
                                    <div style="flex: 0 0 auto;">
                                        <div style="font-size: 13px; font-weight: 600; color: var(--grey-700); margin-bottom: 12px;">ğŸ“ˆ ì§€í‘œ ì„ íƒ</div>
                                        <select id="deviceTypeMetricDropdown" style="min-width: 200px; padding: 10px 12px; border: 1px solid var(--grey-300); border-radius: 6px; background: white; font-size: 13px; color: var(--grey-800); cursor: pointer; transition: all 0.2s;">
                                            <option value="roas">ROAS</option>
                                            <option value="cost">ë¹„ìš©</option>
                                            <option value="revenue">ì „í™˜ê°’</option>
                                            <option value="conversions">ì „í™˜ìˆ˜</option>
                                            <option value="impressions">ë…¸ì¶œìˆ˜</option>
                                            <option value="clicks">í´ë¦­ìˆ˜</option>
                                            <option value="cpm">CPM</option>
                                            <option value="cpc">CPC</option>
                                            <option value="cpa">CPA</option>
                                            <option value="ctr">CTR</option>
                                            <option value="cvr">ì „í™˜ìœ¨</option>
                                        </select>
                                    </div>

                                    <!-- ê¸°ê°„ ì„ íƒ -->
                                    <div style="flex: 0 0 auto; margin-left: auto;">
                                        <div style="font-size: 13px; font-weight: 600; color: var(--grey-700); margin-bottom: 12px;">ğŸ“… ê¸°ê°„ ì„ íƒ</div>
                                        <div style="display: flex; align-items: center; gap: 10px;">
                                            <input type="date" id="deviceTypeStartDate" style="padding: 10px 12px; border: 1px solid var(--grey-300); border-radius: 6px; background: white; font-size: 13px; color: var(--grey-800); cursor: pointer; transition: all 0.2s;">
                                            <span style="color: var(--grey-600); font-weight: 500;">~</span>
                                            <input type="date" id="deviceTypeEndDate" style="padding: 10px 12px; border: 1px solid var(--grey-300); border-radius: 6px; background: white; font-size: 13px; color: var(--grey-800); cursor: pointer; transition: all 0.2s;">
                                        </div>
                                    </div>
                                </div>

                                <!-- ë“œë¡­ë‹¤ìš´ í˜•íƒœ í•„í„° -->
                                <div style="margin-bottom: 20px; padding: 16px; background: var(--grey-50); border-radius: 8px; border: 1px solid var(--grey-200);">
                                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 14px;">
                                        <div style="font-size: 13px; font-weight: 600; color: var(--grey-700);">ğŸ“Š ë¶„ë¥˜ ê¸°ì¤€</div>
                                        <div style="font-size: 12px; color: #2e7d32; font-weight: 600;">
                                            ğŸ¯ <span id="filteredDeviceTypeCount">0</span>ê°œ ê¸°ê¸°
                                        </div>
                                    </div>

                                    <!-- ë“œë¡­ë‹¤ìš´ ë²„íŠ¼ë“¤ -->
                                    <div style="display: flex; gap: 12px; align-items: flex-start; flex-wrap: wrap;">
                                        <!-- ì±„ë„ë³„ ë“œë¡­ë‹¤ìš´ -->
                                        <div style="position: relative; min-width: 180px; flex: 1;">
                                            <button type="button" class="devicetype-filter-dropdown-btn" data-filter="channel" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; color: var(--grey-800); cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; text-align: left;">
                                                <span style="font-weight: 500;">ì±„ë„_ì „ì²´</span>
                                                <span style="display: flex; align-items: center; gap: 6px;">
                                                    <span class="devicetype-selected-count" style="font-size: 11px; color: var(--grey-500);"></span>
                                                    <span style="font-size: 10px;">â–¼</span>
                                                </span>
                                            </button>
                                            <div class="devicetype-filter-dropdown-list" data-filter="channel" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                                <div style="padding: 8px;">
                                                    <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px; z-index: 1;">
                                                        <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px; border-radius: 4px; transition: background 0.2s;">
                                                            <input type="checkbox" class="devicetype-filter-select-all" data-filter="channel" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                                                            ì „ì²´ ì„ íƒ
                                                        </label>
                                                    </div>
                                                    <div id="devicetypeFilterChannelList" class="devicetype-filter-checkbox-list"></div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- ì œí’ˆë³„ ë“œë¡­ë‹¤ìš´ -->
                                        <div style="position: relative; min-width: 180px; flex: 1;">
                                            <button type="button" class="devicetype-filter-dropdown-btn" data-filter="product" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; color: var(--grey-800); cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; text-align: left;">
                                                <span style="font-weight: 500;">ì œí’ˆ_ì „ì²´</span>
                                                <span style="display: flex; align-items: center; gap: 6px;">
                                                    <span class="devicetype-selected-count" style="font-size: 11px; color: var(--grey-500);"></span>
                                                    <span style="font-size: 10px;">â–¼</span>
                                                </span>
                                            </button>
                                            <div class="devicetype-filter-dropdown-list" data-filter="product" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                                <div style="padding: 8px;">
                                                    <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px; z-index: 1;">
                                                        <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px; border-radius: 4px; transition: background 0.2s;">
                                                            <input type="checkbox" class="devicetype-filter-select-all" data-filter="product" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                                                            ì „ì²´ ì„ íƒ
                                                        </label>
                                                    </div>
                                                    <div id="devicetypeFilterProductList" class="devicetype-filter-checkbox-list"></div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- ë¸Œëœë“œë³„ ë“œë¡­ë‹¤ìš´ -->
                                        <div style="position: relative; min-width: 180px; flex: 1;">
                                            <button type="button" class="devicetype-filter-dropdown-btn" data-filter="brand" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; color: var(--grey-800); cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; text-align: left;">
                                                <span style="font-weight: 500;">ë¸Œëœë“œ_ì „ì²´</span>
                                                <span style="display: flex; align-items: center; gap: 6px;">
                                                    <span class="devicetype-selected-count" style="font-size: 11px; color: var(--grey-500);"></span>
                                                    <span style="font-size: 10px;">â–¼</span>
                                                </span>
                                            </button>
                                            <div class="devicetype-filter-dropdown-list" data-filter="brand" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                                <div style="padding: 8px;">
                                                    <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px; z-index: 1;">
                                                        <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px; border-radius: 4px; transition: background 0.2s;">
                                                            <input type="checkbox" class="devicetype-filter-select-all" data-filter="brand" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                                                            ì „ì²´ ì„ íƒ
                                                        </label>
                                                    </div>
                                                    <div id="devicetypeFilterBrandList" class="devicetype-filter-checkbox-list"></div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- í”„ë¡œëª¨ì…˜ë³„ ë“œë¡­ë‹¤ìš´ -->
                                        <div style="position: relative; min-width: 180px; flex: 1;">
                                            <button type="button" class="devicetype-filter-dropdown-btn" data-filter="promotion" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; color: var(--grey-800); cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; text-align: left;">
                                                <span style="font-weight: 500;">í”„ë¡œëª¨ì…˜_ì „ì²´</span>
                                                <span style="display: flex; align-items: center; gap: 6px;">
                                                    <span class="devicetype-selected-count" style="font-size: 11px; color: var(--grey-500);"></span>
                                                    <span style="font-size: 10px;">â–¼</span>
                                                </span>
                                            </button>
                                            <div class="devicetype-filter-dropdown-list" data-filter="promotion" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                                <div style="padding: 8px;">
                                                    <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px; z-index: 1;">
                                                        <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px; border-radius: 4px; transition: background 0.2s;">
                                                            <input type="checkbox" class="devicetype-filter-select-all" data-filter="promotion" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                                                            ì „ì²´ ì„ íƒ
                                                        </label>
                                                    </div>
                                                    <div id="devicetypeFilterPromotionList" class="devicetype-filter-checkbox-list"></div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- ê´‘ê³ ì„¸íŠ¸ë³„ ë“œë¡­ë‹¤ìš´ -->
                                        <div style="position: relative; min-width: 180px; flex: 1;">
                                            <button type="button" class="devicetype-filter-dropdown-btn" data-filter="adset" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; color: var(--grey-800); cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; text-align: left;">
                                                <span style="font-weight: 500;">ê´‘ê³ ì„¸íŠ¸_ì „ì²´</span>
                                                <span style="display: flex; align-items: center; gap: 6px;">
                                                    <span class="devicetype-selected-count" style="font-size: 11px; color: var(--grey-500);"></span>
                                                    <span style="font-size: 10px;">â–¼</span>
                                                </span>
                                            </button>
                                            <div class="devicetype-filter-dropdown-list" data-filter="adset" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                                <div style="padding: 8px;">
                                                    <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px; z-index: 1;">
                                                        <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px; border-radius: 4px; transition: background 0.2s;">
                                                            <input type="checkbox" class="devicetype-filter-select-all" data-filter="adset" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                                                            ì „ì²´ ì„ íƒ
                                                        </label>
                                                    </div>
                                                    <div id="devicetypeFilterAdsetList" class="devicetype-filter-checkbox-list"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- íŠ¸ë Œë“œ ì°¨íŠ¸ -->
                                <div class="chart-container">
                                    <canvas id="deviceTypeTrendChart"></canvas>
                                </div>

                                <!-- íŠ¸ë Œë“œ ë¶„ì„ íŒ (ì°¨íŠ¸ í•˜ë‹¨) -->
                                <div style="margin-top: 20px; padding: 16px; background: linear-gradient(135deg, #e3f2fd 0%, #f1f8fc 100%); border-radius: 10px; border-left: 4px solid #2196f3;">
                                    <div style="font-size: 13px; font-weight: 600; color: #2196f3; margin-bottom: 8px;">
                                        ğŸ’¡ íŠ¸ë Œë“œ ë¶„ì„ íŒ
                                    </div>
                                    <div style="font-size: 13px; color: var(--grey-800); line-height: 1.6;">
                                        ìƒìŠ¹ ì¶”ì„¸ë¥¼ ë³´ì´ëŠ” ê¸°ê¸°ì— ì˜ˆì‚°ì„ ì§‘ì¤‘í•˜ê³ , í•˜ë½ ì¶”ì„¸ë¥¼ ë³´ì´ëŠ” ê¸°ê¸°ì˜ ë¬¸ì œì ì„ íŒŒì•…í•˜ì—¬ ê°œì„ í•˜ì„¸ìš”.
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- íƒ­ 7: ì„±ë³„ ì—°ë ¹ PIVOT -->
                        <div class="trend-analysis-tab-content" id="ageGenderPivotTab" style="display: none;">
                            <!-- ì»´íŒ©íŠ¸ ì„¤ëª… ì„¹ì…˜ -->
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                                <!-- ë¶„ì„ ëª©ì  ì¹´ë“œ -->
                                <div style="padding: 14px 16px; background: linear-gradient(135deg, #e3f2fd 0%, #f0f7ff 100%); border-radius: 8px; border-left: 4px solid #2196f3; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                                        <span style="font-size: 16px;">ğŸ“Š</span>
                                        <strong style="color: #1976d2; font-size: 13px;">ì´ ë¶„ì„ì˜ ëª©ì </strong>
                                    </div>
                                    <p style="margin: 0; font-size: 12px; color: #424242; line-height: 1.6;">
                                        ì„±ë³„ê³¼ ì—°ë ¹ëŒ€ë³„ <strong style="color: #1565c0;">êµì°¨ ë¶„ì„</strong>ì„ í†µí•´<br>
                                        ê°€ì¥ íš¨ê³¼ì ì¸ íƒ€ê²Ÿ ê·¸ë£¹ì„ íŒŒì•…í•©ë‹ˆë‹¤
                                    </p>
                                </div>

                                <!-- ì‚¬ìš© ë°©ë²• ì¹´ë“œ -->
                                <div style="padding: 14px 16px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8f4 100%); border-radius: 8px; border-left: 4px solid #4caf50; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                                        <span style="font-size: 16px;">ğŸ’¡</span>
                                        <strong style="color: #388e3c; font-size: 13px;">ì‚¬ìš© ë°©ë²•</strong>
                                    </div>
                                    <div style="font-size: 12px; color: #424242; line-height: 1.6;">
                                        <div style="display: flex; align-items: start; gap: 8px; margin-bottom: 4px;">
                                            <span style="display: inline-flex; align-items: center; justify-content: center; width: 18px; height: 18px; background: #4caf50; color: white; border-radius: 50%; font-size: 10px; font-weight: 600; flex-shrink: 0;">1</span>
                                            <span>ë¶„ë¥˜ ê¸°ì¤€ ë“œë¡­ë‹¤ìš´ì—ì„œ í•„í„° ì„ íƒ</span>
                                        </div>
                                        <div style="display: flex; align-items: start; gap: 8px;">
                                            <span style="display: inline-flex; align-items: center; justify-content: center; width: 18px; height: 18px; background: #4caf50; color: white; border-radius: 50%; font-size: 10px; font-weight: 600; flex-shrink: 0;">2</span>
                                            <span>ìƒ‰ìƒ ìŠ¤ì¼€ì¼ë¡œ ë†’ì€/ë‚®ì€ ê°’ í™•ì¸</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card">
                                <!-- ìƒë‹¨: ì œëª© -->
                                <div style="margin-bottom: 20px; border-bottom: 2px solid var(--grey-200); padding-bottom: 16px;">
                                    <div class="card-title" style="margin-bottom: 4px;">ì„±ë³„ Ã— ì—°ë ¹ëŒ€ ì„±ê³¼ ë¶„ì„</div>
                                    <p style="color: var(--grey-600); font-size: 13px; margin: 0;">
                                        ì„±ë³„ê³¼ ì—°ë ¹ëŒ€ì˜ êµì°¨ ë¶„ì„ìœ¼ë¡œ ìµœì ì˜ íƒ€ê²Ÿì„ ë°œê²¬í•˜ì„¸ìš”. ëª¨ë“  ì£¼ìš” ì§€í‘œ(ë¹„ìš©, CPM, CPC, CPA, ROAS)ë¥¼ í•œëˆˆì— ë¹„êµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                                    </p>
                                </div>

                                <!-- ê¸°ê°„ ì„ íƒ -->
                                <div style="display: flex; justify-content: flex-end; align-items: flex-start; gap: 20px; margin-bottom: 20px;">
                                    <div style="flex: 0 0 auto; margin-left: auto;">
                                        <div style="font-size: 13px; font-weight: 600; color: var(--grey-700); margin-bottom: 12px;">ğŸ“… ê¸°ê°„ ì„ íƒ</div>
                                        <div style="display: flex; align-items: center; gap: 10px;">
                                            <input type="date" id="pivotStartDate" style="padding: 10px 12px; border: 1px solid var(--grey-300); border-radius: 6px; background: white; font-size: 13px; color: var(--grey-800); cursor: pointer; transition: all 0.2s;">
                                            <span style="color: var(--grey-600); font-weight: 500;">~</span>
                                            <input type="date" id="pivotEndDate" style="padding: 10px 12px; border: 1px solid var(--grey-300); border-radius: 6px; background: white; font-size: 13px; color: var(--grey-800); cursor: pointer; transition: all 0.2s;">
                                        </div>
                                    </div>
                                </div>

                                <!-- ë“œë¡­ë‹¤ìš´ í˜•íƒœ í•„í„° -->
                                <div style="margin-bottom: 20px; padding: 16px; background: var(--grey-50); border-radius: 8px; border: 1px solid var(--grey-200);">
                                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 14px;">
                                        <div style="font-size: 13px; font-weight: 600; color: var(--grey-700);">ğŸ“Š ë¶„ë¥˜ ê¸°ì¤€</div>
                                    </div>

                                    <!-- ë“œë¡­ë‹¤ìš´ ë²„íŠ¼ë“¤ -->
                                    <div style="display: flex; gap: 12px; align-items: flex-start; flex-wrap: wrap;">
                                        <!-- ì±„ë„ë³„ ë“œë¡­ë‹¤ìš´ -->
                                        <div style="position: relative; min-width: 180px; flex: 1;">
                                            <button type="button" class="pivot-filter-dropdown-btn" data-filter="channel" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; color: var(--grey-800); cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; text-align: left;">
                                                <span style="font-weight: 500;">ì±„ë„_ì „ì²´</span>
                                                <div style="display: flex; align-items: center; gap: 6px;">
                                                    <span class="pivot-selected-count" style="font-size: 11px; background: var(--grey-200); padding: 2px 8px; border-radius: 10px; color: var(--grey-600);">0ê°œ</span>
                                                    <span style="color: var(--grey-400); font-size: 10px;">â–¼</span>
                                                </div>
                                            </button>
                                            <div class="pivot-filter-dropdown-list" data-filter="channel" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 1000; max-height: 250px; overflow-y: auto; margin-top: 4px;">
                                                <div style="padding: 8px 10px; border-bottom: 1px solid var(--grey-200); background: var(--grey-50);">
                                                    <label style="display: flex; align-items: center; cursor: pointer; font-size: 12px; font-weight: 600; color: var(--grey-700);">
                                                        <input type="checkbox" class="pivot-filter-select-all" data-filter="channel" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                                                        ì „ì²´ ì„ íƒ
                                                    </label>
                                                </div>
                                                <div id="pivotFilterChannelList" class="pivot-filter-checkbox-list"></div>
                                            </div>
                                        </div>

                                        <!-- ì œí’ˆë³„ ë“œë¡­ë‹¤ìš´ -->
                                        <div style="position: relative; min-width: 180px; flex: 1;">
                                            <button type="button" class="pivot-filter-dropdown-btn" data-filter="product" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; color: var(--grey-800); cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; text-align: left;">
                                                <span style="font-weight: 500;">ì œí’ˆ_ì „ì²´</span>
                                                <div style="display: flex; align-items: center; gap: 6px;">
                                                    <span class="pivot-selected-count" style="font-size: 11px; background: var(--grey-200); padding: 2px 8px; border-radius: 10px; color: var(--grey-600);">0ê°œ</span>
                                                    <span style="color: var(--grey-400); font-size: 10px;">â–¼</span>
                                                </div>
                                            </button>
                                            <div class="pivot-filter-dropdown-list" data-filter="product" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 1000; max-height: 250px; overflow-y: auto; margin-top: 4px;">
                                                <div style="padding: 8px 10px; border-bottom: 1px solid var(--grey-200); background: var(--grey-50);">
                                                    <label style="display: flex; align-items: center; cursor: pointer; font-size: 12px; font-weight: 600; color: var(--grey-700);">
                                                        <input type="checkbox" class="pivot-filter-select-all" data-filter="product" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                                                        ì „ì²´ ì„ íƒ
                                                    </label>
                                                </div>
                                                <div id="pivotFilterProductList" class="pivot-filter-checkbox-list"></div>
                                            </div>
                                        </div>

                                        <!-- ë¸Œëœë“œë³„ ë“œë¡­ë‹¤ìš´ -->
                                        <div style="position: relative; min-width: 180px; flex: 1;">
                                            <button type="button" class="pivot-filter-dropdown-btn" data-filter="brand" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; color: var(--grey-800); cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; text-align: left;">
                                                <span style="font-weight: 500;">ë¸Œëœë“œ_ì „ì²´</span>
                                                <div style="display: flex; align-items: center; gap: 6px;">
                                                    <span class="pivot-selected-count" style="font-size: 11px; background: var(--grey-200); padding: 2px 8px; border-radius: 10px; color: var(--grey-600);">0ê°œ</span>
                                                    <span style="color: var(--grey-400); font-size: 10px;">â–¼</span>
                                                </div>
                                            </button>
                                            <div class="pivot-filter-dropdown-list" data-filter="brand" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 1000; max-height: 250px; overflow-y: auto; margin-top: 4px;">
                                                <div style="padding: 8px 10px; border-bottom: 1px solid var(--grey-200); background: var(--grey-50);">
                                                    <label style="display: flex; align-items: center; cursor: pointer; font-size: 12px; font-weight: 600; color: var(--grey-700);">
                                                        <input type="checkbox" class="pivot-filter-select-all" data-filter="brand" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                                                        ì „ì²´ ì„ íƒ
                                                    </label>
                                                </div>
                                                <div id="pivotFilterBrandList" class="pivot-filter-checkbox-list"></div>
                                            </div>
                                        </div>

                                        <!-- í”„ë¡œëª¨ì…˜ë³„ ë“œë¡­ë‹¤ìš´ -->
                                        <div style="position: relative; min-width: 180px; flex: 1;">
                                            <button type="button" class="pivot-filter-dropdown-btn" data-filter="promotion" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; color: var(--grey-800); cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; text-align: left;">
                                                <span style="font-weight: 500;">í”„ë¡œëª¨ì…˜_ì „ì²´</span>
                                                <div style="display: flex; align-items: center; gap: 6px;">
                                                    <span class="pivot-selected-count" style="font-size: 11px; background: var(--grey-200); padding: 2px 8px; border-radius: 10px; color: var(--grey-600);">0ê°œ</span>
                                                    <span style="color: var(--grey-400); font-size: 10px;">â–¼</span>
                                                </div>
                                            </button>
                                            <div class="pivot-filter-dropdown-list" data-filter="promotion" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 1000; max-height: 250px; overflow-y: auto; margin-top: 4px;">
                                                <div style="padding: 8px 10px; border-bottom: 1px solid var(--grey-200); background: var(--grey-50);">
                                                    <label style="display: flex; align-items: center; cursor: pointer; font-size: 12px; font-weight: 600; color: var(--grey-700);">
                                                        <input type="checkbox" class="pivot-filter-select-all" data-filter="promotion" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                                                        ì „ì²´ ì„ íƒ
                                                    </label>
                                                </div>
                                                <div id="pivotFilterPromotionList" class="pivot-filter-checkbox-list"></div>
                                            </div>
                                        </div>

                                        <!-- ê´‘ê³ ì„¸íŠ¸ë³„ ë“œë¡­ë‹¤ìš´ -->
                                        <div style="position: relative; min-width: 180px; flex: 1;">
                                            <button type="button" class="pivot-filter-dropdown-btn" data-filter="adset" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; color: var(--grey-800); cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; text-align: left;">
                                                <span style="font-weight: 500;">ê´‘ê³ ì„¸íŠ¸_ì „ì²´</span>
                                                <div style="display: flex; align-items: center; gap: 6px;">
                                                    <span class="pivot-selected-count" style="font-size: 11px; background: var(--grey-200); padding: 2px 8px; border-radius: 10px; color: var(--grey-600);">0ê°œ</span>
                                                    <span style="color: var(--grey-400); font-size: 10px;">â–¼</span>
                                                </div>
                                            </button>
                                            <div class="pivot-filter-dropdown-list" data-filter="adset" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 1000; max-height: 250px; overflow-y: auto; margin-top: 4px;">
                                                <div style="padding: 8px 10px; border-bottom: 1px solid var(--grey-200); background: var(--grey-50);">
                                                    <label style="display: flex; align-items: center; cursor: pointer; font-size: 12px; font-weight: 600; color: var(--grey-700);">
                                                        <input type="checkbox" class="pivot-filter-select-all" data-filter="adset" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                                                        ì „ì²´ ì„ íƒ
                                                    </label>
                                                </div>
                                                <div id="pivotFilterAdsetList" class="pivot-filter-checkbox-list"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- PIVOT í…Œì´ë¸” -->
                                <div style="margin-bottom: 20px;">
                                    <div id="ageGenderPivotTableContainer" style="overflow-x: auto; overflow-y: visible;">
                                        <p style="text-align: center; color: var(--grey-500); padding: 40px;">
                                            ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ì„±ê³¼ ìƒì„¸ ë¶„ì„ (í†µí•© íƒ­) - ë…ë¦½ì  ì„¹ì…˜ -->
            <div class="collapsible-section">
                <div class="collapsible-header">
                    <div class="collapsible-title">
                        <span class="collapsible-icon">ğŸ“Š</span>
                        <span>ì„±ê³¼ ìƒì„¸ ë¶„ì„ - ì°¨ì›ë³„ ì„±ê³¼ë¥¼ ë¹„êµí•˜ì„¸ìš”</span>
                    </div>
                    <button class="collapsible-toggle">
                        <span>í¼ì¹˜ê¸°</span>
                        <span class="collapsible-toggle-icon collapsed">â–¼</span>
                    </button>
                </div>
                <div class="collapsible-content">
                    <!-- íƒ­ ë²„íŠ¼ -->
                    <div class="view-type-section" style="margin-bottom: 24px;">
                        <button class="view-btn detail-analysis-tab-btn active" data-tab="detail-adset">ê´‘ê³ ì„¸íŠ¸</button>
                        <button class="view-btn detail-analysis-tab-btn" data-tab="detail-gender">ì„±ë³„</button>
                        <button class="view-btn detail-analysis-tab-btn" data-tab="detail-age">ì—°ë ¹</button>
                        <button class="view-btn detail-analysis-tab-btn" data-tab="detail-platform">í”Œë«í¼</button>
                        <button class="view-btn detail-analysis-tab-btn" data-tab="detail-device-platform">ê¸°ê¸°í”Œë«í¼</button>
                        <button class="view-btn detail-analysis-tab-btn" data-tab="detail-device-type">ê¸°ê¸°</button>
                    </div>

                    <!-- íƒ­ 1: ê´‘ê³ ì„¸íŠ¸ -->
                    <div class="detail-analysis-tab-content active" id="detailAdsetTab">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                            <div style="padding: 14px 16px; background: linear-gradient(135deg, #e3f2fd 0%, #f0f7ff 100%); border-radius: 8px; border-left: 4px solid #2196f3; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                                    <span style="font-size: 16px;">ğŸ“Š</span>
                                    <strong style="color: #1976d2; font-size: 13px;">ì´ ë¶„ì„ì˜ ëª©ì </strong>
                                </div>
                                <p style="margin: 0; font-size: 12px; color: #424242; line-height: 1.6;">
                                    <strong style="color: #1565c0;">ê´‘ê³ ì„¸íŠ¸ë³„ ì„±ê³¼</strong>ë¥¼ ë¹„êµí•˜ì—¬<br>
                                    ìµœì ì˜ ê´‘ê³ ì„¸íŠ¸ë¥¼ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
                                </p>
                            </div>
                            <div style="padding: 14px 16px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8f4 100%); border-radius: 8px; border-left: 4px solid #4caf50; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                                    <span style="font-size: 16px;">ğŸ’¡</span>
                                    <strong style="color: #388e3c; font-size: 13px;">ì‚¬ìš© ë°©ë²•</strong>
                                </div>
                                <div style="font-size: 12px; color: #424242; line-height: 1.6;">
                                    <div style="display: flex; align-items: start; gap: 8px; margin-bottom: 4px;">
                                        <span style="display: inline-flex; align-items: center; justify-content: center; width: 18px; height: 18px; background: #4caf50; color: white; border-radius: 50%; font-size: 10px; font-weight: 600; flex-shrink: 0;">1</span>
                                        <span>ë“œë¡­ë‹¤ìš´ì—ì„œ í•„í„° ì„ íƒ</span>
                                    </div>
                                    <div style="display: flex; align-items: start; gap: 8px;">
                                        <span style="display: inline-flex; align-items: center; justify-content: center; width: 18px; height: 18px; background: #4caf50; color: white; border-radius: 50%; font-size: 10px; font-weight: 600; flex-shrink: 0;">2</span>
                                        <span>ë§‰ëŒ€ ì°¨íŠ¸ë¡œ ì„±ê³¼ ë¹„êµ</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid var(--grey-200); padding-bottom: 16px;">
                                <div>
                                    <div class="card-title" style="margin-bottom: 4px;">ê´‘ê³ ì„¸íŠ¸ë³„ ì„±ê³¼ ë¹„êµ</div>
                                    <p style="color: var(--grey-600); font-size: 13px; margin: 0;">
                                        ê° ê´‘ê³ ì„¸íŠ¸ì˜ ì„±ê³¼ë¥¼ ë¹„êµí•˜ì—¬ ìµœì ì˜ ì„¸íŠ¸ë¥¼ íŒŒì•…í•˜ì„¸ìš”.
                                    </p>
                                </div>
                            </div>

                            <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 20px; margin-bottom: 20px;">
                                <div style="flex: 0 0 auto;">
                                    <div style="font-size: 13px; font-weight: 600; color: var(--grey-700); margin-bottom: 12px;">ğŸ“ˆ ì§€í‘œ ì„ íƒ</div>
                                    <select id="detailAdsetMetricDropdown" style="min-width: 200px; padding: 10px 12px; border: 1px solid var(--grey-300); border-radius: 6px; background: white; font-size: 13px; color: var(--grey-800); cursor: pointer; transition: all 0.2s;">
                                        <option value="roas">ROAS</option>
                                        <option value="cost">ë¹„ìš©</option>
                                        <option value="revenue">ì „í™˜ê°’</option>
                                        <option value="conversions">ì „í™˜ìˆ˜</option>
                                        <option value="impressions">ë…¸ì¶œìˆ˜</option>
                                        <option value="clicks">í´ë¦­ìˆ˜</option>
                                        <option value="cpm">CPM</option>
                                        <option value="cpc">CPC</option>
                                        <option value="cpa">CPA</option>
                                        <option value="ctr">CTR</option>
                                        <option value="cvr">ì „í™˜ìœ¨</option>
                                    </select>
                                </div>
                                <div style="flex: 0 0 auto; margin-left: auto;">
                                    <div style="font-size: 13px; font-weight: 600; color: var(--grey-700); margin-bottom: 12px;">ğŸ“… ê¸°ê°„ ì„ íƒ</div>
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <input type="date" id="detailAdsetStartDate" style="padding: 10px 12px; border: 1px solid var(--grey-300); border-radius: 6px; background: white; font-size: 13px; color: var(--grey-800); cursor: pointer;">
                                        <span style="color: var(--grey-600); font-weight: 500;">~</span>
                                        <input type="date" id="detailAdsetEndDate" style="padding: 10px 12px; border: 1px solid var(--grey-300); border-radius: 6px; background: white; font-size: 13px; color: var(--grey-800); cursor: pointer;">
                                    </div>
                                </div>
                            </div>

                            <div style="margin-bottom: 20px; padding: 16px; background: var(--grey-50); border-radius: 8px; border: 1px solid var(--grey-200);">
                                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 14px;">
                                    <div style="font-size: 13px; font-weight: 600; color: var(--grey-700);">ğŸ“Š ë¶„ë¥˜ ê¸°ì¤€</div>
                                    <div style="font-size: 12px; color: #2e7d32; font-weight: 600;">
                                        ğŸ¯ <span id="detailFilteredAdsetCount">0</span>ê°œ ê´‘ê³ ì„¸íŠ¸
                                    </div>
                                </div>
                                <div style="display: flex; gap: 12px; align-items: flex-start; flex-wrap: wrap;">
                                    <div style="position: relative; min-width: 180px; flex: 1;">
                                        <button type="button" class="detail-filter-dropdown-btn" data-filter="channel" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; color: var(--grey-800); cursor: pointer; display: flex; justify-content: space-between; align-items: center; text-align: left;">
                                            <span style="font-weight: 500;">ì±„ë„_ì „ì²´</span>
                                            <span style="font-size: 10px;">â–¼</span>
                                        </button>
                                        <div class="detail-filter-dropdown-list" data-filter="channel" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                            <div style="padding: 8px;">
                                                <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px;">
                                                    <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px;">
                                                        <input type="checkbox" class="detail-filter-select-all" data-filter="channel" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                                                        ì „ì²´ ì„ íƒ
                                                    </label>
                                                </div>
                                                <div id="detailFilterChannelList" class="detail-filter-checkbox-list"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="position: relative; min-width: 180px; flex: 1;">
                                        <button type="button" class="detail-filter-dropdown-btn" data-filter="product" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; color: var(--grey-800); cursor: pointer; display: flex; justify-content: space-between; align-items: center; text-align: left;">
                                            <span style="font-weight: 500;">ì œí’ˆ_ì „ì²´</span>
                                            <span style="font-size: 10px;">â–¼</span>
                                        </button>
                                        <div class="detail-filter-dropdown-list" data-filter="product" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                            <div style="padding: 8px;">
                                                <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px;">
                                                    <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px;">
                                                        <input type="checkbox" class="detail-filter-select-all" data-filter="product" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                                                        ì „ì²´ ì„ íƒ
                                                    </label>
                                                </div>
                                                <div id="detailFilterProductList" class="detail-filter-checkbox-list"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="position: relative; min-width: 180px; flex: 1;">
                                        <button type="button" class="detail-filter-dropdown-btn" data-filter="brand" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; color: var(--grey-800); cursor: pointer; display: flex; justify-content: space-between; align-items: center; text-align: left;">
                                            <span style="font-weight: 500;">ë¸Œëœë“œ_ì „ì²´</span>
                                            <span style="font-size: 10px;">â–¼</span>
                                        </button>
                                        <div class="detail-filter-dropdown-list" data-filter="brand" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                            <div style="padding: 8px;">
                                                <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px;">
                                                    <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px;">
                                                        <input type="checkbox" class="detail-filter-select-all" data-filter="brand" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                                                        ì „ì²´ ì„ íƒ
                                                    </label>
                                                </div>
                                                <div id="detailFilterBrandList" class="detail-filter-checkbox-list"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="position: relative; min-width: 180px; flex: 1;">
                                        <button type="button" class="detail-filter-dropdown-btn" data-filter="promotion" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; color: var(--grey-800); cursor: pointer; display: flex; justify-content: space-between; align-items: center; text-align: left;">
                                            <span style="font-weight: 500;">í”„ë¡œëª¨ì…˜_ì „ì²´</span>
                                            <span style="font-size: 10px;">â–¼</span>
                                        </button>
                                        <div class="detail-filter-dropdown-list" data-filter="promotion" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                            <div style="padding: 8px;">
                                                <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px;">
                                                    <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px;">
                                                        <input type="checkbox" class="detail-filter-select-all" data-filter="promotion" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                                                        ì „ì²´ ì„ íƒ
                                                    </label>
                                                </div>
                                                <div id="detailFilterPromotionList" class="detail-filter-checkbox-list"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="chart-container" style="height: 400px;">
                                <canvas id="detailAdsetBarChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- íƒ­ 2: ì„±ë³„ -->
                    <div class="detail-analysis-tab-content" id="detailGenderTab" style="display: none;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                            <div style="padding: 14px 16px; background: linear-gradient(135deg, #e3f2fd 0%, #f0f7ff 100%); border-radius: 8px; border-left: 4px solid #2196f3;">
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                                    <span style="font-size: 16px;">ğŸ“Š</span>
                                    <strong style="color: #1976d2; font-size: 13px;">ì´ ë¶„ì„ì˜ ëª©ì </strong>
                                </div>
                                <p style="margin: 0; font-size: 12px; color: #424242; line-height: 1.6;">
                                    <strong style="color: #1565c0;">ì„±ë³„ ì„±ê³¼</strong>ë¥¼ ë¹„êµí•˜ì—¬ íƒ€ê²ŸíŒ…ì„ ìµœì í™”í•©ë‹ˆë‹¤
                                </p>
                            </div>
                            <div style="padding: 14px 16px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8f4 100%); border-radius: 8px; border-left: 4px solid #4caf50;">
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                                    <span style="font-size: 16px;">ğŸ’¡</span>
                                    <strong style="color: #388e3c; font-size: 13px;">ì‚¬ìš© ë°©ë²•</strong>
                                </div>
                                <div style="font-size: 12px; color: #424242;">ì§€í‘œì™€ í•„í„°ë¥¼ ì„ íƒí•˜ì—¬ ì„±ë³„ ì„±ê³¼ë¥¼ ë¹„êµí•˜ì„¸ìš”</div>
                            </div>
                        </div>
                        <div class="card">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid var(--grey-200); padding-bottom: 16px;">
                                <div>
                                    <div class="card-title" style="margin-bottom: 4px;">ì„±ë³„ ì„±ê³¼ ë¹„êµ</div>
                                    <p style="color: var(--grey-600); font-size: 13px; margin: 0;">ê° ì„±ë³„ì˜ ì„±ê³¼ë¥¼ ë¹„êµí•©ë‹ˆë‹¤.</p>
                                </div>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 20px; margin-bottom: 20px;">
                                <div style="flex: 0 0 auto;">
                                    <div style="font-size: 13px; font-weight: 600; color: var(--grey-700); margin-bottom: 12px;">ğŸ“ˆ ì§€í‘œ ì„ íƒ</div>
                                    <select id="detailGenderMetricDropdown" style="min-width: 200px; padding: 10px 12px; border: 1px solid var(--grey-300); border-radius: 6px; background: white; font-size: 13px;">
                                        <option value="roas">ROAS</option>
                                        <option value="cost">ë¹„ìš©</option>
                                        <option value="revenue">ì „í™˜ê°’</option>
                                        <option value="conversions">ì „í™˜ìˆ˜</option>
                                        <option value="impressions">ë…¸ì¶œìˆ˜</option>
                                        <option value="clicks">í´ë¦­ìˆ˜</option>
                                        <option value="cpm">CPM</option>
                                        <option value="cpc">CPC</option>
                                        <option value="cpa">CPA</option>
                                        <option value="ctr">CTR</option>
                                        <option value="cvr">ì „í™˜ìœ¨</option>
                                    </select>
                                </div>
                                <div style="flex: 0 0 auto; margin-left: auto;">
                                    <div style="font-size: 13px; font-weight: 600; color: var(--grey-700); margin-bottom: 12px;">ğŸ“… ê¸°ê°„ ì„ íƒ</div>
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <input type="date" id="detailGenderStartDate" style="padding: 10px 12px; border: 1px solid var(--grey-300); border-radius: 6px; background: white; font-size: 13px;">
                                        <span style="color: var(--grey-600); font-weight: 500;">~</span>
                                        <input type="date" id="detailGenderEndDate" style="padding: 10px 12px; border: 1px solid var(--grey-300); border-radius: 6px; background: white; font-size: 13px;">
                                    </div>
                                </div>
                            </div>
                            <div style="margin-bottom: 20px; padding: 16px; background: var(--grey-50); border-radius: 8px; border: 1px solid var(--grey-200);">
                                <div style="font-size: 13px; font-weight: 600; color: var(--grey-700); margin-bottom: 14px;">ğŸ“Š ë¶„ë¥˜ ê¸°ì¤€</div>
                                <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                                    <div style="position: relative; min-width: 180px; flex: 1;">
                                        <button type="button" class="detail-gender-filter-dropdown-btn" data-filter="channel" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; text-align: left;">
                                            <span style="font-weight: 500;">ì±„ë„_ì „ì²´</span>
                                            <span style="font-size: 10px;">â–¼</span>
                                        </button>
                                        <div class="detail-gender-filter-dropdown-list" data-filter="channel" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                            <div style="padding: 8px;">
                                                <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px;">
                                                    <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px;">
                                                        <input type="checkbox" class="detail-gender-filter-select-all" data-filter="channel" style="margin-right: 10px; width: 16px; height: 16px;">
                                                        ì „ì²´ ì„ íƒ
                                                    </label>
                                                </div>
                                                <div id="detailGenderFilterChannelList" class="detail-gender-filter-checkbox-list"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="position: relative; min-width: 180px; flex: 1;">
                                        <button type="button" class="detail-gender-filter-dropdown-btn" data-filter="product" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; text-align: left;">
                                            <span style="font-weight: 500;">ì œí’ˆ_ì „ì²´</span>
                                            <span style="font-size: 10px;">â–¼</span>
                                        </button>
                                        <div class="detail-gender-filter-dropdown-list" data-filter="product" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                            <div style="padding: 8px;">
                                                <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px;">
                                                    <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px;">
                                                        <input type="checkbox" class="detail-gender-filter-select-all" data-filter="product" style="margin-right: 10px; width: 16px; height: 16px;">
                                                        ì „ì²´ ì„ íƒ
                                                    </label>
                                                </div>
                                                <div id="detailGenderFilterProductList" class="detail-gender-filter-checkbox-list"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="position: relative; min-width: 180px; flex: 1;">
                                        <button type="button" class="detail-gender-filter-dropdown-btn" data-filter="brand" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; text-align: left;">
                                            <span style="font-weight: 500;">ë¸Œëœë“œ_ì „ì²´</span>
                                            <span style="font-size: 10px;">â–¼</span>
                                        </button>
                                        <div class="detail-gender-filter-dropdown-list" data-filter="brand" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                            <div style="padding: 8px;">
                                                <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px;">
                                                    <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px;">
                                                        <input type="checkbox" class="detail-gender-filter-select-all" data-filter="brand" style="margin-right: 10px; width: 16px; height: 16px;">
                                                        ì „ì²´ ì„ íƒ
                                                    </label>
                                                </div>
                                                <div id="detailGenderFilterBrandList" class="detail-gender-filter-checkbox-list"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="position: relative; min-width: 180px; flex: 1;">
                                        <button type="button" class="detail-gender-filter-dropdown-btn" data-filter="promotion" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; text-align: left;">
                                            <span style="font-weight: 500;">í”„ë¡œëª¨ì…˜_ì „ì²´</span>
                                            <span style="font-size: 10px;">â–¼</span>
                                        </button>
                                        <div class="detail-gender-filter-dropdown-list" data-filter="promotion" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                            <div style="padding: 8px;">
                                                <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px;">
                                                    <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px;">
                                                        <input type="checkbox" class="detail-gender-filter-select-all" data-filter="promotion" style="margin-right: 10px; width: 16px; height: 16px;">
                                                        ì „ì²´ ì„ íƒ
                                                    </label>
                                                </div>
                                                <div id="detailGenderFilterPromotionList" class="detail-gender-filter-checkbox-list"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="position: relative; min-width: 180px; flex: 1;">
                                        <button type="button" class="detail-gender-filter-dropdown-btn" data-filter="adset" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; text-align: left;">
                                            <span style="font-weight: 500;">ê´‘ê³ ì„¸íŠ¸_ì „ì²´</span>
                                            <span style="font-size: 10px;">â–¼</span>
                                        </button>
                                        <div class="detail-gender-filter-dropdown-list" data-filter="adset" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                            <div style="padding: 8px;">
                                                <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px;">
                                                    <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px;">
                                                        <input type="checkbox" class="detail-gender-filter-select-all" data-filter="adset" style="margin-right: 10px; width: 16px; height: 16px;">
                                                        ì „ì²´ ì„ íƒ
                                                    </label>
                                                </div>
                                                <div id="detailGenderFilterAdsetList" class="detail-gender-filter-checkbox-list"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="chart-container" style="height: 300px;">
                                <canvas id="detailGenderBarChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- íƒ­ 3: ì—°ë ¹ -->
                    <div class="detail-analysis-tab-content" id="detailAgeTab" style="display: none;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                            <div style="padding: 14px 16px; background: linear-gradient(135deg, #e3f2fd 0%, #f0f7ff 100%); border-radius: 8px; border-left: 4px solid #2196f3;">
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                                    <span style="font-size: 16px;">ğŸ“Š</span>
                                    <strong style="color: #1976d2; font-size: 13px;">ì´ ë¶„ì„ì˜ ëª©ì </strong>
                                </div>
                                <p style="margin: 0; font-size: 12px; color: #424242; line-height: 1.6;">
                                    <strong style="color: #1565c0;">ì—°ë ¹ëŒ€ë³„ ì„±ê³¼</strong>ë¥¼ ë¹„êµí•˜ì—¬ íƒ€ê²ŸíŒ…ì„ ìµœì í™”í•©ë‹ˆë‹¤
                                </p>
                            </div>
                            <div style="padding: 14px 16px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8f4 100%); border-radius: 8px; border-left: 4px solid #4caf50;">
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                                    <span style="font-size: 16px;">ğŸ’¡</span>
                                    <strong style="color: #388e3c; font-size: 13px;">ì‚¬ìš© ë°©ë²•</strong>
                                </div>
                                <div style="font-size: 12px; color: #424242;">ì§€í‘œì™€ í•„í„°ë¥¼ ì„ íƒí•˜ì—¬ ì—°ë ¹ëŒ€ ì„±ê³¼ë¥¼ ë¹„êµí•˜ì„¸ìš”</div>
                            </div>
                        </div>
                        <div class="card">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid var(--grey-200); padding-bottom: 16px;">
                                <div>
                                    <div class="card-title" style="margin-bottom: 4px;">ì—°ë ¹ëŒ€ë³„ ì„±ê³¼ ë¹„êµ</div>
                                    <p style="color: var(--grey-600); font-size: 13px; margin: 0;">ê° ì—°ë ¹ëŒ€ì˜ ì„±ê³¼ë¥¼ ë¹„êµí•©ë‹ˆë‹¤.</p>
                                </div>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 20px; margin-bottom: 20px;">
                                <div style="flex: 0 0 auto;">
                                    <div style="font-size: 13px; font-weight: 600; color: var(--grey-700); margin-bottom: 12px;">ğŸ“ˆ ì§€í‘œ ì„ íƒ</div>
                                    <select id="detailAgeMetricDropdown" style="min-width: 200px; padding: 10px 12px; border: 1px solid var(--grey-300); border-radius: 6px; background: white; font-size: 13px;">
                                        <option value="roas">ROAS</option>
                                        <option value="cost">ë¹„ìš©</option>
                                        <option value="revenue">ì „í™˜ê°’</option>
                                        <option value="conversions">ì „í™˜ìˆ˜</option>
                                        <option value="impressions">ë…¸ì¶œìˆ˜</option>
                                        <option value="clicks">í´ë¦­ìˆ˜</option>
                                        <option value="cpm">CPM</option>
                                        <option value="cpc">CPC</option>
                                        <option value="cpa">CPA</option>
                                        <option value="ctr">CTR</option>
                                        <option value="cvr">ì „í™˜ìœ¨</option>
                                    </select>
                                </div>
                                <div style="flex: 0 0 auto; margin-left: auto;">
                                    <div style="font-size: 13px; font-weight: 600; color: var(--grey-700); margin-bottom: 12px;">ğŸ“… ê¸°ê°„ ì„ íƒ</div>
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <input type="date" id="detailAgeStartDate" style="padding: 10px 12px; border: 1px solid var(--grey-300); border-radius: 6px; background: white; font-size: 13px;">
                                        <span style="color: var(--grey-600); font-weight: 500;">~</span>
                                        <input type="date" id="detailAgeEndDate" style="padding: 10px 12px; border: 1px solid var(--grey-300); border-radius: 6px; background: white; font-size: 13px;">
                                    </div>
                                </div>
                            </div>
                            <div style="margin-bottom: 20px; padding: 16px; background: var(--grey-50); border-radius: 8px; border: 1px solid var(--grey-200);">
                                <div style="font-size: 13px; font-weight: 600; color: var(--grey-700); margin-bottom: 14px;">ğŸ“Š ë¶„ë¥˜ ê¸°ì¤€</div>
                                <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                                    <div style="position: relative; min-width: 180px; flex: 1;">
                                        <button type="button" class="detail-age-filter-dropdown-btn" data-filter="channel" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; text-align: left;">
                                            <span style="font-weight: 500;">ì±„ë„_ì „ì²´</span>
                                            <span style="font-size: 10px;">â–¼</span>
                                        </button>
                                        <div class="detail-age-filter-dropdown-list" data-filter="channel" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                            <div style="padding: 8px;">
                                                <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px;">
                                                    <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px;">
                                                        <input type="checkbox" class="detail-age-filter-select-all" data-filter="channel" style="margin-right: 10px; width: 16px; height: 16px;">
                                                        ì „ì²´ ì„ íƒ
                                                    </label>
                                                </div>
                                                <div id="detailAgeFilterChannelList" class="detail-age-filter-checkbox-list"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="position: relative; min-width: 180px; flex: 1;">
                                        <button type="button" class="detail-age-filter-dropdown-btn" data-filter="product" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; text-align: left;">
                                            <span style="font-weight: 500;">ì œí’ˆ_ì „ì²´</span>
                                            <span style="font-size: 10px;">â–¼</span>
                                        </button>
                                        <div class="detail-age-filter-dropdown-list" data-filter="product" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                            <div style="padding: 8px;">
                                                <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px;">
                                                    <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px;">
                                                        <input type="checkbox" class="detail-age-filter-select-all" data-filter="product" style="margin-right: 10px; width: 16px; height: 16px;">
                                                        ì „ì²´ ì„ íƒ
                                                    </label>
                                                </div>
                                                <div id="detailAgeFilterProductList" class="detail-age-filter-checkbox-list"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="position: relative; min-width: 180px; flex: 1;">
                                        <button type="button" class="detail-age-filter-dropdown-btn" data-filter="brand" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; text-align: left;">
                                            <span style="font-weight: 500;">ë¸Œëœë“œ_ì „ì²´</span>
                                            <span style="font-size: 10px;">â–¼</span>
                                        </button>
                                        <div class="detail-age-filter-dropdown-list" data-filter="brand" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                            <div style="padding: 8px;">
                                                <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px;">
                                                    <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px;">
                                                        <input type="checkbox" class="detail-age-filter-select-all" data-filter="brand" style="margin-right: 10px; width: 16px; height: 16px;">
                                                        ì „ì²´ ì„ íƒ
                                                    </label>
                                                </div>
                                                <div id="detailAgeFilterBrandList" class="detail-age-filter-checkbox-list"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="position: relative; min-width: 180px; flex: 1;">
                                        <button type="button" class="detail-age-filter-dropdown-btn" data-filter="promotion" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; text-align: left;">
                                            <span style="font-weight: 500;">í”„ë¡œëª¨ì…˜_ì „ì²´</span>
                                            <span style="font-size: 10px;">â–¼</span>
                                        </button>
                                        <div class="detail-age-filter-dropdown-list" data-filter="promotion" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                            <div style="padding: 8px;">
                                                <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px;">
                                                    <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px;">
                                                        <input type="checkbox" class="detail-age-filter-select-all" data-filter="promotion" style="margin-right: 10px; width: 16px; height: 16px;">
                                                        ì „ì²´ ì„ íƒ
                                                    </label>
                                                </div>
                                                <div id="detailAgeFilterPromotionList" class="detail-age-filter-checkbox-list"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="position: relative; min-width: 180px; flex: 1;">
                                        <button type="button" class="detail-age-filter-dropdown-btn" data-filter="adset" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; text-align: left;">
                                            <span style="font-weight: 500;">ê´‘ê³ ì„¸íŠ¸_ì „ì²´</span>
                                            <span style="font-size: 10px;">â–¼</span>
                                        </button>
                                        <div class="detail-age-filter-dropdown-list" data-filter="adset" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                            <div style="padding: 8px;">
                                                <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px;">
                                                    <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px;">
                                                        <input type="checkbox" class="detail-age-filter-select-all" data-filter="adset" style="margin-right: 10px; width: 16px; height: 16px;">
                                                        ì „ì²´ ì„ íƒ
                                                    </label>
                                                </div>
                                                <div id="detailAgeFilterAdsetList" class="detail-age-filter-checkbox-list"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="chart-container" style="height: 350px;">
                                <canvas id="detailAgeBarChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- íƒ­ 4: í”Œë«í¼ -->
                    <div class="detail-analysis-tab-content" id="detailPlatformTab" style="display: none;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                            <div style="padding: 14px 16px; background: linear-gradient(135deg, #e3f2fd 0%, #f0f7ff 100%); border-radius: 8px; border-left: 4px solid #2196f3;">
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                                    <span style="font-size: 16px;">ğŸ“Š</span>
                                    <strong style="color: #1976d2; font-size: 13px;">ì´ ë¶„ì„ì˜ ëª©ì </strong>
                                </div>
                                <p style="margin: 0; font-size: 12px; color: #424242; line-height: 1.6;">
                                    <strong style="color: #1565c0;">í”Œë«í¼ë³„ ì„±ê³¼</strong>ë¥¼ ë¹„êµí•©ë‹ˆë‹¤
                                </p>
                            </div>
                            <div style="padding: 14px 16px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8f4 100%); border-radius: 8px; border-left: 4px solid #4caf50;">
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                                    <span style="font-size: 16px;">ğŸ’¡</span>
                                    <strong style="color: #388e3c; font-size: 13px;">ì‚¬ìš© ë°©ë²•</strong>
                                </div>
                                <div style="font-size: 12px; color: #424242;">ì§€í‘œì™€ í•„í„°ë¥¼ ì„ íƒí•˜ì—¬ í”Œë«í¼ ì„±ê³¼ë¥¼ ë¹„êµí•˜ì„¸ìš”</div>
                            </div>
                        </div>
                        <div class="card">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid var(--grey-200); padding-bottom: 16px;">
                                <div>
                                    <div class="card-title" style="margin-bottom: 4px;">í”Œë«í¼ë³„ ì„±ê³¼ ë¹„êµ</div>
                                    <p style="color: var(--grey-600); font-size: 13px; margin: 0;">ê° í”Œë«í¼ì˜ ì„±ê³¼ë¥¼ ë¹„êµí•©ë‹ˆë‹¤.</p>
                                </div>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 20px; margin-bottom: 20px;">
                                <div style="flex: 0 0 auto;">
                                    <div style="font-size: 13px; font-weight: 600; color: var(--grey-700); margin-bottom: 12px;">ğŸ“ˆ ì§€í‘œ ì„ íƒ</div>
                                    <select id="detailPlatformMetricDropdown" style="min-width: 200px; padding: 10px 12px; border: 1px solid var(--grey-300); border-radius: 6px; background: white; font-size: 13px;">
                                        <option value="roas">ROAS</option>
                                        <option value="cost">ë¹„ìš©</option>
                                        <option value="revenue">ì „í™˜ê°’</option>
                                        <option value="conversions">ì „í™˜ìˆ˜</option>
                                        <option value="impressions">ë…¸ì¶œìˆ˜</option>
                                        <option value="clicks">í´ë¦­ìˆ˜</option>
                                        <option value="cpm">CPM</option>
                                        <option value="cpc">CPC</option>
                                        <option value="cpa">CPA</option>
                                        <option value="ctr">CTR</option>
                                        <option value="cvr">ì „í™˜ìœ¨</option>
                                    </select>
                                </div>
                                <div style="flex: 0 0 auto; margin-left: auto;">
                                    <div style="font-size: 13px; font-weight: 600; color: var(--grey-700); margin-bottom: 12px;">ğŸ“… ê¸°ê°„ ì„ íƒ</div>
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <input type="date" id="detailPlatformStartDate" style="padding: 10px 12px; border: 1px solid var(--grey-300); border-radius: 6px; background: white; font-size: 13px;">
                                        <span style="color: var(--grey-600); font-weight: 500;">~</span>
                                        <input type="date" id="detailPlatformEndDate" style="padding: 10px 12px; border: 1px solid var(--grey-300); border-radius: 6px; background: white; font-size: 13px;">
                                    </div>
                                </div>
                            </div>
                            <div style="margin-bottom: 20px; padding: 16px; background: var(--grey-50); border-radius: 8px; border: 1px solid var(--grey-200);">
                                <div style="font-size: 13px; font-weight: 600; color: var(--grey-700); margin-bottom: 14px;">ğŸ“Š ë¶„ë¥˜ ê¸°ì¤€</div>
                                <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                                    <div style="position: relative; min-width: 180px; flex: 1;">
                                        <button type="button" class="detail-platform-filter-dropdown-btn" data-filter="channel" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; text-align: left;">
                                            <span style="font-weight: 500;">ì±„ë„_ì „ì²´</span>
                                            <span style="font-size: 10px;">â–¼</span>
                                        </button>
                                        <div class="detail-platform-filter-dropdown-list" data-filter="channel" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                            <div style="padding: 8px;">
                                                <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px;">
                                                    <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px;">
                                                        <input type="checkbox" class="detail-platform-filter-select-all" data-filter="channel" style="margin-right: 10px; width: 16px; height: 16px;">
                                                        ì „ì²´ ì„ íƒ
                                                    </label>
                                                </div>
                                                <div id="detailPlatformFilterChannelList" class="detail-platform-filter-checkbox-list"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="position: relative; min-width: 180px; flex: 1;">
                                        <button type="button" class="detail-platform-filter-dropdown-btn" data-filter="product" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; text-align: left;">
                                            <span style="font-weight: 500;">ì œí’ˆ_ì „ì²´</span>
                                            <span style="font-size: 10px;">â–¼</span>
                                        </button>
                                        <div class="detail-platform-filter-dropdown-list" data-filter="product" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                            <div style="padding: 8px;">
                                                <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px;">
                                                    <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px;">
                                                        <input type="checkbox" class="detail-platform-filter-select-all" data-filter="product" style="margin-right: 10px; width: 16px; height: 16px;">
                                                        ì „ì²´ ì„ íƒ
                                                    </label>
                                                </div>
                                                <div id="detailPlatformFilterProductList" class="detail-platform-filter-checkbox-list"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="position: relative; min-width: 180px; flex: 1;">
                                        <button type="button" class="detail-platform-filter-dropdown-btn" data-filter="brand" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; text-align: left;">
                                            <span style="font-weight: 500;">ë¸Œëœë“œ_ì „ì²´</span>
                                            <span style="font-size: 10px;">â–¼</span>
                                        </button>
                                        <div class="detail-platform-filter-dropdown-list" data-filter="brand" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                            <div style="padding: 8px;">
                                                <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px;">
                                                    <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px;">
                                                        <input type="checkbox" class="detail-platform-filter-select-all" data-filter="brand" style="margin-right: 10px; width: 16px; height: 16px;">
                                                        ì „ì²´ ì„ íƒ
                                                    </label>
                                                </div>
                                                <div id="detailPlatformFilterBrandList" class="detail-platform-filter-checkbox-list"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="position: relative; min-width: 180px; flex: 1;">
                                        <button type="button" class="detail-platform-filter-dropdown-btn" data-filter="promotion" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; text-align: left;">
                                            <span style="font-weight: 500;">í”„ë¡œëª¨ì…˜_ì „ì²´</span>
                                            <span style="font-size: 10px;">â–¼</span>
                                        </button>
                                        <div class="detail-platform-filter-dropdown-list" data-filter="promotion" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                            <div style="padding: 8px;">
                                                <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px;">
                                                    <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px;">
                                                        <input type="checkbox" class="detail-platform-filter-select-all" data-filter="promotion" style="margin-right: 10px; width: 16px; height: 16px;">
                                                        ì „ì²´ ì„ íƒ
                                                    </label>
                                                </div>
                                                <div id="detailPlatformFilterPromotionList" class="detail-platform-filter-checkbox-list"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="position: relative; min-width: 180px; flex: 1;">
                                        <button type="button" class="detail-platform-filter-dropdown-btn" data-filter="adset" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; text-align: left;">
                                            <span style="font-weight: 500;">ê´‘ê³ ì„¸íŠ¸_ì „ì²´</span>
                                            <span style="font-size: 10px;">â–¼</span>
                                        </button>
                                        <div class="detail-platform-filter-dropdown-list" data-filter="adset" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                            <div style="padding: 8px;">
                                                <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px;">
                                                    <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px;">
                                                        <input type="checkbox" class="detail-platform-filter-select-all" data-filter="adset" style="margin-right: 10px; width: 16px; height: 16px;">
                                                        ì „ì²´ ì„ íƒ
                                                    </label>
                                                </div>
                                                <div id="detailPlatformFilterAdsetList" class="detail-platform-filter-checkbox-list"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="chart-container" style="height: 300px;">
                                <canvas id="detailPlatformBarChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- íƒ­ 5: ê¸°ê¸°í”Œë«í¼ -->
                    <div class="detail-analysis-tab-content" id="detailDevicePlatformTab" style="display: none;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                            <div style="padding: 14px 16px; background: linear-gradient(135deg, #e3f2fd 0%, #f0f7ff 100%); border-radius: 8px; border-left: 4px solid #2196f3;">
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                                    <span style="font-size: 16px;">ğŸ“Š</span>
                                    <strong style="color: #1976d2; font-size: 13px;">ì´ ë¶„ì„ì˜ ëª©ì </strong>
                                </div>
                                <p style="margin: 0; font-size: 12px; color: #424242; line-height: 1.6;">
                                    <strong style="color: #1565c0;">ê¸°ê¸°í”Œë«í¼ë³„ ì„±ê³¼</strong>ë¥¼ ë¹„êµí•©ë‹ˆë‹¤
                                </p>
                            </div>
                            <div style="padding: 14px 16px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8f4 100%); border-radius: 8px; border-left: 4px solid #4caf50;">
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                                    <span style="font-size: 16px;">ğŸ’¡</span>
                                    <strong style="color: #388e3c; font-size: 13px;">ì‚¬ìš© ë°©ë²•</strong>
                                </div>
                                <div style="font-size: 12px; color: #424242;">ì§€í‘œì™€ í•„í„°ë¥¼ ì„ íƒí•˜ì—¬ ê¸°ê¸°í”Œë«í¼ ì„±ê³¼ë¥¼ ë¹„êµí•˜ì„¸ìš”</div>
                            </div>
                        </div>
                        <div class="card">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid var(--grey-200); padding-bottom: 16px;">
                                <div>
                                    <div class="card-title" style="margin-bottom: 4px;">ê¸°ê¸°í”Œë«í¼ë³„ ì„±ê³¼ ë¹„êµ</div>
                                    <p style="color: var(--grey-600); font-size: 13px; margin: 0;">ê° ê¸°ê¸°í”Œë«í¼ì˜ ì„±ê³¼ë¥¼ ë¹„êµí•©ë‹ˆë‹¤.</p>
                                </div>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 20px; margin-bottom: 20px;">
                                <div style="flex: 0 0 auto;">
                                    <div style="font-size: 13px; font-weight: 600; color: var(--grey-700); margin-bottom: 12px;">ğŸ“ˆ ì§€í‘œ ì„ íƒ</div>
                                    <select id="detailDevicePlatformMetricDropdown" style="min-width: 200px; padding: 10px 12px; border: 1px solid var(--grey-300); border-radius: 6px; background: white; font-size: 13px;">
                                        <option value="roas">ROAS</option>
                                        <option value="cost">ë¹„ìš©</option>
                                        <option value="revenue">ì „í™˜ê°’</option>
                                        <option value="conversions">ì „í™˜ìˆ˜</option>
                                        <option value="impressions">ë…¸ì¶œìˆ˜</option>
                                        <option value="clicks">í´ë¦­ìˆ˜</option>
                                        <option value="cpm">CPM</option>
                                        <option value="cpc">CPC</option>
                                        <option value="cpa">CPA</option>
                                        <option value="ctr">CTR</option>
                                        <option value="cvr">ì „í™˜ìœ¨</option>
                                    </select>
                                </div>
                                <div style="flex: 0 0 auto; margin-left: auto;">
                                    <div style="font-size: 13px; font-weight: 600; color: var(--grey-700); margin-bottom: 12px;">ğŸ“… ê¸°ê°„ ì„ íƒ</div>
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <input type="date" id="detailDevicePlatformStartDate" style="padding: 10px 12px; border: 1px solid var(--grey-300); border-radius: 6px; background: white; font-size: 13px;">
                                        <span style="color: var(--grey-600); font-weight: 500;">~</span>
                                        <input type="date" id="detailDevicePlatformEndDate" style="padding: 10px 12px; border: 1px solid var(--grey-300); border-radius: 6px; background: white; font-size: 13px;">
                                    </div>
                                </div>
                            </div>
                            <div style="margin-bottom: 20px; padding: 16px; background: var(--grey-50); border-radius: 8px; border: 1px solid var(--grey-200);">
                                <div style="font-size: 13px; font-weight: 600; color: var(--grey-700); margin-bottom: 14px;">ğŸ“Š ë¶„ë¥˜ ê¸°ì¤€</div>
                                <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                                    <div style="position: relative; min-width: 180px; flex: 1;">
                                        <button type="button" class="detail-device-platform-filter-dropdown-btn" data-filter="channel" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; text-align: left;">
                                            <span style="font-weight: 500;">ì±„ë„_ì „ì²´</span>
                                            <span style="font-size: 10px;">â–¼</span>
                                        </button>
                                        <div class="detail-device-platform-filter-dropdown-list" data-filter="channel" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                            <div style="padding: 8px;">
                                                <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px;">
                                                    <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px;">
                                                        <input type="checkbox" class="detail-device-platform-filter-select-all" data-filter="channel" style="margin-right: 10px; width: 16px; height: 16px;">
                                                        ì „ì²´ ì„ íƒ
                                                    </label>
                                                </div>
                                                <div id="detailDevicePlatformFilterChannelList" class="detail-device-platform-filter-checkbox-list"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="position: relative; min-width: 180px; flex: 1;">
                                        <button type="button" class="detail-device-platform-filter-dropdown-btn" data-filter="product" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; text-align: left;">
                                            <span style="font-weight: 500;">ì œí’ˆ_ì „ì²´</span>
                                            <span style="font-size: 10px;">â–¼</span>
                                        </button>
                                        <div class="detail-device-platform-filter-dropdown-list" data-filter="product" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                            <div style="padding: 8px;">
                                                <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px;">
                                                    <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px;">
                                                        <input type="checkbox" class="detail-device-platform-filter-select-all" data-filter="product" style="margin-right: 10px; width: 16px; height: 16px;">
                                                        ì „ì²´ ì„ íƒ
                                                    </label>
                                                </div>
                                                <div id="detailDevicePlatformFilterProductList" class="detail-device-platform-filter-checkbox-list"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="position: relative; min-width: 180px; flex: 1;">
                                        <button type="button" class="detail-device-platform-filter-dropdown-btn" data-filter="brand" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; text-align: left;">
                                            <span style="font-weight: 500;">ë¸Œëœë“œ_ì „ì²´</span>
                                            <span style="font-size: 10px;">â–¼</span>
                                        </button>
                                        <div class="detail-device-platform-filter-dropdown-list" data-filter="brand" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                            <div style="padding: 8px;">
                                                <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px;">
                                                    <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px;">
                                                        <input type="checkbox" class="detail-device-platform-filter-select-all" data-filter="brand" style="margin-right: 10px; width: 16px; height: 16px;">
                                                        ì „ì²´ ì„ íƒ
                                                    </label>
                                                </div>
                                                <div id="detailDevicePlatformFilterBrandList" class="detail-device-platform-filter-checkbox-list"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="position: relative; min-width: 180px; flex: 1;">
                                        <button type="button" class="detail-device-platform-filter-dropdown-btn" data-filter="promotion" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; text-align: left;">
                                            <span style="font-weight: 500;">í”„ë¡œëª¨ì…˜_ì „ì²´</span>
                                            <span style="font-size: 10px;">â–¼</span>
                                        </button>
                                        <div class="detail-device-platform-filter-dropdown-list" data-filter="promotion" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                            <div style="padding: 8px;">
                                                <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px;">
                                                    <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px;">
                                                        <input type="checkbox" class="detail-device-platform-filter-select-all" data-filter="promotion" style="margin-right: 10px; width: 16px; height: 16px;">
                                                        ì „ì²´ ì„ íƒ
                                                    </label>
                                                </div>
                                                <div id="detailDevicePlatformFilterPromotionList" class="detail-device-platform-filter-checkbox-list"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="position: relative; min-width: 180px; flex: 1;">
                                        <button type="button" class="detail-device-platform-filter-dropdown-btn" data-filter="adset" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; text-align: left;">
                                            <span style="font-weight: 500;">ê´‘ê³ ì„¸íŠ¸_ì „ì²´</span>
                                            <span style="font-size: 10px;">â–¼</span>
                                        </button>
                                        <div class="detail-device-platform-filter-dropdown-list" data-filter="adset" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                            <div style="padding: 8px;">
                                                <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px;">
                                                    <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px;">
                                                        <input type="checkbox" class="detail-device-platform-filter-select-all" data-filter="adset" style="margin-right: 10px; width: 16px; height: 16px;">
                                                        ì „ì²´ ì„ íƒ
                                                    </label>
                                                </div>
                                                <div id="detailDevicePlatformFilterAdsetList" class="detail-device-platform-filter-checkbox-list"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="chart-container" style="height: 300px;">
                                <canvas id="detailDevicePlatformBarChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- íƒ­ 6: ê¸°ê¸° -->
                    <div class="detail-analysis-tab-content" id="detailDeviceTypeTab" style="display: none;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                            <div style="padding: 14px 16px; background: linear-gradient(135deg, #e3f2fd 0%, #f0f7ff 100%); border-radius: 8px; border-left: 4px solid #2196f3;">
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                                    <span style="font-size: 16px;">ğŸ“Š</span>
                                    <strong style="color: #1976d2; font-size: 13px;">ì´ ë¶„ì„ì˜ ëª©ì </strong>
                                </div>
                                <p style="margin: 0; font-size: 12px; color: #424242; line-height: 1.6;">
                                    <strong style="color: #1565c0;">ê¸°ê¸°ë³„ ì„±ê³¼</strong>ë¥¼ ë¹„êµí•©ë‹ˆë‹¤
                                </p>
                            </div>
                            <div style="padding: 14px 16px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8f4 100%); border-radius: 8px; border-left: 4px solid #4caf50;">
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                                    <span style="font-size: 16px;">ğŸ’¡</span>
                                    <strong style="color: #388e3c; font-size: 13px;">ì‚¬ìš© ë°©ë²•</strong>
                                </div>
                                <div style="font-size: 12px; color: #424242;">ì§€í‘œì™€ í•„í„°ë¥¼ ì„ íƒí•˜ì—¬ ê¸°ê¸° ì„±ê³¼ë¥¼ ë¹„êµí•˜ì„¸ìš”</div>
                            </div>
                        </div>
                        <div class="card">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid var(--grey-200); padding-bottom: 16px;">
                                <div>
                                    <div class="card-title" style="margin-bottom: 4px;">ê¸°ê¸°ë³„ ì„±ê³¼ ë¹„êµ</div>
                                    <p style="color: var(--grey-600); font-size: 13px; margin: 0;">ê° ê¸°ê¸°ì˜ ì„±ê³¼ë¥¼ ë¹„êµí•©ë‹ˆë‹¤.</p>
                                </div>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 20px; margin-bottom: 20px;">
                                <div style="flex: 0 0 auto;">
                                    <div style="font-size: 13px; font-weight: 600; color: var(--grey-700); margin-bottom: 12px;">ğŸ“ˆ ì§€í‘œ ì„ íƒ</div>
                                    <select id="detailDeviceTypeMetricDropdown" style="min-width: 200px; padding: 10px 12px; border: 1px solid var(--grey-300); border-radius: 6px; background: white; font-size: 13px;">
                                        <option value="roas">ROAS</option>
                                        <option value="cost">ë¹„ìš©</option>
                                        <option value="revenue">ì „í™˜ê°’</option>
                                        <option value="conversions">ì „í™˜ìˆ˜</option>
                                        <option value="impressions">ë…¸ì¶œìˆ˜</option>
                                        <option value="clicks">í´ë¦­ìˆ˜</option>
                                        <option value="cpm">CPM</option>
                                        <option value="cpc">CPC</option>
                                        <option value="cpa">CPA</option>
                                        <option value="ctr">CTR</option>
                                        <option value="cvr">ì „í™˜ìœ¨</option>
                                    </select>
                                </div>
                                <div style="flex: 0 0 auto; margin-left: auto;">
                                    <div style="font-size: 13px; font-weight: 600; color: var(--grey-700); margin-bottom: 12px;">ğŸ“… ê¸°ê°„ ì„ íƒ</div>
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <input type="date" id="detailDeviceTypeStartDate" style="padding: 10px 12px; border: 1px solid var(--grey-300); border-radius: 6px; background: white; font-size: 13px;">
                                        <span style="color: var(--grey-600); font-weight: 500;">~</span>
                                        <input type="date" id="detailDeviceTypeEndDate" style="padding: 10px 12px; border: 1px solid var(--grey-300); border-radius: 6px; background: white; font-size: 13px;">
                                    </div>
                                </div>
                            </div>
                            <div style="margin-bottom: 20px; padding: 16px; background: var(--grey-50); border-radius: 8px; border: 1px solid var(--grey-200);">
                                <div style="font-size: 13px; font-weight: 600; color: var(--grey-700); margin-bottom: 14px;">ğŸ“Š ë¶„ë¥˜ ê¸°ì¤€</div>
                                <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                                    <div style="position: relative; min-width: 180px; flex: 1;">
                                        <button type="button" class="detail-device-type-filter-dropdown-btn" data-filter="channel" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; text-align: left;">
                                            <span style="font-weight: 500;">ì±„ë„_ì „ì²´</span>
                                            <span style="font-size: 10px;">â–¼</span>
                                        </button>
                                        <div class="detail-device-type-filter-dropdown-list" data-filter="channel" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                            <div style="padding: 8px;">
                                                <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px;">
                                                    <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px;">
                                                        <input type="checkbox" class="detail-device-type-filter-select-all" data-filter="channel" style="margin-right: 10px; width: 16px; height: 16px;">
                                                        ì „ì²´ ì„ íƒ
                                                    </label>
                                                </div>
                                                <div id="detailDeviceTypeFilterChannelList" class="detail-device-type-filter-checkbox-list"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="position: relative; min-width: 180px; flex: 1;">
                                        <button type="button" class="detail-device-type-filter-dropdown-btn" data-filter="product" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; text-align: left;">
                                            <span style="font-weight: 500;">ì œí’ˆ_ì „ì²´</span>
                                            <span style="font-size: 10px;">â–¼</span>
                                        </button>
                                        <div class="detail-device-type-filter-dropdown-list" data-filter="product" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                            <div style="padding: 8px;">
                                                <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px;">
                                                    <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px;">
                                                        <input type="checkbox" class="detail-device-type-filter-select-all" data-filter="product" style="margin-right: 10px; width: 16px; height: 16px;">
                                                        ì „ì²´ ì„ íƒ
                                                    </label>
                                                </div>
                                                <div id="detailDeviceTypeFilterProductList" class="detail-device-type-filter-checkbox-list"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="position: relative; min-width: 180px; flex: 1;">
                                        <button type="button" class="detail-device-type-filter-dropdown-btn" data-filter="brand" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; text-align: left;">
                                            <span style="font-weight: 500;">ë¸Œëœë“œ_ì „ì²´</span>
                                            <span style="font-size: 10px;">â–¼</span>
                                        </button>
                                        <div class="detail-device-type-filter-dropdown-list" data-filter="brand" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                            <div style="padding: 8px;">
                                                <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px;">
                                                    <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px;">
                                                        <input type="checkbox" class="detail-device-type-filter-select-all" data-filter="brand" style="margin-right: 10px; width: 16px; height: 16px;">
                                                        ì „ì²´ ì„ íƒ
                                                    </label>
                                                </div>
                                                <div id="detailDeviceTypeFilterBrandList" class="detail-device-type-filter-checkbox-list"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="position: relative; min-width: 180px; flex: 1;">
                                        <button type="button" class="detail-device-type-filter-dropdown-btn" data-filter="promotion" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; text-align: left;">
                                            <span style="font-weight: 500;">í”„ë¡œëª¨ì…˜_ì „ì²´</span>
                                            <span style="font-size: 10px;">â–¼</span>
                                        </button>
                                        <div class="detail-device-type-filter-dropdown-list" data-filter="promotion" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                            <div style="padding: 8px;">
                                                <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px;">
                                                    <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px;">
                                                        <input type="checkbox" class="detail-device-type-filter-select-all" data-filter="promotion" style="margin-right: 10px; width: 16px; height: 16px;">
                                                        ì „ì²´ ì„ íƒ
                                                    </label>
                                                </div>
                                                <div id="detailDeviceTypeFilterPromotionList" class="detail-device-type-filter-checkbox-list"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="position: relative; min-width: 180px; flex: 1;">
                                        <button type="button" class="detail-device-type-filter-dropdown-btn" data-filter="adset" style="width: 100%; padding: 10px 14px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; font-size: 13px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; text-align: left;">
                                            <span style="font-weight: 500;">ê´‘ê³ ì„¸íŠ¸_ì „ì²´</span>
                                            <span style="font-size: 10px;">â–¼</span>
                                        </button>
                                        <div class="detail-device-type-filter-dropdown-list" data-filter="adset" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: white; border: 1px solid var(--grey-300); border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 280px; overflow-y: auto; z-index: 100;">
                                            <div style="padding: 8px;">
                                                <div style="position: sticky; top: 0; background: white; padding: 6px 0; border-bottom: 1px solid var(--grey-200); margin-bottom: 6px;">
                                                    <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-weight: 600; font-size: 12px;">
                                                        <input type="checkbox" class="detail-device-type-filter-select-all" data-filter="adset" style="margin-right: 10px; width: 16px; height: 16px;">
                                                        ì „ì²´ ì„ íƒ
                                                    </label>
                                                </div>
                                                <div id="detailDeviceTypeFilterAdsetList" class="detail-device-type-filter-checkbox-list"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="chart-container" style="height: 300px;">
                                <canvas id="detailDeviceTypeBarChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 1. ì„±ê³¼ ë¶„ì„ (ë¸Œëœë“œ/ìƒí’ˆ/í”„ë¡œëª¨ì…˜/íƒ€ê²ŸíŒ…) -->
            <div class="collapsible-section">
                <div class="collapsible-header">
                    <div class="collapsible-title">
                        <span class="collapsible-icon">ğŸ†</span>
                        <span>ì„±ê³¼ ë¶„ì„ - ë¬´ì—‡ì´ ê°€ì¥ ì˜ íŒ”ë¦¬ê³  ìˆë‚˜ìš”?</span>
                    </div>
                    <button class="collapsible-toggle">
                        <span>í¼ì¹˜ê¸°</span>
                        <span class="collapsible-toggle-icon collapsed">â–¼</span>
                    </button>
                </div>
                <div class="collapsible-content">
                    <!-- ì„œë¸Œíƒ­ ë²„íŠ¼ -->
                    <div style="display: flex; gap: 8px; padding: 16px 24px; background: #f8f9fa; border-bottom: 1px solid #e9ecef;">
                        <button class="performance-subtab active" data-perf-tab="brand"
                                style="padding: 8px 16px; font-size: 12px; font-weight: 600; border: none; border-radius: 20px; cursor: pointer; transition: all 0.2s; background: #1a73e8; color: white;">
                            ë¸Œëœë“œ
                        </button>
                        <button class="performance-subtab" data-perf-tab="product"
                                style="padding: 8px 16px; font-size: 12px; font-weight: 600; border: 1px solid #dee2e6; border-radius: 20px; cursor: pointer; transition: all 0.2s; background: white; color: #495057;">
                            ìƒí’ˆ
                        </button>
                        <button class="performance-subtab" data-perf-tab="promotion"
                                style="padding: 8px 16px; font-size: 12px; font-weight: 600; border: 1px solid #dee2e6; border-radius: 20px; cursor: pointer; transition: all 0.2s; background: white; color: #495057;">
                            í”„ë¡œëª¨ì…˜
                        </button>
                        <button class="performance-subtab" data-perf-tab="targeting"
                                style="padding: 8px 16px; font-size: 12px; font-weight: 600; border: 1px solid #dee2e6; border-radius: 20px; cursor: pointer; transition: all 0.2s; background: white; color: #495057;">
                            íƒ€ê²ŸíŒ…
                        </button>
                    </div>

                    <!-- ë¸Œëœë“œ ë·° -->
                    <div class="performance-filter-content active" id="brandView">
                        <!-- ìì—°ì–´ ì¸ì‚¬ì´íŠ¸ -->
                        <div id="brandInsightText" style="padding: 20px 24px; background: linear-gradient(135deg, #e3f2fd 0%, #f5f9ff 100%); border-bottom: 1px solid #e9ecef;">
                            <div style="font-size: 14px; color: #1565c0; font-weight: 600; margin-bottom: 8px;">ğŸ’¡ ë¸Œëœë“œ ì„±ê³¼ ì¸ì‚¬ì´íŠ¸</div>
                            <div style="font-size: 13px; color: #424242; line-height: 1.7;">ë¡œë”© ì¤‘...</div>
                        </div>

                        <div class="card" style="margin: 16px; border-radius: 12px;">
                            <!-- ì»¨íŠ¸ë¡¤ ë²„íŠ¼ -->
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; border-bottom: 1px solid #e9ecef;">
                                <div style="display: flex; gap: 6px;">
                                    <button class="perf-kpi-btn active" data-category="brand" data-kpi="roas" style="padding: 6px 12px; font-size: 11px; font-weight: 600; border: none; border-radius: 6px; cursor: pointer; background: #1a73e8; color: white;">ROAS</button>
                                    <button class="perf-kpi-btn" data-category="brand" data-kpi="cpa" style="padding: 6px 12px; font-size: 11px; font-weight: 600; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer; background: white; color: #495057;">CPA</button>
                                    <button class="perf-kpi-btn" data-category="brand" data-kpi="cost" style="padding: 6px 12px; font-size: 11px; font-weight: 600; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer; background: white; color: #495057;">ë¹„ìš©</button>
                                    <button class="perf-kpi-btn" data-category="brand" data-kpi="conversions" style="padding: 6px 12px; font-size: 11px; font-weight: 600; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer; background: white; color: #495057;">ì „í™˜ìˆ˜</button>
                                    <button class="perf-kpi-btn" data-category="brand" data-kpi="revenue" style="padding: 6px 12px; font-size: 11px; font-weight: 600; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer; background: white; color: #495057;">ì „í™˜ê°’</button>
                                </div>
                                <div style="display: flex; gap: 6px;">
                                    <button class="perf-sort-btn active" data-category="brand" data-sort="desc" style="padding: 6px 10px; font-size: 11px; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer; background: #f8f9fa; color: #495057;">â†“ ë‚´ë¦¼ì°¨ìˆœ</button>
                                    <button class="perf-sort-btn" data-category="brand" data-sort="asc" style="padding: 6px 10px; font-size: 11px; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer; background: white; color: #495057;">â†‘ ì˜¤ë¦„ì°¨ìˆœ</button>
                                </div>
                            </div>
                            <!-- ë§‰ëŒ€ ê·¸ë˜í”„ -->
                            <div style="padding: 20px;">
                                <div class="chart-container" style="height: 280px;">
                                    <canvas id="brandPerformanceChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ìƒí’ˆ ë·° -->
                    <div class="performance-filter-content" id="productView" style="display: none;">
                        <!-- ìì—°ì–´ ì¸ì‚¬ì´íŠ¸ -->
                        <div id="productInsightText" style="padding: 20px 24px; background: linear-gradient(135deg, #e8f5e9 0%, #f5fff5 100%); border-bottom: 1px solid #e9ecef;">
                            <div style="font-size: 14px; color: #2e7d32; font-weight: 600; margin-bottom: 8px;">ğŸ’¡ ìƒí’ˆ ì„±ê³¼ ì¸ì‚¬ì´íŠ¸</div>
                            <div style="font-size: 13px; color: #424242; line-height: 1.7;">ë¡œë”© ì¤‘...</div>
                        </div>

                        <div class="card" style="margin: 16px; border-radius: 12px;">
                            <!-- ì»¨íŠ¸ë¡¤ ë²„íŠ¼ -->
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; border-bottom: 1px solid #e9ecef;">
                                <div style="display: flex; gap: 6px;">
                                    <button class="perf-kpi-btn active" data-category="product" data-kpi="roas" style="padding: 6px 12px; font-size: 11px; font-weight: 600; border: none; border-radius: 6px; cursor: pointer; background: #1a73e8; color: white;">ROAS</button>
                                    <button class="perf-kpi-btn" data-category="product" data-kpi="cpa" style="padding: 6px 12px; font-size: 11px; font-weight: 600; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer; background: white; color: #495057;">CPA</button>
                                    <button class="perf-kpi-btn" data-category="product" data-kpi="cost" style="padding: 6px 12px; font-size: 11px; font-weight: 600; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer; background: white; color: #495057;">ë¹„ìš©</button>
                                    <button class="perf-kpi-btn" data-category="product" data-kpi="conversions" style="padding: 6px 12px; font-size: 11px; font-weight: 600; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer; background: white; color: #495057;">ì „í™˜ìˆ˜</button>
                                    <button class="perf-kpi-btn" data-category="product" data-kpi="revenue" style="padding: 6px 12px; font-size: 11px; font-weight: 600; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer; background: white; color: #495057;">ì „í™˜ê°’</button>
                                </div>
                                <div style="display: flex; gap: 6px;">
                                    <button class="perf-sort-btn active" data-category="product" data-sort="desc" style="padding: 6px 10px; font-size: 11px; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer; background: #f8f9fa; color: #495057;">â†“ ë‚´ë¦¼ì°¨ìˆœ</button>
                                    <button class="perf-sort-btn" data-category="product" data-sort="asc" style="padding: 6px 10px; font-size: 11px; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer; background: white; color: #495057;">â†‘ ì˜¤ë¦„ì°¨ìˆœ</button>
                                </div>
                            </div>
                            <!-- ë§‰ëŒ€ ê·¸ë˜í”„ -->
                            <div style="padding: 20px;">
                                <div class="chart-container" style="height: 280px;">
                                    <canvas id="productPerformanceChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- í”„ë¡œëª¨ì…˜ ë·° -->
                    <div class="performance-filter-content" id="promotionView" style="display: none;">
                        <!-- ìì—°ì–´ ì¸ì‚¬ì´íŠ¸ -->
                        <div id="promotionInsightText" style="padding: 20px 24px; background: linear-gradient(135deg, #fff3e0 0%, #fffaf5 100%); border-bottom: 1px solid #e9ecef;">
                            <div style="font-size: 14px; color: #e65100; font-weight: 600; margin-bottom: 8px;">ğŸ’¡ í”„ë¡œëª¨ì…˜ ì„±ê³¼ ì¸ì‚¬ì´íŠ¸</div>
                            <div style="font-size: 13px; color: #424242; line-height: 1.7;">ë¡œë”© ì¤‘...</div>
                        </div>

                        <div class="card" style="margin: 16px; border-radius: 12px;">
                            <!-- ì»¨íŠ¸ë¡¤ ë²„íŠ¼ -->
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; border-bottom: 1px solid #e9ecef;">
                                <div style="display: flex; gap: 6px;">
                                    <button class="perf-kpi-btn active" data-category="promotion" data-kpi="roas" style="padding: 6px 12px; font-size: 11px; font-weight: 600; border: none; border-radius: 6px; cursor: pointer; background: #1a73e8; color: white;">ROAS</button>
                                    <button class="perf-kpi-btn" data-category="promotion" data-kpi="cpa" style="padding: 6px 12px; font-size: 11px; font-weight: 600; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer; background: white; color: #495057;">CPA</button>
                                    <button class="perf-kpi-btn" data-category="promotion" data-kpi="cost" style="padding: 6px 12px; font-size: 11px; font-weight: 600; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer; background: white; color: #495057;">ë¹„ìš©</button>
                                    <button class="perf-kpi-btn" data-category="promotion" data-kpi="conversions" style="padding: 6px 12px; font-size: 11px; font-weight: 600; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer; background: white; color: #495057;">ì „í™˜ìˆ˜</button>
                                    <button class="perf-kpi-btn" data-category="promotion" data-kpi="revenue" style="padding: 6px 12px; font-size: 11px; font-weight: 600; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer; background: white; color: #495057;">ì „í™˜ê°’</button>
                                </div>
                                <div style="display: flex; gap: 6px;">
                                    <button class="perf-sort-btn active" data-category="promotion" data-sort="desc" style="padding: 6px 10px; font-size: 11px; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer; background: #f8f9fa; color: #495057;">â†“ ë‚´ë¦¼ì°¨ìˆœ</button>
                                    <button class="perf-sort-btn" data-category="promotion" data-sort="asc" style="padding: 6px 10px; font-size: 11px; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer; background: white; color: #495057;">â†‘ ì˜¤ë¦„ì°¨ìˆœ</button>
                                </div>
                            </div>
                            <!-- ë§‰ëŒ€ ê·¸ë˜í”„ -->
                            <div style="padding: 20px;">
                                <div class="chart-container" style="height: 280px;">
                                    <canvas id="promotionPerformanceChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- íƒ€ê²ŸíŒ… ë·° -->
                    <div class="performance-filter-content" id="targetingView" style="display: none;">
                        <!-- ìì—°ì–´ ì¸ì‚¬ì´íŠ¸ -->
                        <div id="targetingInsightText" style="padding: 20px 24px; background: linear-gradient(135deg, #f3e5f5 0%, #faf5ff 100%); border-bottom: 1px solid #e9ecef;">
                            <div style="font-size: 14px; color: #7b1fa2; font-weight: 600; margin-bottom: 8px;">ğŸ’¡ íƒ€ê²ŸíŒ… ì„±ê³¼ ì¸ì‚¬ì´íŠ¸</div>
                            <div style="font-size: 13px; color: #424242; line-height: 1.7;">ë¡œë”© ì¤‘...</div>
                        </div>

                        <div class="card" style="margin: 16px; border-radius: 12px;">
                            <!-- ì»¨íŠ¸ë¡¤ ë²„íŠ¼ -->
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; border-bottom: 1px solid #e9ecef;">
                                <div style="display: flex; gap: 6px;">
                                    <button class="perf-kpi-btn active" data-category="targeting" data-kpi="roas" style="padding: 6px 12px; font-size: 11px; font-weight: 600; border: none; border-radius: 6px; cursor: pointer; background: #1a73e8; color: white;">ROAS</button>
                                    <button class="perf-kpi-btn" data-category="targeting" data-kpi="cpa" style="padding: 6px 12px; font-size: 11px; font-weight: 600; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer; background: white; color: #495057;">CPA</button>
                                    <button class="perf-kpi-btn" data-category="targeting" data-kpi="cost" style="padding: 6px 12px; font-size: 11px; font-weight: 600; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer; background: white; color: #495057;">ë¹„ìš©</button>
                                    <button class="perf-kpi-btn" data-category="targeting" data-kpi="conversions" style="padding: 6px 12px; font-size: 11px; font-weight: 600; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer; background: white; color: #495057;">ì „í™˜ìˆ˜</button>
                                    <button class="perf-kpi-btn" data-category="targeting" data-kpi="revenue" style="padding: 6px 12px; font-size: 11px; font-weight: 600; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer; background: white; color: #495057;">ì „í™˜ê°’</button>
                                </div>
                                <div style="display: flex; gap: 6px;">
                                    <button class="perf-sort-btn active" data-category="targeting" data-sort="desc" style="padding: 6px 10px; font-size: 11px; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer; background: #f8f9fa; color: #495057;">â†“ ë‚´ë¦¼ì°¨ìˆœ</button>
                                    <button class="perf-sort-btn" data-category="targeting" data-sort="asc" style="padding: 6px 10px; font-size: 11px; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer; background: white; color: #495057;">â†‘ ì˜¤ë¦„ì°¨ìˆœ</button>
                                </div>
                            </div>
                            <!-- ë§‰ëŒ€ ê·¸ë˜í”„ -->
                            <div style="padding: 20px;">
                                <div class="chart-container" style="height: 280px;">
                                    <canvas id="targetingPerformanceChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 2. ë¦¬íƒ€ê²ŸíŒ… ë¶„ì„ -->
            <div class="collapsible-section">
                <div class="collapsible-header">
                    <div class="collapsible-title">
                        <span class="collapsible-icon">ğŸ¯</span>
                        <span>ë¦¬íƒ€ê²ŸíŒ… ë¶„ì„ - ì œí’ˆì— ê´€ì‹¬ì´ ë§ì€ ì†Œë¹„ìë¥¼ í™•ì¸í•˜ì„¸ìš”</span>
                    </div>
                    <button class="collapsible-toggle">
                        <span>í¼ì¹˜ê¸°</span>
                        <span class="collapsible-toggle-icon collapsed">â–¼</span>
                    </button>
                </div>
                <div class="collapsible-content">
                    <!-- ì„œë¸Œíƒ­ ë²„íŠ¼ -->
                    <div style="display: flex; flex-wrap: wrap; gap: 8px; padding: 16px 24px; background: #f8f9fa; border-bottom: 1px solid #e9ecef;">
                        <button class="retargeting-subtab active" data-retarget-tab="ageGender"
                                style="padding: 8px 16px; font-size: 12px; font-weight: 600; border: none; border-radius: 20px; cursor: pointer; transition: all 0.2s; background: #1a73e8; color: white;">
                            ì„±ë³„/ì—°ë ¹
                        </button>
                        <button class="retargeting-subtab" data-retarget-tab="device"
                                style="padding: 8px 16px; font-size: 12px; font-weight: 600; border: 1px solid #dee2e6; border-radius: 20px; cursor: pointer; transition: all 0.2s; background: white; color: #495057;">
                            ê¸°ê¸°ë³„
                        </button>
                        <button class="retargeting-subtab" data-retarget-tab="platform"
                                style="padding: 8px 16px; font-size: 12px; font-weight: 600; border: 1px solid #dee2e6; border-radius: 20px; cursor: pointer; transition: all 0.2s; background: white; color: #495057;">
                            í”Œë«í¼ë³„
                        </button>
                        <button class="retargeting-subtab" data-retarget-tab="devicePlatform"
                                style="padding: 8px 16px; font-size: 12px; font-weight: 600; border: 1px solid #dee2e6; border-radius: 20px; cursor: pointer; transition: all 0.2s; background: white; color: #495057;">
                            ë…¸ì¶œê¸°ê¸°ë³„
                        </button>
                    </div>

                    <!-- ì„±ë³„/ì—°ë ¹ ë¦¬íƒ€ê²ŸíŒ… ë·° -->
                    <div class="retargeting-tab-content active" id="ageGenderRetargetView">
                        <!-- ìì—°ì–´ ì¸ì‚¬ì´íŠ¸ -->
                        <div style="padding: 20px 24px; background: linear-gradient(135deg, #fce4ec 0%, #fff5f7 100%); border-bottom: 1px solid #e9ecef;">
                            <div style="font-size: 14px; color: #c2185b; font-weight: 600; margin-bottom: 8px;">ğŸ’¡ ì„±ë³„/ì—°ë ¹ íƒ€ê²ŸíŒ… ì¸ì‚¬ì´íŠ¸</div>
                            <div style="font-size: 13px; color: #424242; line-height: 1.7;" id="ageGenderRetargetInsightText">ë¡œë”© ì¤‘...</div>
                        </div>

                        <div class="card" style="margin: 16px; border-radius: 12px;">
                            <div style="padding: 16px 20px; border-bottom: 1px solid #e9ecef;">
                                <h4 style="font-size: 14px; font-weight: 600; color: var(--grey-800); margin: 0;">ì„±ë³„/ì—°ë ¹ ì¡°í•©ë³„ ì„±ê³¼</h4>
                                <p style="font-size: 12px; color: var(--grey-600); margin: 4px 0 0 0;">ì–´ë–¤ ì—°ë ¹ëŒ€ì™€ ì„±ë³„ ì¡°í•©ì´ ê°€ì¥ íš¨ê³¼ì ì¸ì§€ í™•ì¸í•˜ì„¸ìš”</p>
                            </div>
                            <div style="padding: 16px 20px; overflow-x: auto;">
                                <table class="data-table" id="ageGenderRetargetTable" style="margin-top: 0;">
                                    <thead>
                                        <tr>
                                            <th style="min-width: 140px;">ì—°ë ¹/ì„±ë³„</th>
                                            <th class="sortable-header" data-table="ageGender" data-column="roas" style="min-width: 100px; text-align: right;">
                                                ROAS
                                                <div class="sort-icon active"><div class="sort-arrow up"></div><div class="sort-arrow down active"></div></div>
                                            </th>
                                            <th class="sortable-header" data-table="ageGender" data-column="cpa" style="min-width: 100px; text-align: right;">
                                                CPA
                                                <div class="sort-icon"><div class="sort-arrow up"></div><div class="sort-arrow down"></div></div>
                                            </th>
                                            <th class="sortable-header" data-table="ageGender" data-column="cost" style="min-width: 120px; text-align: right;">
                                                ê´‘ê³ ë¹„
                                                <div class="sort-icon"><div class="sort-arrow up"></div><div class="sort-arrow down"></div></div>
                                            </th>
                                            <th class="sortable-header" data-table="ageGender" data-column="conversions" style="min-width: 80px; text-align: right;">
                                                ì „í™˜ìˆ˜
                                                <div class="sort-icon"><div class="sort-arrow up"></div><div class="sort-arrow down"></div></div>
                                            </th>
                                            <th class="sortable-header" data-table="ageGender" data-column="revenue" style="min-width: 120px; text-align: right;">
                                                ì „í™˜ê°’
                                                <div class="sort-icon"><div class="sort-arrow up"></div><div class="sort-arrow down"></div></div>
                                            </th>
                                            <th style="min-width: 80px; text-align: center;">íš¨ìœ¨ë“±ê¸‰</th>
                                        </tr>
                                    </thead>
                                    <tbody id="ageGenderRetargetTableBody">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- ê¸°ê¸°ë³„ ë¦¬íƒ€ê²ŸíŒ… ë·° -->
                    <div class="retargeting-tab-content" id="deviceRetargetView" style="display: none;">
                        <!-- ìì—°ì–´ ì¸ì‚¬ì´íŠ¸ -->
                        <div style="padding: 20px 24px; background: linear-gradient(135deg, #e3f2fd 0%, #f5f9ff 100%); border-bottom: 1px solid #e9ecef;">
                            <div style="font-size: 14px; color: #1565c0; font-weight: 600; margin-bottom: 8px;">ğŸ’¡ ê¸°ê¸°ë³„ ë¦¬íƒ€ê²ŸíŒ… ì¸ì‚¬ì´íŠ¸</div>
                            <div style="font-size: 13px; color: #424242; line-height: 1.7;" id="deviceRetargetInsightText">ë¡œë”© ì¤‘...</div>
                        </div>

                        <div class="card" style="margin: 16px; border-radius: 12px;">
                            <div style="padding: 16px 20px; border-bottom: 1px solid #e9ecef;">
                                <h4 style="font-size: 14px; font-weight: 600; color: var(--grey-800); margin: 0;">ê¸°ê¸°ë³„ ë¦¬íƒ€ê²ŸíŒ… ì„±ê³¼</h4>
                                <p style="font-size: 12px; color: var(--grey-600); margin: 4px 0 0 0;">Android, iPhone, Computers, Tablets ë“± ê¸°ê¸°ë³„ ê´‘ê³  íš¨ìœ¨</p>
                            </div>
                            <div style="padding: 16px 20px; overflow-x: auto;">
                                <table class="data-table" id="deviceRetargetTable" style="margin-top: 0;">
                                    <thead>
                                        <tr>
                                            <th style="min-width: 150px;">ê¸°ê¸°</th>
                                            <th class="sortable-header" data-table="device" data-column="roas" style="min-width: 100px; text-align: right;">
                                                ROAS
                                                <div class="sort-icon active"><div class="sort-arrow up"></div><div class="sort-arrow down active"></div></div>
                                            </th>
                                            <th class="sortable-header" data-table="device" data-column="cpa" style="min-width: 100px; text-align: right;">
                                                CPA
                                                <div class="sort-icon"><div class="sort-arrow up"></div><div class="sort-arrow down"></div></div>
                                            </th>
                                            <th class="sortable-header" data-table="device" data-column="cost" style="min-width: 120px; text-align: right;">
                                                ê´‘ê³ ë¹„
                                                <div class="sort-icon"><div class="sort-arrow up"></div><div class="sort-arrow down"></div></div>
                                            </th>
                                            <th class="sortable-header" data-table="device" data-column="conversions" style="min-width: 80px; text-align: right;">
                                                ì „í™˜ìˆ˜
                                                <div class="sort-icon"><div class="sort-arrow up"></div><div class="sort-arrow down"></div></div>
                                            </th>
                                            <th class="sortable-header" data-table="device" data-column="revenue" style="min-width: 120px; text-align: right;">
                                                ì „í™˜ê°’
                                                <div class="sort-icon"><div class="sort-arrow up"></div><div class="sort-arrow down"></div></div>
                                            </th>
                                            <th style="min-width: 80px; text-align: center;">íš¨ìœ¨ë“±ê¸‰</th>
                                        </tr>
                                    </thead>
                                    <tbody id="deviceRetargetTableBody">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- í”Œë«í¼ë³„ ë¦¬íƒ€ê²ŸíŒ… ë·° -->
                    <div class="retargeting-tab-content" id="platformRetargetView" style="display: none;">
                        <!-- ìì—°ì–´ ì¸ì‚¬ì´íŠ¸ -->
                        <div style="padding: 20px 24px; background: linear-gradient(135deg, #f3e5f5 0%, #faf5ff 100%); border-bottom: 1px solid #e9ecef;">
                            <div style="font-size: 14px; color: #7b1fa2; font-weight: 600; margin-bottom: 8px;">ğŸ’¡ í”Œë«í¼ë³„ ë¦¬íƒ€ê²ŸíŒ… ì¸ì‚¬ì´íŠ¸</div>
                            <div style="font-size: 13px; color: #424242; line-height: 1.7;" id="platformRetargetInsightText">ë¡œë”© ì¤‘...</div>
                        </div>

                        <div class="card" style="margin: 16px; border-radius: 12px;">
                            <div style="padding: 16px 20px; border-bottom: 1px solid #e9ecef;">
                                <h4 style="font-size: 14px; font-weight: 600; color: var(--grey-800); margin: 0;">í”Œë«í¼ë³„ ë¦¬íƒ€ê²ŸíŒ… ì„±ê³¼</h4>
                                <p style="font-size: 12px; color: var(--grey-600); margin: 4px 0 0 0;">Cross-network, YouTube, Display ë“± í”Œë«í¼ë³„ ê´‘ê³  íš¨ìœ¨</p>
                            </div>
                            <div style="padding: 16px 20px; overflow-x: auto;">
                                <table class="data-table" id="platformRetargetTable" style="margin-top: 0;">
                                    <thead>
                                        <tr>
                                            <th style="min-width: 140px;">í”Œë«í¼</th>
                                            <th class="sortable-header" data-table="platform" data-column="roas" style="min-width: 100px; text-align: right;">
                                                ROAS
                                                <div class="sort-icon active"><div class="sort-arrow up"></div><div class="sort-arrow down active"></div></div>
                                            </th>
                                            <th class="sortable-header" data-table="platform" data-column="cpa" style="min-width: 100px; text-align: right;">
                                                CPA
                                                <div class="sort-icon"><div class="sort-arrow up"></div><div class="sort-arrow down"></div></div>
                                            </th>
                                            <th class="sortable-header" data-table="platform" data-column="cost" style="min-width: 120px; text-align: right;">
                                                ê´‘ê³ ë¹„
                                                <div class="sort-icon"><div class="sort-arrow up"></div><div class="sort-arrow down"></div></div>
                                            </th>
                                            <th class="sortable-header" data-table="platform" data-column="conversions" style="min-width: 80px; text-align: right;">
                                                ì „í™˜ìˆ˜
                                                <div class="sort-icon"><div class="sort-arrow up"></div><div class="sort-arrow down"></div></div>
                                            </th>
                                            <th class="sortable-header" data-table="platform" data-column="revenue" style="min-width: 120px; text-align: right;">
                                                ì „í™˜ê°’
                                                <div class="sort-icon"><div class="sort-arrow up"></div><div class="sort-arrow down"></div></div>
                                            </th>
                                            <th style="min-width: 80px; text-align: center;">íš¨ìœ¨ë“±ê¸‰</th>
                                        </tr>
                                    </thead>
                                    <tbody id="platformRetargetTableBody">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- ë…¸ì¶œê¸°ê¸°ë³„ ë¦¬íƒ€ê²ŸíŒ… ë·° -->
                    <div class="retargeting-tab-content" id="devicePlatformRetargetView" style="display: none;">
                        <!-- ìì—°ì–´ ì¸ì‚¬ì´íŠ¸ -->
                        <div style="padding: 20px 24px; background: linear-gradient(135deg, #e0f2f1 0%, #f5fffd 100%); border-bottom: 1px solid #e9ecef;">
                            <div style="font-size: 14px; color: #00796b; font-weight: 600; margin-bottom: 8px;">ğŸ’¡ ë…¸ì¶œê¸°ê¸°ë³„ ë¦¬íƒ€ê²ŸíŒ… ì¸ì‚¬ì´íŠ¸</div>
                            <div style="font-size: 13px; color: #424242; line-height: 1.7;" id="devicePlatformRetargetInsightText">ë¡œë”© ì¤‘...</div>
                        </div>

                        <div class="card" style="margin: 16px; border-radius: 12px;">
                            <div style="padding: 16px 20px; border-bottom: 1px solid #e9ecef;">
                                <h4 style="font-size: 14px; font-weight: 600; color: var(--grey-800); margin: 0;">ë…¸ì¶œê¸°ê¸°ë³„ ë¦¬íƒ€ê²ŸíŒ… ì„±ê³¼</h4>
                                <p style="font-size: 12px; color: var(--grey-600); margin: 4px 0 0 0;">Mobile app, Mobile web, Desktop ë“± ë…¸ì¶œê¸°ê¸°ë³„ ê´‘ê³  íš¨ìœ¨</p>
                            </div>
                            <div style="padding: 16px 20px; overflow-x: auto;">
                                <table class="data-table" id="devicePlatformRetargetTable" style="margin-top: 0;">
                                    <thead>
                                        <tr>
                                            <th style="min-width: 140px;">ë…¸ì¶œê¸°ê¸°</th>
                                            <th class="sortable-header" data-table="devicePlatform" data-column="roas" style="min-width: 100px; text-align: right;">
                                                ROAS
                                                <div class="sort-icon active"><div class="sort-arrow up"></div><div class="sort-arrow down active"></div></div>
                                            </th>
                                            <th class="sortable-header" data-table="devicePlatform" data-column="cpa" style="min-width: 100px; text-align: right;">
                                                CPA
                                                <div class="sort-icon"><div class="sort-arrow up"></div><div class="sort-arrow down"></div></div>
                                            </th>
                                            <th class="sortable-header" data-table="devicePlatform" data-column="cost" style="min-width: 120px; text-align: right;">
                                                ê´‘ê³ ë¹„
                                                <div class="sort-icon"><div class="sort-arrow up"></div><div class="sort-arrow down"></div></div>
                                            </th>
                                            <th class="sortable-header" data-table="devicePlatform" data-column="conversions" style="min-width: 80px; text-align: right;">
                                                ì „í™˜ìˆ˜
                                                <div class="sort-icon"><div class="sort-arrow up"></div><div class="sort-arrow down"></div></div>
                                            </th>
                                            <th class="sortable-header" data-table="devicePlatform" data-column="revenue" style="min-width: 120px; text-align: right;">
                                                ì „í™˜ê°’
                                                <div class="sort-icon"><div class="sort-arrow up"></div><div class="sort-arrow down"></div></div>
                                            </th>
                                            <th style="min-width: 80px; text-align: center;">íš¨ìœ¨ë“±ê¸‰</th>
                                        </tr>
                                    </thead>
                                    <tbody id="devicePlatformRetargetTableBody">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let insightsData = null;
        let dailyData = null;
        let dimensionData = null;
        let currentPeriod = 'full';  // ê¸°ê°„ í•„í„°: 'full', '180d', '90d'

        // í˜„ì¬ ì„ íƒëœ ê¸°ê°„ì˜ ë°ì´í„° ë°˜í™˜
        function getPeriodData() {
            if (!insightsData || !insightsData.by_period) {
                return insightsData;  // ì´ì „ êµ¬ì¡° í˜¸í™˜
            }
            return insightsData.by_period[currentPeriod] || insightsData.by_period['full'];
        }

        // ë¶„ê¸°ë³„ ì¶”ì´ ë°ì´í„° (ì „ì²´ ê¸°ê°„ë§Œ ì‚¬ìš©)
        function getSeasonalityData() {
            if (!insightsData) return null;
            // insightsData.seasonalityê°€ ìˆìœ¼ë©´ ë°˜í™˜, ì—†ìœ¼ë©´ ìµœìƒìœ„ ë ˆë²¨ì—ì„œ ì°¾ê¸°
            if (insightsData.seasonality) {
                return insightsData.seasonality;
            }
            // ìµœìƒìœ„ ë ˆë²¨ì— seasonality_analysis, seasonality_insightsê°€ ìˆëŠ” ê²½ìš°
            return {
                seasonality_analysis: insightsData.seasonality_analysis || null,
                seasonality_insights: insightsData.seasonality_insights || []
            };
        }
        let currentTimeseriesPeriod = 'daily';
        let currentTimeseriesMetric = 'roas';
        let timeseriesFilters = {
            channel: [],
            product: [],
            brand: [],
            promotion: []
        };
        let timeseriesStartDate = '';
        let timeseriesEndDate = '';
        let timeseriesTrendChart = null;
        let adsetDimensionData = null;  // ê´‘ê³ ì„¸íŠ¸ ì¶”ì´ ì „ìš© ë°ì´í„°

        // ì„±ë³„ ì¶”ì´ ê´€ë ¨ ë³€ìˆ˜
        let currentGenderFilter = 'channel';
        let currentGenderPeriod = 'daily';
        let currentGenderMetric = 'roas';
        let genderStartDate = '';
        let genderEndDate = '';
        let selectedGenderItems = [];
        let genderTrendChart = null;
        let genderDimensionData = null;  // ì„±ë³„ ì¶”ì´ ì „ìš© ë°ì´í„°

        // ì—°ë ¹ ì¶”ì´ ê´€ë ¨ ë³€ìˆ˜
        let currentAgeFilter = 'channel';
        let currentAgePeriod = 'daily';
        let currentAgeMetric = 'roas';
        let ageStartDate = '';
        let ageEndDate = '';
        let selectedAgeItems = [];
        let ageTrendChart = null;
        let ageDimensionData = null;  // ì—°ë ¹ ì¶”ì´ ì „ìš© ë°ì´í„°

        // í”Œë«í¼ ì¶”ì´ ê´€ë ¨ ë³€ìˆ˜
        let currentPlatformFilter = 'channel';
        let currentPlatformPeriod = 'daily';
        let currentPlatformMetric = 'roas';
        let platformStartDate = '';
        let platformEndDate = '';
        let selectedPlatformItems = [];
        let platformTrendChart = null;
        let platformDimensionData = null;  // í”Œë«í¼ ì¶”ì´ ì „ìš© ë°ì´í„°

        // ê¸°ê¸°í”Œë«í¼ ì¶”ì´ ê´€ë ¨ ë³€ìˆ˜
        let currentDevicePlatformFilter = 'channel';
        let currentDevicePlatformPeriod = 'daily';
        let currentDevicePlatformMetric = 'roas';
        let devicePlatformStartDate = '';
        let devicePlatformEndDate = '';
        let selectedDevicePlatformItems = [];
        let devicePlatformTrendChart = null;
        let devicePlatformDimensionData = null;  // ê¸°ê¸°í”Œë«í¼ ì¶”ì´ ì „ìš© ë°ì´í„°

        // ê¸°ê¸°ìœ í˜• ì¶”ì´ ê´€ë ¨ ë³€ìˆ˜
        let currentDeviceTypeFilter = 'channel';
        let currentDeviceTypePeriod = 'daily';
        let currentDeviceTypeMetric = 'roas';
        let deviceTypeStartDate = '';
        let deviceTypeEndDate = '';
        let selectedDeviceTypeItems = [];
        let deviceTypeTrendChart = null;
        let deviceTypeDimensionData = null;  // ê¸°ê¸°ìœ í˜• ì¶”ì´ ì „ìš© ë°ì´í„°

        // ì„±ë³„ ì—°ë ¹ PIVOT ê´€ë ¨ ë³€ìˆ˜
        let currentPivotFilters = {
            channel: [],
            product: [],
            brand: [],
            promotion: [],
            adset: []
        };
        let pivotStartDate = '';
        let pivotEndDate = '';
        let pivotDropdownsInitialized = false;
        let pivotDimensionData = null;  // ì„±ë³„ì—°ë ¹ PIVOT ì „ìš© ë°ì´í„°

        // ========== ì„±ê³¼ ìƒì„¸ ë¶„ì„ ì„¹ì…˜ ë³€ìˆ˜ (ë…ë¦½ì ) ==========
        // ê´‘ê³ ì„¸íŠ¸ ìƒì„¸
        let detailAdsetFilters = { channel: [], product: [], brand: [], promotion: [] };
        let detailAdsetMetric = 'roas';
        let detailAdsetStartDate = '';
        let detailAdsetEndDate = '';
        let detailAdsetBarChart = null;

        // ì„±ë³„ ìƒì„¸
        let detailGenderFilters = { channel: [], product: [], brand: [], promotion: [], adset: [] };
        let detailGenderMetric = 'roas';
        let detailGenderStartDate = '';
        let detailGenderEndDate = '';
        let detailGenderBarChart = null;

        // ì—°ë ¹ ìƒì„¸
        let detailAgeFilters = { channel: [], product: [], brand: [], promotion: [], adset: [] };
        let detailAgeMetric = 'roas';
        let detailAgeStartDate = '';
        let detailAgeEndDate = '';
        let detailAgeBarChart = null;

        // í”Œë«í¼ ìƒì„¸
        let detailPlatformFilters = { channel: [], product: [], brand: [], promotion: [], adset: [] };
        let detailPlatformMetric = 'roas';
        let detailPlatformStartDate = '';
        let detailPlatformEndDate = '';
        let detailPlatformBarChart = null;

        // ê¸°ê¸°í”Œë«í¼ ìƒì„¸
        let detailDevicePlatformFilters = { channel: [], product: [], brand: [], promotion: [], adset: [] };
        let detailDevicePlatformMetric = 'roas';
        let detailDevicePlatformStartDate = '';
        let detailDevicePlatformEndDate = '';
        let detailDevicePlatformBarChart = null;

        // ê¸°ê¸° ìƒì„¸
        let detailDeviceTypeFilters = { channel: [], product: [], brand: [], promotion: [], adset: [] };
        let detailDeviceTypeMetric = 'roas';
        let detailDeviceTypeStartDate = '';
        let detailDeviceTypeEndDate = '';
        let detailDeviceTypeBarChart = null;

        // ë°ì´í„° ë¡œë”©
        async function loadData() {
            try {
                // ìºì‹œ ë°©ì§€ë¥¼ ìœ„í•œ íƒ€ì„ìŠ¤íƒ¬í”„ ì¶”ê°€
                const response = await fetch('type/insights.json?t=' + Date.now());
                insightsData = await response.json();

                // ì°¨ì› ë°ì´í„° ë¡œë”© (merged_data.csv - ì¼ë³„ ë°ì´í„° í¬í•¨)
                try {
                    const dimensionResponse = await fetch('type/merged_data.csv');
                    const dimensionText = await dimensionResponse.text();
                    dimensionData = parseCSV(dimensionText);
                } catch (err) {
                    console.warn('ì°¨ì› ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:', err);
                }

                // ê´‘ê³ ì„¸íŠ¸ ì¶”ì´ ì „ìš© ë°ì´í„° ë¡œë”© (dimension_type1_campaign_adset.csv)
                try {
                    const adsetResponse = await fetch('type/dimension_type1_campaign_adset.csv');
                    const adsetText = await adsetResponse.text();
                    adsetDimensionData = parseCSV(adsetText);
                } catch (err) {
                    console.warn('ê´‘ê³ ì„¸íŠ¸ ì°¨ì› ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:', err);
                }

                // ì„±ë³„ ì¶”ì´ ì „ìš© ë°ì´í„° ë¡œë”© (dimension_type4_adset_gender.csv)
                try {
                    const genderResponse = await fetch('type/dimension_type4_adset_gender.csv');
                    const genderText = await genderResponse.text();
                    genderDimensionData = parseCSV(genderText);
                } catch (err) {
                    console.warn('ì„±ë³„ ì°¨ì› ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:', err);
                }

                // ì—°ë ¹ ì¶”ì´ ì „ìš© ë°ì´í„° ë¡œë”© (dimension_type3_adset_age.csv)
                try {
                    const ageResponse = await fetch('type/dimension_type3_adset_age.csv');
                    const ageText = await ageResponse.text();
                    ageDimensionData = parseCSV(ageText);
                } catch (err) {
                    console.warn('ì—°ë ¹ ì°¨ì› ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:', err);
                }

                // í”Œë«í¼ ì¶”ì´ ì „ìš© ë°ì´í„° ë¡œë”© (dimension_type6_adset_platform.csv)
                try {
                    const platformResponse = await fetch('type/dimension_type6_adset_platform.csv');
                    const platformText = await platformResponse.text();
                    platformDimensionData = parseCSV(platformText);
                } catch (err) {
                    console.warn('í”Œë«í¼ ì°¨ì› ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:', err);
                }

                // ê¸°ê¸°í”Œë«í¼ ì¶”ì´ ì „ìš© ë°ì´í„° ë¡œë”© (dimension_type7_adset_deviceplatform.csv)
                try {
                    const devicePlatformResponse = await fetch('type/dimension_type7_adset_deviceplatform.csv');
                    const devicePlatformText = await devicePlatformResponse.text();
                    devicePlatformDimensionData = parseCSV(devicePlatformText);
                } catch (err) {
                    console.warn('ê¸°ê¸°í”Œë«í¼ ì°¨ì› ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:', err);
                }

                // ê¸°ê¸°ìœ í˜• ì¶”ì´ ì „ìš© ë°ì´í„° ë¡œë”© (dimension_type5_adset_device.csv)
                try {
                    const deviceTypeResponse = await fetch('type/dimension_type5_adset_device.csv');
                    const deviceTypeText = await deviceTypeResponse.text();
                    deviceTypeDimensionData = parseCSV(deviceTypeText);
                } catch (err) {
                    console.warn('ê¸°ê¸°ìœ í˜• ì°¨ì› ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:', err);
                }

                // ì„±ë³„ì—°ë ¹ PIVOT ì „ìš© ë°ì´í„° ë¡œë”© (dimension_type2_adset_age_gender.csv)
                try {
                    const pivotResponse = await fetch('type/dimension_type2_adset_age_gender.csv');
                    const pivotText = await pivotResponse.text();
                    pivotDimensionData = parseCSV(pivotText);
                } catch (err) {
                    console.warn('ì„±ë³„ì—°ë ¹ PIVOT ì°¨ì› ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:', err);
                }

                // ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™”
                initDashboard();
                initTrendAnalysisFilters();
                setupEventListeners();
            } catch (error) {
                console.error('ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:', error);
                alert('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // CSV íŒŒì‹± í•¨ìˆ˜ (RFC 4180 í‘œì¤€ ì¤€ìˆ˜)
        function parseCSV(text) {
            const lines = text.trim().split('\n');

            // RFC 4180 í˜¸í™˜ CSV íŒŒì‹±
            function parseLine(line) {
                const result = [];
                let current = '';
                let inQuotes = false;

                for (let i = 0; i < line.length; i++) {
                    const char = line[i];
                    const nextChar = line[i + 1];

                    if (char === '"') {
                        if (inQuotes && nextChar === '"') {
                            // ì—°ì†ëœ ë”°ì˜´í‘œëŠ” ì´ìŠ¤ì¼€ì´í”„ëœ ë”°ì˜´í‘œ
                            current += '"';
                            i++; // ë‹¤ìŒ ë”°ì˜´í‘œ ê±´ë„ˆë›°ê¸°
                        } else {
                            // ë”°ì˜´í‘œ ëª¨ë“œ ì „í™˜
                            inQuotes = !inQuotes;
                        }
                    } else if (char === ',' && !inQuotes) {
                        // ë”°ì˜´í‘œ ë°–ì˜ ì‰¼í‘œëŠ” êµ¬ë¶„ì
                        result.push(current.trim());
                        current = '';
                    } else {
                        current += char;
                    }
                }
                // ë§ˆì§€ë§‰ í•„ë“œ ì¶”ê°€
                result.push(current.trim());
                return result;
            }

            // í—¤ë” íŒŒì‹±
            const headers = parseLine(lines[0]).map(h => h.replace(/^"|"$/g, '').trim());
            const result = [];

            // ë°ì´í„° í–‰ íŒŒì‹±
            for (let i = 1; i < lines.length; i++) {
                if (!lines[i].trim()) continue; // ë¹ˆ ì¤„ ê±´ë„ˆë›°ê¸°

                const values = parseLine(lines[i]);
                const obj = {};

                headers.forEach((header, index) => {
                    // ë”°ì˜´í‘œ ì œê±° ë° trim
                    let value = values[index] || '';
                    value = value.replace(/^"|"$/g, '').trim();
                    obj[header] = value;
                });

                result.push(obj);
            }

            return result;
        }

        // ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™”
        function initDashboard() {
            updatePeriodInfo();
            renderKPICards();
            renderDecisionTools();
            initTimeseriesDropdowns();
            initGenderDropdowns();
            initAgeDropdowns();
            initPlatformDropdowns();
            initDevicePlatformDropdowns();
            initDeviceTypeDropdowns();
            initPivotDropdowns();
            initPerformanceCharts();
            initRetargetingAnalysis();
            initDetailAnalysis();
        }

        // ê¸°ê°„ ì •ë³´ ì—…ë°ì´íŠ¸
        function updatePeriodInfo() {
            const periodData = getPeriodData();
            const period = periodData.summary.analysis_period;
            document.getElementById('period-info').textContent =
                `ë¶„ì„ ê¸°ê°„: ${period.start_date} ~ ${period.end_date} (${period.total_days}ì¼)`;
        }

        // KPI ì¹´ë“œ ë Œë”ë§
        function renderKPICards() {
            const periodData = getPeriodData();
            const overall = periodData.overall;

            // adsetDimensionData(dimension_type1_campaign_adset.csv)ì—ì„œ KPI í•©ê³„ ê³„ì‚°
            let totalCost = 0;
            let totalImpressions = 0;
            let totalClicks = 0;
            let totalConversions = 0;
            let totalRevenue = 0;

            if (adsetDimensionData && adsetDimensionData.length > 0) {
                adsetDimensionData.forEach(row => {
                    // ìº í˜ì¸ì´ë¦„, ê´‘ê³ ì„¸íŠ¸ê°€ ì¡´ì¬í•˜ëŠ” ë°ì´í„°ë§Œ
                    const hasCampaign = row['ìº í˜ì¸ì´ë¦„'] && row['ìº í˜ì¸ì´ë¦„'] !== '-';
                    const hasAdset = row['ê´‘ê³ ì„¸íŠ¸'] && row['ê´‘ê³ ì„¸íŠ¸'] !== '-';

                    if (hasCampaign && hasAdset) {
                        totalCost += parseFloat(row['ë¹„ìš©']) || 0;
                        totalImpressions += parseFloat(row['ë…¸ì¶œ']) || 0;
                        totalClicks += parseFloat(row['í´ë¦­']) || 0;
                        totalConversions += parseFloat(row['ì „í™˜ìˆ˜']) || 0;
                        totalRevenue += parseFloat(row['ì „í™˜ê°’']) || 0;
                    }
                });
            }

            // Primary KPIs (ìƒë‹¨ 5ê°œ): ë¹„ìš©, CPM, CPC, CPA, ROAS
            const cpm = totalImpressions > 0 ? (totalCost / totalImpressions * 1000) : 0;
            const cpc = totalClicks > 0 ? (totalCost / totalClicks) : 0;
            const cpa = totalConversions > 0 ? (totalCost / totalConversions) : 0;
            const roas = totalCost > 0 ? (totalRevenue / totalCost * 100) : 0;

            const html = `
                <div class="kpi-row kpi-row-primary">
                    <div class="kpi-card">
                        <h3>ì´ ë¹„ìš©</h3>
                        <div class="value">${formatCurrency(totalCost)}</div>
                        <div class="unit">ì›</div>
                    </div>
                    <div class="kpi-card">
                        <h3>CPM</h3>
                        <div class="value">${formatCurrency(cpm)}</div>
                        <div class="unit">ì›</div>
                    </div>
                    <div class="kpi-card">
                        <h3>CPC</h3>
                        <div class="value">${formatCurrency(cpc)}</div>
                        <div class="unit">ì›</div>
                    </div>
                    <div class="kpi-card">
                        <h3>CPA</h3>
                        <div class="value">${formatCurrency(cpa)}</div>
                        <div class="unit">ì›</div>
                    </div>
                    <div class="kpi-card">
                        <h3>ROAS</h3>
                        <div class="value">${formatPercent(roas)}</div>
                        <div class="unit"></div>
                    </div>
                </div>
                <div class="kpi-row kpi-row-secondary">
                    <div class="kpi-card">
                        <h3>ì´ ë…¸ì¶œ</h3>
                        <div class="value">${formatNumber(totalImpressions)}</div>
                        <div class="unit">íšŒ</div>
                    </div>
                    <div class="kpi-card">
                        <h3>ì´ í´ë¦­</h3>
                        <div class="value">${formatNumber(totalClicks)}</div>
                        <div class="unit">íšŒ</div>
                    </div>
                    <div class="kpi-card">
                        <h3>ì´ ì „í™˜ìˆ˜</h3>
                        <div class="value">${formatNumber(totalConversions)}</div>
                        <div class="unit">ê±´</div>
                    </div>
                    <div class="kpi-card">
                        <h3>ì´ ì „í™˜ê°’</h3>
                        <div class="value">${formatCurrency(totalRevenue)}</div>
                        <div class="unit">ì›</div>
                    </div>
                </div>
            `;

            document.getElementById('kpi-wrapper').innerHTML = html;
        }

        // ì•Œìˆ˜ì—†ìŒ ë°ì´í„° í•„í„°ë§ í—¬í¼ í•¨ìˆ˜
        function isValidGender(gender) {
            if (!gender || gender === '-') return false;
            const genderStr = String(gender).trim().toLowerCase();
            const unknownPattern = /^(êµ¬ë¶„ì—†ìŒ|ì•Œ\s?ìˆ˜\s?ì—†ìŒ|un.*|unknown)/i;
            return !unknownPattern.test(genderStr);
        }

        function isValidAge(age) {
            if (!age || age === '-') return false;
            const ageStr = String(age).trim().toLowerCase();
            const unknownPattern = /^(êµ¬ë¶„ì—†ìŒ|ì•Œ\s?ìˆ˜\s?ì—†ìŒ|un.*|unknown|age_range_undetermined)/i;
            return !unknownPattern.test(ageStr);
        }

        function normalizeGender(gender) {
            if (!isValidGender(gender)) return null;
            const genderStr = String(gender).trim().toLowerCase();
            if (/^(ë‚¨ì|ë‚¨ì„±|male|m)$/i.test(genderStr)) return 'ë‚¨ì„±';
            if (/^(ì—¬ì|ì—¬ì„±|female|f)$/i.test(genderStr)) return 'ì—¬ì„±';
            return gender;
        }

        // ë°ì´í„° ê¸°ë°˜ ì˜ì‚¬ê²°ì • ë„êµ¬ ë Œë”ë§
        function renderDecisionTools() {
            renderSummaryTab();
            renderOpportunityTab();
            renderWarningTab();
            renderTargetingTab();
            renderForecastTab();
            initDecisionToolTabs();
            initDecisionTooltips();
            initCardHoverTooltips();
            updatePeriodDateRange();
        }

        // ê¸°ê°„ ì „í™˜ í•¨ìˆ˜
        function switchPeriod(period) {
            currentPeriod = period;

            // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.period-filter-btn').forEach(btn => {
                if (btn.dataset.period === period) {
                    btn.style.background = '#1a73e8';
                    btn.style.color = 'white';
                    btn.style.borderColor = '#1a73e8';
                    btn.classList.add('active');
                } else {
                    btn.style.background = 'white';
                    btn.style.color = '#495057';
                    btn.style.borderColor = '#dee2e6';
                    btn.classList.remove('active');
                }
            });

            // ë‚ ì§œ ë²”ìœ„ í‘œì‹œ ì—…ë°ì´íŠ¸
            updatePeriodDateRange();

            // ëª¨ë“  íƒ­ ë‹¤ì‹œ ë Œë”ë§ (ë¶„ê¸°ë³„ ì¶”ì´ ì œì™¸)
            renderSummaryTab();
            renderOpportunityTab();
            renderWarningTab();
            renderTargetingTab();
            renderForecastTab();
            renderBudgetGuideTab();
            // ê³„ì ˆì„± ë¶„ì„ì€ ì „ì²´ ê¸°ê°„ ë°ì´í„°ë§Œ ì‚¬ìš©í•˜ë¯€ë¡œ ë‹¤ì‹œ ë Œë”ë§í•˜ì§€ ì•ŠìŒ
        }
        // ì¸ë¼ì¸ onclickì—ì„œ ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ì „ì—­ ìŠ¤ì½”í”„ì— ë…¸ì¶œ
        window.switchPeriod = switchPeriod;

        // ì„ íƒëœ ê¸°ê°„ì˜ ë‚ ì§œ ë²”ìœ„ í‘œì‹œ
        function updatePeriodDateRange() {
            const periodData = getPeriodData();
            if (periodData && periodData.summary && periodData.summary.analysis_period) {
                const ap = periodData.summary.analysis_period;
                const dateRangeEl = document.getElementById('periodDateRange');
                if (dateRangeEl) {
                    dateRangeEl.textContent = `${ap.start_date} ~ ${ap.end_date} (${ap.total_days}ì¼)`;
                }
            }
        }

        // íˆ´íŒ ì´ˆê¸°í™”
        function initDecisionTooltips() {
            // ì¸ë¼ì¸ íˆ´íŒ (? ì•„ì´ì½˜)
            document.addEventListener('mouseenter', function(e) {
                if (e.target && e.target.classList && e.target.classList.contains('inline-help-icon')) {
                    const tooltipText = e.target.getAttribute('data-tooltip');
                    if (tooltipText) {
                        showInlineTooltip(e.target, tooltipText);
                    }
                }
            }, true);

            document.addEventListener('mouseleave', function(e) {
                if (e.target && e.target.classList && e.target.classList.contains('inline-help-icon')) {
                    hideInlineTooltip();
                }
            }, true);
        }

        // ì¸ë¼ì¸ íˆ´íŒ í‘œì‹œ
        function showInlineTooltip(element, text) {
            let tooltip = document.getElementById('inlineDecisionTooltip');
            if (!tooltip) {
                tooltip = document.createElement('div');
                tooltip.id = 'inlineDecisionTooltip';
                tooltip.style.cssText = 'position: fixed; background: #1a1a2e; color: white; padding: 10px 14px; border-radius: 8px; font-size: 12px; max-width: 280px; line-height: 1.5; z-index: 10000; box-shadow: 0 4px 20px rgba(0,0,0,0.25); pointer-events: none;';
                document.body.appendChild(tooltip);
            }
            tooltip.innerHTML = text;
            tooltip.style.display = 'block';

            const rect = element.getBoundingClientRect();
            tooltip.style.left = rect.left + 'px';
            tooltip.style.top = (rect.bottom + 8) + 'px';
        }

        // ì¸ë¼ì¸ íˆ´íŒ ìˆ¨ê¸°ê¸°
        function hideInlineTooltip() {
            const tooltip = document.getElementById('inlineDecisionTooltip');
            if (tooltip) tooltip.style.display = 'none';
        }

        // ì¹´ë“œ í˜¸ë²„ íˆ´íŒ ì´ˆê¸°í™”
        function initCardHoverTooltips() {
            // ê¸€ë¡œë²Œ íˆ´íŒ ì—˜ë¦¬ë¨¼íŠ¸ ìƒì„±
            let cardTooltip = document.getElementById('cardHoverTooltip');
            if (!cardTooltip) {
                cardTooltip = document.createElement('div');
                cardTooltip.id = 'cardHoverTooltip';
                cardTooltip.className = 'card-hover-tooltip';
                document.body.appendChild(cardTooltip);
            }

            // ì´ë²¤íŠ¸ ìœ„ì„ ë°©ì‹ìœ¼ë¡œ í˜¸ë²„ ì²˜ë¦¬
            document.addEventListener('mouseenter', function(e) {
                if (!e.target || !e.target.closest) return;
                const card = e.target.closest('.hoverable-card');
                if (card && card.dataset.tooltipTitle) {
                    showCardTooltip(card, cardTooltip);
                }
            }, true);

            document.addEventListener('mouseleave', function(e) {
                if (!e.target || !e.target.closest) return;
                const card = e.target.closest('.hoverable-card');
                if (card && card.dataset.tooltipTitle) {
                    hideCardTooltip(cardTooltip);
                }
            }, true);

            document.addEventListener('mousemove', function(e) {
                if (!e.target || !e.target.closest) return;
                const card = e.target.closest('.hoverable-card');
                if (card && card.dataset.tooltipTitle && cardTooltip.classList.contains('show')) {
                    positionCardTooltip(e, cardTooltip);
                }
            }, true);
        }

        // ì¹´ë“œ íˆ´íŒ í‘œì‹œ
        function showCardTooltip(card, tooltip) {
            const title = card.dataset.tooltipTitle || '';
            const icon = card.dataset.tooltipIcon || 'ğŸ’¡';
            const insight = card.dataset.tooltipInsight || '';
            const recommendation = card.dataset.tooltipRecommendation || '';

            let html = `
                <div class="card-tooltip-header">
                    <span class="card-tooltip-header-icon">${icon}</span>
                    <span class="card-tooltip-header-title">${title}</span>
                </div>
            `;

            if (insight) {
                html += `
                    <div class="card-tooltip-insight">
                        <div class="card-tooltip-insight-label">ğŸ’¡ ì¸ì‚¬ì´íŠ¸</div>
                        <div class="card-tooltip-insight-text">${insight}</div>
                    </div>
                `;
            }

            if (recommendation) {
                html += `
                    <div class="card-tooltip-recommendation">
                        <div class="card-tooltip-recommendation-label">âœ… í™œìš© íŒ</div>
                        <div class="card-tooltip-recommendation-text">${recommendation}</div>
                    </div>
                `;
            }

            tooltip.innerHTML = html;
            tooltip.classList.add('show');
        }

        // ì¹´ë“œ íˆ´íŒ ìœ„ì¹˜ ì¡°ì •
        function positionCardTooltip(e, tooltip) {
            const padding = 15;
            const viewportWidth = window.innerWidth;
            const viewportHeight = window.innerHeight;
            const tooltipWidth = tooltip.offsetWidth;
            const tooltipHeight = tooltip.offsetHeight;

            let left = e.clientX + padding;
            let top = e.clientY + padding;

            // ì˜¤ë¥¸ìª½ í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ë©´ ì™¼ìª½ì— í‘œì‹œ
            if (left + tooltipWidth > viewportWidth - padding) {
                left = e.clientX - tooltipWidth - padding;
            }

            // ì•„ë˜ í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ë©´ ìœ„ì— í‘œì‹œ
            if (top + tooltipHeight > viewportHeight - padding) {
                top = e.clientY - tooltipHeight - padding;
            }

            // ìµœì†Œê°’ ë³´ì •
            if (left < padding) left = padding;
            if (top < padding) top = padding;

            tooltip.style.left = left + 'px';
            tooltip.style.top = top + 'px';
        }

        // ì¹´ë“œ íˆ´íŒ ìˆ¨ê¸°ê¸°
        function hideCardTooltip(tooltip) {
            tooltip.classList.remove('show');
        }

        // íƒ­ 0: ì˜¤ëŠ˜ì˜ ìš”ì•½ (ìƒˆë¡œìš´ ë©”ì¸ íƒ­)
        function renderSummaryTab() {
            const periodData = getPeriodData();
            const summary = periodData.summary || {};
            const summaryCard = periodData.summary_card || null;
            const topRecommendations = periodData.top_recommendations || [];
            const topCategories = periodData.top_categories || [];
            const productPerformance = periodData.product_performance || [];
            const genderData = (periodData.gender_performance || []).filter(g => isValidGender(g.gender));
            const timeseries = periodData.timeseries || {};

            const avgRoas = summary.overall_roas || 0;
            const avgCpa = summary.overall_cpa || 0;
            const totalConversions = summary.total_conversions || 0;
            const totalRevenue = summary.total_revenue || 0;
            const totalCost = summary.total_cost || 0;

            // ì„±ê³¼ ìƒíƒœ íŒë‹¨
            const roasStatus = avgRoas >= 200 ? 'excellent' : avgRoas >= 150 ? 'good' : avgRoas >= 100 ? 'normal' : 'warning';
            const statusConfig = {
                excellent: { text: 'ë§¤ìš° ì¢‹ìŒ', color: '#00c853', bg: '#e8f5e9', icon: 'ğŸ‰' },
                good: { text: 'ì–‘í˜¸', color: '#2e7d32', bg: '#e8f5e9', icon: 'ğŸ‘' },
                normal: { text: 'ë³´í†µ', color: '#f57c00', bg: '#fff3e0', icon: 'ğŸ“Š' },
                warning: { text: 'ê°œì„  í•„ìš”', color: '#d32f2f', bg: '#ffebee', icon: 'âš ï¸' }
            };
            const status = statusConfig[roasStatus];

            // ìµœê³ /ìµœì € ì„±ê³¼ ì°¾ê¸°
            const sortedByRoas = [...topCategories].sort((a, b) => b.roas - a.roas);
            const sortedByCpa = [...topCategories].sort((a, b) => a.cpa - b.cpa);
            const topChannel = sortedByRoas[0];
            const lowCpaChannel = sortedByCpa[0];

            // ì›”ë³„ ì¶”ì„¸ì—ì„œ ìµœê·¼ ë³€í™” ê³„ì‚°
            let recentTrend = '';
            let trendIcon = '';
            if (timeseries.monthly_growth && timeseries.monthly_growth.length > 0) {
                const lastMonth = timeseries.monthly_growth[timeseries.monthly_growth.length - 1];
                if (lastMonth.roas_change > 10) {
                    recentTrend = `ì§€ë‚œë‹¬ ëŒ€ë¹„ ROAS ${lastMonth.roas_change.toFixed(1)}%p ìƒìŠ¹`;
                    trendIcon = 'ğŸ“ˆ';
                } else if (lastMonth.roas_change < -10) {
                    recentTrend = `ì§€ë‚œë‹¬ ëŒ€ë¹„ ROAS ${Math.abs(lastMonth.roas_change).toFixed(1)}%p í•˜ë½`;
                    trendIcon = 'ğŸ“‰';
                } else {
                    recentTrend = 'ì§€ë‚œë‹¬ê³¼ ë¹„ìŠ·í•œ ì„±ê³¼ ìœ ì§€ ì¤‘';
                    trendIcon = 'â¡ï¸';
                }
            }

            // ì„ íƒëœ ê¸°ê°„ ì •ë³´
            const periodLabels = {'full': 'ì „ì²´ ê¸°ê°„', '180d': 'ìµœê·¼ 180ì¼', '90d': 'ìµœê·¼ 90ì¼'};
            const currentPeriodLabel = periodLabels[currentPeriod] || 'ì „ì²´ ê¸°ê°„';

            let html = '';

            // 0. AI ì»¨ì„¤í„´íŠ¸ ì¢…í•© ì§„ë‹¨ ì¹´ë“œ (summary_card)
            if (summaryCard) {
                html += `
                    <div style="margin-bottom: 20px; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 16px; color: white; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);">
                        <div style="display: flex; align-items: flex-start; gap: 16px;">
                            <div style="font-size: 48px; line-height: 1;">ğŸ¤–</div>
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                    <span style="font-size: 18px; font-weight: 700;">${summaryCard.title || 'ë§ˆì¼€íŒ… ì¢…í•© ì§„ë‹¨'}</span>
                                    <span style="font-size: 11px; background: rgba(255,255,255,0.25); padding: 3px 10px; border-radius: 12px; margin-left: auto;">${currentPeriodLabel} ê¸°ì¤€</span>
                                </div>
                                <div style="display: flex; flex-wrap: wrap; gap: 12px; margin-bottom: 12px;">
                                    <div style="padding: 6px 14px; background: rgba(255,255,255,0.2); border-radius: 20px; font-size: 13px; font-weight: 600;">
                                        ${summaryCard.total_roas_formatted || 'ROAS ' + formatPercent(avgRoas)}
                                    </div>
                                    <div style="padding: 6px 14px; background: rgba(255,255,255,0.2); border-radius: 20px; font-size: 13px; font-weight: 600;">
                                        ë§¤ì¶œ ${summaryCard.total_revenue_formatted || formatCurrency(totalRevenue)}
                                    </div>
                                    <div style="padding: 6px 14px; background: rgba(255,255,255,0.2); border-radius: 20px; font-size: 13px; font-weight: 600;">
                                        ë¹„ìš© ${summaryCard.total_cost_formatted || formatCurrency(totalCost)}
                                    </div>
                                </div>
                                <div style="font-size: 14px; opacity: 0.95; line-height: 1.7; padding: 12px; background: rgba(255,255,255,0.15); border-radius: 10px;">
                                    ${summaryCard.message || ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            // 1. í•µì‹¬ ì§€í‘œ ëŒ€ì‹œë³´ë“œ (ì¹´ë“œ í˜•íƒœ) - í˜¸ë²„ íˆ´íŒ ì ìš©
            html += `
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 20px;">
                    <!-- ì „ì²´ ROAS -->
                    <div class="hoverable-card"
                         data-tooltip-title="ROAS (ê´‘ê³ ìˆ˜ìµë¥ )"
                         data-tooltip-icon="ğŸ“ˆ"
                         data-tooltip-insight="ê´‘ê³ ë¹„ ëŒ€ë¹„ ë§¤ì¶œ ë¹„ìœ¨ì…ë‹ˆë‹¤. ROAS 200%ëŠ” 1ë§Œì› ê´‘ê³ ë¹„ë¡œ 2ë§Œì› ë§¤ì¶œì„ ì˜¬ë ¸ë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤."
                         data-tooltip-recommendation="ROAS 100% ì´ìƒì´ë©´ ìˆ˜ìµ ë°œìƒ, 200% ì´ìƒì´ë©´ íš¨ìœ¨ì ì¸ ê´‘ê³ ì…ë‹ˆë‹¤."
                         style="padding: 16px; background: ${status.bg}; border-radius: 12px; border: 1px solid ${status.color}20; position: relative;">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                            <div>
                                <div style="font-size: 11px; color: var(--grey-600); margin-bottom: 4px;">ROAS</div>
                                <div style="font-size: 24px; font-weight: 800; color: ${status.color};">${formatPercent(avgRoas)}</div>
                            </div>
                            <div style="padding: 4px 8px; background: ${status.color}; color: white; border-radius: 12px; font-size: 10px; font-weight: 600;">
                                ${status.icon} ${status.text}
                            </div>
                        </div>
                    </div>

                    <!-- CPA -->
                    <div class="hoverable-card"
                         data-tooltip-title="CPA (ì „í™˜ë‹¹ ë¹„ìš©)"
                         data-tooltip-icon="ğŸ’°"
                         data-tooltip-insight="ì „í™˜ 1ê±´ë‹¹ ë“œëŠ” ë¹„ìš©ì…ë‹ˆë‹¤. CPA 10,000ì›ì´ë©´ êµ¬ë§¤ 1ê±´ì— ê´‘ê³ ë¹„ 1ë§Œì›ì´ ë“ ë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤."
                         data-tooltip-recommendation="CPAê°€ ë‚®ì„ìˆ˜ë¡ íš¨ìœ¨ì ì…ë‹ˆë‹¤. ìƒí’ˆ ë§ˆì§„ ëŒ€ë¹„ CPAë¥¼ í™•ì¸í•˜ì„¸ìš”."
                         style="padding: 16px; background: #e3f2fd; border-radius: 12px; border: 1px solid #90caf920;">
                        <div style="font-size: 11px; color: var(--grey-600); margin-bottom: 4px;">CPA</div>
                        <div style="font-size: 24px; font-weight: 800; color: #1565c0;">${formatCurrency(avgCpa)}</div>
                    </div>

                    <!-- ì´ ì „í™˜ -->
                    <div class="hoverable-card"
                         data-tooltip-title="ì´ ì „í™˜ìˆ˜"
                         data-tooltip-icon="ğŸ¯"
                         data-tooltip-insight="ê´‘ê³ ë¥¼ í†µí•´ ë°œìƒí•œ êµ¬ë§¤, ê°€ì… ë“±ì˜ ëª©í‘œ í–‰ë™ ìˆ˜ì…ë‹ˆë‹¤."
                         data-tooltip-recommendation="ì „í™˜ìˆ˜ê°€ ë§ì„ìˆ˜ë¡ ê´‘ê³ ê°€ ì˜ ë™ì‘í•˜ê³  ìˆìŠµë‹ˆë‹¤."
                         style="padding: 16px; background: #f3e5f5; border-radius: 12px; border: 1px solid #ce93d820;">
                        <div style="font-size: 11px; color: var(--grey-600); margin-bottom: 4px;">ì´ ì „í™˜ìˆ˜</div>
                        <div style="font-size: 24px; font-weight: 800; color: #7b1fa2;">${formatNumber(totalConversions)}</div>
                    </div>

                    <!-- ì´ ë§¤ì¶œ -->
                    <div class="hoverable-card"
                         data-tooltip-title="ì´ ë§¤ì¶œ"
                         data-tooltip-icon="ğŸ’µ"
                         data-tooltip-insight="ê´‘ê³ ë¥¼ í†µí•´ ë°œìƒí•œ ì´ ë§¤ì¶œ ê¸ˆì•¡ì…ë‹ˆë‹¤."
                         data-tooltip-recommendation="ë§¤ì¶œ ëŒ€ë¹„ ê´‘ê³ ë¹„ ë¹„ìœ¨ì„ í™•ì¸í•˜ì—¬ ìˆ˜ìµì„±ì„ ì ê²€í•˜ì„¸ìš”."
                         style="padding: 16px; background: #fff8e1; border-radius: 12px; border: 1px solid #ffcc8020;">
                        <div style="font-size: 11px; color: var(--grey-600); margin-bottom: 4px;">ì´ ë§¤ì¶œ</div>
                        <div style="font-size: 24px; font-weight: 800; color: #f57c00;">${formatCurrency(totalRevenue)}</div>
                    </div>
                </div>
            `;

            // 2. í•œì¤„ ìš”ì•½ (ìŠ¤í† ë¦¬í…”ë§)
            html += `
                <div style="margin-bottom: 20px; padding: 16px 20px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 12px; border-left: 4px solid ${status.color};">
                    <div style="font-size: 14px; color: var(--grey-900); line-height: 1.7;">
                        <span style="font-size: 18px; margin-right: 8px;">${trendIcon}</span>
                        ${recentTrend ? `<strong>${recentTrend}</strong>ì…ë‹ˆë‹¤. ` : ''}
                        ${topChannel ? `í˜„ì¬ <strong style="color: #2e7d32;">${topChannel.name}</strong> ì±„ë„ì´ ROAS ${formatPercent(topChannel.roas)}ë¡œ ê°€ì¥ ì¢‹ì€ ì„±ê³¼ë¥¼ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤.` : ''}
                    </div>
                </div>
            `;

            // 2.5. ì•¡ì…˜ ê°€ì´ë“œ ì„¹ì…˜ (í•˜ìœ„ íƒ­: ì§€ê¸ˆ ë°”ë¡œ í•  ìˆ˜ ìˆëŠ” ì¼ / AI í•µì‹¬ ì¶”ì²œ)
            const hasRecommendations = topRecommendations && topRecommendations.length > 0;

            // Severity ê¸°ì¤€ ì •ë ¬ (highê°€ ê°€ì¥ ìƒìœ„)
            const recsSeverityOrder = { 'high': 0, 'warning': 1, 'opportunity': 2, 'info': 3 };
            const sortBySeverity = (a, b) => {
                const orderA = recsSeverityOrder[a.severity] !== undefined ? recsSeverityOrder[a.severity] : 4;
                const orderB = recsSeverityOrder[b.severity] !== undefined ? recsSeverityOrder[b.severity] : 4;
                return orderA - orderB;
            };

            const urgentRecs = topRecommendations
                .filter(r => r.priority === 'high' || r.severity === 'high')
                .sort(sortBySeverity);
            const otherRecs = topRecommendations
                .filter(r => r.priority !== 'high' && r.severity !== 'high')
                .sort(sortBySeverity);

            html += `
                <div style="margin-bottom: 20px; border: 1px solid var(--grey-200); border-radius: 12px; overflow: hidden;">
                    <!-- í•˜ìœ„ íƒ­ í—¤ë” -->
                    <div style="display: flex; background: #f8f9fa; border-bottom: 1px solid var(--grey-200);">
                        <button class="action-guide-tab active" data-action-tab="quickAction"
                                style="flex: 1; padding: 12px 16px; font-size: 12px; font-weight: 600; border: none; background: white; color: var(--primary-main); cursor: pointer; border-bottom: 2px solid var(--primary-main); transition: all 0.2s;">
                            âœ… ì§€ê¸ˆ ë°”ë¡œ í•  ìˆ˜ ìˆëŠ” ì¼
                        </button>
                        <button class="action-guide-tab" data-action-tab="aiRecommend"
                                style="flex: 1; padding: 12px 16px; font-size: 12px; font-weight: 600; border: none; background: #f8f9fa; color: var(--grey-600); cursor: pointer; border-bottom: 2px solid transparent; transition: all 0.2s;">
                            ğŸ¯ AI í•µì‹¬ ì¶”ì²œ ${urgentRecs.length > 0 ? '<span style="padding: 2px 6px; background: #ff5722; color: white; border-radius: 8px; font-size: 10px; margin-left: 4px;">' + urgentRecs.length + '</span>' : ''}
                        </button>
                    </div>

                    <!-- íƒ­ 1: ì§€ê¸ˆ ë°”ë¡œ í•  ìˆ˜ ìˆëŠ” ì¼ -->
                    <div id="quickActionContent" class="action-guide-content" style="padding: 16px;">
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;">
            `;

            // ì•¡ì…˜ 1: í™•ëŒ€í•  ì±„ë„
            if (topChannel && topChannel.roas >= 200) {
                html += `
                    <div style="padding: 14px; background: #e8f5e9; border-radius: 10px; border-left: 3px solid #4caf50;">
                        <div style="font-size: 11px; color: #2e7d32; font-weight: 600; margin-bottom: 6px;">ğŸ”¥ ì˜ˆì‚° ëŠ˜ë¦¬ê¸°</div>
                        <div style="font-size: 12px; color: var(--grey-800); line-height: 1.5;">
                            <strong>${topChannel.name}</strong> ì±„ë„ì— ì˜ˆì‚°ì„ <strong>10-20%</strong> ë” íˆ¬ìí•˜ì„¸ìš”
                        </div>
                        <div style="font-size: 10px; color: var(--grey-500); margin-top: 6px;">ROAS ${formatPercent(topChannel.roas)}</div>
                    </div>
                `;
            } else {
                html += `
                    <div style="padding: 14px; background: #e3f2fd; border-radius: 10px; border-left: 3px solid #2196f3;">
                        <div style="font-size: 11px; color: #1565c0; font-weight: 600; margin-bottom: 6px;">ğŸ“Š ì„±ê³¼ ë¶„ì„</div>
                        <div style="font-size: 12px; color: var(--grey-800); line-height: 1.5;">
                            ì±„ë„ë³„ ì„±ê³¼ë¥¼ ë¹„êµí•˜ì—¬ <strong>ê°€ì¥ íš¨ìœ¨ì ì¸ ì±„ë„</strong>ì„ ì°¾ì•„ë³´ì„¸ìš”
                        </div>
                    </div>
                `;
            }

            // ì•¡ì…˜ 2: CPA ìµœì í™”
            if (lowCpaChannel) {
                html += `
                    <div style="padding: 14px; background: #e3f2fd; border-radius: 10px; border-left: 3px solid #1976d2;">
                        <div style="font-size: 11px; color: #1565c0; font-weight: 600; margin-bottom: 6px;">ğŸ’° ë¹„ìš© íš¨ìœ¨í™”</div>
                        <div style="font-size: 12px; color: var(--grey-800); line-height: 1.5;">
                            <strong>${lowCpaChannel.name}</strong>ì´ ì „í™˜ë‹¹ ë¹„ìš©ì´ ê°€ì¥ ë‚®ìŠµë‹ˆë‹¤
                        </div>
                        <div style="font-size: 10px; color: var(--grey-500); margin-top: 6px;">CPA ${formatCurrency(lowCpaChannel.cpa)}</div>
                    </div>
                `;
            }

            // ì•¡ì…˜ 3: ê°œì„  í•„ìš”
            const poorChannel = sortedByRoas.length > 0 ? sortedByRoas[sortedByRoas.length - 1] : null;
            if (poorChannel && poorChannel.roas < 100) {
                html += `
                    <div style="padding: 14px; background: #fff3e0; border-radius: 10px; border-left: 3px solid #f57c00;">
                        <div style="font-size: 11px; color: #e65100; font-weight: 600; margin-bottom: 6px;">âš ï¸ ì ê²€ í•„ìš”</div>
                        <div style="font-size: 12px; color: var(--grey-800); line-height: 1.5;">
                            <strong>${poorChannel.name}</strong> ì±„ë„ì˜ ê´‘ê³  ì†Œì¬ë¥¼ êµì²´í•´ë³´ì„¸ìš”
                        </div>
                        <div style="font-size: 10px; color: var(--grey-500); margin-top: 6px;">ROAS ${formatPercent(poorChannel.roas)}</div>
                    </div>
                `;
            } else {
                html += `
                    <div style="padding: 14px; background: #f3e5f5; border-radius: 10px; border-left: 3px solid #9c27b0;">
                        <div style="font-size: 11px; color: #7b1fa2; font-weight: 600; margin-bottom: 6px;">ğŸ¯ íƒ€ê²Ÿ ìµœì í™”</div>
                        <div style="font-size: 12px; color: var(--grey-800); line-height: 1.5;">
                            'íƒ€ê²Ÿ ë¶„ì„' íƒ­ì—ì„œ ê°€ì¥ íš¨ê³¼ì ì¸ <strong>ê³ ê°ì¸µ</strong>ì„ í™•ì¸í•˜ì„¸ìš”
                        </div>
                    </div>
                `;
            }

            html += `</div></div>`;

            // íƒ­ 2: AI í•µì‹¬ ì¶”ì²œ (ì ‘ê¸°/í¼ì¹˜ê¸°)
            html += `<div id="aiRecommendContent" class="action-guide-content" style="padding: 16px; display: none;">`;

            if (hasRecommendations) {
                // ê¸´ê¸‰ ì¹´ë“œ (í•­ìƒ í‘œì‹œ, ìµœëŒ€ 3ê°œ)
                const urgentToShow = urgentRecs.slice(0, 3);
                const remainingRecs = [...urgentRecs.slice(3), ...otherRecs];

                if (urgentToShow.length > 0) {
                    html += `<div style="display: flex; flex-direction: column; gap: 10px;">`;
                    urgentToShow.forEach((rec, idx) => {
                        html += renderRecommendationCard(rec, idx);
                    });
                    html += `</div>`;
                }

                // ë‚˜ë¨¸ì§€ ì¶”ì²œ (ì ‘ê¸°/í¼ì¹˜ê¸°) - ë”ë³´ê¸°/ì ‘ê¸° ë²„íŠ¼ ë¶„ë¦¬
                if (remainingRecs.length > 0) {
                    const recsToggleId = 'recsToggle_' + Date.now();
                    html += `
                        <div id="${recsToggleId}_showMore" style="text-align: center; margin-top: 12px;">
                            <button class="show-more-btn" onclick="document.getElementById('${recsToggleId}_content').style.display='block'; document.getElementById('${recsToggleId}_showMore').style.display='none';">
                                ë” ë³´ê¸° (${remainingRecs.length}ê±´)
                            </button>
                        </div>
                        <div id="${recsToggleId}_content" style="display: none; margin-top: 12px;">
                            <div style="display: flex; flex-direction: column; gap: 10px;">
                    `;
                    remainingRecs.forEach((rec, idx) => {
                        html += renderRecommendationCard(rec, idx + urgentToShow.length);
                    });
                    html += `
                            </div>
                            <div style="text-align: center; margin-top: 12px;">
                                <button class="show-more-btn" onclick="document.getElementById('${recsToggleId}_content').style.display='none'; document.getElementById('${recsToggleId}_showMore').style.display='block';">
                                    ì ‘ê¸°
                                </button>
                            </div>
                        </div>`;
                }

                if (urgentToShow.length === 0 && remainingRecs.length === 0) {
                    html += `<div style="text-align: center; padding: 20px; color: var(--grey-500);">í˜„ì¬ AI ì¶”ì²œ ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
                }
            } else {
                html += `<div style="text-align: center; padding: 20px; color: var(--grey-500);">í˜„ì¬ AI ì¶”ì²œ ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
            }

            html += `</div></div>`;

            // ì¶”ì²œ ì¹´ë“œ ë Œë”ë§ í—¬í¼ í•¨ìˆ˜
            function renderRecommendationCard(rec, idx) {
                const severityConfig = {
                    'high': { border: '#ef5350', bg: '#ffebee', icon: 'ğŸš¨' },
                    'warning': { border: '#ff9800', bg: '#fff3e0', icon: 'âš ï¸' },
                    'opportunity': { border: '#4caf50', bg: '#e8f5e9', icon: 'ğŸš€' },
                    'info': { border: '#2196f3', bg: '#e3f2fd', icon: 'ğŸ’¡' }
                };
                const config = severityConfig[rec.severity] || severityConfig['info'];
                const priorityBadge = rec.priority === 'high' ? '<span style="padding: 2px 8px; background: #ff5722; color: white; border-radius: 10px; font-size: 9px; font-weight: 700; margin-left: 8px;">ê¸´ê¸‰</span>' : '';

                return `
                    <div style="padding: 14px 16px; background: ${config.bg}; border-radius: 12px; border-left: 4px solid ${config.border};">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 6px;">
                            <div style="font-size: 13px; font-weight: 700; color: var(--grey-900);">
                                ${rec.title || config.icon + ' ì¶”ì²œ ' + (idx + 1)}${priorityBadge}
                            </div>
                            ${rec.category ? '<span style="padding: 2px 8px; background: rgba(0,0,0,0.08); border-radius: 10px; font-size: 10px; color: var(--grey-600);">' + rec.category + '</span>' : ''}
                        </div>
                        <div style="font-size: 12px; color: var(--grey-700); line-height: 1.6; margin-bottom: 8px;">
                            ${rec.message || ''}
                        </div>
                        ${rec.action ? '<div style="padding: 10px 12px; background: rgba(255,255,255,0.7); border-radius: 8px; border: 1px dashed ' + config.border + ';"><div style="font-size: 10px; color: ' + config.border + '; font-weight: 600; margin-bottom: 4px;">ğŸ’¡ ì‹¤í–‰ ê°€ì´ë“œ</div><div style="font-size: 11px; color: var(--grey-800); line-height: 1.5;">' + rec.action + '</div></div>' : ''}
                        ${rec.expected_impact ? '<div style="margin-top: 8px; font-size: 10px; color: #2e7d32; font-weight: 600;">ğŸ“ˆ ê¸°ëŒ€ íš¨ê³¼: ' + rec.expected_impact + '</div>' : ''}
                    </div>
                `;
            }

            // 4. ì±„ë„ ì„±ê³¼ ìˆœìœ„ (ì»´íŒ©íŠ¸ í…Œì´ë¸”) - í˜¸ë²„ íˆ´íŒ ì ìš©
            if (topCategories.length > 0) {
                html += `
                    <div class="hoverable-card"
                         data-tooltip-title="ì±„ë„ë³„ ì„±ê³¼ ìˆœìœ„"
                         data-tooltip-icon="ğŸ“Š"
                         data-tooltip-insight="ROAS ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬ëœ ìƒìœ„ 5ê°œ ì±„ë„ì…ë‹ˆë‹¤."
                         data-tooltip-recommendation="ğŸ”¥ í™•ëŒ€: ì˜ˆì‚° ì¦ì•¡ ì¶”ì²œ | âœ“ ìœ ì§€: í˜„ì¬ ì „ëµ ìœ ì§€ | âš ï¸ ê²€í† : ê°œì„  í•„ìš”"
                         style="padding: 16px; background: white; border-radius: 12px; border: 1px solid var(--grey-200);">
                        <div style="font-size: 13px; font-weight: 700; color: var(--grey-900); margin-bottom: 12px;">
                            ğŸ“Š ì±„ë„ë³„ ì„±ê³¼ ìˆœìœ„
                        </div>
                        <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                            <thead>
                                <tr style="background: #f5f5f5; border-radius: 8px;">
                                    <th style="padding: 10px 12px; text-align: left; font-weight: 600; color: var(--grey-700);">ì±„ë„</th>
                                    <th style="padding: 10px 8px; text-align: right; font-weight: 600; color: var(--grey-700);">ROAS</th>
                                    <th style="padding: 10px 8px; text-align: right; font-weight: 600; color: var(--grey-700);">CPA</th>
                                    <th style="padding: 10px 8px; text-align: center; font-weight: 600; color: var(--grey-700);">ê¶Œì¥</th>
                                </tr>
                            </thead>
                            <tbody>
                `;

                sortedByRoas.slice(0, 5).forEach((cat, idx) => {
                    const roasLevel = cat.roas > 200 ? 'high' : cat.roas > 100 ? 'mid' : 'low';
                    let verdict = '', verdictColor = '', verdictBg = '';
                    if (roasLevel === 'high') {
                        verdict = 'ğŸ”¥ í™•ëŒ€'; verdictColor = '#2e7d32'; verdictBg = '#e8f5e9';
                    } else if (roasLevel === 'low') {
                        verdict = 'âš ï¸ ê²€í† '; verdictColor = '#e65100'; verdictBg = '#fff3e0';
                    } else {
                        verdict = 'âœ“ ìœ ì§€'; verdictColor = '#757575'; verdictBg = '#f5f5f5';
                    }

                    const medal = idx === 0 ? 'ğŸ¥‡' : idx === 1 ? 'ğŸ¥ˆ' : idx === 2 ? 'ğŸ¥‰' : '';

                    html += `
                        <tr style="border-bottom: 1px solid #f0f0f0;">
                            <td style="padding: 10px 12px; font-weight: 500;">${medal} ${cat.name}</td>
                            <td style="padding: 10px 8px; text-align: right; font-weight: 700; color: ${roasLevel === 'high' ? '#2e7d32' : roasLevel === 'low' ? '#d32f2f' : 'var(--grey-900)'};">${formatPercent(cat.roas)}</td>
                            <td style="padding: 10px 8px; text-align: right; color: var(--grey-700);">${formatCurrency(cat.cpa)}</td>
                            <td style="padding: 10px 8px; text-align: center;">
                                <span style="display: inline-block; padding: 3px 8px; background: ${verdictBg}; color: ${verdictColor}; border-radius: 10px; font-size: 10px; font-weight: 600;">${verdict}</span>
                            </td>
                        </tr>
                    `;
                });

                html += `</tbody></table></div>`;
            }

            document.getElementById('summaryContent').innerHTML = html;

            // ì•¡ì…˜ ê°€ì´ë“œ íƒ­ ì´ë²¤íŠ¸ ì´ˆê¸°í™”
            initActionGuideTabs();
        }

        // ì•¡ì…˜ ê°€ì´ë“œ í•˜ìœ„ íƒ­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
        function initActionGuideTabs() {
            const tabs = document.querySelectorAll('.action-guide-tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const targetTab = this.dataset.actionTab;

                    // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
                    tabs.forEach(t => {
                        t.classList.remove('active');
                        t.style.background = '#f8f9fa';
                        t.style.color = 'var(--grey-600)';
                        t.style.borderBottom = '2px solid transparent';
                    });

                    // í´ë¦­í•œ íƒ­ í™œì„±í™”
                    this.classList.add('active');
                    this.style.background = 'white';
                    this.style.color = 'var(--primary-main)';
                    this.style.borderBottom = '2px solid var(--primary-main)';

                    // ëª¨ë“  ì»¨í…ì¸  ìˆ¨ê¸°ê¸°
                    document.querySelectorAll('.action-guide-content').forEach(content => {
                        content.style.display = 'none';
                    });

                    // í•´ë‹¹ ì»¨í…ì¸  í‘œì‹œ
                    const contentId = targetTab === 'quickAction' ? 'quickActionContent' : 'aiRecommendContent';
                    const targetContent = document.getElementById(contentId);
                    if (targetContent) {
                        targetContent.style.display = 'block';
                    }
                });
            });
        }

        // íƒ­ 1: ì„±ê³¼ ê¸°íšŒ ë¶„ì„ (ì»´íŒ©íŠ¸ + ìŠ¤í† ë¦¬í…”ë§)
        function renderOpportunityTab() {
            const periodData = getPeriodData();
            const topCategories = periodData.top_categories || [];
            const summary = periodData.summary || {};
            const productPerformance = periodData.product_performance || [];
            const topAdsets = periodData.top_adsets || [];

            const avgCpa = summary.overall_cpa || 0;
            const avgRoas = summary.overall_roas || 0;

            // ì„ íƒëœ ê¸°ê°„ ì •ë³´
            const periodLabels = {'full': 'ì „ì²´ ê¸°ê°„', '180d': 'ìµœê·¼ 180ì¼', '90d': 'ìµœê·¼ 90ì¼'};
            const currentPeriodLabel = periodLabels[currentPeriod] || 'ì „ì²´ ê¸°ê°„';

            // ROAS ë†’ì€ ìˆœìœ¼ë¡œ ì •ë ¬
            const sortedByRoas = [...topCategories].sort((a, b) => b.roas - a.roas);
            const goodChannels = sortedByRoas.filter(c => c.roas >= 200);
            const sortedProducts = [...productPerformance].sort((a, b) => b.roas - a.roas);
            const goodProducts = sortedProducts.filter(p => p.roas >= 150);

            let html = '';

            // ì¸íŠ¸ë¡œ ë©”ì‹œì§€ - í˜¸ë²„ íˆ´íŒ ì ìš© (ê¸°ê°„ í‘œì‹œ ì¶”ê°€)
            html += `
                <div class="hoverable-card"
                     data-tooltip-title="ì˜ˆì‚° í™•ëŒ€ ê¸°íšŒ"
                     data-tooltip-icon="ğŸ¯"
                     data-tooltip-insight="ROASê°€ ë†’ë‹¤ëŠ” ê²ƒì€ ê´‘ê³ ë¹„ë¥¼ ì“¸ìˆ˜ë¡ ë” ë§ì€ ë§¤ì¶œì´ ë°œìƒí•œë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤."
                     data-tooltip-recommendation="íš¨ìœ¨ì´ ê²€ì¦ëœ ê³³ì— íˆ¬ìë¥¼ ì§‘ì¤‘í•˜ì„¸ìš”. ì˜ˆì‚° ì¦ì•¡ ì‹œ ì„±ê³¼ ìƒìŠ¹ì´ ê¸°ëŒ€ë©ë‹ˆë‹¤."
                     style="margin-bottom: 16px; padding: 16px 20px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8f4 100%); border-radius: 12px; border-left: 4px solid #4caf50;">
                    <div style="display: flex; align-items: flex-start; gap: 12px;">
                        <span style="font-size: 28px;">ğŸ¯</span>
                        <div style="flex: 1;">
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                                <span style="font-size: 14px; font-weight: 700; color: #2e7d32;">ì„±ê³¼ê°€ ì¢‹ì€ ê³³ì— ë” íˆ¬ìí•˜ì„¸ìš”</span>
                                <span style="font-size: 10px; color: #4caf50; background: rgba(76, 175, 80, 0.1); padding: 2px 8px; border-radius: 10px; margin-left: auto;">${currentPeriodLabel} ê¸°ì¤€</span>
                            </div>
                            <div style="font-size: 12px; color: var(--grey-700); line-height: 1.6;">
                                ì•„ë˜ëŠ” <strong>ì˜ˆì‚°ì„ ëŠ˜ë¦¬ë©´ ë” ì¢‹ì€ ì„±ê³¼</strong>ë¥¼ ë‚¼ ìˆ˜ ìˆëŠ” ì±„ë„ê³¼ ìƒí’ˆì…ë‹ˆë‹¤.
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // 1. í™•ëŒ€ ì¶”ì²œ ì±„ë„ (ROAS 200% ì´ìƒ)
            if (goodChannels.length > 0) {
                html += `
                    <div style="margin-bottom: 16px;">
                        <div style="font-size: 13px; font-weight: 700; color: var(--grey-900); margin-bottom: 10px; display: flex; align-items: center; gap: 6px;">
                            ğŸ”¥ ì˜ˆì‚° í™•ëŒ€ ì¶”ì²œ ì±„ë„
                            <span style="font-size: 10px; color: var(--grey-500); font-weight: 400;">(ROAS 200% ì´ìƒ)</span>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 10px;">
                `;

                goodChannels.slice(0, 4).forEach((cat, idx) => {
                    const increasePercent = cat.roas >= 500 ? '20-30%' : cat.roas >= 300 ? '15-20%' : '10-15%';
                    html += `
                        <div style="padding: 14px; background: white; border-radius: 10px; border: 2px solid #4caf50; position: relative;">
                            ${idx === 0 ? '<div style="position: absolute; top: -8px; right: 10px; padding: 2px 8px; background: #4caf50; color: white; font-size: 9px; font-weight: 600; border-radius: 8px;">TOP</div>' : ''}
                            <div style="font-size: 12px; font-weight: 600; color: var(--grey-800); margin-bottom: 8px;">${cat.name}</div>
                            <div style="display: flex; justify-content: space-between; align-items: flex-end;">
                                <div>
                                    <div style="font-size: 10px; color: var(--grey-500);">ROAS</div>
                                    <div style="font-size: 20px; font-weight: 800; color: #2e7d32;">${formatPercent(cat.roas)}</div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-size: 9px; color: var(--grey-500);">ì¶”ì²œ ì¦ì•¡</div>
                                    <div style="font-size: 12px; font-weight: 700; color: #1565c0;">${increasePercent}</div>
                                </div>
                            </div>
                        </div>
                    `;
                });

                html += `</div></div>`;
            } else {
                html += `
                    <div style="margin-bottom: 16px; padding: 20px; background: #f5f5f5; border-radius: 10px; text-align: center;">
                        <div style="font-size: 24px; margin-bottom: 8px;">ğŸ“Š</div>
                        <div style="font-size: 13px; color: var(--grey-700);">í˜„ì¬ ROAS 200% ì´ìƒ ì±„ë„ì´ ì—†ìŠµë‹ˆë‹¤</div>
                        <div style="font-size: 11px; color: var(--grey-500); margin-top: 4px;">ê´‘ê³  ì†Œì¬ ê°œì„ ì´ë‚˜ íƒ€ê²Ÿ ìµœì í™”ë¥¼ ê³ ë ¤í•´ë³´ì„¸ìš”</div>
                    </div>
                `;
            }

            // 2. íš¨ìœ¨ ì¢‹ì€ ìƒí’ˆ (ì»´íŒ©íŠ¸) - í˜¸ë²„ íˆ´íŒ ì ìš©
            if (goodProducts.length > 0) {
                html += `
                    <div class="hoverable-card"
                         data-tooltip-title="íš¨ìœ¨ ì¢‹ì€ ìƒí’ˆ"
                         data-tooltip-icon="ğŸ›ï¸"
                         data-tooltip-insight="ROAS 150% ì´ìƒì¸ ìƒí’ˆë“¤ì…ë‹ˆë‹¤."
                         data-tooltip-recommendation="ì´ ìƒí’ˆë“¤ì˜ ê´‘ê³ ë¥¼ ë” í™œì„±í™”í•˜ë©´ ì „ì²´ ì„±ê³¼ê°€ ê°œì„ ë©ë‹ˆë‹¤."
                         style="margin-bottom: 16px; padding: 14px; background: #f5f5f5; border-radius: 10px;">
                        <div style="font-size: 12px; font-weight: 700; color: var(--grey-900); margin-bottom: 10px;">
                            ğŸ›ï¸ íš¨ìœ¨ ì¢‹ì€ ìƒí’ˆ
                        </div>
                        <div style="display: flex; flex-wrap: wrap; gap: 6px;">
                `;

                goodProducts.slice(0, 5).forEach(prod => {
                    html += `
                        <div style="padding: 6px 12px; background: white; border-radius: 16px; font-size: 11px; display: flex; align-items: center; gap: 6px;">
                            <span style="font-weight: 600; color: var(--grey-800);">${prod.product}</span>
                            <span style="color: #2e7d32; font-weight: 700;">${formatPercent(prod.roas)}</span>
                        </div>
                    `;
                });

                html += `</div></div>`;
            }

            // 3. TOP ê´‘ê³ ì„¸íŠ¸ (ë°ì´í„° ìƒ‰ìƒ ìŠ¤ì¼€ì¼ í¬í•¨)
            if (topAdsets.length > 0) {
                // ROAS ìµœëŒ€ê°’ ê³„ì‚° (ìŠ¤ì¼€ì¼ ë°”ìš©)
                const maxRoas = Math.max(...topAdsets.slice(0, 5).map(a => a.roas || 0));

                html += `
                    <div style="border: 1px solid var(--grey-200); border-radius: 10px; overflow: hidden;">
                        <div style="padding: 10px 14px; background: #fafafa; cursor: pointer; display: flex; justify-content: space-between; align-items: center;"
                             onclick="this.nextElementSibling.style.display = this.nextElementSibling.style.display === 'none' ? 'block' : 'none'; this.querySelector('.toggle-icon').textContent = this.nextElementSibling.style.display === 'none' ? 'â–¶' : 'â–¼';">
                            <span style="font-size: 12px; font-weight: 600; color: var(--grey-800);">ğŸ“ˆ ì„±ê³¼ TOP ê´‘ê³ ì„¸íŠ¸ (ìƒìœ„ 5ê°œ)</span>
                            <span class="toggle-icon" style="font-size: 10px; color: var(--grey-500);">â–¶</span>
                        </div>
                        <div style="display: none; padding: 12px;">
                            <!-- ìƒ‰ìƒ ë²”ë¡€ -->
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px; padding: 8px 12px; background: #f8f9fa; border-radius: 6px; flex-wrap: wrap;">
                                <span style="font-size: 10px; color: var(--grey-600); font-weight: 600;">ROAS ìŠ¤ì¼€ì¼:</span>
                                <div style="display: flex; align-items: center; gap: 6px; flex-wrap: wrap;">
                                    <div style="display: flex; align-items: center; gap: 3px;">
                                        <div style="width: 14px; height: 14px; background: linear-gradient(90deg, #4caf50, #81c784); border-radius: 3px;"></div>
                                        <span style="font-size: 10px; color: #2e7d32; font-weight: 600;">500%+</span>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 3px;">
                                        <div style="width: 14px; height: 14px; background: linear-gradient(90deg, #8bc34a, #aed581); border-radius: 3px;"></div>
                                        <span style="font-size: 10px; color: #558b2f; font-weight: 600;">300%</span>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 3px;">
                                        <div style="width: 14px; height: 14px; background: linear-gradient(90deg, #ffeb3b, #fff176); border-radius: 3px;"></div>
                                        <span style="font-size: 10px; color: #f57f17; font-weight: 600;">200%</span>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 3px;">
                                        <div style="width: 14px; height: 14px; background: linear-gradient(90deg, #ff9800, #ffb74d); border-radius: 3px;"></div>
                                        <span style="font-size: 10px; color: #e65100; font-weight: 600;">100%</span>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 3px;">
                                        <div style="width: 14px; height: 14px; background: linear-gradient(90deg, #ef5350, #e57373); border-radius: 3px;"></div>
                                        <span style="font-size: 10px; color: #c62828; font-weight: 600;">&lt;100%</span>
                                    </div>
                                </div>
                            </div>
                `;

                topAdsets.slice(0, 5).forEach((adset, idx) => {
                    // ROAS ê¸°ë°˜ ìƒ‰ìƒ ê³„ì‚°
                    const roas = adset.roas || 0;
                    let barColor, textColor, barWidth;

                    if (roas >= 500) {
                        barColor = 'linear-gradient(90deg, #4caf50, #81c784)';
                        textColor = '#2e7d32';
                    } else if (roas >= 300) {
                        barColor = 'linear-gradient(90deg, #8bc34a, #aed581)';
                        textColor = '#558b2f';
                    } else if (roas >= 200) {
                        barColor = 'linear-gradient(90deg, #ffeb3b, #fff176)';
                        textColor = '#f57f17';
                    } else if (roas >= 100) {
                        barColor = 'linear-gradient(90deg, #ff9800, #ffb74d)';
                        textColor = '#e65100';
                    } else {
                        barColor = 'linear-gradient(90deg, #ef5350, #e57373)';
                        textColor = '#c62828';
                    }

                    // ìŠ¤ì¼€ì¼ ë°” ë„ˆë¹„ ê³„ì‚° (ìµœëŒ€ 100%)
                    barWidth = Math.min((roas / maxRoas) * 100, 100);

                    html += `
                        <div style="margin-bottom: 10px; padding: 10px 12px; background: #fafafa; border-radius: 8px; position: relative; overflow: hidden;">
                            <!-- ë°°ê²½ ìŠ¤ì¼€ì¼ ë°” -->
                            <div style="position: absolute; top: 0; left: 0; height: 100%; width: ${barWidth}%; background: ${barColor}; opacity: 0.15; border-radius: 8px;"></div>
                            <div style="position: relative; z-index: 1;">
                                <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                    <div style="flex: 1;">
                                        <div style="font-size: 11px; font-weight: 600; color: var(--grey-800); display: flex; align-items: center; gap: 6px;">
                                            <span style="width: 18px; height: 18px; background: ${barColor}; border-radius: 4px; display: flex; align-items: center; justify-content: center; color: white; font-size: 10px; font-weight: 700;">${idx + 1}</span>
                                            ${adset.adset}
                                        </div>
                                        <div style="font-size: 10px; color: var(--grey-500); margin-top: 2px; margin-left: 24px;">${adset.category}</div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="font-size: 14px; font-weight: 800; color: ${textColor};">${formatPercent(roas)}</div>
                                        <div style="font-size: 9px; color: var(--grey-500);">ROAS</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });

                html += `</div></div>`;
            }

            // 4. ì•¡ì…˜ ê°€ì´ë“œ
            html += `
                <div style="margin-top: 16px; padding: 12px 14px; background: linear-gradient(135deg, #fff8e1 0%, #fff3e0 100%); border-radius: 10px; border-left: 3px solid #ffc107;">
                    <div style="font-size: 11px; font-weight: 600; color: #f57f17; margin-bottom: 6px;">ğŸ’¡ ì´ë ‡ê²Œ ì‹¤í–‰í•˜ì„¸ìš”</div>
                    <div style="font-size: 11px; color: var(--grey-800); line-height: 1.7;">
                        1. ğŸ”¥ í‘œì‹œëœ ì±„ë„ì˜ ì¼ì¼ ì˜ˆì‚°ì„ <strong>10-20%</strong> ëŠ˜ë ¤ë³´ì„¸ìš”<br>
                        2. íš¨ìœ¨ ì¢‹ì€ ìƒí’ˆ ê´‘ê³ ì˜ <strong>ë…¸ì¶œì„ í™•ëŒ€</strong>í•˜ì„¸ìš”<br>
                        3. 3-5ì¼ í›„ ì„±ê³¼ë¥¼ í™•ì¸í•˜ê³  ì¶”ê°€ ì¡°ì •í•˜ì„¸ìš”
                    </div>
                </div>
            `;

            document.getElementById('opportunityContent').innerHTML = html;
        }

        // íƒ­ 2: ì˜ˆì‚° íˆ¬ì ê°€ì´ë“œ (Compact + ROAS/CPA ì¸ì‚¬ì´íŠ¸)
        function renderBudgetGuideTab() {
            const periodData = getPeriodData();
            const recommendations = periodData.recommendations || [];
            const forecast = periodData.prophet_forecast || null;
            const topCategories = periodData.top_categories || [];
            const productPerformance = periodData.product_performance || [];
            const summary = periodData.summary || {};

            let html = '';
            const avgCpa = summary.overall_cpa || 0;
            const avgRoas = summary.overall_roas || 0;

            // 1. íˆ¬ì ì˜ì‚¬ê²°ì • ë§¤íŠ¸ë¦­ìŠ¤ (ROAS vs CPA)
            html += `
                <div style="margin-bottom: 16px; padding: 14px; background: #f5f5f5; border-radius: 10px;">
                    <div style="font-size: 12px; font-weight: 600; color: var(--grey-800); margin-bottom: 10px;">ğŸ’¡ íˆ¬ì ì˜ì‚¬ê²°ì • ê¸°ì¤€</div>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; font-size: 10px;">
                        <div style="padding: 8px; background: #e8f5e9; border-radius: 6px; text-align: center;">
                            <div style="font-weight: 700; color: #2e7d32;">ğŸ”¥ í™•ëŒ€</div>
                            <div style="color: var(--grey-700);">ROAS 200%â†‘<br>CPA í‰ê· â†“</div>
                        </div>
                        <div style="padding: 8px; background: #fff8e1; border-radius: 6px; text-align: center;">
                            <div style="font-weight: 700; color: #f57c00;">âœ“ ìœ ì§€</div>
                            <div style="color: var(--grey-700);">ROAS 100-200%<br>CPA í‰ê· </div>
                        </div>
                        <div style="padding: 8px; background: #ffebee; border-radius: 6px; text-align: center;">
                            <div style="font-weight: 700; color: #d32f2f;">âš ï¸ ê²€í† </div>
                            <div style="color: var(--grey-700);">ROAS 100%â†“<br>CPA í‰ê· â†‘</div>
                        </div>
                    </div>
                </div>
            `;

            // 2. ì±„ë„ë³„ íˆ¬ì ìš°ì„ ìˆœìœ„ (ì ‘ê¸°/í¼ì¹˜ê¸°)
            html += `
                <div style="margin-bottom: 16px; border: 1px solid var(--grey-200); border-radius: 10px; overflow: hidden;">
                    <div style="padding: 12px 16px; background: #e3f2fd; cursor: pointer; display: flex; justify-content: space-between; align-items: center;"
                         onclick="this.nextElementSibling.style.display = this.nextElementSibling.style.display === 'none' ? 'block' : 'none'; this.querySelector('.toggle-icon').textContent = this.nextElementSibling.style.display === 'none' ? 'â–¶' : 'â–¼';">
                        <span style="font-size: 13px; font-weight: 600; color: #0d47a1;">ğŸ’° ì±„ë„ë³„ íˆ¬ì ìš°ì„ ìˆœìœ„</span>
                        <span class="toggle-icon" style="font-size: 10px; color: var(--grey-500);">â–¼</span>
                    </div>
                    <div style="padding: 12px;">
            `;

            topCategories.slice(0, 5).forEach((cat, idx) => {
                const roasLevel = cat.roas > 200 ? 'high' : cat.roas > 100 ? 'mid' : 'low';
                const cpaLevel = cat.cpa < avgCpa ? 'good' : 'bad';
                let action = '', actionColor = '', actionBg = '';

                if (roasLevel === 'high' && cpaLevel === 'good') {
                    action = 'ğŸ”¥ ì ê·¹ í™•ëŒ€ (ì˜ˆì‚° +20%)'; actionColor = '#2e7d32'; actionBg = '#e8f5e9';
                } else if (roasLevel === 'high') {
                    action = 'ğŸ“ˆ í™•ëŒ€ (ì˜ˆì‚° +10%)'; actionColor = '#1976d2'; actionBg = '#e3f2fd';
                } else if (roasLevel === 'low') {
                    action = 'âš ï¸ ìµœì í™” í•„ìš”'; actionColor = '#d32f2f'; actionBg = '#ffebee';
                } else {
                    action = 'âœ“ í˜„ìƒ ìœ ì§€'; actionColor = '#757575'; actionBg = '#f5f5f5';
                }

                html += `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #f0f0f0;">
                        <div style="flex: 1;">
                            <div style="font-size: 12px; font-weight: 600; color: var(--grey-900);">${idx + 1}. ${cat.name}</div>
                            <div style="font-size: 10px; color: var(--grey-600);">ROAS ${formatPercent(cat.roas)} | CPA ${formatCurrency(cat.cpa)}</div>
                        </div>
                        <div style="padding: 4px 10px; background: ${actionBg}; border-radius: 12px; font-size: 10px; color: ${actionColor}; font-weight: 600;">
                            ${action}
                        </div>
                    </div>
                `;
            });

            html += `</div></div>`;

            // 3. CPA íš¨ìœ¨ ìˆœìœ„ (ì ‘ê¸°/í¼ì¹˜ê¸°)
            if (topCategories.length > 0) {
                const sortedByCpa = [...topCategories].sort((a, b) => a.cpa - b.cpa);
                html += `
                    <div style="margin-bottom: 16px; border: 1px solid var(--grey-200); border-radius: 10px; overflow: hidden;">
                        <div style="padding: 12px 16px; background: #e8f5e9; cursor: pointer; display: flex; justify-content: space-between; align-items: center;"
                             onclick="this.nextElementSibling.style.display = this.nextElementSibling.style.display === 'none' ? 'block' : 'none'; this.querySelector('.toggle-icon').textContent = this.nextElementSibling.style.display === 'none' ? 'â–¶' : 'â–¼';">
                            <span style="font-size: 13px; font-weight: 600; color: #1b5e20;">ğŸ’¸ CPA íš¨ìœ¨ ìˆœìœ„ (ì „í™˜ë‹¹ ë¹„ìš© ë‚®ì€ ìˆœ)</span>
                            <span class="toggle-icon" style="font-size: 10px; color: var(--grey-500);">â–¶</span>
                        </div>
                        <div style="padding: 12px; display: none;">
                `;

                sortedByCpa.slice(0, 5).forEach((cat, idx) => {
                    const efficiency = cat.cpa < avgCpa ? 'íš¨ìœ¨ì ' : 'ë¹„íš¨ìœ¨ì ';
                    const effColor = cat.cpa < avgCpa ? '#2e7d32' : '#f57c00';
                    html += `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #f0f0f0;">
                            <div>
                                <span style="font-size: 12px; font-weight: 600;">${idx + 1}. ${cat.name}</span>
                                <span style="font-size: 10px; color: ${effColor}; margin-left: 8px;">(${efficiency})</span>
                            </div>
                            <div style="font-size: 14px; font-weight: 700; color: #1b5e20;">${formatCurrency(cat.cpa)}</div>
                        </div>
                    `;
                });

                html += `</div></div>`;
            }

            // 4. AI ì˜ˆì¸¡ ê¸°ë°˜ ì¶”ì²œ (ìˆì„ ê²½ìš°ë§Œ)
            if (forecast && (forecast.by_category || forecast.by_product)) {
                html += `
                    <div style="margin-bottom: 16px; border: 1px solid #e1bee7; border-radius: 10px; overflow: hidden;">
                        <div style="padding: 12px 16px; background: #f3e5f5; cursor: pointer; display: flex; justify-content: space-between; align-items: center;"
                             onclick="this.nextElementSibling.style.display = this.nextElementSibling.style.display === 'none' ? 'block' : 'none'; this.querySelector('.toggle-icon').textContent = this.nextElementSibling.style.display === 'none' ? 'â–¶' : 'â–¼';">
                            <span style="font-size: 13px; font-weight: 600; color: #6a1b9a;">ğŸ”® AI ì˜ˆì¸¡ ê¸°ë°˜ ì¶”ì²œ</span>
                            <span class="toggle-icon" style="font-size: 10px; color: var(--grey-500);">â–¶</span>
                        </div>
                        <div style="padding: 12px; display: none;">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 8px;">
                `;

                if (forecast.by_category) {
                    const upCategory = forecast.by_category.find(c => c.trend_direction === 'ìƒìŠ¹');
                    if (upCategory) {
                        html += `
                            <div style="padding: 10px; background: #fce4ec; border-radius: 8px; text-align: center;">
                                <div style="font-size: 10px; color: #c2185b;">ìƒìŠ¹ ì˜ˆì¸¡ ì±„ë„</div>
                                <div style="font-size: 12px; font-weight: 700; color: var(--grey-900);">${upCategory.category}</div>
                            </div>
                        `;
                    }
                }

                if (forecast.by_product && forecast.by_product.length > 0) {
                    const topProd = [...forecast.by_product].sort((a, b) => b.total_30day_forecast - a.total_30day_forecast)[0];
                    if (topProd) {
                        html += `
                            <div style="padding: 10px; background: #e8f5e9; border-radius: 8px; text-align: center;">
                                <div style="font-size: 10px; color: #2e7d32;">ì¶”ì²œ ìƒí’ˆ</div>
                                <div style="font-size: 12px; font-weight: 700; color: var(--grey-900);">${topProd.product}</div>
                            </div>
                        `;
                    }
                }

                html += `</div></div></div>`;
            }

            // 5. ì‹¤í–‰ ì²´í¬ë¦¬ìŠ¤íŠ¸ (Compact)
            html += `
                <div style="padding: 12px 14px; background: #fff8e1; border-radius: 8px; border-left: 3px solid #ffc107;">
                    <div style="font-size: 11px; font-weight: 600; color: #f57f17; margin-bottom: 6px;">âœ… ì´ë²ˆ ì£¼ ì²´í¬ë¦¬ìŠ¤íŠ¸</div>
                    <div style="font-size: 10px; color: var(--grey-800); line-height: 1.7;">
                        â–¡ ROAS 200%â†‘ ì±„ë„ ì˜ˆì‚° ì¦ì•¡<br>
                        â–¡ CPA í‰ê·  ì´ˆê³¼ ì±„ë„ íƒ€ê²ŸíŒ… ì¬ê²€í† <br>
                        â–¡ ë¹„íš¨ìœ¨ ìº í˜ì¸ í¬ë¦¬ì—ì´í‹°ë¸Œ êµì²´
                    </div>
                </div>
            `;

            const budgetGuideEl = document.getElementById('budgetGuideContent');
            if (budgetGuideEl) {
                budgetGuideEl.innerHTML = html;
            }
        }

        // íƒ­ 2: ì£¼ì˜ í•„ìš” (ê²½ê³ ) - ì‚¬ìš©ì ì¹œí™”ì  ë²„ì „
        function renderWarningTab() {
            const periodData = getPeriodData();
            if (!periodData) return;

            const allAlerts = periodData.alerts || [];
            const warnings = allAlerts.filter(a => a.severity === 'warning' || a.severity === 'high');
            const topCategories = periodData.top_categories || [];
            const summary = periodData.summary || {};
            const productPerformance = periodData.product_performance || [];

            const avgCpa = summary.overall_cpa || 0;
            const highCpaCategories = topCategories.filter(cat => cat.cpa > avgCpa * 1.5);
            const lowRoasCategories = topCategories.filter(cat => cat.roas < 100);
            const lowRoasProducts = productPerformance.filter(prod => prod.roas < 100);
            const totalIssues = highCpaCategories.length + lowRoasCategories.length + lowRoasProducts.length + warnings.length;

            let html = '';

            // ì¸íŠ¸ë¡œ ë©”ì‹œì§€
            if (totalIssues === 0) {
                html += `
                    <div style="padding: 40px 20px; text-align: center;">
                        <div style="font-size: 48px; margin-bottom: 16px;">ğŸ‰</div>
                        <div style="font-size: 18px; font-weight: 700; color: #2e7d32; margin-bottom: 8px;">ëª¨ë“  ê´‘ê³ ê°€ ì˜ ëŒì•„ê°€ê³  ìˆì–´ìš”!</div>
                        <div style="font-size: 13px; color: var(--grey-600); line-height: 1.6;">
                            í˜„ì¬ íŠ¹ë³„íˆ ì£¼ì˜ê°€ í•„ìš”í•œ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.<br>
                            ê³„ì†í•´ì„œ ì¢‹ì€ ì„±ê³¼ë¥¼ ìœ ì§€í•´ì£¼ì„¸ìš”.
                        </div>
                    </div>
                `;
                document.getElementById('warningContent').innerHTML = html;
                return;
            }

            // ì„ íƒëœ ê¸°ê°„ ì •ë³´
            const periodLabels = {'full': 'ì „ì²´ ê¸°ê°„', '180d': 'ìµœê·¼ 180ì¼', '90d': 'ìµœê·¼ 90ì¼'};
            const currentPeriodLabel = periodLabels[currentPeriod] || 'ì „ì²´ ê¸°ê°„';

            // ê²½ê³  ìˆì„ ë•Œ ì¸íŠ¸ë¡œ - í˜¸ë²„ íˆ´íŒ ì ìš© (ê¸°ê°„ í‘œì‹œ ì¶”ê°€)
            html += `
                <div class="hoverable-card"
                     data-tooltip-title="ì£¼ì˜ í•„ìš” í•­ëª©"
                     data-tooltip-icon="âš ï¸"
                     data-tooltip-insight="ROASê°€ 100% ë¯¸ë§Œì´ë©´ ê´‘ê³ ë¹„ë³´ë‹¤ ë§¤ì¶œì´ ì ë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤."
                     data-tooltip-recommendation="ê³„ì† ë‘ë©´ ì†í•´ê°€ ì»¤ì§ˆ ìˆ˜ ìˆì–´ìš”. ë¹¨ë¦¬ ì¡°ì¹˜í•˜ë©´ ì†ì‹¤ì„ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤."
                     style="margin-bottom: 16px; padding: 16px 20px; background: linear-gradient(135deg, #ffebee 0%, #fff5f5 100%); border-radius: 12px; border-left: 4px solid #ef5350;">
                    <div style="display: flex; align-items: flex-start; gap: 12px;">
                        <span style="font-size: 28px;">âš ï¸</span>
                        <div style="flex: 1;">
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                                <span style="font-size: 14px; font-weight: 700; color: #c62828;">í™•ì¸ì´ í•„ìš”í•œ í•­ëª©ì´ ìˆì–´ìš”</span>
                                <span style="font-size: 10px; color: #ef5350; background: rgba(239, 83, 80, 0.1); padding: 2px 8px; border-radius: 10px; margin-left: auto;">${currentPeriodLabel} ê¸°ì¤€</span>
                            </div>
                            <div style="font-size: 12px; color: var(--grey-700); line-height: 1.6;">
                                ì•„ë˜ í•­ëª©ë“¤ì€ <strong>ì˜ˆì‚° ë‚­ë¹„</strong>ê°€ ë°œìƒí•  ìˆ˜ ìˆì–´ìš”. ë¹¨ë¦¬ ì¡°ì¹˜í•˜ë©´ ì†ì‹¤ì„ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // ì„œë¸Œíƒ­ êµ¬í˜„ - AI ë¶„ì„ ê²½ê³ , CPA ë†’ìŒ, ë¹„íš¨ìœ¨ ìƒí’ˆ
            const hasAiAlerts = warnings.length > 0;
            const hasHighCpa = highCpaCategories.length > 0;
            const hasLowRoasProducts = lowRoasProducts.length > 0;
            const firstActiveTab = hasAiAlerts ? 'aiAlert' : (hasHighCpa ? 'cpa' : (hasLowRoasProducts ? 'products' : 'cpa'));

            html += `
                <div style="margin-bottom: 16px;">
                    <div style="display: flex; gap: 8px; border-bottom: 2px solid var(--grey-200); padding-bottom: 0; flex-wrap: wrap;">
            `;

            // AI ë¶„ì„ ê²½ê³  íƒ­
            if (hasAiAlerts) {
                html += `
                    <button class="warning-subtab ${firstActiveTab === 'aiAlert' ? 'active' : ''}" data-warning-tab="aiAlert"
                            style="padding: 10px 16px; font-size: 12px; font-weight: 600; border: none; background: ${firstActiveTab === 'aiAlert' ? '#ffebee' : 'transparent'};
                                   color: ${firstActiveTab === 'aiAlert' ? '#d32f2f' : 'var(--grey-600)'}; cursor: pointer; border-radius: 8px 8px 0 0;
                                   border-bottom: ${firstActiveTab === 'aiAlert' ? '3px solid #d32f2f' : '3px solid transparent'}; margin-bottom: -2px;
                                   transition: all 0.2s ease;">
                        ğŸš¨ AI ë¶„ì„ ê²½ê³  ${warnings.length}ê°œ
                    </button>
                `;
            }

            // CPA ë†’ìŒ íƒ­
            if (hasHighCpa) {
                html += `
                    <button class="warning-subtab ${firstActiveTab === 'cpa' ? 'active' : ''}" data-warning-tab="cpa"
                            style="padding: 10px 16px; font-size: 12px; font-weight: 600; border: none; background: ${firstActiveTab === 'cpa' ? '#fff3e0' : 'transparent'};
                                   color: ${firstActiveTab === 'cpa' ? '#e65100' : 'var(--grey-600)'}; cursor: pointer; border-radius: 8px 8px 0 0;
                                   border-bottom: ${firstActiveTab === 'cpa' ? '3px solid #e65100' : '3px solid transparent'}; margin-bottom: -2px;
                                   transition: all 0.2s ease;">
                        ğŸŸ  CPA ë†’ìŒ ${highCpaCategories.length}ê°œ
                    </button>
                `;
            }

            // ë¹„íš¨ìœ¨ ìƒí’ˆ íƒ­
            if (hasLowRoasProducts) {
                html += `
                    <button class="warning-subtab ${firstActiveTab === 'products' ? 'active' : ''}" data-warning-tab="products"
                            style="padding: 10px 16px; font-size: 12px; font-weight: 600; border: none; background: ${firstActiveTab === 'products' ? '#f3e5f5' : 'transparent'};
                                   color: ${firstActiveTab === 'products' ? '#7b1fa2' : 'var(--grey-600)'}; cursor: pointer; border-radius: 8px 8px 0 0;
                                   border-bottom: ${firstActiveTab === 'products' ? '3px solid #7b1fa2' : '3px solid transparent'}; margin-bottom: -2px;
                                   transition: all 0.2s ease;">
                        ğŸŸ£ ë¹„íš¨ìœ¨ ìƒí’ˆ ${lowRoasProducts.length}ê°œ
                    </button>
                `;
            }

            html += `
                    </div>
                </div>
            `;

            // AI ë¶„ì„ ê²½ê³  ì»¨í…ì¸  (default 3ê°œ ë…¸ì¶œ + ì ‘ê¸°/í¼ì¹˜ê¸°)
            if (hasAiAlerts) {
                // severity ê¸°ì¤€ ì •ë ¬ (high > warning > ê¸°íƒ€)
                const severityOrder = { 'high': 0, 'warning': 1 };
                const sortedWarnings = [...warnings].sort((a, b) => {
                    const orderA = severityOrder[a.severity] !== undefined ? severityOrder[a.severity] : 2;
                    const orderB = severityOrder[b.severity] !== undefined ? severityOrder[b.severity] : 2;
                    return orderA - orderB;
                });
                const visibleAlerts = sortedWarnings.slice(0, 3);
                const hiddenAlerts = sortedWarnings.slice(3);

                html += `<div id="warningTabAiAlert" class="warning-tab-content" style="display: ${firstActiveTab === 'aiAlert' ? 'block' : 'none'};">`;
                html += `
                    <div style="padding: 14px; background: white; border-radius: 10px; border: 1px solid #ffcdd2;">
                        <div style="font-size: 12px; font-weight: 700; color: #d32f2f; margin-bottom: 12px;">
                            ğŸš¨ AIê°€ ê°ì§€í•œ ê²½ê³  ì•Œë¦¼
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                `;

                // í—¬í¼ í•¨ìˆ˜: ê²½ê³  ì¹´ë“œ ë Œë”ë§
                function renderAlertCard(alert) {
                    const severityConfig = {
                        'high': { border: '#d32f2f', bg: '#ffebee', badge: 'ê¸´ê¸‰', badgeBg: '#d32f2f' },
                        'warning': { border: '#f57c00', bg: '#fff3e0', badge: 'ì£¼ì˜', badgeBg: '#f57c00' }
                    };
                    const config = severityConfig[alert.severity] || severityConfig['warning'];

                    // íƒ€ì…ë³„ í•œêµ­ì–´ ì œëª© ë§¤í•‘
                    const typeTitleMap = {
                        'forecast_underperformance': 'âš ï¸ ì˜ˆì¸¡ ëŒ€ë¹„ ì‹¤ì  ë¯¸ë‹¬',
                        'low_roas': 'ğŸ“‰ ë‚®ì€ ROAS ê²½ê³ ',
                        'high_cpa': 'ğŸ’° ë†’ì€ CPA ê²½ê³ ',
                        'budget_waste': 'ğŸ’¸ ì˜ˆì‚° ë‚­ë¹„ ê°€ëŠ¥ì„±',
                        'performance_drop': 'ğŸ“Š ì„±ê³¼ í•˜ë½ ê°ì§€'
                    };
                    const alertTitle = alert.title || typeTitleMap[alert.type] || 'âš ï¸ ê²½ê³ ';

                    let cardHtml = `
                        <div style="padding: 14px 16px; background: ${config.bg}; border-radius: 12px; border-left: 4px solid ${config.border};">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px;">
                                <div style="font-size: 13px; font-weight: 700; color: var(--grey-900);">
                                    ${alertTitle}
                                </div>
                                <span style="padding: 2px 8px; background: ${config.badgeBg}; color: white; border-radius: 10px; font-size: 10px; font-weight: 600;">${config.badge}</span>
                            </div>
                            <div style="font-size: 12px; color: var(--grey-700); line-height: 1.6; margin-bottom: 10px;">
                                ${alert.message || ''}
                            </div>
                    `;

                    // Financial Impact í‘œì‹œ
                    if (alert.financial_impact) {
                        const fi = alert.financial_impact;
                        cardHtml += `
                            <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                                ${fi.loss_amount ? `
                                    <div style="flex: 1; padding: 8px 10px; background: rgba(211, 47, 47, 0.1); border-radius: 8px; text-align: center;">
                                        <div style="font-size: 10px; color: #d32f2f; font-weight: 600;">ì˜ˆìƒ ì†ì‹¤</div>
                                        <div style="font-size: 14px; font-weight: 800; color: #d32f2f;">${fi.loss_amount}</div>
                                    </div>
                                ` : ''}
                                ${fi.potential_uplift ? `
                                    <div style="flex: 1; padding: 8px 10px; background: rgba(46, 125, 50, 0.1); border-radius: 8px; text-align: center;">
                                        <div style="font-size: 10px; color: #2e7d32; font-weight: 600;">ê°œì„ ì‹œ ê¸°ëŒ€ ìˆ˜ìµ</div>
                                        <div style="font-size: 14px; font-weight: 800; color: #2e7d32;">${fi.potential_uplift}</div>
                                    </div>
                                ` : ''}
                            </div>
                        `;
                    }

                    // Action ê°€ì´ë“œ í‘œì‹œ
                    if (alert.action) {
                        cardHtml += `
                            <div style="padding: 10px 12px; background: rgba(255,255,255,0.8); border-radius: 8px; border: 1px dashed ${config.border};">
                                <div style="font-size: 10px; color: ${config.border}; font-weight: 600; margin-bottom: 4px;">ğŸ’¡ ì‹¤í–‰ ê°€ì´ë“œ</div>
                                <div style="font-size: 11px; color: var(--grey-800); line-height: 1.5;">${alert.action}</div>
                            </div>
                        `;
                    }

                    cardHtml += `</div>`;
                    return cardHtml;
                }

                // ê¸°ë³¸ ë…¸ì¶œ ì¹´ë“œ (3ê°œ)
                visibleAlerts.forEach((alert) => {
                    html += renderAlertCard(alert);
                });

                html += `</div>`;

                // ì¶”ê°€ ì¹´ë“œ (ì ‘ê¸°/í¼ì¹˜ê¸°) - ë”ë³´ê¸°/ì ‘ê¸° ë²„íŠ¼ ë¶„ë¦¬
                if (hiddenAlerts.length > 0) {
                    const alertsToggleId = 'alertsToggle_' + Date.now();
                    html += `
                        <div id="${alertsToggleId}_showMore" style="text-align: center; margin-top: 12px;">
                            <button class="show-more-btn warning-style" onclick="document.getElementById('${alertsToggleId}_content').style.display='block'; document.getElementById('${alertsToggleId}_showMore').style.display='none';">
                                ë” ë³´ê¸° (${hiddenAlerts.length}ê±´)
                            </button>
                        </div>
                        <div id="${alertsToggleId}_content" style="display: none; margin-top: 12px;">
                            <div style="display: flex; flex-direction: column; gap: 10px;">
                    `;
                    hiddenAlerts.forEach((alert) => {
                        html += renderAlertCard(alert);
                    });
                    html += `
                            </div>
                            <div style="text-align: center; margin-top: 12px;">
                                <button class="show-more-btn warning-style" onclick="document.getElementById('${alertsToggleId}_content').style.display='none'; document.getElementById('${alertsToggleId}_showMore').style.display='block';">
                                    ì ‘ê¸°
                                </button>
                            </div>
                        </div>`;
                }

                html += `</div></div>`;
            }

            // CPA ë†’ì€ ì±„ë„ ì»¨í…ì¸  (default 3ê°œ ë…¸ì¶œ + ì ‘ê¸°/í¼ì¹˜ê¸°)
            if (hasHighCpa) {
                const visibleCpa = highCpaCategories.slice(0, 3);
                const hiddenCpa = highCpaCategories.slice(3);

                html += `<div id="warningTabCpa" class="warning-tab-content" style="display: ${firstActiveTab === 'cpa' ? 'block' : 'none'};">`;
                html += `
                    <div class="hoverable-card"
                         data-tooltip-title="CPA ë†’ì€ ì±„ë„"
                         data-tooltip-icon="ğŸŸ "
                         data-tooltip-insight="í•œ ë²ˆì˜ êµ¬ë§¤/ì „í™˜ì„ ì–»ëŠ” ë° ë“œëŠ” ë¹„ìš©ì´ í‰ê· ë³´ë‹¤ í›¨ì”¬ ë†’ë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤."
                         data-tooltip-recommendation="ì…ì°° ê¸ˆì•¡ ì¡°ì • ë˜ëŠ” íƒ€ê²Ÿ ì •ë°€í™”ë¥¼ ê³ ë ¤í•˜ì„¸ìš”."
                         style="margin-bottom: 12px; padding: 14px; background: white; border-radius: 10px; border: 1px solid #ffe0b2;">
                        <div style="font-size: 12px; font-weight: 700; color: #e65100; margin-bottom: 10px;">
                            ğŸŸ  ì „í™˜ ë¹„ìš©ì´ ë„ˆë¬´ ë†’ì€ ì±„ë„
                        </div>
                `;

                // í—¬í¼ í•¨ìˆ˜: CPA ì¹´ë“œ ë Œë”ë§
                function renderCpaCard(cat) {
                    const cpaRatio = ((cat.cpa / avgCpa - 1) * 100).toFixed(0);
                    return `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #f5f5f5;">
                            <div>
                                <div style="font-size: 12px; font-weight: 600; color: var(--grey-800);">${cat.name}</div>
                                <div style="font-size: 10px; color: #e65100;">ì „í™˜ 1ê±´ë‹¹ ${formatCurrency(cat.cpa)}</div>
                            </div>
                            <div style="padding: 4px 10px; background: #fff3e0; border-radius: 12px; font-size: 10px; color: #e65100; font-weight: 600;">
                                í‰ê· ë³´ë‹¤ +${cpaRatio}% ë¹„ìŒˆ
                            </div>
                        </div>
                    `;
                }

                // ê¸°ë³¸ ë…¸ì¶œ (3ê°œ)
                visibleCpa.forEach(cat => {
                    html += renderCpaCard(cat);
                });

                // ì¶”ê°€ í•­ëª© (ì ‘ê¸°/í¼ì¹˜ê¸°) - ë”ë³´ê¸°/ì ‘ê¸° ë²„íŠ¼ ë¶„ë¦¬
                if (hiddenCpa.length > 0) {
                    const cpaToggleId = 'cpaToggle_' + Date.now();
                    html += `
                        <div id="${cpaToggleId}_showMore" style="text-align: center; margin-top: 12px;">
                            <button class="show-more-btn caution-style" onclick="document.getElementById('${cpaToggleId}_content').style.display='block'; document.getElementById('${cpaToggleId}_showMore').style.display='none';">
                                ë” ë³´ê¸° (${hiddenCpa.length}ê±´)
                            </button>
                        </div>
                        <div id="${cpaToggleId}_content" style="display: none; margin-top: 8px;">
                    `;
                    hiddenCpa.forEach(cat => {
                        html += renderCpaCard(cat);
                    });
                    html += `
                            <div style="text-align: center; margin-top: 12px;">
                                <button class="show-more-btn caution-style" onclick="document.getElementById('${cpaToggleId}_content').style.display='none'; document.getElementById('${cpaToggleId}_showMore').style.display='block';">
                                    ì ‘ê¸°
                                </button>
                            </div>
                        </div>`;
                }

                html += `
                        <div style="margin-top: 10px; padding: 10px; background: #fff8f0; border-radius: 8px;">
                            <div style="font-size: 11px; font-weight: 600; color: #e65100; margin-bottom: 4px;">ğŸ’¡ ì´ë ‡ê²Œ í•´ë³´ì„¸ìš”</div>
                            <div style="font-size: 10px; color: var(--grey-700); line-height: 1.6;">
                                â€¢ ì…ì°° ê¸ˆì•¡ì„ ë‚®ì¶°ë³´ì„¸ìš”<br>
                                â€¢ ë” ì •í™•í•œ íƒ€ê²Ÿì—ê²Œë§Œ ê´‘ê³ ë¥¼ ë…¸ì¶œí•˜ì„¸ìš”
                            </div>
                        </div>
                    </div>
                </div>
                `;
            }

            // ë¹„íš¨ìœ¨ ìƒí’ˆ ì»¨í…ì¸ 
            if (hasLowRoasProducts) {
                html += `<div id="warningTabProducts" class="warning-tab-content" style="display: ${firstActiveTab === 'products' ? 'block' : 'none'};">`;
                html += `
                    <div class="hoverable-card"
                         data-tooltip-title="ë¹„íš¨ìœ¨ ìƒí’ˆ"
                         data-tooltip-icon="ğŸŸ£"
                         data-tooltip-insight="ROASê°€ 100% ë¯¸ë§Œì¸ ìƒí’ˆë“¤ì…ë‹ˆë‹¤. ê´‘ê³ ë¹„ë³´ë‹¤ ë§¤ì¶œì´ ì ìŠµë‹ˆë‹¤."
                         data-tooltip-recommendation="ì´ ìƒí’ˆë“¤ì€ ê´‘ê³ ë³´ë‹¤ í”„ë¡œëª¨ì…˜/í• ì¸ì´ ë” íš¨ê³¼ì ì¼ ìˆ˜ ìˆì–´ìš”."
                         style="margin-bottom: 12px; padding: 14px; background: white; border-radius: 10px; border: 1px solid #e1bee7;">
                        <div style="font-size: 12px; font-weight: 700; color: #7b1fa2; margin-bottom: 12px;">
                            ğŸŸ£ íš¨ìœ¨ì´ ë‚®ì€ ìƒí’ˆ (${lowRoasProducts.length}ê°œ)
                        </div>
                        <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 12px;">
                `;

                lowRoasProducts.forEach(prod => {
                    html += `
                            <div style="padding: 8px 14px; background: #f3e5f5; border-radius: 20px; font-size: 11px; display: flex; align-items: center; gap: 8px; border: 1px solid #ce93d8;">
                                <span style="color: var(--grey-800); font-weight: 500;">${prod.product}</span>
                                <span style="color: #7b1fa2; font-weight: 700;">${formatPercent(prod.roas)}</span>
                            </div>
                    `;
                });

                html += `
                        </div>
                        <div style="padding: 10px; background: #fce4ec; border-radius: 8px;">
                            <div style="font-size: 11px; font-weight: 600; color: #7b1fa2; margin-bottom: 4px;">ğŸ’¡ ì´ë ‡ê²Œ í•´ë³´ì„¸ìš”</div>
                            <div style="font-size: 10px; color: var(--grey-700); line-height: 1.6;">
                                â€¢ ì´ ìƒí’ˆë“¤ì€ ê´‘ê³ ë³´ë‹¤ í”„ë¡œëª¨ì…˜/í• ì¸ì´ ë” íš¨ê³¼ì ì¼ ìˆ˜ ìˆì–´ìš”<br>
                                â€¢ ê´‘ê³  ì†Œì¬ë‚˜ íƒ€ê²Ÿì„ ë³€ê²½í•´ë³´ì„¸ìš”<br>
                                â€¢ ê´‘ê³  ì˜ˆì‚°ì„ íš¨ìœ¨ ì¢‹ì€ ìƒí’ˆìœ¼ë¡œ ì´ë™í•˜ì„¸ìš”
                            </div>
                        </div>
                    </div>
                </div>
                `;
            }

            document.getElementById('warningContent').innerHTML = html;

            // ì„œë¸Œíƒ­ í´ë¦­ ì´ë²¤íŠ¸ ì´ˆê¸°í™”
            initWarningSubtabs();
        }

        // ì£¼ì˜ í•„ìš” íƒ­ì˜ ì„œë¸Œíƒ­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
        function initWarningSubtabs() {
            const subtabs = document.querySelectorAll('.warning-subtab');
            subtabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const targetTab = this.dataset.warningTab;

                    // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
                    subtabs.forEach(t => {
                        t.classList.remove('active');
                        t.style.background = 'transparent';
                        t.style.color = 'var(--grey-600)';
                        t.style.borderBottom = '3px solid transparent';
                    });

                    // í´ë¦­í•œ íƒ­ í™œì„±í™”
                    this.classList.add('active');
                    if (targetTab === 'aiAlert') {
                        this.style.background = '#ffebee';
                        this.style.color = '#d32f2f';
                        this.style.borderBottom = '3px solid #d32f2f';
                    } else if (targetTab === 'cpa') {
                        this.style.background = '#fff3e0';
                        this.style.color = '#e65100';
                        this.style.borderBottom = '3px solid #e65100';
                    } else if (targetTab === 'products') {
                        this.style.background = '#f3e5f5';
                        this.style.color = '#7b1fa2';
                        this.style.borderBottom = '3px solid #7b1fa2';
                    }

                    // ëª¨ë“  ì»¨í…ì¸  ìˆ¨ê¸°ê¸°
                    document.querySelectorAll('.warning-tab-content').forEach(content => {
                        content.style.display = 'none';
                    });

                    // í•´ë‹¹ ì»¨í…ì¸  í‘œì‹œ
                    const contentIdMap = {
                        'aiAlert': 'warningTabAiAlert',
                        'cpa': 'warningTabCpa',
                        'products': 'warningTabProducts'
                    };
                    const contentId = contentIdMap[targetTab] || 'warningTabCpa';
                    const targetContent = document.getElementById(contentId);
                    if (targetContent) {
                        targetContent.style.display = 'block';
                    }
                });
            });
        }

        // íƒ­ 3: íƒ€ê²Ÿ ë¶„ì„ - ì‚¬ìš©ì ì¹œí™”ì  ë²„ì „
        function renderTargetingTab() {
            const periodData = getPeriodData();
            const genderData = (periodData.gender_performance || []).filter(g => isValidGender(g.gender));
            const deviceData = (periodData.device_performance || []).filter(d =>
                d.device && d.device.toLowerCase() !== 'uncategorized' && d.device.toLowerCase() !== 'unknown'
            );
            const devicePlatformData = (periodData.deviceplatform_performance || []).filter(d =>
                d.deviceplatform && d.deviceplatform.toLowerCase() !== 'uncategorized' && d.deviceplatform.toLowerCase() !== 'unknown'
            );
            const ageGenderData = (periodData.age_gender_combinations || []).filter(item =>
                isValidGender(item.gender) && isValidAge(item.age)
            );
            const summary = periodData.summary || {};
            const avgCpa = summary.overall_cpa || 0;

            // ì„ íƒëœ ê¸°ê°„ ì •ë³´
            const periodLabels = {'full': 'ì „ì²´ ê¸°ê°„', '180d': 'ìµœê·¼ 180ì¼', '90d': 'ìµœê·¼ 90ì¼'};
            const currentPeriodLabel = periodLabels[currentPeriod] || 'ì „ì²´ ê¸°ê°„';

            let html = '';

            // ì¸íŠ¸ë¡œ ë©”ì‹œì§€ - í˜¸ë²„ íˆ´íŒ ì ìš© (ê¸°ê°„ í‘œì‹œ ì¶”ê°€)
            html += `
                <div class="hoverable-card"
                     data-tooltip-title="íƒ€ê²Ÿ ë¶„ì„"
                     data-tooltip-icon="ğŸ‘¥"
                     data-tooltip-insight="ê´‘ê³ ë¥¼ íŠ¹ì • ê·¸ë£¹(ì„±ë³„, ë‚˜ì´, ê´€ì‹¬ì‚¬ ë“±)ì—ê²Œë§Œ ë³´ì—¬ì£¼ëŠ” ê²ƒì„ íƒ€ê²ŸíŒ…ì´ë¼ê³  í•©ë‹ˆë‹¤."
                     data-tooltip-recommendation="íš¨ìœ¨ì ì¸ íƒ€ê²Ÿì— ì§‘ì¤‘í•˜ë©´ ê°™ì€ ë¹„ìš©ìœ¼ë¡œ ë” ë§ì€ ì„±ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆì–´ìš”."
                     style="margin-bottom: 16px; padding: 16px 20px; background: linear-gradient(135deg, #e8eaf6 0%, #f5f5ff 100%); border-radius: 12px; border-left: 4px solid #5c6bc0;">
                    <div style="display: flex; align-items: flex-start; gap: 12px;">
                        <span style="font-size: 28px;">ğŸ‘¥</span>
                        <div style="flex: 1;">
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                                <span style="font-size: 14px; font-weight: 700; color: #3949ab;">ëˆ„êµ¬ì—ê²Œ ê´‘ê³ ë¥¼ ë³´ì—¬ì¤˜ì•¼ íš¨ê³¼ì ì¼ê¹Œìš”?</span>
                                <span style="font-size: 10px; color: #5c6bc0; background: rgba(92, 107, 192, 0.1); padding: 2px 8px; border-radius: 10px; margin-left: auto;">${currentPeriodLabel} ê¸°ì¤€</span>
                            </div>
                            <div style="font-size: 12px; color: var(--grey-700); line-height: 1.6;">
                                ì„±ë³„, ì—°ë ¹, ê¸°ê¸°ë³„ë¡œ <strong>ì–´ë–¤ ê³ ê°ì´ ê°€ì¥ ì˜ ë°˜ì‘í•˜ëŠ”ì§€</strong> ë¶„ì„í–ˆìŠµë‹ˆë‹¤.
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // 1. í•µì‹¬ íƒ€ê²Ÿ ìš”ì•½ (í° ì¹´ë“œ)
            const topGender = genderData.length > 0 ? [...genderData].sort((a, b) => b.roas - a.roas)[0] : null;
            const topDevice = deviceData.length > 0 ? [...deviceData].sort((a, b) => b.roas - a.roas)[0] : null;
            const topAgeGender = ageGenderData.length > 0 ? ageGenderData[0] : null;

            html += `
                <div style="margin-bottom: 16px; padding: 16px; background: white; border-radius: 12px; border: 1px solid var(--grey-200);">
                    <div style="font-size: 13px; font-weight: 700; color: var(--grey-900); margin-bottom: 12px;">ğŸ† ê°€ì¥ íš¨ê³¼ì ì¸ íƒ€ê²Ÿ</div>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;">
            `;

            // ìµœê³  ì„±ë³„
            if (topGender) {
                const normalizedGender = normalizeGender(topGender.gender) || topGender.gender;
                html += `
                    <div style="padding: 12px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8f4 100%); border-radius: 10px; text-align: center;">
                        <div style="font-size: 24px; margin-bottom: 4px;">ğŸ‘¤</div>
                        <div style="font-size: 10px; color: var(--grey-500); margin-bottom: 2px;">ì„±ë³„</div>
                        <div style="font-size: 16px; font-weight: 800; color: #2e7d32;">${normalizedGender}</div>
                        <div style="font-size: 11px; color: var(--grey-600); margin-top: 4px;">ROAS ${formatPercent(topGender.roas)}</div>
                    </div>
                `;
            }

            // ìµœê³  ê¸°ê¸°ìœ í˜•
            if (topDevice) {
                html += `
                    <div style="padding: 12px; background: linear-gradient(135deg, #e3f2fd 0%, #f0f7ff 100%); border-radius: 10px; text-align: center;">
                        <div style="font-size: 24px; margin-bottom: 4px;">ğŸ“±</div>
                        <div style="font-size: 10px; color: var(--grey-500); margin-bottom: 2px;">ê¸°ê¸°</div>
                        <div style="font-size: 16px; font-weight: 800; color: #1565c0;">${topDevice.device}</div>
                        <div style="font-size: 11px; color: var(--grey-600); margin-top: 4px;">ROAS ${formatPercent(topDevice.roas)}</div>
                    </div>
                `;
            }

            // ìµœê³  ì—°ë ¹Ã—ì„±ë³„
            if (topAgeGender) {
                const normalizedGender = normalizeGender(topAgeGender.gender) || topAgeGender.gender;
                html += `
                    <div style="padding: 12px; background: linear-gradient(135deg, #f3e5f5 0%, #fce4ec 100%); border-radius: 10px; text-align: center;">
                        <div style="font-size: 24px; margin-bottom: 4px;">ğŸ¯</div>
                        <div style="font-size: 10px; color: var(--grey-500); margin-bottom: 2px;">ìµœê³  ì¡°í•©</div>
                        <div style="font-size: 14px; font-weight: 800; color: #7b1fa2;">${topAgeGender.age}</div>
                        <div style="font-size: 11px; color: var(--grey-600);">${normalizedGender}</div>
                    </div>
                `;
            }

            html += `</div></div>`;

            // 2. ì„±ë³„ ë¹„êµ (ì‹œê°ì ) - í˜¸ë²„ íˆ´íŒ ì ìš©
            if (genderData.length > 0) {
                html += `
                    <div class="hoverable-card"
                         data-tooltip-title="ì„±ë³„ ë¹„êµ"
                         data-tooltip-icon="ğŸ‘¥"
                         data-tooltip-insight="ê°™ì€ ê´‘ê³ ë¥¼ ë´¤ì„ ë•Œ ë‚¨ì„±ê³¼ ì—¬ì„± ì¤‘ ëˆ„ê°€ ë” ì˜ êµ¬ë§¤í–ˆëŠ”ì§€ ë¹„êµí•©ë‹ˆë‹¤."
                         data-tooltip-recommendation="íš¨ìœ¨ì´ ë†’ì€ ì„±ë³„ì— ì˜ˆì‚°ì„ ì§‘ì¤‘í•˜ë©´ ì„±ê³¼ê°€ ê°œì„ ë©ë‹ˆë‹¤."
                         style="margin-bottom: 12px; padding: 14px; background: white; border-radius: 10px; border: 1px solid var(--grey-200);">
                        <div style="font-size: 12px; font-weight: 700; color: var(--grey-900); margin-bottom: 12px;">
                            ğŸ‘¥ ì„±ë³„ ë¹„êµ
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px;">
                `;

                const sortedGender = [...genderData].sort((a, b) => b.roas - a.roas);
                sortedGender.forEach((g, idx) => {
                    const normalizedGender = normalizeGender(g.gender) || g.gender;
                    const cpa = g.conversions > 0 ? g.cost / g.conversions : 0;
                    const isTop = idx === 0;
                    html += `
                        <div style="padding: 12px; background: ${isTop ? '#e8f5e9' : '#f5f5f5'}; border-radius: 8px; ${isTop ? 'border: 2px solid #4caf50;' : ''}">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <span style="font-size: 13px; font-weight: 700; color: var(--grey-800);">${normalizedGender}</span>
                                ${isTop ? '<span style="font-size: 10px; padding: 2px 6px; background: #4caf50; color: white; border-radius: 8px;">ì¶”ì²œ</span>' : ''}
                            </div>
                            <div style="font-size: 18px; font-weight: 800; color: ${isTop ? '#2e7d32' : 'var(--grey-700)'}; margin-bottom: 4px;">${formatPercent(g.roas)}</div>
                            <div style="font-size: 10px; color: var(--grey-500);">ì „í™˜ë‹¹ ${formatCurrency(cpa)}</div>
                        </div>
                    `;
                });

                html += `</div></div>`;
            }

            // 3. ê¸°ê¸°í”Œë«í¼ë³„ ì„±ê³¼ (ì›¹/ì•±/ëª¨ë°”ì¼)
            if (devicePlatformData.length > 0) {
                const maxDevicePlatformRoas = Math.max(...devicePlatformData.map(d => d.roas || 0));
                html += `
                    <div style="border: 1px solid var(--grey-200); border-radius: 10px; overflow: hidden; margin-bottom: 12px;">
                        <div style="padding: 10px 14px; background: #fafafa; cursor: pointer; display: flex; justify-content: space-between; align-items: center;"
                             onclick="this.nextElementSibling.style.display = this.nextElementSibling.style.display === 'none' ? 'block' : 'none'; this.querySelector('.toggle-icon').textContent = this.nextElementSibling.style.display === 'none' ? 'â–¶' : 'â–¼';">
                            <span style="font-size: 12px; font-weight: 600; color: var(--grey-800);">ğŸ“± ê¸°ê¸°í”Œë«í¼ë³„ ì„±ê³¼</span>
                            <span class="toggle-icon" style="font-size: 10px; color: var(--grey-500);">â–¶</span>
                        </div>
                        <div style="display: none; padding: 12px;">
                            <div style="font-size: 10px; color: var(--grey-600); margin-bottom: 10px; padding: 8px; background: #e3f2fd; border-radius: 6px;">
                                ğŸ’¡ ì›¹, ì•±, ëª¨ë°”ì¼ì—ì„œì˜ ê´‘ê³  ë°˜ì‘ ì°¨ì´ë¥¼ íŒŒì•…í•˜ì„¸ìš”
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px;">
                `;

                const sortedDevicePlatforms = [...devicePlatformData].sort((a, b) => (b.roas || 0) - (a.roas || 0));
                sortedDevicePlatforms.forEach((d, idx) => {
                    const cpa = d.conversions > 0 ? d.cost / d.conversions : 0;
                    const isTop = idx === 0;
                    const platformName = d.deviceplatform || '';
                    const platformIcon = platformName.toLowerCase().includes('ì•±') ? 'ğŸ“²' :
                                        platformName.toLowerCase().includes('ì›¹') ? 'ğŸŒ' :
                                        platformName.toLowerCase().includes('ëª¨ë°”ì¼') ? 'ğŸ“±' : 'ğŸ–¥ï¸';
                    // ROAS ìƒ‰ìƒ ìŠ¤ì¼€ì¼
                    const roas = d.roas || 0;
                    let roasColor = '#c62828';
                    if (roas >= 500) roasColor = '#2e7d32';
                    else if (roas >= 300) roasColor = '#558b2f';
                    else if (roas >= 200) roasColor = '#f57f17';
                    else if (roas >= 100) roasColor = '#e65100';

                    html += `
                        <div style="padding: 12px; background: ${isTop ? '#e8f5e9' : '#f5f5f5'}; border-radius: 8px; ${isTop ? 'border: 2px solid #4caf50;' : ''}">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <span style="font-size: 13px; font-weight: 700; color: var(--grey-800);">${platformIcon} ${platformName}</span>
                                ${isTop ? '<span style="font-size: 10px; padding: 2px 6px; background: #4caf50; color: white; border-radius: 8px;">ì¶”ì²œ</span>' : ''}
                            </div>
                            <div style="font-size: 18px; font-weight: 800; color: ${roasColor}; margin-bottom: 4px;">${formatPercent(d.roas || 0)}</div>
                            <div style="display: flex; justify-content: space-between; font-size: 10px; color: var(--grey-500);">
                                <span>ì „í™˜ë‹¹ ${formatCurrency(cpa)}</span>
                                <span>ë¹„ìš© ${formatCurrency(d.cost || 0)}</span>
                            </div>
                        </div>
                    `;
                });

                html += `</div></div></div>`;
            }

            // 4. ê¸°ê¸°ë³„ ì„±ê³¼ (ì•ˆë“œë¡œì´ë“œ/ì• í”Œ/ì›¹)
            if (deviceData.length > 0) {
                const maxDeviceRoas = Math.max(...deviceData.map(d => d.roas || 0));
                html += `
                    <div style="border: 1px solid var(--grey-200); border-radius: 10px; overflow: hidden; margin-bottom: 12px;">
                        <div style="padding: 10px 14px; background: #fafafa; cursor: pointer; display: flex; justify-content: space-between; align-items: center;"
                             onclick="this.nextElementSibling.style.display = this.nextElementSibling.style.display === 'none' ? 'block' : 'none'; this.querySelector('.toggle-icon').textContent = this.nextElementSibling.style.display === 'none' ? 'â–¶' : 'â–¼';">
                            <span style="font-size: 12px; font-weight: 600; color: var(--grey-800);">ğŸ’» ê¸°ê¸°ë³„ ì„±ê³¼</span>
                            <span class="toggle-icon" style="font-size: 10px; color: var(--grey-500);">â–¶</span>
                        </div>
                        <div style="display: none; padding: 12px;">
                `;

                const sortedDevice = [...deviceData].sort((a, b) => b.roas - a.roas);
                sortedDevice.slice(0, 5).forEach((d, idx) => {
                    const cpa = d.conversions > 0 ? d.cost / d.conversions : 0;
                    // ROAS ìƒ‰ìƒ ìŠ¤ì¼€ì¼
                    const roas = d.roas || 0;
                    let roasColor = '#c62828';
                    if (roas >= 500) roasColor = '#2e7d32';
                    else if (roas >= 300) roasColor = '#558b2f';
                    else if (roas >= 200) roasColor = '#f57f17';
                    else if (roas >= 100) roasColor = '#e65100';
                    // ë°°ê²½ ìŠ¤ì¼€ì¼ ë°”
                    const barWidth = Math.min((roas / maxDeviceRoas) * 100, 100);

                    html += `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 12px; margin-bottom: 6px; background: #fafafa; border-radius: 8px; position: relative; overflow: hidden;">
                            <div style="position: absolute; top: 0; left: 0; height: 100%; width: ${barWidth}%; background: linear-gradient(90deg, ${roasColor}22, ${roasColor}11); border-radius: 8px;"></div>
                            <div style="position: relative; z-index: 1; font-size: 12px; font-weight: 600; color: var(--grey-800);">${idx === 0 ? 'ğŸ¥‡' : idx === 1 ? 'ğŸ¥ˆ' : idx === 2 ? 'ğŸ¥‰' : `${idx + 1}.`} ${d.device}</div>
                            <div style="position: relative; z-index: 1; font-size: 13px; font-weight: 700; color: ${roasColor};">${formatPercent(d.roas)}</div>
                        </div>
                    `;
                });

                html += `</div></div>`;
            }

            // 5. ì—°ë ¹+ì„±ë³„ ì¡°í•© TOP 5 - ì„¸ ë²ˆì§¸
            if (ageGenderData.length > 0) {
                const maxAgeGenderRoas = Math.max(...ageGenderData.slice(0, 5).map(item => item.roas || 0));
                html += `
                    <div style="border: 1px solid var(--grey-200); border-radius: 10px; overflow: hidden;">
                        <div style="padding: 10px 14px; background: #fafafa; cursor: pointer; display: flex; justify-content: space-between; align-items: center;"
                             onclick="this.nextElementSibling.style.display = this.nextElementSibling.style.display === 'none' ? 'block' : 'none'; this.querySelector('.toggle-icon').textContent = this.nextElementSibling.style.display === 'none' ? 'â–¶' : 'â–¼';">
                            <span style="font-size: 12px; font-weight: 600; color: var(--grey-800);">ğŸ¯ ì—°ë ¹+ì„±ë³„ ì¡°í•© TOP 5</span>
                            <span class="toggle-icon" style="font-size: 10px; color: var(--grey-500);">â–¶</span>
                        </div>
                        <div style="display: none; padding: 12px;">
                            <div style="font-size: 10px; color: var(--grey-600); margin-bottom: 10px; padding: 8px; background: #f5f5f5; border-radius: 6px;">
                                ğŸ’¡ ì´ ì¡°í•©ì˜ íƒ€ê²Ÿì—ê²Œ ê´‘ê³ ë¥¼ ì§‘ì¤‘í•˜ë©´ ë” ì¢‹ì€ ì„±ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆì–´ìš”
                            </div>
                `;

                ageGenderData.slice(0, 5).forEach((item, idx) => {
                    const normalizedGender = normalizeGender(item.gender) || item.gender;
                    const medal = idx === 0 ? 'ğŸ¥‡' : idx === 1 ? 'ğŸ¥ˆ' : idx === 2 ? 'ğŸ¥‰' : `${idx + 1}.`;
                    // ROAS ìƒ‰ìƒ ìŠ¤ì¼€ì¼
                    const roas = item.roas || 0;
                    let roasColor = '#c62828';
                    if (roas >= 500) roasColor = '#2e7d32';
                    else if (roas >= 300) roasColor = '#558b2f';
                    else if (roas >= 200) roasColor = '#f57f17';
                    else if (roas >= 100) roasColor = '#e65100';
                    // ë°°ê²½ ìŠ¤ì¼€ì¼ ë°”
                    const barWidth = Math.min((roas / maxAgeGenderRoas) * 100, 100);

                    html += `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 12px; margin-bottom: 6px; background: #fafafa; border-radius: 8px; position: relative; overflow: hidden;">
                            <div style="position: absolute; top: 0; left: 0; height: 100%; width: ${barWidth}%; background: linear-gradient(90deg, ${roasColor}22, ${roasColor}11); border-radius: 8px;"></div>
                            <div style="position: relative; z-index: 1;">
                                <span style="font-size: 14px;">${medal}</span>
                                <span style="font-size: 12px; font-weight: 600; margin-left: 8px; color: var(--grey-800);">${item.age} ${normalizedGender}</span>
                            </div>
                            <div style="position: relative; z-index: 1; font-size: 14px; font-weight: 800; color: ${roasColor};">${formatPercent(item.roas)}</div>
                        </div>
                    `;
                });

                html += `</div></div>`;
            }

            // 5. ì‹¤í–‰ ê°€ì´ë“œ
            html += `
                <div style="margin-top: 16px; padding: 12px 14px; background: linear-gradient(135deg, #e8eaf6 0%, #f5f5ff 100%); border-radius: 10px; border-left: 3px solid #5c6bc0;">
                    <div style="font-size: 11px; font-weight: 600; color: #3949ab; margin-bottom: 6px;">ğŸ’¡ ì´ë ‡ê²Œ í™œìš©í•˜ì„¸ìš”</div>
                    <div style="font-size: 11px; color: var(--grey-800); line-height: 1.7;">
                        1. ğŸ† í‘œì‹œëœ íƒ€ê²Ÿì—ê²Œ <strong>ê´‘ê³  ì˜ˆì‚°ì„ ë” ë°°ì •</strong>í•˜ì„¸ìš”<br>
                        2. íš¨ìœ¨ ë‚®ì€ íƒ€ê²Ÿì€ ê´‘ê³  <strong>ë…¸ì¶œì„ ì¤„ì´ê±°ë‚˜ ì œì™¸</strong>í•˜ì„¸ìš”<br>
                        3. ì—°ë ¹+ì„±ë³„ ì¡°í•©ìœ¼ë¡œ <strong>ë§ì¶¤ ê´‘ê³  ì†Œì¬</strong>ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”
                    </div>
                </div>
            `;

            document.getElementById('targetingContent').innerHTML = html;
        }

        // íƒ­ 5: AI ì˜ˆì¸¡ (Prophet Forecast)
        function renderForecastTab() {
            const periodData = getPeriodData();
            const forecast = periodData.prophet_forecast || null;
            let html = '';

            // forecast ë°ì´í„°ê°€ ì—†ì–´ë„ insightsData ê¸°ë°˜ AI ë¶„ì„ í‘œì‹œ
            if (!forecast) {
                // ì¸íŠ¸ë¡œ ë©”ì‹œì§€ - í˜¸ë²„ íˆ´íŒ ì ìš©
                html += `
                    <div class="hoverable-card"
                         data-tooltip-title="AI ë°ì´í„° ë¶„ì„"
                         data-tooltip-icon="ğŸ¤–"
                         data-tooltip-insight="í˜„ì¬ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ AIê°€ ë¶„ì„í•œ ê¸°íšŒì™€ ì¶”ì²œ ì•¡ì…˜ì…ë‹ˆë‹¤."
                         data-tooltip-recommendation="AI ì¶”ì²œì„ ì°¸ê³ í•˜ì—¬ ê´‘ê³  ì „ëµì„ ìµœì í™”í•˜ì„¸ìš”."
                         style="margin-bottom: 16px; padding: 14px 18px; background: linear-gradient(135deg, #e8eaf6 0%, #f3e5f5 100%); border-radius: 12px; border-left: 4px solid #7c4dff;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 18px;">ğŸ¤–</span>
                            <span style="font-size: 13px; font-weight: 700; color: #5e35b1;">AI ë°ì´í„° ë¶„ì„ ì¸ì‚¬ì´íŠ¸</span>
                        </div>
                        <div style="font-size: 11px; color: #7c4dff; margin-top: 6px;">ğŸ“Š í˜„ì¬ ê´‘ê³  ì„±ê³¼ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë¶„ì„í–ˆìŠµë‹ˆë‹¤</div>
                    </div>
                `;

                // í•µì‹¬ ì„±ê³¼ ìš”ì•½ (periodData ê¸°ë°˜)
                if (periodData && periodData.summary) {
                    const summary = periodData.summary;
                    const overallRoas = summary.overall_roas || 0;
                    const overallCpa = summary.overall_cpa || 0;
                    const isPositiveRoas = overallRoas >= 100;

                    html += `
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 16px;">
                            <div style="padding: 14px; background: ${isPositiveRoas ? 'linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%)' : 'linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%)'}; border-radius: 10px; text-align: center;">
                                <div style="font-size: 10px; color: ${isPositiveRoas ? '#2e7d32' : '#c62828'}; font-weight: 600; margin-bottom: 2px;">
                                    ${isPositiveRoas ? 'ğŸ“ˆ ì „ì²´ ROAS' : 'ğŸ“‰ ì „ì²´ ROAS'}
                                </div>
                                <div style="font-size: 22px; font-weight: 800; color: ${isPositiveRoas ? '#1b5e20' : '#b71c1c'};">${overallRoas.toFixed(0)}%</div>
                            </div>
                            <div style="padding: 14px; background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); border-radius: 10px; text-align: center;">
                                <div style="font-size: 10px; color: #1565c0; font-weight: 600; margin-bottom: 2px;">ğŸ’° í‰ê·  CPA</div>
                                <div style="font-size: 18px; font-weight: 800; color: #0d47a1;">${formatCurrency(overallCpa)}</div>
                            </div>
                            <div style="padding: 14px; background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%); border-radius: 10px; text-align: center;">
                                <div style="font-size: 10px; color: #e65100; font-weight: 600; margin-bottom: 2px;">ğŸ“Š ì „í™˜ ìˆ˜</div>
                                <div style="font-size: 18px; font-weight: 700; color: #bf360c;">${formatNumber(summary.total_conversions || 0)}</div>
                            </div>
                        </div>
                    `;
                }

                // ìµœì  íƒ€ê²Ÿ ì •ë³´ (insightsData ê¸°ë°˜)
                html += `<div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 16px;">`;

                // ìµœì  ì±„ë„
                if (periodData && periodData.top_categories && periodData.top_categories.length > 0) {
                    const sorted = [...periodData.top_categories].sort((a, b) => (b.roas || 0) - (a.roas || 0));
                    const top = sorted[0];
                    if (top) {
                        html += `
                            <div style="padding: 12px; background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); border-radius: 10px; text-align: center;">
                                <div style="font-size: 9px; color: #1565c0; font-weight: 600; margin-bottom: 2px;">ğŸ“Š ìµœì  ì±„ë„</div>
                                <div style="font-size: 11px; font-weight: 700; color: #0d47a1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${top.name}</div>
                                <div style="font-size: 10px; color: #1565c0;">ROAS ${(top.roas || 0).toFixed(0)}%</div>
                            </div>
                        `;
                    }
                }

                // ìµœì  ì„±ë³„
                if (periodData && periodData.gender_performance && periodData.gender_performance.length > 0) {
                    const validGenders = periodData.gender_performance.filter(function(g) { return g.cost > 0 && isValidGender(g.gender); });
                    if (validGenders.length > 0) {
                        const sorted = [...validGenders].sort((a, b) => (b.roas || 0) - (a.roas || 0));
                        const top = sorted[0];
                        if (top) {
                            const genderName = normalizeGender(top.gender) || top.gender;
                            html += `
                                <div style="padding: 12px; background: linear-gradient(135deg, #fce4ec 0%, #f8bbd9 100%); border-radius: 10px; text-align: center;">
                                    <div style="font-size: 9px; color: #c2185b; font-weight: 600; margin-bottom: 2px;">ğŸ‘« ìµœì  ì„±ë³„</div>
                                    <div style="font-size: 12px; font-weight: 700; color: #880e4f;">${genderName}</div>
                                    <div style="font-size: 10px; color: #c2185b;">ROAS ${(top.roas || 0).toFixed(0)}%</div>
                                </div>
                            `;
                        }
                    }
                }

                // ìµœì  ìƒí’ˆ
                if (periodData && periodData.product_performance && periodData.product_performance.length > 0) {
                    const sorted = [...periodData.product_performance].sort((a, b) => (b.roas || 0) - (a.roas || 0));
                    const top = sorted[0];
                    if (top) {
                        html += `
                            <div style="padding: 12px; background: linear-gradient(135deg, #e8eaf6 0%, #c5cae9 100%); border-radius: 10px; text-align: center;">
                                <div style="font-size: 9px; color: #3949ab; font-weight: 600; margin-bottom: 2px;">ğŸ›ï¸ ìµœì  ìƒí’ˆ</div>
                                <div style="font-size: 11px; font-weight: 700; color: #1a237e;">${top.product}</div>
                                <div style="font-size: 10px; color: #3949ab;">ROAS ${(top.roas || 0).toFixed(0)}%</div>
                            </div>
                        `;
                    }
                }
                html += '</div>';

                // ì±„ë„ë³„ ROAS ìˆœìœ„ (ì»´íŒ©íŠ¸ í…Œì´ë¸”)
                if (periodData && periodData.top_categories && periodData.top_categories.length > 1) {
                    const sorted = [...periodData.top_categories].sort((a, b) => (b.roas || 0) - (a.roas || 0));
                    html += `
                        <div style="margin-bottom: 12px; padding: 12px; background: white; border: 1px solid var(--grey-200); border-radius: 10px;">
                            <div style="font-size: 11px; font-weight: 700; color: #333; margin-bottom: 10px; display: flex; align-items: center; gap: 6px;">
                                <span>ğŸ“ˆ</span> ì±„ë„ë³„ ROAS ìˆœìœ„
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 6px;">
                    `;
                    sorted.slice(0, 6).forEach((cat, idx) => {
                        const roas = cat.roas || 0;
                        const isGood = roas >= 100;
                        const medal = idx === 0 ? 'ğŸ¥‡' : idx === 1 ? 'ğŸ¥ˆ' : idx === 2 ? 'ğŸ¥‰' : '';
                        html += `
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 6px 8px; background: ${isGood ? '#f1f8e9' : '#fff3e0'}; border-radius: 6px; font-size: 10px;">
                                <span style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 100px;">${medal} ${cat.name}</span>
                                <span style="font-weight: 700; color: ${isGood ? '#2e7d32' : '#e65100'};">${roas.toFixed(0)}%</span>
                            </div>
                        `;
                    });
                    html += `
                            </div>
                        </div>
                    `;
                }

                // AIê°€ ë°œê²¬í•œ ê¸°íšŒ (insightsData ê¸°ë°˜)
                const opportunityData = generateAIOpportunities(null) || [];
                const opportunityCount = opportunityData.length;

                let opportunityItemsHtml = '';
                if (opportunityData.length > 0) {
                    opportunityData.forEach(function(item, idx) {
                        const borderStyle = idx === opportunityData.length - 1 ? 'border-bottom: none;' : '';
                        const metricHtml = item.metric ? '<div style="margin-top: 6px; font-size: 10px; font-weight: 600; color: #2e7d32; background: #e8f5e9; padding: 4px 8px; border-radius: 4px; display: inline-block;">' + item.metric + '</div>' : '';
                        opportunityItemsHtml += '<div style="padding: 12px 16px; border-bottom: 1px solid #fce4ec; ' + borderStyle + '">' +
                            '<div style="display: flex; align-items: flex-start; gap: 10px;">' +
                                '<span style="font-size: 16px; flex-shrink: 0;">' + item.icon + '</span>' +
                                '<div style="flex: 1;">' +
                                    '<div style="font-size: 11px; font-weight: 600; color: #880e4f; margin-bottom: 4px;">' + item.title + '</div>' +
                                    '<div style="font-size: 10px; color: #666; line-height: 1.5;">' + item.description + '</div>' +
                                    metricHtml +
                                '</div>' +
                            '</div>' +
                        '</div>';
                    });
                } else {
                    opportunityItemsHtml = '<div style="padding: 16px; text-align: center; color: #666; font-size: 11px;">ë°ì´í„°ë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</div>';
                }

                html += '<div class="forecast-accordion" style="margin-bottom: 10px; border-radius: 10px; overflow: hidden; border: 1px solid #f8bbd0;">' +
                    '<div class="forecast-accordion-header" data-target="forecastOpportunityContent" style="background: linear-gradient(135deg, #fce4ec 0%, #f8bbd9 100%); padding: 12px 16px; cursor: pointer; display: flex; justify-content: space-between; align-items: center;">' +
                        '<div style="display: flex; align-items: center; gap: 8px;">' +
                            '<span style="font-size: 14px;">ğŸš€</span>' +
                            '<span style="font-size: 12px; font-weight: 700; color: #880e4f;">AIê°€ ë°œê²¬í•œ ê¸°íšŒ (' + opportunityCount + 'ê±´)</span>' +
                        '</div>' +
                        '<span class="forecast-accordion-icon" style="font-size: 12px; color: #880e4f; transition: transform 0.3s;">â–¼</span>' +
                    '</div>' +
                    '<div id="forecastOpportunityContent" class="forecast-accordion-content" style="display: none; background: #fff5f7; padding: 0;">' +
                        opportunityItemsHtml +
                    '</div>' +
                '</div>';

                // AI ì¶”ì²œ ì•¡ì…˜ (insightsData ê¸°ë°˜)
                const actionData = generateAIActions(null) || [];
                const actionCount = actionData.length;

                let actionItemsHtml = '';
                if (actionData.length > 0) {
                    actionData.forEach(function(item, idx) {
                        const borderStyle = idx === actionData.length - 1 ? 'border-bottom: none;' : '';
                        let priorityBadge = '';
                        if (item.priority === 'high') {
                            priorityBadge = '<span style="background: #ffebee; color: #c62828; font-size: 9px; padding: 2px 6px; border-radius: 10px; margin-left: 6px;">ê¸´ê¸‰</span>';
                        } else if (item.priority === 'medium') {
                            priorityBadge = '<span style="background: #fff3e0; color: #e65100; font-size: 9px; padding: 2px 6px; border-radius: 10px; margin-left: 6px;">ì¤‘ìš”</span>';
                        }
                        const effectHtml = item.expectedEffect ? '<div style="margin-top: 6px; font-size: 10px; font-weight: 600; color: #1565c0; background: #e3f2fd; padding: 4px 8px; border-radius: 4px; display: inline-block;">ì˜ˆìƒ íš¨ê³¼: ' + item.expectedEffect + '</div>' : '';
                        actionItemsHtml += '<div style="padding: 12px 16px; border-bottom: 1px solid #fff9c4; ' + borderStyle + '">' +
                            '<div style="display: flex; align-items: flex-start; gap: 10px;">' +
                                '<span style="font-size: 16px; flex-shrink: 0;">' + item.icon + '</span>' +
                                '<div style="flex: 1;">' +
                                    '<div style="font-size: 11px; font-weight: 600; color: #f57f17; margin-bottom: 4px;">' + item.title + priorityBadge + '</div>' +
                                    '<div style="font-size: 10px; color: #666; line-height: 1.5;">' + item.description + '</div>' +
                                    effectHtml +
                                '</div>' +
                            '</div>' +
                        '</div>';
                    });
                } else {
                    actionItemsHtml = '<div style="padding: 16px; text-align: center; color: #666; font-size: 11px;">ë°ì´í„°ë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</div>';
                }

                html += '<div class="forecast-accordion" style="margin-bottom: 12px; border-radius: 10px; overflow: hidden; border: 1px solid #fff176;">' +
                    '<div class="forecast-accordion-header" data-target="forecastActionContent" style="background: linear-gradient(135deg, #fffde7 0%, #fff9c4 100%); padding: 12px 16px; cursor: pointer; display: flex; justify-content: space-between; align-items: center;">' +
                        '<div style="display: flex; align-items: center; gap: 8px;">' +
                            '<span style="font-size: 14px;">ğŸ’¡</span>' +
                            '<span style="font-size: 12px; font-weight: 700; color: #f57f17;">AI ì¶”ì²œ ì•¡ì…˜ (' + actionCount + 'ê±´)</span>' +
                        '</div>' +
                        '<span class="forecast-accordion-icon" style="font-size: 12px; color: #f57f17; transition: transform 0.3s;">â–¼</span>' +
                    '</div>' +
                    '<div id="forecastActionContent" class="forecast-accordion-content" style="display: none; background: #fffef5; padding: 0;">' +
                        actionItemsHtml +
                    '</div>' +
                '</div>';

                // í™œìš© ê°€ì´ë“œ
                html += `
                    <div style="padding: 10px 12px; background: linear-gradient(135deg, #eceff1 0%, #cfd8dc 100%); border-radius: 8px;">
                        <div style="display: flex; flex-wrap: wrap; gap: 12px; font-size: 10px; color: #546e7a;">
                            <span>âœ… ROAS 100%+ ì±„ë„ì— ì˜ˆì‚° ì§‘ì¤‘</span>
                            <span>âœ… CPA ë†’ì€ ìƒí’ˆ ì†Œì¬/íƒ€ê²Ÿ ì ê²€</span>
                            <span>âœ… ê³ íš¨ìœ¨ íƒ€ê²Ÿ í™œìš©</span>
                        </div>
                    </div>
                `;

                document.getElementById('forecastContent').innerHTML = html;

                // ì•„ì½”ë””ì–¸ ì´ˆê¸°í™”
                initForecastAccordions();
                return;
            }

            // forecast ë°ì´í„°ê°€ ìˆëŠ” ê²½ìš°
            html = '';

            // ì„ íƒëœ ê¸°ê°„ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const periodLabels = {'full': 'ì „ì²´ ê¸°ê°„', '180d': 'ìµœê·¼ 180ì¼', '90d': 'ìµœê·¼ 90ì¼'};
            const currentPeriodLabel = periodLabels[currentPeriod] || 'ì „ì²´ ê¸°ê°„';

            // ì¸íŠ¸ë¡œ ë©”ì‹œì§€ - í˜¸ë²„ íˆ´íŒ ì ìš© (ê¸°ê°„ í‘œì‹œ ì¶”ê°€)
            html += `
                <div class="hoverable-card"
                     data-tooltip-title="AI ì˜ˆì¸¡ ë¶„ì„"
                     data-tooltip-icon="ğŸ”®"
                     data-tooltip-insight="ROAS(ê´‘ê³ ìˆ˜ìµë¥ )ê°€ 100% ì´ìƒì´ë©´ ê´‘ê³ ë¹„ë³´ë‹¤ ë§ì€ ìˆ˜ìµì´ ë°œìƒí•œë‹¤ëŠ” ì˜ë¯¸ì˜ˆìš”."
                     data-tooltip-recommendation="AI ì˜ˆì¸¡ì„ ì°¸ê³ í•˜ì—¬ ì˜ˆì‚° ë°°ë¶„ì„ ìµœì í™”í•˜ì„¸ìš”."
                     style="margin-bottom: 16px; padding: 14px 18px; background: linear-gradient(135deg, #e8eaf6 0%, #f3e5f5 100%); border-radius: 12px; border-left: 4px solid #7c4dff;">
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 18px;">ğŸ”®</span>
                        <span style="font-size: 13px; font-weight: 700; color: #5e35b1;">AI ë¶„ì„ ì¸ì‚¬ì´íŠ¸</span>
                        <span style="font-size: 10px; color: #7c4dff; background: rgba(124, 77, 255, 0.1); padding: 2px 8px; border-radius: 10px; margin-left: auto;">${currentPeriodLabel} ê¸°ì¤€</span>
                    </div>
                </div>
            `;

            // 1. í•µì‹¬ ì„±ê³¼ ìš”ì•½ (ì„ íƒëœ ê¸°ê°„ì˜ ì‹¤ì œ ë°ì´í„°) - ê¸°ê°„ë³„ë¡œ ë‹¤ë¥¸ ë°ì´í„° í‘œì‹œ
            if (periodData && periodData.summary) {
                const summary = periodData.summary;
                const actualRoas = summary.overall_roas || 0;
                const actualCpa = summary.overall_cpa || 0;
                const isPositiveRoas = actualRoas >= 100;
                const totalConversions = summary.total_conversions || 0;

                html += `
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 10px;">
                        <div style="padding: 14px; background: ${isPositiveRoas ? 'linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%)' : 'linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%)'}; border-radius: 10px; text-align: center;">
                            <div style="font-size: 10px; color: ${isPositiveRoas ? '#2e7d32' : '#c62828'}; font-weight: 600; margin-bottom: 2px;">
                                ${isPositiveRoas ? 'ğŸ“ˆ í˜„ì¬ ROAS' : 'ğŸ“‰ í˜„ì¬ ROAS'}
                            </div>
                            <div style="font-size: 22px; font-weight: 800; color: ${isPositiveRoas ? '#1b5e20' : '#b71c1c'};">${actualRoas.toFixed(0)}%</div>
                        </div>
                        <div style="padding: 14px; background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); border-radius: 10px; text-align: center;">
                            <div style="font-size: 10px; color: #1565c0; font-weight: 600; margin-bottom: 2px;">ğŸ’° í˜„ì¬ CPA</div>
                            <div style="font-size: 18px; font-weight: 800; color: #0d47a1;">${formatCurrency(actualCpa)}</div>
                        </div>
                        <div style="padding: 14px; background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%); border-radius: 10px; text-align: center;">
                            <div style="font-size: 10px; color: #e65100; font-weight: 600; margin-bottom: 2px;">ğŸ¯ ì „í™˜ ìˆ˜</div>
                            <div style="font-size: 16px; font-weight: 700; color: #bf360c;">${formatNumber(totalConversions)}</div>
                        </div>
                    </div>
                `;
            }

            // 2. ìµœì  íƒ€ê²Ÿ (ì„ íƒëœ ê¸°ê°„ì˜ ì‹¤ì œ ë°ì´í„° ì‚¬ìš©) - ê¸°ê°„ë³„ë¡œ ë‹¤ë¥¸ ë°ì´í„° í‘œì‹œ
            html += `<div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 16px;">`;

            // ìµœì  ê¸°ê¸°ìœ í˜• (periodData ì‚¬ìš©)
            if (periodData && periodData.device_performance && periodData.device_performance.length > 0) {
                const validDevices = periodData.device_performance.filter(d => d.cost > 0 && d.device !== 'Uncategorized' && d.device !== 'unknown');
                if (validDevices.length > 0) {
                    const sortedDevices = [...validDevices].sort((a, b) => (b.roas || 0) - (a.roas || 0));
                    const topDevice = sortedDevices[0];
                    html += `
                        <div style="padding: 12px; background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); border-radius: 10px; text-align: center;">
                            <div style="font-size: 9px; color: #1565c0; font-weight: 600; margin-bottom: 2px;">ğŸ“± ìµœì  ê¸°ê¸°</div>
                            <div style="font-size: 12px; font-weight: 700; color: #0d47a1;">${topDevice.device}</div>
                            <div style="font-size: 10px; color: #1565c0;">ROAS ${(topDevice.roas || 0).toFixed(0)}%</div>
                        </div>
                    `;
                }
            }

            // ìµœì  ì„±ë³„ (periodData ì‚¬ìš©)
            if (periodData && periodData.gender_performance && periodData.gender_performance.length > 0) {
                const validGenders = periodData.gender_performance.filter(g => g.cost > 0 && isValidGender(g.gender));
                if (validGenders.length > 0) {
                    const sorted = [...validGenders].sort((a, b) => (b.roas || 0) - (a.roas || 0));
                    const top = sorted[0];
                    html += `
                        <div style="padding: 12px; background: linear-gradient(135deg, #fce4ec 0%, #f8bbd9 100%); border-radius: 10px; text-align: center;">
                            <div style="font-size: 9px; color: #c2185b; font-weight: 600; margin-bottom: 2px;">ğŸ‘« ìµœì  ì„±ë³„</div>
                            <div style="font-size: 12px; font-weight: 700; color: #880e4f;">${normalizeGender(top.gender) || top.gender}</div>
                            <div style="font-size: 10px; color: #c2185b;">ROAS ${(top.roas || 0).toFixed(0)}%</div>
                        </div>
                    `;
                }
            }

            // ìµœì  ì—°ë ¹ (periodData ì‚¬ìš©) - age_gender_combinationsì—ì„œ ì¶”ì¶œ
            if (periodData && periodData.age_gender_combinations && periodData.age_gender_combinations.length > 0) {
                // ì—°ë ¹ë³„ë¡œ ê·¸ë£¹í•‘í•˜ì—¬ ROAS ê³„ì‚°
                const ageGroups = {};
                periodData.age_gender_combinations.forEach(item => {
                    const age = item.age;
                    if (!ageGroups[age]) {
                        ageGroups[age] = {age: age, totalRevenue: 0, totalCost: 0};
                    }
                    ageGroups[age].totalRevenue += item.revenue || 0;
                    ageGroups[age].totalCost += item.cost || 0;
                });
                const agePerformance = Object.values(ageGroups).map(g => ({
                    age: g.age,
                    roas: g.totalCost > 0 ? (g.totalRevenue / g.totalCost * 100) : 0
                })).filter(a => isValidAge(a.age) && a.roas > 0);

                if (agePerformance.length > 0) {
                    const sorted = agePerformance.sort((a, b) => b.roas - a.roas);
                    const top = sorted[0];
                    html += `
                        <div style="padding: 12px; background: linear-gradient(135deg, #e8eaf6 0%, #c5cae9 100%); border-radius: 10px; text-align: center;">
                            <div style="font-size: 9px; color: #3949ab; font-weight: 600; margin-bottom: 2px;">ğŸ‘¤ ìµœì  ì—°ë ¹</div>
                            <div style="font-size: 11px; font-weight: 700; color: #1a237e;">${top.age}</div>
                            <div style="font-size: 10px; color: #3949ab;">ROAS ${top.roas.toFixed(0)}%</div>
                        </div>
                    `;
                }
            }
            html += '</div>';

            // 3. ìƒí’ˆë³„ ì˜ˆì¸¡ + ì„œë¸Œíƒ­ (ì„±ë³„&ì—°ë ¹, ê¸°ê¸°, í”Œë«í¼, ë…¸ì¶œê¸°ê¸°)
            html += `
                <div style="margin-bottom: 16px; background: white; border: 1px solid var(--grey-200); border-radius: 12px; overflow: hidden;">
                    <div style="display: flex; border-bottom: 1px solid var(--grey-200); background: #f8f9fa;">
                        <button class="forecast-subtab active" data-subtab="product" style="flex: 1; padding: 10px 8px; font-size: 11px; font-weight: 600; border: none; background: none; cursor: pointer; color: var(--grey-600); border-bottom: 2px solid transparent;">ğŸ›ï¸ ìƒí’ˆë³„</button>
                        <button class="forecast-subtab" data-subtab="gender-age" style="flex: 1; padding: 10px 8px; font-size: 11px; font-weight: 600; border: none; background: none; cursor: pointer; color: var(--grey-600); border-bottom: 2px solid transparent;">ğŸ‘« ì„±ë³„&ì—°ë ¹</button>
                        <button class="forecast-subtab" data-subtab="deviceplatform" style="flex: 1; padding: 10px 8px; font-size: 11px; font-weight: 600; border: none; background: none; cursor: pointer; color: var(--grey-600); border-bottom: 2px solid transparent;">ğŸ“± ê¸°ê¸°í”Œë«í¼</button>
                        <button class="forecast-subtab" data-subtab="category" style="flex: 1; padding: 10px 8px; font-size: 11px; font-weight: 600; border: none; background: none; cursor: pointer; color: var(--grey-600); border-bottom: 2px solid transparent;">ğŸ“Š ì±„ë„</button>
                    </div>
                    <div id="forecastSubtabContent" style="padding: 12px;"></div>
                </div>
            `;

            // 4. AI ë°œê²¬ ê¸°íšŒ (í¼ì¹˜ê¸°/ì ‘ê¸°)
            const opportunityData = generateAIOpportunities(forecast) || [];
            const opportunityCount = opportunityData.length;

            let opportunityItemsHtml = '';
            if (opportunityData.length > 0) {
                opportunityData.forEach(function(item, idx) {
                    const borderStyle = idx === opportunityData.length - 1 ? 'border-bottom: none;' : '';
                    const metricHtml = item.metric ? '<div style="margin-top: 6px; font-size: 10px; font-weight: 600; color: #2e7d32; background: #e8f5e9; padding: 4px 8px; border-radius: 4px; display: inline-block;">' + item.metric + '</div>' : '';
                    opportunityItemsHtml += '<div style="padding: 12px 16px; border-bottom: 1px solid #fce4ec; ' + borderStyle + '">' +
                        '<div style="display: flex; align-items: flex-start; gap: 10px;">' +
                            '<span style="font-size: 16px; flex-shrink: 0;">' + item.icon + '</span>' +
                            '<div style="flex: 1;">' +
                                '<div style="font-size: 11px; font-weight: 600; color: #880e4f; margin-bottom: 4px;">' + item.title + '</div>' +
                                '<div style="font-size: 10px; color: #666; line-height: 1.5;">' + item.description + '</div>' +
                                metricHtml +
                            '</div>' +
                        '</div>' +
                    '</div>';
                });
            } else {
                opportunityItemsHtml = '<div style="padding: 16px; text-align: center; color: #666; font-size: 11px;">ë°ì´í„°ë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</div>';
            }

            html += '<div class="forecast-accordion" style="margin-bottom: 10px; border-radius: 10px; overflow: hidden; border: 1px solid #f8bbd0;">' +
                '<div class="forecast-accordion-header" data-target="forecastOpportunityContent" style="background: linear-gradient(135deg, #fce4ec 0%, #f8bbd9 100%); padding: 12px 16px; cursor: pointer; display: flex; justify-content: space-between; align-items: center;">' +
                    '<div style="display: flex; align-items: center; gap: 8px;">' +
                        '<span style="font-size: 14px;">ğŸš€</span>' +
                        '<span style="font-size: 12px; font-weight: 700; color: #880e4f;">AIê°€ ë°œê²¬í•œ ê¸°íšŒ (' + opportunityCount + 'ê±´)</span>' +
                    '</div>' +
                    '<span class="forecast-accordion-icon" style="font-size: 12px; color: #880e4f; transition: transform 0.3s;">â–¼</span>' +
                '</div>' +
                '<div id="forecastOpportunityContent" class="forecast-accordion-content" style="display: none; background: #fff5f7; padding: 0;">' +
                    opportunityItemsHtml +
                '</div>' +
            '</div>';

            // 5. AI ì¶”ì²œ ì•¡ì…˜ (í¼ì¹˜ê¸°/ì ‘ê¸°)
            const actionData = generateAIActions(forecast) || [];
            const actionCount = actionData.length;

            let actionItemsHtml = '';
            if (actionData.length > 0) {
                actionData.forEach(function(item, idx) {
                    const borderStyle = idx === actionData.length - 1 ? 'border-bottom: none;' : '';
                    let priorityBadge = '';
                    if (item.priority === 'high') {
                        priorityBadge = '<span style="background: #ffebee; color: #c62828; font-size: 9px; padding: 2px 6px; border-radius: 10px; margin-left: 6px;">ê¸´ê¸‰</span>';
                    } else if (item.priority === 'medium') {
                        priorityBadge = '<span style="background: #fff3e0; color: #e65100; font-size: 9px; padding: 2px 6px; border-radius: 10px; margin-left: 6px;">ì¤‘ìš”</span>';
                    }
                    const effectHtml = item.expectedEffect ? '<div style="margin-top: 6px; font-size: 10px; font-weight: 600; color: #1565c0; background: #e3f2fd; padding: 4px 8px; border-radius: 4px; display: inline-block;">ì˜ˆìƒ íš¨ê³¼: ' + item.expectedEffect + '</div>' : '';
                    actionItemsHtml += '<div style="padding: 12px 16px; border-bottom: 1px solid #fff9c4; ' + borderStyle + '">' +
                        '<div style="display: flex; align-items: flex-start; gap: 10px;">' +
                            '<span style="font-size: 16px; flex-shrink: 0;">' + item.icon + '</span>' +
                            '<div style="flex: 1;">' +
                                '<div style="font-size: 11px; font-weight: 600; color: #f57f17; margin-bottom: 4px;">' + item.title + priorityBadge + '</div>' +
                                '<div style="font-size: 10px; color: #666; line-height: 1.5;">' + item.description + '</div>' +
                                effectHtml +
                            '</div>' +
                        '</div>' +
                    '</div>';
                });
            } else {
                actionItemsHtml = '<div style="padding: 16px; text-align: center; color: #666; font-size: 11px;">ë°ì´í„°ë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</div>';
            }

            html += '<div class="forecast-accordion" style="margin-bottom: 12px; border-radius: 10px; overflow: hidden; border: 1px solid #fff176;">' +
                '<div class="forecast-accordion-header" data-target="forecastActionContent" style="background: linear-gradient(135deg, #fffde7 0%, #fff9c4 100%); padding: 12px 16px; cursor: pointer; display: flex; justify-content: space-between; align-items: center;">' +
                    '<div style="display: flex; align-items: center; gap: 8px;">' +
                        '<span style="font-size: 14px;">ğŸ’¡</span>' +
                        '<span style="font-size: 12px; font-weight: 700; color: #f57f17;">AI ì¶”ì²œ ì•¡ì…˜ (' + actionCount + 'ê±´)</span>' +
                    '</div>' +
                    '<span class="forecast-accordion-icon" style="font-size: 12px; color: #f57f17; transition: transform 0.3s;">â–¼</span>' +
                '</div>' +
                '<div id="forecastActionContent" class="forecast-accordion-content" style="display: none; background: #fffef5; padding: 0;">' +
                    actionItemsHtml +
                '</div>' +
            '</div>';

            // 5. ì˜ˆì¸¡ í™œìš© ê°€ì´ë“œ (ì»´íŒ©íŠ¸)
            html += `
                <div style="padding: 10px 12px; background: linear-gradient(135deg, #eceff1 0%, #cfd8dc 100%); border-radius: 8px;">
                    <div style="display: flex; flex-wrap: wrap; gap: 12px; font-size: 10px; color: #546e7a;">
                        <span>âœ… ROAS 100%+ ì±„ë„ì— ì˜ˆì‚° ì§‘ì¤‘</span>
                        <span>âœ… CPA ë†’ì€ ìƒí’ˆ ì†Œì¬/íƒ€ê²Ÿ ì ê²€</span>
                        <span>âœ… ìµœì  íƒ€ê²Ÿ í™œìš©</span>
                    </div>
                </div>
            `;

            document.getElementById('forecastContent').innerHTML = html;

            // ì„œë¸Œíƒ­ ì´ˆê¸°í™”
            initForecastSubtabs(forecast);

            // ì•„ì½”ë””ì–¸ ì´ˆê¸°í™”
            initForecastAccordions();
        }

        // AI ì˜ˆì¸¡ ì„œë¸Œíƒ­ ì´ˆê¸°í™”
        function initForecastSubtabs(forecast) {
            const subtabBtns = document.querySelectorAll('.forecast-subtab');
            const contentDiv = document.getElementById('forecastSubtabContent');

            subtabBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    subtabBtns.forEach(b => {
                        b.classList.remove('active');
                        b.style.color = 'var(--grey-600)';
                        b.style.borderBottom = '2px solid transparent';
                    });
                    this.classList.add('active');
                    this.style.color = '#7c4dff';
                    this.style.borderBottom = '2px solid #7c4dff';
                    renderForecastSubtab(this.dataset.subtab, forecast, contentDiv);
                });
            });

            // ê¸°ë³¸ íƒ­ í™œì„±í™”
            const defaultBtn = document.querySelector('.forecast-subtab[data-subtab="product"]');
            if (defaultBtn) {
                defaultBtn.style.color = '#7c4dff';
                defaultBtn.style.borderBottom = '2px solid #7c4dff';
                renderForecastSubtab('product', forecast, contentDiv);
            }
        }

        // AI ì˜ˆì¸¡ ì•„ì½”ë””ì–¸ ì´ˆê¸°í™”
        function initForecastAccordions() {
            const forecastContent = document.getElementById('forecastContent');
            if (!forecastContent) return;

            // ì´ë²¤íŠ¸ ìœ„ì„ ë°©ì‹ìœ¼ë¡œ ë³€ê²½ - ê¸°ì¡´ ë¦¬ìŠ¤ë„ˆ ì œê±° í›„ ì¬ë“±ë¡
            forecastContent.removeEventListener('click', handleForecastAccordionClick);
            forecastContent.addEventListener('click', handleForecastAccordionClick);
        }

        // ì•„ì½”ë””ì–¸ í´ë¦­ í•¸ë“¤ëŸ¬ (ì´ë²¤íŠ¸ ìœ„ì„)
        function handleForecastAccordionClick(e) {
            const header = e.target.closest('.forecast-accordion-header');
            if (!header) return;

            const targetId = header.dataset.target;
            const content = document.getElementById(targetId);
            const icon = header.querySelector('.forecast-accordion-icon');

            if (!content || !icon) return;

            if (content.style.display === 'none' || content.style.display === '') {
                content.style.display = 'block';
                icon.style.transform = 'rotate(180deg)';
            } else {
                content.style.display = 'none';
                icon.style.transform = 'rotate(0deg)';
            }
        }

        // AIê°€ ë°œê²¬í•œ ê¸°íšŒ ë°ì´í„° ìƒì„± (5ê°œ) - periodData ê¸°ë°˜
        function generateAIOpportunities(forecast) {
            const opportunities = [];
            const periodData = getPeriodData();

            try {
                // 1. ìµœê³  ì„±ê³¼ ê¸°ê¸°í”Œë«í¼ ê¸°íšŒ
                if (periodData && periodData.deviceplatform_performance && periodData.deviceplatform_performance.length > 0) {
                    const validPlatforms = periodData.deviceplatform_performance.filter(p => p.cost > 0 && p.deviceplatform !== 'Uncategorized');
                    if (validPlatforms.length > 0) {
                        const sorted = [...validPlatforms].sort((a, b) => (b.roas || 0) - (a.roas || 0));
                        const top = sorted[0];
                        if (top && (top.roas || 0) >= 100) {
                            opportunities.push({
                                icon: 'ğŸ“±',
                                title: top.deviceplatform + ' ê¸°ê¸°í”Œë«í¼ ê³ íš¨ìœ¨ ê¸°íšŒ',
                                description: top.deviceplatform + 'ì—ì„œ ROAS ' + (top.roas || 0).toFixed(0) + '%ë¡œ ê°€ì¥ ë†’ì€ íš¨ìœ¨ì„ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤. í•´ë‹¹ ê¸°ê¸°í”Œë«í¼ì˜ ì˜ˆì‚°ì„ í™•ëŒ€í•˜ë©´ ì „ì²´ ìº í˜ì¸ ì„±ê³¼ ê°œì„ ì´ ê¸°ëŒ€ë©ë‹ˆë‹¤.',
                                metric: 'ROAS ' + (top.roas || 0).toFixed(0) + '%'
                            });
                        }
                    }
                }

                // 2. ê³ ì„±ê³¼ ì±„ë„ ê¸°íšŒ
                if (periodData && periodData.top_categories && periodData.top_categories.length > 0) {
                    const sorted = [...periodData.top_categories].sort((a, b) => (b.roas || 0) - (a.roas || 0));
                    const top = sorted[0];
                    if (top && (top.roas || 0) >= 100) {
                        opportunities.push({
                            icon: 'ğŸ“Š',
                            title: top.name + ' ì±„ë„ í™•ëŒ€ ê¸°íšŒ',
                            description: top.name + ' ì±„ë„ì˜ ROASê°€ ' + (top.roas || 0).toFixed(0) + '%ë¡œ ë§¤ìš° ë†’ìŠµë‹ˆë‹¤. ì´ ì±„ë„ì— ì˜ˆì‚°ì„ ì§‘ì¤‘í•˜ë©´ ë†’ì€ ìˆ˜ìµì„ ê¸°ëŒ€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
                            metric: 'ROAS ' + (top.roas || 0).toFixed(0) + '%'
                        });
                    }
                }

                // 3. ìµœì  ì„±ë³„ ê¸°íšŒ
                if (periodData && periodData.gender_performance && periodData.gender_performance.length > 0) {
                    const validGenders = periodData.gender_performance.filter(function(g) { return g.cost > 0 && isValidGender(g.gender); });
                    if (validGenders.length > 0) {
                        const sorted = [...validGenders].sort((a, b) => (b.roas || 0) - (a.roas || 0));
                        const top = sorted[0];
                        if (top && (top.roas || 0) >= 100) {
                            const genderName = normalizeGender(top.gender) || top.gender;
                            opportunities.push({
                                icon: 'ğŸ‘«',
                                title: genderName + ' íƒ€ê²Ÿ í™•ëŒ€ ê¸°íšŒ',
                                description: genderName + ' íƒ€ê²Ÿì—ì„œ ROAS ' + (top.roas || 0).toFixed(0) + '%ë¡œ ìš°ìˆ˜í•œ ì„±ê³¼ë¥¼ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤. ì„±ë³„ ë§ì¶¤ ë©”ì‹œì§€ ì „ëµì„ ê°•í™”í•˜ì„¸ìš”.',
                                metric: 'ROAS ' + (top.roas || 0).toFixed(0) + '%'
                            });
                        }
                    }
                }

                // 4. ê³ ì„±ê³¼ ìƒí’ˆ ê¸°íšŒ
                if (periodData && periodData.product_performance && periodData.product_performance.length > 0) {
                    const sorted = [...periodData.product_performance].sort((a, b) => (b.roas || 0) - (a.roas || 0));
                    const top = sorted[0];
                    if (top && (top.roas || 0) >= 100) {
                        opportunities.push({
                            icon: 'ğŸ›ï¸',
                            title: top.product + ' ìƒí’ˆ í™•ëŒ€ ê¸°íšŒ',
                            description: top.product + ' ìƒí’ˆì˜ ROASê°€ ' + (top.roas || 0).toFixed(0) + '%ë¡œ ê°€ì¥ ë†’ìŠµë‹ˆë‹¤. í•´ë‹¹ ìƒí’ˆ ì¤‘ì‹¬ì˜ í”„ë¡œëª¨ì…˜ ë° ê´‘ê³  ì˜ˆì‚° ì§‘ì¤‘ì„ ê¶Œì¥í•©ë‹ˆë‹¤.',
                            metric: 'ROAS ' + (top.roas || 0).toFixed(0) + '%'
                        });
                    }
                }

                // 5. ì „ì²´ ì„±ê³¼ ê¸°íšŒ
                if (periodData && periodData.summary) {
                    const overallRoas = periodData.summary.overall_roas || 0;
                    if (overallRoas >= 100) {
                        opportunities.push({
                            icon: 'ğŸ“ˆ',
                            title: 'ì „ì²´ ìº í˜ì¸ ì„±ì¥ ê¸°íšŒ',
                            description: 'ì „ì²´ ROASê°€ ' + overallRoas.toFixed(0) + '%ë¡œ ì–‘í˜¸í•©ë‹ˆë‹¤. í˜„ì¬ ì „ëµì„ ìœ ì§€í•˜ë©´ì„œ ê³ íš¨ìœ¨ ì±„ë„ì— ì¶”ê°€ íˆ¬ìë¥¼ ê²€í† í•˜ì„¸ìš”.',
                            metric: 'ì „ì²´ ROAS ' + overallRoas.toFixed(0) + '%'
                        });
                    }
                }
            } catch (e) {
                console.error('generateAIOpportunities error:', e);
            }

            // ìµœì†Œ 5ê°œ ë³´ì¥ - ê¸°ë³¸ê°’ ì¶”ê°€
            const defaults = [
                { icon: 'ğŸ¯', title: 'íƒ€ê²Ÿ ìµœì í™” ê¸°íšŒ', description: 'í˜„ì¬ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ íƒ€ê²ŸíŒ… ì „ëµì„ ê°œì„ í•˜ë©´ ë” ë†’ì€ ì„±ê³¼ë¥¼ ê¸°ëŒ€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', metric: null },
                { icon: 'ğŸ’°', title: 'ì˜ˆì‚° ì¬ë°°ë¶„ ê¸°íšŒ', description: 'ê³ íš¨ìœ¨ ì±„ë„ë¡œ ì˜ˆì‚°ì„ ì¬ë°°ë¶„í•˜ì—¬ ì „ì²´ ROASë¥¼ ê°œì„ í•  ìˆ˜ ìˆëŠ” ê¸°íšŒê°€ ìˆìŠµë‹ˆë‹¤.', metric: null },
                { icon: 'ğŸ”„', title: 'í¬ë¦¬ì—ì´í‹°ë¸Œ ê°±ì‹  ê¸°íšŒ', description: 'ìƒˆë¡œìš´ í¬ë¦¬ì—ì´í‹°ë¸Œ í…ŒìŠ¤íŠ¸ë¥¼ í†µí•´ ê´‘ê³  í”¼ë¡œë„ë¥¼ ë‚®ì¶”ê³  ì„±ê³¼ë¥¼ ê°œì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', metric: null },
                { icon: 'ğŸ“Š', title: 'ë°ì´í„° ê¸°ë°˜ ìµœì í™” ê¸°íšŒ', description: 'A/B í…ŒìŠ¤íŠ¸ë¥¼ í†µí•´ ë” íš¨ê³¼ì ì¸ ê´‘ê³  ì†Œì¬ì™€ íƒ€ê²Ÿì„ ë°œêµ´í•  ê¸°íšŒê°€ ìˆìŠµë‹ˆë‹¤.', metric: null },
                { icon: 'âš¡', title: 'ì‹œì¦Œ ëŒ€ì‘ ê¸°íšŒ', description: 'ì‹œì¦Œë³„ íŠ¸ë Œë“œì— ë§ì¶° ìƒí’ˆê³¼ ë©”ì‹œì§€ë¥¼ ìµœì í™”í•˜ë©´ ì¶”ê°€ ì„±ê³¼ë¥¼ ê¸°ëŒ€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', metric: null }
            ];

            let defaultIdx = 0;
            while (opportunities.length < 5) {
                opportunities.push(defaults[defaultIdx]);
                defaultIdx++;
            }

            return opportunities.slice(0, 5);
        }

        // AI ì¶”ì²œ ì•¡ì…˜ ë°ì´í„° ìƒì„± (5ê°œ) - periodData ê¸°ë°˜
        function generateAIActions(forecast) {
            const actions = [];
            const periodData = getPeriodData();

            try {
                // 1. ì €íš¨ìœ¨ ìƒí’ˆ ê°œì„  ì•¡ì…˜
                if (periodData && periodData.product_performance && periodData.product_performance.length > 0) {
                    const sorted = [...periodData.product_performance].sort((a, b) => (a.roas || 0) - (b.roas || 0));
                    const worst = sorted[0];
                    if (worst && (worst.roas || 0) < 100) {
                        actions.push({
                            icon: 'ğŸ”§',
                            title: worst.product + ' ìƒí’ˆ ê´‘ê³  ê°œì„ ',
                            description: worst.product + 'ì˜ ROASê°€ ' + (worst.roas || 0).toFixed(0) + '%ë¡œ ë‚®ìŠµë‹ˆë‹¤. íƒ€ê²Ÿ ì¬ì„¤ì •, í¬ë¦¬ì—ì´í‹°ë¸Œ êµì²´, ë˜ëŠ” ì˜ˆì‚° ì¶•ì†Œë¥¼ ê²€í† í•˜ì„¸ìš”.',
                            priority: 'high',
                            expectedEffect: 'CPA 15~20% ê°œì„ '
                        });
                    }
                }

                // 2. ê³ íš¨ìœ¨ ê¸°ê¸°í”Œë«í¼ ì˜ˆì‚° í™•ëŒ€ ì•¡ì…˜
                if (periodData && periodData.deviceplatform_performance && periodData.deviceplatform_performance.length > 0) {
                    const validPlatforms = periodData.deviceplatform_performance.filter(function(p) { return p.cost > 0 && p.deviceplatform !== 'Uncategorized'; });
                    if (validPlatforms.length > 0) {
                        const sorted = [...validPlatforms].sort((a, b) => (b.roas || 0) - (a.roas || 0));
                        const top = sorted[0];
                        if (top && (top.roas || 0) >= 150) {
                            actions.push({
                                icon: 'ğŸ’µ',
                                title: top.deviceplatform + ' ì˜ˆì‚° 20% ì¦ì•¡',
                                description: top.deviceplatform + 'ì˜ ROASê°€ ' + (top.roas || 0).toFixed(0) + '%ë¡œ ë§¤ìš° ë†’ìŠµë‹ˆë‹¤. í•´ë‹¹ ê¸°ê¸°í”Œë«í¼ ì˜ˆì‚°ì„ 20% ì¦ì•¡í•˜ì—¬ ì„±ê³¼ë¥¼ ê·¹ëŒ€í™”í•˜ì„¸ìš”.',
                                priority: 'high',
                                expectedEffect: 'ë§¤ì¶œ ì¦ê°€ ê¸°ëŒ€'
                            });
                        }
                    }
                }

                // 3. ê³ íš¨ìœ¨ ì±„ë„ ì§‘ì¤‘ ì•¡ì…˜
                if (periodData && periodData.top_categories && periodData.top_categories.length > 0) {
                    const sorted = [...periodData.top_categories].sort((a, b) => (b.roas || 0) - (a.roas || 0));
                    const top = sorted[0];
                    if (top) {
                        actions.push({
                            icon: 'ğŸ¯',
                            title: top.name + ' ì±„ë„ ìº í˜ì¸ ê°•í™”',
                            description: top.name + ' ì±„ë„ì˜ ì„±ê³¼ê°€ ê°€ì¥ ìš°ìˆ˜í•©ë‹ˆë‹¤(ROAS ' + (top.roas || 0).toFixed(0) + '%). í•´ë‹¹ ì±„ë„ ì „ìš© ìº í˜ì¸ì„ ì‹ ì„¤í•˜ê±°ë‚˜ ê¸°ì¡´ ìº í˜ì¸ì˜ ì˜ˆì‚° ë¹„ì¤‘ì„ ë†’ì´ì„¸ìš”.',
                            priority: 'medium',
                            expectedEffect: 'ROAS 10~15% ê°œì„ '
                        });
                    }
                }

                // 4. ì €íš¨ìœ¨ ê¸°ê¸°í”Œë«í¼ ê°œì„  ë˜ëŠ” ì¶•ì†Œ ì•¡ì…˜
                if (periodData && periodData.deviceplatform_performance && periodData.deviceplatform_performance.length > 1) {
                    const validPlatforms = periodData.deviceplatform_performance.filter(function(p) { return p.cost > 10000 && p.deviceplatform !== 'Uncategorized'; });
                    if (validPlatforms.length > 0) {
                        const sorted = [...validPlatforms].sort((a, b) => (a.roas || 0) - (b.roas || 0));
                        const worst = sorted[0];
                        if (worst && (worst.roas || 0) < 100) {
                            actions.push({
                                icon: 'âš ï¸',
                                title: worst.deviceplatform + ' ì˜ˆì‚° ì¬ê²€í† ',
                                description: worst.deviceplatform + 'ì˜ ROASê°€ ' + (worst.roas || 0).toFixed(0) + '%ë¡œ ì†ìµë¶„ê¸°ì  ë¯¸ë‹¬ì…ë‹ˆë‹¤. íƒ€ê²Ÿ ë° ì†Œì¬ ìµœì í™” í›„ì—ë„ ê°œì„ ë˜ì§€ ì•Šìœ¼ë©´ ì˜ˆì‚° ì¶•ì†Œë¥¼ ê³ ë ¤í•˜ì„¸ìš”.',
                                priority: 'medium',
                                expectedEffect: 'ë¹„ìš© íš¨ìœ¨í™”'
                            });
                        }
                    }
                }

                // 5. ì „ì²´ ì „ëµ ì•¡ì…˜
                if (periodData && periodData.summary) {
                    const avgCpa = periodData.summary.overall_cpa || 0;
                    actions.push({
                        icon: 'ğŸ“‹',
                        title: 'CPA ê¸°ë°˜ ì…ì°° ì „ëµ ìµœì í™”',
                        description: 'ì „ì²´ CPAê°€ ' + formatCurrency(avgCpa) + 'ì…ë‹ˆë‹¤. ëª©í‘œ CPAë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìë™ ì…ì°° ì „ëµì„ ì¡°ì •í•˜ê³ , ê³ CPA ê´‘ê³ ì„¸íŠ¸ëŠ” ìˆ˜ë™ ê²€í† í•˜ì„¸ìš”.',
                        priority: 'low',
                        expectedEffect: 'ì „ì²´ CPA 5~10% ê°œì„ '
                    });
                }
            } catch (e) {
                console.error('generateAIActions error:', e);
            }

            // ìµœì†Œ 5ê°œ ë³´ì¥ - ê¸°ë³¸ê°’ ì¶”ê°€
            const defaults = [
                { icon: 'ğŸ”„', title: 'í¬ë¦¬ì—ì´í‹°ë¸Œ A/B í…ŒìŠ¤íŠ¸', description: 'í˜„ì¬ ìš´ì˜ ì¤‘ì¸ ê´‘ê³  ì†Œì¬ì˜ ë‹¤ì–‘í•œ ë²„ì „ì„ í…ŒìŠ¤íŠ¸í•˜ì—¬ ìµœì ì˜ ì„±ê³¼ë¥¼ ì°¾ìœ¼ì„¸ìš”.', priority: 'low', expectedEffect: 'CTR í–¥ìƒ' },
                { icon: 'ğŸ“±', title: 'ëœë”©í˜ì´ì§€ ìµœì í™”', description: 'ê´‘ê³  í´ë¦­ í›„ ì „í™˜ìœ¨ì„ ë†’ì´ê¸° ìœ„í•´ ëœë”©í˜ì´ì§€ ë¡œë”© ì†ë„ì™€ UXë¥¼ ì ê²€í•˜ì„¸ìš”.', priority: 'low', expectedEffect: 'ì „í™˜ìœ¨ í–¥ìƒ' },
                { icon: 'ğŸ•', title: 'ê´‘ê³  ë…¸ì¶œ ì‹œê°„ëŒ€ ìµœì í™”', description: 'ì„±ê³¼ê°€ ì¢‹ì€ ì‹œê°„ëŒ€ì— ì˜ˆì‚°ì„ ì§‘ì¤‘í•˜ì—¬ íš¨ìœ¨ì„ ê·¹ëŒ€í™”í•˜ì„¸ìš”.', priority: 'low', expectedEffect: 'ROAS ê°œì„ ' },
                { icon: 'ğŸ“Š', title: 'ë¦¬íƒ€ê²ŸíŒ… ìº í˜ì¸ ê°•í™”', description: 'ì‚¬ì´íŠ¸ ë°©ë¬¸ì ë° ì¥ë°”êµ¬ë‹ˆ ì´íƒˆì ëŒ€ìƒ ë¦¬íƒ€ê²ŸíŒ…ì„ ê°•í™”í•˜ì„¸ìš”.', priority: 'low', expectedEffect: 'ì „í™˜ ì¦ê°€' },
                { icon: 'ğŸ¨', title: 'ì‹œì¦Œ ë§ì¶¤ ì†Œì¬ ì œì‘', description: 'í˜„ì¬ ì‹œì¦Œ ë° íŠ¸ë Œë“œì— ë§ëŠ” ìƒˆë¡œìš´ ê´‘ê³  ì†Œì¬ë¥¼ ì œì‘í•˜ì„¸ìš”.', priority: 'low', expectedEffect: 'ê´‘ê³  í”¼ë¡œë„ ê°ì†Œ' }
            ];

            let defaultIdx = 0;
            while (actions.length < 5) {
                actions.push(defaults[defaultIdx]);
                defaultIdx++;
            }

            return actions.slice(0, 5);
        }

        // AI ì˜ˆì¸¡ ì„œë¸Œíƒ­ ë Œë”ë§
        function renderForecastSubtab(tab, forecast, container) {
            let html = '';

            if (tab === 'product') {
                // ìƒí’ˆë³„ ì˜ˆì¸¡
                if (forecast.by_product && forecast.by_product.length > 0) {
                    const sorted = [...forecast.by_product].sort((a, b) => (b.avg_forecast_roas || 0) - (a.avg_forecast_roas || 0));
                    html += `<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">`;

                    // ROAS TOP
                    html += `<div style="padding: 10px; background: #e8f5e9; border-radius: 8px;">
                        <div style="font-size: 10px; font-weight: 600; color: #2e7d32; margin-bottom: 6px;">ğŸ† ROAS TOP</div>`;
                    sorted.slice(0, 4).forEach((prod, idx) => {
                        const medal = idx === 0 ? 'ğŸ¥‡' : idx === 1 ? 'ğŸ¥ˆ' : idx === 2 ? 'ğŸ¥‰' : '';
                        html += `
                            <div style="display: flex; justify-content: space-between; padding: 4px 0; font-size: 10px; border-bottom: 1px solid rgba(0,0,0,0.05);">
                                <span>${medal} ${prod.product}</span>
                                <span style="font-weight: 700; color: #1b5e20;">${(prod.avg_forecast_roas || 0).toFixed(0)}%</span>
                            </div>
                        `;
                    });
                    html += '</div>';

                    // CPA ê°œì„  í•„ìš”
                    const bottom = sorted.slice(-4).reverse();
                    html += `<div style="padding: 10px; background: #fff3e0; border-radius: 8px;">
                        <div style="font-size: 10px; font-weight: 600; color: #e65100; margin-bottom: 6px;">ğŸ“‰ CPA ê°œì„  í•„ìš”</div>`;
                    bottom.forEach(prod => {
                        html += `
                            <div style="display: flex; justify-content: space-between; padding: 4px 0; font-size: 10px; border-bottom: 1px solid rgba(0,0,0,0.05);">
                                <span>${prod.product}</span>
                                <span style="font-weight: 700; color: #bf360c;">${(prod.avg_forecast_roas || 0).toFixed(0)}%</span>
                            </div>
                        `;
                    });
                    html += '</div></div>';
                }
            } else if (tab === 'gender-age') {
                // ì„±ë³„ & ì—°ë ¹ ì˜ˆì¸¡
                html += `<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">`;

                // ì„±ë³„
                if (forecast.by_gender && forecast.by_gender.length > 0) {
                    const validGenders = forecast.by_gender.filter(g => isValidGender(g.gender));
                    html += `<div style="padding: 10px; background: #fce4ec; border-radius: 8px;">
                        <div style="font-size: 10px; font-weight: 600; color: #c2185b; margin-bottom: 6px;">ğŸ‘« ì„±ë³„ ì˜ˆì¸¡</div>`;
                    validGenders.forEach(g => {
                        const roas = g.avg_forecast_roas || 0;
                        html += `
                            <div style="display: flex; justify-content: space-between; padding: 4px 0; font-size: 10px; border-bottom: 1px solid rgba(0,0,0,0.05);">
                                <span>${normalizeGender(g.gender) || g.gender}</span>
                                <span style="font-weight: 700; color: ${roas >= 100 ? '#2e7d32' : '#c62828'};">${roas.toFixed(0)}%</span>
                            </div>
                        `;
                    });
                    html += '</div>';
                }

                // ì—°ë ¹
                if (forecast.by_age && forecast.by_age.length > 0) {
                    const validAges = forecast.by_age.filter(a => isValidAge(a.age));
                    const sorted = [...validAges].sort((a, b) => (b.avg_forecast_roas || 0) - (a.avg_forecast_roas || 0));
                    html += `<div style="padding: 10px; background: #e8eaf6; border-radius: 8px;">
                        <div style="font-size: 10px; font-weight: 600; color: #3949ab; margin-bottom: 6px;">ğŸ‘¤ ì—°ë ¹ ì˜ˆì¸¡ TOP 5</div>`;
                    sorted.slice(0, 5).forEach((a, idx) => {
                        const roas = a.avg_forecast_roas || 0;
                        const medal = idx === 0 ? 'ğŸ¥‡' : idx === 1 ? 'ğŸ¥ˆ' : idx === 2 ? 'ğŸ¥‰' : '';
                        html += `
                            <div style="display: flex; justify-content: space-between; padding: 4px 0; font-size: 10px; border-bottom: 1px solid rgba(0,0,0,0.05);">
                                <span>${medal} ${a.age}</span>
                                <span style="font-weight: 700; color: ${roas >= 100 ? '#2e7d32' : '#c62828'};">${roas.toFixed(0)}%</span>
                            </div>
                        `;
                    });
                    html += '</div>';
                }
                html += '</div>';
            } else if (tab === 'deviceplatform') {
                // ê¸°ê¸°í”Œë«í¼ ì˜ˆì¸¡
                if (forecast.by_deviceplatform && forecast.by_deviceplatform.length > 0) {
                    const sorted = [...forecast.by_deviceplatform].sort((a, b) => (b.avg_forecast_roas || 0) - (a.avg_forecast_roas || 0));
                    html += `<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 8px;">`;
                    sorted.forEach((dev, idx) => {
                        const roas = dev.avg_forecast_roas || 0;
                        const isTop = idx === 0;
                        const platformName = dev.deviceplatform || dev.device || '';
                        html += `
                            <div style="padding: 10px; background: ${isTop ? 'linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%)' : '#f5f5f5'}; border-radius: 8px; text-align: center; ${isTop ? 'border: 2px solid #1976d2;' : ''}">
                                <div style="font-size: 9px; color: var(--grey-600); margin-bottom: 2px;">${platformName}</div>
                                <div style="font-size: 14px; font-weight: 700; color: ${roas >= 100 ? '#1565c0' : '#c62828'};">${roas.toFixed(0)}%</div>
                                ${isTop ? '<div style="font-size: 8px; color: #1976d2; margin-top: 2px;">ğŸ† 1ìœ„</div>' : ''}
                            </div>
                        `;
                    });
                    html += '</div>';
                }
            } else if (tab === 'category') {
                // ì±„ë„ë³„ ì˜ˆì¸¡
                if (forecast.by_category && forecast.by_category.length > 0) {
                    const sorted = [...forecast.by_category].sort((a, b) => (b.avg_forecast_roas || 0) - (a.avg_forecast_roas || 0));
                    const good = sorted.filter(c => (c.avg_forecast_roas || 0) >= 100);
                    const poor = sorted.filter(c => (c.avg_forecast_roas || 0) < 100);

                    html += `<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">`;

                    // íš¨ìœ¨ ì–‘í˜¸
                    html += `<div style="padding: 10px; background: #e8f5e9; border-radius: 8px;">
                        <div style="font-size: 10px; font-weight: 600; color: #2e7d32; margin-bottom: 6px;">âœ… íš¨ìœ¨ ì–‘í˜¸</div>`;
                    good.forEach(cat => {
                        html += `
                            <div style="display: flex; justify-content: space-between; padding: 4px 0; font-size: 10px; border-bottom: 1px solid rgba(0,0,0,0.05);">
                                <span style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 80px;">${cat.category}</span>
                                <span style="font-weight: 700; color: #1b5e20;">${(cat.avg_forecast_roas || 0).toFixed(0)}%</span>
                            </div>
                        `;
                    });
                    if (good.length === 0) html += '<div style="font-size: 10px; color: var(--grey-500);">ë°ì´í„° ì—†ìŒ</div>';
                    html += '</div>';

                    // ê°œì„  í•„ìš”
                    html += `<div style="padding: 10px; background: #ffebee; border-radius: 8px;">
                        <div style="font-size: 10px; font-weight: 600; color: #c62828; margin-bottom: 6px;">âš ï¸ ê°œì„  í•„ìš”</div>`;
                    poor.forEach(cat => {
                        html += `
                            <div style="display: flex; justify-content: space-between; padding: 4px 0; font-size: 10px; border-bottom: 1px solid rgba(0,0,0,0.05);">
                                <span style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 80px;">${cat.category}</span>
                                <span style="font-weight: 700; color: #b71c1c;">${(cat.avg_forecast_roas || 0).toFixed(0)}%</span>
                            </div>
                        `;
                    });
                    if (poor.length === 0) html += '<div style="font-size: 10px; color: var(--grey-500);">ë°ì´í„° ì—†ìŒ</div>';
                    html += '</div></div>';
                }
            }

            container.innerHTML = html || '<div style="text-align: center; padding: 20px; color: var(--grey-500); font-size: 12px;">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
        }

        // ì˜ì‚¬ê²°ì • ë„êµ¬ íƒ­ ì „í™˜ ì´ˆê¸°í™”
        function initDecisionToolTabs() {
            const tabMapping = {
                'summary': 'summaryTab',
                'opportunity': 'opportunityTab',
                'warning': 'warningTab',
                'targeting': 'targetingTab',
                'dayAnalysis': 'dayAnalysisTab',
                'forecast': 'forecastTab'
            };

            document.querySelectorAll('.decision-tool-tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.decision-tool-tab-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');

                    const targetTab = this.dataset.tab;
                    document.querySelectorAll('.decision-tool-tab-content').forEach(content => {
                        content.style.display = 'none';
                        content.classList.remove('active');
                    });

                    const tabId = tabMapping[targetTab];
                    const selectedTab = tabId ? document.getElementById(tabId) : null;

                    if (selectedTab) {
                        selectedTab.style.display = 'block';
                        selectedTab.classList.add('active');
                    }

                    // ê³„ì ˆì„± ë¶„ì„ íƒ­ ì„ íƒ ì‹œ ê¸°ë³¸ ë Œë”ë§ (ë¶„ê¸°ë³„ ì¶”ì´ê°€ ê¸°ë³¸)
                    if (targetTab === 'dayAnalysis') {
                        renderQuarterlyTrendChart();
                        renderQuarterlyTable();
                        renderSeasonalityTable();
                        renderSeasonalityCategoryTable();
                        setupRetargetingSortEvents();
                    }
                });
            });

            // ê¸°ë³¸ìœ¼ë¡œ 'ì˜¤ëŠ˜ì˜ ìš”ì•½' íƒ­ í™œì„±í™”
            const defaultBtn = document.querySelector('.decision-tool-tab-btn[data-tab="summary"]');
            if (defaultBtn) {
                defaultBtn.click();
            }

            // ê¸°ê°„ í•„í„° ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            document.querySelectorAll('.period-filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const period = this.dataset.period;
                    if (period) {
                        switchPeriod(period);
                    }
                });
            });

            // ìš”ì¼ë³„ ë¶„ì„ ì„œë¸Œíƒ­ ì´ë²¤íŠ¸ ì´ˆê¸°í™”
            initDayAnalysisSubtabs();
        }

        // ìš”ì¼ë³„ ë¶„ì„ ì„œë¸Œíƒ­ ì „í™˜ ì´ë²¤íŠ¸
        function initDayAnalysisSubtabs() {
            document.querySelectorAll('.day-analysis-subtab').forEach(btn => {
                btn.addEventListener('click', function() {
                    // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ë³€ê²½ (íšŒìƒ‰ í…Œë§ˆ - ì „ì²´ ê¸°ê°„ ê³ ì • íƒ­)
                    document.querySelectorAll('.day-analysis-subtab').forEach(b => {
                        b.style.background = 'white';
                        b.style.color = '#546e7a';
                        b.style.border = '1px solid #b0bec5';
                    });
                    this.style.background = '#78909c';
                    this.style.color = 'white';
                    this.style.border = 'none';

                    // ì½˜í…ì¸  ì „í™˜
                    const targetTab = this.dataset.dayTab;
                    document.querySelectorAll('.day-analysis-tab-content').forEach(content => {
                        content.style.display = 'none';
                        content.classList.remove('active');
                    });

                    const viewMap = {
                        'quarterlyTrend': 'quarterlyTrendView',
                        'dayConversion': 'dayConversionView',
                        'channelDay': 'channelDayView'
                    };

                    const targetView = document.getElementById(viewMap[targetTab]);
                    if (targetView) {
                        targetView.style.display = 'block';
                        targetView.classList.add('active');

                        // ë¶„ê¸°ë³„ ì¶”ì´ íƒ­ ì„ íƒ ì‹œ ì°¨íŠ¸ ë Œë”ë§
                        if (targetTab === 'quarterlyTrend') {
                            renderQuarterlyTrendChart();
                            renderQuarterlyTable();
                        }

                        // ì±„ë„ë³„ ìš”ì¼ íƒ­ ì„ íƒ ì‹œ ì°¨íŠ¸ ë° KPI ì¹´ë“œ ë Œë”ë§
                        if (targetTab === 'channelDay') {
                            renderChannelDayKpiCards();
                            renderChannelDayRoasChart();
                            renderSeasonalityCategoryTable();
                        }
                    }
                });
            });
        }

        // ì„±ë³„ ì°¨íŠ¸
        function renderGenderChart() {
            const periodData = getPeriodData();
            // ì•Œìˆ˜ì—†ìŒ í•„í„°ë§ ë° ë¹„ìš© > 0 í•„í„° ì ìš©
            const genders = periodData.gender_performance
                .filter(g => g.cost > 0 && isValidGender(g.gender))
                .map(g => ({
                    ...g,
                    displayGender: normalizeGender(g.gender) || g.gender
                }));

            const ctx = document.getElementById('genderChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: genders.map(g => g.displayGender),
                    datasets: [{
                        data: genders.map(g => g.roas),
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.8)',
                            'rgba(54, 162, 235, 0.8)',
                            'rgba(255, 206, 86, 0.8)',
                            'rgba(75, 192, 192, 0.8)',
                            'rgba(153, 102, 255, 0.8)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const item = genders[context.dataIndex];
                                    return [
                                        `${item.displayGender}`,
                                        `ROAS: ${formatPercent(item.roas)}`,
                                        `ì „í™˜ìˆ˜: ${formatNumber(item.conversions)}`,
                                        `ì„±ê³¼: ${item.performance_level}`
                                    ];
                                }
                            }
                        }
                    }
                }
            });
        }

        // í”Œë«í¼ ì°¨íŠ¸
        function renderPlatformChart() {
            const periodData = getPeriodData();
            const platforms = periodData.deviceplatform_performance;

            const ctx = document.getElementById('platformChart').getContext('2d');
            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: platforms.map(p => p.deviceplatform),
                    datasets: [{
                        data: platforms.map(p => p.revenue),
                        backgroundColor: [
                            'rgba(103, 58, 183, 0.8)',
                            'rgba(33, 150, 243, 0.8)',
                            'rgba(0, 200, 83, 0.8)',
                            'rgba(255, 171, 0, 0.8)',
                            'rgba(255, 23, 68, 0.8)',
                            'rgba(156, 39, 176, 0.8)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const item = platforms[context.dataIndex];
                                    return [
                                        `${item.deviceplatform}`,
                                        `ì „í™˜ê°’: ${formatCurrency(item.revenue)}`,
                                        `ROAS: ${formatPercent(item.roas)}`,
                                        `ì „í™˜ìˆ˜: ${formatNumber(item.conversions)}`
                                    ];
                                }
                            }
                        }
                    }
                }
            });
        }

        // ë¸Œëœë“œ ì„±ê³¼ ì°¨íŠ¸
        // ì„±ê³¼ë¶„ì„ ì°¨íŠ¸ ìƒíƒœ ê´€ë¦¬
        let perfChartState = {
            brand: { kpi: 'roas', sort: 'desc', chart: null },
            product: { kpi: 'roas', sort: 'desc', chart: null },
            promotion: { kpi: 'roas', sort: 'desc', chart: null },
            targeting: { kpi: 'roas', sort: 'desc', chart: null }
        };

        // KPIë³„ ìƒ‰ìƒ
        const kpiColors = {
            roas: { bg: 'rgba(0, 200, 83, 0.8)', border: 'rgba(0, 200, 83, 1)' },
            cost: { bg: 'rgba(255, 152, 0, 0.8)', border: 'rgba(255, 152, 0, 1)' },
            cpa: { bg: 'rgba(244, 67, 54, 0.8)', border: 'rgba(244, 67, 54, 1)' },
            conversions: { bg: 'rgba(33, 150, 243, 0.8)', border: 'rgba(33, 150, 243, 1)' },
            revenue: { bg: 'rgba(156, 39, 176, 0.8)', border: 'rgba(156, 39, 176, 1)' }
        };

        // KPIë³„ ë¼ë²¨
        const kpiLabels = {
            roas: 'ROAS (%)',
            cost: 'ë¹„ìš© (ì›)',
            cpa: 'CPA (ì›)',
            conversions: 'ì „í™˜ìˆ˜',
            revenue: 'ì „í™˜ê°’ (ì›)'
        };

        // ìì—°ì–´ ì¸ì‚¬ì´íŠ¸ ìƒì„±
        function generateBrandInsight() {
            const periodData = getPeriodData();
            const brands = periodData.brand_performance;
            if (!brands || brands.length === 0) return;

            const sorted = [...brands].sort((a, b) => b.roas - a.roas);
            const best = sorted[0];
            const worst = sorted[sorted.length - 1];
            const avgRoas = brands.reduce((sum, b) => sum + b.roas, 0) / brands.length;
            const totalCost = brands.reduce((sum, b) => sum + b.cost, 0);

            const highPerformers = brands.filter(b => b.roas >= 200);
            const lowPerformers = brands.filter(b => b.roas < 100);

            let insight = `<strong>${best.brand}</strong>ê°€ ROAS <strong>${formatPercent(best.roas)}</strong>ë¡œ ê°€ì¥ ë†’ì€ ì„±ê³¼ë¥¼ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤. `;

            if (highPerformers.length > 1) {
                insight += `${highPerformers.length}ê°œ ë¸Œëœë“œê°€ ROAS 200% ì´ìƒì˜ ìš°ìˆ˜í•œ ì„±ê³¼ë¥¼ ë‚´ê³  ìˆì–´ ì˜ˆì‚° í™•ëŒ€ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤. `;
            }

            if (lowPerformers.length > 0) {
                insight += `<br><br>âš ï¸ <strong>${worst.brand}</strong> ë“± ${lowPerformers.length}ê°œ ë¸Œëœë“œëŠ” ROAS ${formatPercent(worst.roas)}ë¡œ íš¨ìœ¨ì´ ë‚®ìŠµë‹ˆë‹¤. íƒ€ê²ŸíŒ… ì¬ì„¤ì •ì´ë‚˜ ê´‘ê³  ì†Œì¬ ê°œì„ ì´ í•„ìš”í•©ë‹ˆë‹¤.`;
            }

            insight += `<br><br>ğŸ“Š ì „ì²´ í‰ê·  ROASëŠ” <strong>${formatPercent(avgRoas)}</strong>ì´ë©°, ì´ ê´‘ê³ ë¹„ <strong>${formatCurrency(totalCost)}</strong>ê°€ ì§‘í–‰ë˜ì—ˆìŠµë‹ˆë‹¤.`;

            document.querySelector('#brandInsightText > div:last-child').innerHTML = insight;
        }

        function generateProductInsight() {
            const periodData = getPeriodData();
            const products = periodData.product_performance;
            if (!products || products.length === 0) return;

            const sorted = [...products].sort((a, b) => b.roas - a.roas);
            const best = sorted[0];
            const worst = sorted[sorted.length - 1];

            // ìŠ¤íƒ€ìƒí’ˆ (ROASâ†‘ ì „í™˜â†‘)
            const avgConv = products.reduce((sum, p) => sum + p.conversions, 0) / products.length;
            const starProducts = products.filter(p => p.roas >= 200 && p.conversions >= avgConv);
            const hiddenGems = products.filter(p => p.roas >= 200 && p.conversions < avgConv);
            const needsWork = products.filter(p => p.roas < 100);

            let insight = `<strong>${best.product}</strong>ê°€ ROAS <strong>${formatPercent(best.roas)}</strong>ë¡œ ìµœê³  ì„±ê³¼ ìƒí’ˆì…ë‹ˆë‹¤. `;

            if (starProducts.length > 0) {
                insight += `<br><br>â­ <strong>ìŠ¤íƒ€ ìƒí’ˆ ${starProducts.length}ê°œ</strong> (${starProducts.map(p => p.product).join(', ')}): ROASì™€ ì „í™˜ìˆ˜ ëª¨ë‘ ìš°ìˆ˜í•©ë‹ˆë‹¤. ì¬ê³  í™•ë³´ì™€ ì˜ˆì‚° í™•ëŒ€ë¥¼ ìµœìš°ì„ ìœ¼ë¡œ ì§„í–‰í•˜ì„¸ìš”.`;
            }

            if (hiddenGems.length > 0) {
                insight += `<br><br>ğŸ’ <strong>ìˆ¨ì€ ë³´ì„ ${hiddenGems.length}ê°œ</strong> (${hiddenGems.map(p => p.product).join(', ')}): ROASëŠ” ë†’ì§€ë§Œ ì „í™˜ìˆ˜ê°€ ì ìŠµë‹ˆë‹¤. ê´‘ê³  ë…¸ì¶œì„ ëŠ˜ë ¤ íŒë§¤ë¥¼ í™•ëŒ€í•˜ì„¸ìš”.`;
            }

            if (needsWork.length > 0) {
                insight += `<br><br>â›” <strong>ê°œì„  í•„ìš” ${needsWork.length}ê°œ</strong>: ROAS 100% ë¯¸ë§Œìœ¼ë¡œ ë¹„íš¨ìœ¨ì ì…ë‹ˆë‹¤. í”„ë¡œëª¨ì…˜ ë³€ê²½ì´ë‚˜ ê´‘ê³  ì¤‘ë‹¨ì„ ê²€í† í•˜ì„¸ìš”.`;
            }

            document.querySelector('#productInsightText > div:last-child').innerHTML = insight;
        }

        function generatePromotionInsight() {
            const periodData = getPeriodData();
            const promotions = periodData.promotion_performance;
            if (!promotions || promotions.length === 0) return;

            const sorted = [...promotions].sort((a, b) => b.roas - a.roas);
            const best = sorted[0];

            const successful = promotions.filter(p => p.roas >= 200);
            const moderate = promotions.filter(p => p.roas >= 100 && p.roas < 200);
            const failing = promotions.filter(p => p.roas < 50);

            let insight = `<strong>${best.promotion}</strong> í”„ë¡œëª¨ì…˜ì´ ROAS <strong>${formatPercent(best.roas)}</strong>ë¡œ ê°€ì¥ íš¨ê³¼ì ì…ë‹ˆë‹¤. `;

            if (successful.length > 0) {
                insight += `<br><br>ğŸ‰ <strong>ì„±ê³µ í”„ë¡œëª¨ì…˜ ${successful.length}ê°œ</strong>: ROAS 200% ì´ìƒìœ¼ë¡œ ê³ ê° ë°˜ì‘ì´ ë§¤ìš° ì¢‹ìŠµë‹ˆë‹¤. ìœ ì‚¬í•œ í”„ë¡œëª¨ì…˜ì„ ë°˜ë³µ ì‹¤í–‰í•˜ì„¸ìš”.`;
            }

            if (moderate.length > 0) {
                insight += `<br><br>ğŸ“… <strong>ìœ ì§€ í”„ë¡œëª¨ì…˜ ${moderate.length}ê°œ</strong>: ROAS 100-200%ë¡œ ìˆ˜ìµì´ ë°œìƒí•˜ê³  ìˆìŠµë‹ˆë‹¤. ê¸°ê°„ ì—°ì¥ì´ë‚˜ í˜œíƒ ê°•í™”ë¥¼ ê³ ë ¤í•˜ì„¸ìš”.`;
            }

            if (failing.length > 0) {
                insight += `<br><br>â›” <strong>ì¤‘ë‹¨ ê¶Œì¥ ${failing.length}ê°œ</strong> (${failing.map(p => p.promotion).join(', ')}): ROAS 50% ë¯¸ë§Œìœ¼ë¡œ ì†ì‹¤ì´ ë°œìƒí•˜ê³  ìˆìŠµë‹ˆë‹¤. ì¦‰ì‹œ ì¤‘ë‹¨í•˜ê³  ì›ì¸ì„ ë¶„ì„í•˜ì„¸ìš”.`;
            }

            document.querySelector('#promotionInsightText > div:last-child').innerHTML = insight;
        }

        function generateTargetingInsight() {
            // adsetDimensionDataì—ì„œ íƒ€ê²ŸíŒ…ë³„ ì§‘ê³„
            if (!adsetDimensionData || adsetDimensionData.length === 0) {
                document.querySelector('#targetingInsightText > div:last-child').innerHTML = 'íƒ€ê²ŸíŒ… ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...';
                return;
            }

            const groupedData = {};
            adsetDimensionData.forEach(row => {
                const targeting = row['íƒ€ê²ŸíŒ…'];
                if (!targeting || targeting === '' || targeting === '-') return;

                if (!groupedData[targeting]) {
                    groupedData[targeting] = { targeting: targeting, cost: 0, conversions: 0, revenue: 0 };
                }
                groupedData[targeting].cost += parseFloat(row['ë¹„ìš©']) || 0;
                groupedData[targeting].conversions += parseFloat(row['ì „í™˜ìˆ˜']) || 0;
                groupedData[targeting].revenue += parseFloat(row['ì „í™˜ê°’']) || 0;
            });

            const targetingData = Object.values(groupedData).map(g => ({
                ...g,
                roas: g.cost > 0 ? (g.revenue / g.cost) * 100 : 0,
                cpa: g.conversions > 0 ? g.cost / g.conversions : 0
            })).filter(g => g.cost > 0);

            if (targetingData.length === 0) return;

            const sorted = [...targetingData].sort((a, b) => b.roas - a.roas);
            const best = sorted[0];
            const totalCost = targetingData.reduce((sum, t) => sum + t.cost, 0);

            const golden = targetingData.filter(c => c.roas >= 300);
            const excellent = targetingData.filter(c => c.roas >= 150 && c.roas < 300);
            const poor = targetingData.filter(c => c.roas < 50);

            let insight = `<strong>${best.targeting}</strong> íƒ€ê²Ÿì´ ROAS <strong>${formatPercent(best.roas)}</strong>ë¡œ ê°€ì¥ ë†’ì€ ìˆ˜ìµì„ ë‚´ê³  ìˆìŠµë‹ˆë‹¤. `;
            insight += `(ë¹„ìš©: ${formatCurrency(best.cost)}, CPA: ${formatCurrency(best.cpa)})`;

            if (golden.length > 0) {
                insight += `<br><br>ğŸ¯ <strong>í™©ê¸ˆ íƒ€ê²Ÿ ${golden.length}ê°œ</strong>: ROAS 300% ì´ìƒì˜ í•µì‹¬ ê³ ê°ì¸µì…ë‹ˆë‹¤. ì´ íƒ€ê²Ÿ ì¡°í•©ìœ¼ë¡œ ìƒˆë¡œìš´ ê´‘ê³ ì„¸íŠ¸ë¥¼ ì¶”ê°€ ìƒì„±í•˜ì—¬ ê³µê²©ì ìœ¼ë¡œ í™•ì¥í•˜ì„¸ìš”.`;
            }

            if (excellent.length > 0) {
                insight += `<br><br>â­ <strong>ìš°ìˆ˜ íƒ€ê²Ÿ ${excellent.length}ê°œ</strong>: ì•ˆì •ì ì¸ ìˆ˜ìµì„ ë‚´ëŠ” íƒ€ê²Ÿì…ë‹ˆë‹¤. í˜„ì¬ ì˜ˆì‚°ì„ ìœ ì§€í•˜ë©´ì„œ ì ì§„ì ìœ¼ë¡œ í™•ëŒ€í•˜ì„¸ìš”.`;
            }

            if (poor.length > 0) {
                const poorCost = poor.reduce((sum, p) => sum + p.cost, 0);
                insight += `<br><br>ğŸš« <strong>ì œì™¸ ê¶Œì¥ ${poor.length}ê°œ</strong>: ROAS 50% ë¯¸ë§Œìœ¼ë¡œ ì´ <strong>${formatCurrency(poorCost)}</strong>ê°€ ë¹„íš¨ìœ¨ì ìœ¼ë¡œ ì‚¬ìš©ë˜ê³  ìˆìŠµë‹ˆë‹¤. ê³¼ê°íˆ íƒ€ê²Ÿì—ì„œ ì œì™¸í•˜ì„¸ìš”.`;
            }

            document.querySelector('#targetingInsightText > div:last-child').innerHTML = insight;
        }

        // ë¸Œëœë“œ ì„±ê³¼ ì°¨íŠ¸ - adsetDimensionData(dimension_type1_campaign_adset.csv) ì‚¬ìš©
        function renderBrandPerformanceChart() {
            const state = perfChartState.brand;

            // adsetDimensionDataì—ì„œ ë¸Œëœë“œë³„ ì§‘ê³„
            let brandData = [];
            if (adsetDimensionData && adsetDimensionData.length > 0) {
                const groupedData = {};
                adsetDimensionData.forEach(row => {
                    const brand = row['ë¸Œëœë“œëª…'];
                    if (!brand) return;
                    if (!groupedData[brand]) {
                        groupedData[brand] = { brand: brand, cost: 0, conversions: 0, revenue: 0 };
                    }
                    groupedData[brand].cost += parseFloat(row['ë¹„ìš©']) || 0;
                    groupedData[brand].conversions += parseFloat(row['ì „í™˜ìˆ˜']) || 0;
                    groupedData[brand].revenue += parseFloat(row['ì „í™˜ê°’']) || 0;
                });
                brandData = Object.values(groupedData).map(g => ({
                    ...g,
                    roas: g.cost > 0 ? (g.revenue / g.cost) * 100 : 0,
                    cpa: g.conversions > 0 ? g.cost / g.conversions : 0
                })).filter(g => g.cost > 0);
            }

            // ì •ë ¬
            let sorted = [...brandData].sort((a, b) => {
                const aVal = a[state.kpi];
                const bVal = b[state.kpi];
                return state.sort === 'desc' ? bVal - aVal : aVal - bVal;
            });

            const labels = sorted.map(b => b.brand);
            const values = sorted.map(b => b[state.kpi]);

            if (state.chart) state.chart.destroy();

            const ctx = document.getElementById('brandPerformanceChart').getContext('2d');
            state.chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: kpiLabels[state.kpi],
                        data: values,
                        backgroundColor: kpiColors[state.kpi].bg,
                        borderColor: kpiColors[state.kpi].border,
                        borderWidth: 1,
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const item = sorted[context.dataIndex];
                                    return [
                                        `ROAS: ${formatPercent(item.roas)}`,
                                        `ë¹„ìš©: ${formatCurrency(item.cost)}`,
                                        `CPA: ${formatCurrency(item.cpa)}`,
                                        `ì „í™˜ìˆ˜: ${formatNumber(item.conversions)}`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        x: { beginAtZero: true },
                        y: {
                            ticks: {
                                font: { size: 11 },
                                callback: function(value) {
                                    const label = this.getLabelForValue(value);
                                    return label.length > 12 ? label.substring(0, 12) + '...' : label;
                                }
                            }
                        }
                    }
                }
            });

            generateBrandInsight();
        }

        // ìƒí’ˆ ì„±ê³¼ ì°¨íŠ¸ - adsetDimensionData(dimension_type1_campaign_adset.csv) ì‚¬ìš©
        function renderProductPerformanceChart() {
            const state = perfChartState.product;

            // adsetDimensionDataì—ì„œ ìƒí’ˆë³„ ì§‘ê³„
            let productData = [];
            if (adsetDimensionData && adsetDimensionData.length > 0) {
                const groupedData = {};
                adsetDimensionData.forEach(row => {
                    const product = row['ìƒí’ˆëª…'];
                    if (!product) return;
                    if (!groupedData[product]) {
                        groupedData[product] = { product: product, cost: 0, conversions: 0, revenue: 0 };
                    }
                    groupedData[product].cost += parseFloat(row['ë¹„ìš©']) || 0;
                    groupedData[product].conversions += parseFloat(row['ì „í™˜ìˆ˜']) || 0;
                    groupedData[product].revenue += parseFloat(row['ì „í™˜ê°’']) || 0;
                });
                productData = Object.values(groupedData).map(g => ({
                    ...g,
                    roas: g.cost > 0 ? (g.revenue / g.cost) * 100 : 0,
                    cpa: g.conversions > 0 ? g.cost / g.conversions : 0
                })).filter(g => g.cost > 0);
            }

            let sorted = [...productData].sort((a, b) => {
                const aVal = a[state.kpi];
                const bVal = b[state.kpi];
                return state.sort === 'desc' ? bVal - aVal : aVal - bVal;
            });

            const labels = sorted.map(p => p.product);
            const values = sorted.map(p => p[state.kpi]);

            if (state.chart) state.chart.destroy();

            const ctx = document.getElementById('productPerformanceChart').getContext('2d');
            state.chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: kpiLabels[state.kpi],
                        data: values,
                        backgroundColor: kpiColors[state.kpi].bg,
                        borderColor: kpiColors[state.kpi].border,
                        borderWidth: 1,
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const item = sorted[context.dataIndex];
                                    return [
                                        `ROAS: ${formatPercent(item.roas)}`,
                                        `ë¹„ìš©: ${formatCurrency(item.cost)}`,
                                        `CPA: ${formatCurrency(item.cpa)}`,
                                        `ì „í™˜ìˆ˜: ${formatNumber(item.conversions)}`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        x: { beginAtZero: true },
                        y: {
                            ticks: {
                                font: { size: 11 },
                                callback: function(value) {
                                    const label = this.getLabelForValue(value);
                                    return label.length > 12 ? label.substring(0, 12) + '...' : label;
                                }
                            }
                        }
                    }
                }
            });

            generateProductInsight();
        }

        // í”„ë¡œëª¨ì…˜ ì„±ê³¼ ì°¨íŠ¸ - adsetDimensionData(dimension_type1_campaign_adset.csv) ì‚¬ìš©
        function renderPromotionPerformanceChart() {
            const state = perfChartState.promotion;

            // adsetDimensionDataì—ì„œ í”„ë¡œëª¨ì…˜ë³„ ì§‘ê³„
            let promotionData = [];
            if (adsetDimensionData && adsetDimensionData.length > 0) {
                const groupedData = {};
                adsetDimensionData.forEach(row => {
                    const promotion = row['í”„ë¡œëª¨ì…˜'];
                    if (!promotion) return;
                    if (!groupedData[promotion]) {
                        groupedData[promotion] = { promotion: promotion, cost: 0, conversions: 0, revenue: 0 };
                    }
                    groupedData[promotion].cost += parseFloat(row['ë¹„ìš©']) || 0;
                    groupedData[promotion].conversions += parseFloat(row['ì „í™˜ìˆ˜']) || 0;
                    groupedData[promotion].revenue += parseFloat(row['ì „í™˜ê°’']) || 0;
                });
                promotionData = Object.values(groupedData).map(g => ({
                    ...g,
                    roas: g.cost > 0 ? (g.revenue / g.cost) * 100 : 0,
                    cpa: g.conversions > 0 ? g.cost / g.conversions : 0
                })).filter(g => g.cost > 0);
            }

            let sorted = [...promotionData].sort((a, b) => {
                const aVal = a[state.kpi];
                const bVal = b[state.kpi];
                return state.sort === 'desc' ? bVal - aVal : aVal - bVal;
            });

            const labels = sorted.map(p => p.promotion);
            const values = sorted.map(p => p[state.kpi]);

            if (state.chart) state.chart.destroy();

            const ctx = document.getElementById('promotionPerformanceChart').getContext('2d');
            state.chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: kpiLabels[state.kpi],
                        data: values,
                        backgroundColor: kpiColors[state.kpi].bg,
                        borderColor: kpiColors[state.kpi].border,
                        borderWidth: 1,
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const item = sorted[context.dataIndex];
                                    return [
                                        `ROAS: ${formatPercent(item.roas)}`,
                                        `ë¹„ìš©: ${formatCurrency(item.cost)}`,
                                        `CPA: ${formatCurrency(item.cpa)}`,
                                        `ì „í™˜ìˆ˜: ${formatNumber(item.conversions)}`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        x: { beginAtZero: true },
                        y: {
                            ticks: {
                                font: { size: 11 },
                                callback: function(value) {
                                    const label = this.getLabelForValue(value);
                                    return label.length > 15 ? label.substring(0, 15) + '...' : label;
                                }
                            }
                        }
                    }
                }
            });

            generatePromotionInsight();
        }

        // íƒ€ê²ŸíŒ… ì„±ê³¼ ì°¨íŠ¸ - adsetDimensionData(dimension_type1_campaign_adset.csv)ì˜ 'íƒ€ê²ŸíŒ…' ì»¬ëŸ¼ ì‚¬ìš©
        function renderTargetingPerformanceChart() {
            const state = perfChartState.targeting;

            // adsetDimensionDataì—ì„œ íƒ€ê²ŸíŒ…ë³„ ì§‘ê³„
            let targetingData = [];

            if (adsetDimensionData && adsetDimensionData.length > 0) {
                const groupedData = {};
                adsetDimensionData.forEach(row => {
                    const targeting = row['íƒ€ê²ŸíŒ…'];
                    if (!targeting || targeting === '' || targeting === '-') return;

                    if (!groupedData[targeting]) {
                        groupedData[targeting] = { targeting: targeting, cost: 0, conversions: 0, revenue: 0 };
                    }
                    groupedData[targeting].cost += parseFloat(row['ë¹„ìš©']) || 0;
                    groupedData[targeting].conversions += parseFloat(row['ì „í™˜ìˆ˜']) || 0;
                    groupedData[targeting].revenue += parseFloat(row['ì „í™˜ê°’']) || 0;
                });

                // ROAS, CPA ê³„ì‚°
                targetingData = Object.values(groupedData).map(g => ({
                    ...g,
                    roas: g.cost > 0 ? (g.revenue / g.cost) * 100 : 0,
                    cpa: g.conversions > 0 ? g.cost / g.conversions : 0,
                    label: g.targeting
                })).filter(g => g.cost > 0);
            }

            // ì •ë ¬
            let sorted = [...targetingData].sort((a, b) => {
                const aVal = a[state.kpi];
                const bVal = b[state.kpi];
                return state.sort === 'desc' ? bVal - aVal : aVal - bVal;
            }).slice(0, 10);

            const labels = sorted.map(c => c.label);
            const values = sorted.map(c => c[state.kpi]);

            if (state.chart) state.chart.destroy();

            const ctx = document.getElementById('targetingPerformanceChart').getContext('2d');
            state.chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: kpiLabels[state.kpi],
                        data: values,
                        backgroundColor: kpiColors[state.kpi].bg,
                        borderColor: kpiColors[state.kpi].border,
                        borderWidth: 1,
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const item = sorted[context.dataIndex];
                                    return [
                                        `ROAS: ${formatPercent(item.roas)}`,
                                        `ë¹„ìš©: ${formatCurrency(item.cost)}`,
                                        `CPA: ${formatCurrency(item.cpa)}`,
                                        `ì „í™˜ìˆ˜: ${formatNumber(item.conversions)}`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        x: { beginAtZero: true },
                        y: {
                            ticks: { font: { size: 11 } }
                        }
                    }
                }
            });

            generateTargetingInsight();
        }

        // ì„±ê³¼ë¶„ì„ KPI/ì •ë ¬ ë²„íŠ¼ ì´ë²¤íŠ¸
        function setupPerformanceControls() {
            // KPI ë²„íŠ¼
            document.querySelectorAll('.perf-kpi-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const category = this.dataset.category;
                    const kpi = this.dataset.kpi;

                    // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ë³€ê²½
                    document.querySelectorAll(`.perf-kpi-btn[data-category="${category}"]`).forEach(b => {
                        b.style.background = 'white';
                        b.style.color = '#495057';
                        b.style.border = '1px solid #dee2e6';
                        b.classList.remove('active');
                    });
                    this.style.background = '#1a73e8';
                    this.style.color = 'white';
                    this.style.border = 'none';
                    this.classList.add('active');

                    // ìƒíƒœ ì—…ë°ì´íŠ¸ ë° ì°¨íŠ¸ ì¬ë Œë”ë§
                    perfChartState[category].kpi = kpi;
                    renderPerformanceChart(category);
                });
            });

            // ì •ë ¬ ë²„íŠ¼
            document.querySelectorAll('.perf-sort-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const category = this.dataset.category;
                    const sort = this.dataset.sort;

                    // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ë³€ê²½
                    document.querySelectorAll(`.perf-sort-btn[data-category="${category}"]`).forEach(b => {
                        b.style.background = 'white';
                        b.classList.remove('active');
                    });
                    this.style.background = '#f8f9fa';
                    this.classList.add('active');

                    // ìƒíƒœ ì—…ë°ì´íŠ¸ ë° ì°¨íŠ¸ ì¬ë Œë”ë§
                    perfChartState[category].sort = sort;
                    renderPerformanceChart(category);
                });
            });
        }

        // ì¹´í…Œê³ ë¦¬ë³„ ì°¨íŠ¸ ë Œë”ë§
        function renderPerformanceChart(category) {
            switch(category) {
                case 'brand': renderBrandPerformanceChart(); break;
                case 'product': renderProductPerformanceChart(); break;
                case 'promotion': renderPromotionPerformanceChart(); break;
                case 'targeting': renderTargetingPerformanceChart(); break;
            }
        }

        // ëª¨ë“  ì„±ê³¼ë¶„ì„ ì°¨íŠ¸ ì´ˆê¸°í™”
        function initPerformanceCharts() {
            renderBrandPerformanceChart();
            renderProductPerformanceChart();
            renderPromotionPerformanceChart();
            renderTargetingPerformanceChart();
            setupPerformanceControls();
        }

        // ê¸°ì¡´ í…Œì´ë¸” í•¨ìˆ˜ë“¤ (í˜¸í™˜ì„± ìœ ì§€)
        function renderBrandDetailTable() {}
        function renderProductDetailTable() {}
        function renderPromotionDetailTable() {}
        function renderTopAdsetsTable() {}
        function renderAgeGenderTable() {}

        // ========== ë¦¬íƒ€ê²ŸíŒ… ë° ê³„ì ˆì„± ë¶„ì„ ==========

        // ë¦¬íƒ€ê²ŸíŒ… í…Œì´ë¸” ì •ë ¬ ìƒíƒœ
        const retargetingSortState = {
            ageGender: { column: 'roas', direction: 'desc' },
            device: { column: 'roas', direction: 'desc' },
            platform: { column: 'roas', direction: 'desc' },
            devicePlatform: { column: 'roas', direction: 'desc' },
            seasonality: { column: 'roas', direction: 'desc' }
        };

        // ë¦¬íƒ€ê²ŸíŒ… ë¶„ì„ ì´ˆê¸°í™”
        function initRetargetingAnalysis() {
            renderAgeGenderRetargetTable();
            renderDeviceRetargetTable();
            renderPlatformRetargetTable();
            renderDevicePlatformRetargetTable();
            setupRetargetingTabEvents();
            setupRetargetingSortEvents();
        }

        // ë¦¬íƒ€ê²ŸíŒ… í…Œì´ë¸” ì •ë ¬ ì´ë²¤íŠ¸ ì„¤ì •
        function setupRetargetingSortEvents() {
            document.querySelectorAll('.sortable-header[data-table]').forEach(th => {
                th.addEventListener('click', function() {
                    const tableType = this.getAttribute('data-table');
                    const column = this.getAttribute('data-column');

                    // ê°™ì€ ì—´ í´ë¦­ì‹œ ë°©í–¥ í† ê¸€, ë‹¤ë¥¸ ì—´ì´ë©´ descë¡œ ì‹œì‘
                    if (retargetingSortState[tableType].column === column) {
                        retargetingSortState[tableType].direction =
                            retargetingSortState[tableType].direction === 'desc' ? 'asc' : 'desc';
                    } else {
                        retargetingSortState[tableType].column = column;
                        retargetingSortState[tableType].direction = 'desc';
                    }

                    // í•´ë‹¹ í…Œì´ë¸” ë‹¤ì‹œ ë Œë”ë§
                    switch(tableType) {
                        case 'ageGender': renderAgeGenderRetargetTable(); break;
                        case 'device': renderDeviceRetargetTable(); break;
                        case 'platform': renderPlatformRetargetTable(); break;
                        case 'devicePlatform': renderDevicePlatformRetargetTable(); break;
                        case 'seasonality': renderSeasonalityTable(); break;
                    }

                    // ì •ë ¬ ì•„ì´ì½˜ ì—…ë°ì´íŠ¸
                    updateRetargetingSortIcons(tableType);
                });
            });
        }

        // ì •ë ¬ ì•„ì´ì½˜ ì—…ë°ì´íŠ¸
        function updateRetargetingSortIcons(tableType) {
            const headers = document.querySelectorAll(`.sortable-header[data-table="${tableType}"]`);
            headers.forEach(th => {
                const column = th.getAttribute('data-column');
                const sortIcon = th.querySelector('.sort-icon');
                const upArrow = th.querySelector('.sort-arrow.up');
                const downArrow = th.querySelector('.sort-arrow.down');

                if (column === retargetingSortState[tableType].column) {
                    sortIcon.classList.add('active');
                    if (retargetingSortState[tableType].direction === 'asc') {
                        upArrow.classList.add('active');
                        downArrow.classList.remove('active');
                    } else {
                        upArrow.classList.remove('active');
                        downArrow.classList.add('active');
                    }
                } else {
                    sortIcon.classList.remove('active');
                    upArrow.classList.remove('active');
                    downArrow.classList.remove('active');
                }
            });
        }

        // ë¦¬íƒ€ê²ŸíŒ… íƒ­ ì „í™˜ ì´ë²¤íŠ¸
        function setupRetargetingTabEvents() {
            document.querySelectorAll('.retargeting-subtab').forEach(btn => {
                btn.addEventListener('click', function() {
                    // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ë³€ê²½
                    document.querySelectorAll('.retargeting-subtab').forEach(b => {
                        b.style.background = 'white';
                        b.style.color = '#495057';
                        b.style.border = '1px solid #dee2e6';
                    });
                    this.style.background = '#1a73e8';
                    this.style.color = 'white';
                    this.style.border = 'none';

                    // ì½˜í…ì¸  ì „í™˜
                    const targetTab = this.dataset.retargetTab;
                    document.querySelectorAll('.retargeting-tab-content').forEach(content => {
                        content.style.display = 'none';
                        content.classList.remove('active');
                    });

                    const viewMap = {
                        'ageGender': 'ageGenderRetargetView',
                        'device': 'deviceRetargetView',
                        'platform': 'platformRetargetView',
                        'devicePlatform': 'devicePlatformRetargetView'
                    };

                    const targetView = document.getElementById(viewMap[targetTab]);
                    if (targetView) {
                        targetView.style.display = 'block';
                        targetView.classList.add('active');
                    }
                });
            });
        }

        // ì„±ë³„/ì—°ë ¹ ë¦¬íƒ€ê²ŸíŒ… í…Œì´ë¸” ë Œë”ë§
        function renderAgeGenderRetargetTable() {
            const periodData = getPeriodData();
            const retargeting = periodData.retargeting_analysis || {};
            const data = retargeting.by_age_gender || [];
            const insights = periodData.retargeting_insights || [];
            const tbody = document.getElementById('ageGenderRetargetTableBody');

            if (!tbody || data.length === 0) {
                if (tbody) tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px; color: var(--grey-500);">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</td></tr>';
                return;
            }

            // ì •ë ¬ ìƒíƒœì— ë”°ë¥¸ ì •ë ¬
            const filteredData = data.filter(item => item.roas > 0);
            const { column, direction } = retargetingSortState.ageGender;
            const sortedData = [...filteredData].sort((a, b) => {
                const aVal = a[column] || 0;
                const bVal = b[column] || 0;
                return direction === 'desc' ? bVal - aVal : aVal - bVal;
            });
            const maxRoas = Math.max(...filteredData.map(d => d.roas), 100);

            let html = '';
            sortedData.forEach((item, index) => {
                const genderIcon = item.gender === 'ë‚¨ì„±' ? 'ğŸ‘¨' : 'ğŸ‘©';
                const roasColor = item.roas >= 50 ? '#2e7d32' : item.roas >= 20 ? '#1565c0' : '#d32f2f';
                const efficiencyGrade = getEfficiencyGrade(item.roas, maxRoas);

                html += `
                    <tr>
                        <td style="font-weight: 500;">${genderIcon} ${item.label || (item.age + ' ' + item.gender)}</td>
                        <td style="text-align: right; font-weight: 700; color: ${roasColor};">${formatPercent(item.roas)}</td>
                        <td style="text-align: right;">${item.cpa > 0 ? formatCurrency(item.cpa) : '-'}</td>
                        <td style="text-align: right;">${formatCurrency(item.cost)}</td>
                        <td style="text-align: right;">${formatNumber(item.conversions)}</td>
                        <td style="text-align: right;">${formatCurrency(item.revenue)}</td>
                        <td style="text-align: center;">${efficiencyGrade}</td>
                    </tr>
                `;
            });

            tbody.innerHTML = html;

            // ì¸ì‚¬ì´íŠ¸ ì—…ë°ì´íŠ¸
            const ageGenderInsight = insights.find(i => i.type === 'retargeting_best_age_gender');
            const insightText = document.getElementById('ageGenderRetargetInsightText');
            if (insightText && ageGenderInsight) {
                insightText.innerHTML = ageGenderInsight.message;
            } else if (insightText && sortedData.length > 0) {
                insightText.innerHTML = `<strong>${sortedData[0].label}</strong> íƒ€ê²Ÿì´ ROAS <strong>${formatPercent(sortedData[0].roas)}</strong>ë¡œ ê°€ì¥ ë†’ì€ íš¨ìœ¨ì„ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤.`;
            }
        }

        // ê¸°ê¸°ë³„ ë¦¬íƒ€ê²ŸíŒ… í…Œì´ë¸” ë Œë”ë§
        function renderDeviceRetargetTable() {
            const periodData = getPeriodData();
            const retargeting = periodData.retargeting_analysis || {};
            const data = retargeting.by_device || [];
            const insights = periodData.retargeting_insights || [];
            const tbody = document.getElementById('deviceRetargetTableBody');

            if (!tbody || data.length === 0) {
                if (tbody) tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px; color: var(--grey-500);">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</td></tr>';
                return;
            }

            // ì •ë ¬ ìƒíƒœì— ë”°ë¥¸ ì •ë ¬
            const filteredData = data.filter(item => item.roas > 0);
            const { column, direction } = retargetingSortState.device;
            const sortedData = [...filteredData].sort((a, b) => {
                const aVal = a[column] || 0;
                const bVal = b[column] || 0;
                return direction === 'desc' ? bVal - aVal : aVal - bVal;
            });
            const maxRoas = Math.max(...filteredData.map(d => d.roas), 100);

            let html = '';
            sortedData.forEach((item, index) => {
                const deviceIcon = getDeviceIcon(item.device);
                const roasColor = item.roas >= 200 ? '#2e7d32' : item.roas >= 100 ? '#1565c0' : '#d32f2f';
                const efficiencyGrade = getEfficiencyGrade(item.roas, maxRoas);

                html += `
                    <tr>
                        <td style="font-weight: 500;">${deviceIcon} ${item.device}</td>
                        <td style="text-align: right; font-weight: 700; color: ${roasColor};">${formatPercent(item.roas)}</td>
                        <td style="text-align: right;">${item.cpa > 0 ? formatCurrency(item.cpa) : '-'}</td>
                        <td style="text-align: right;">${formatCurrency(item.cost)}</td>
                        <td style="text-align: right;">${formatNumber(item.conversions)}</td>
                        <td style="text-align: right;">${formatCurrency(item.revenue)}</td>
                        <td style="text-align: center;">${efficiencyGrade}</td>
                    </tr>
                `;
            });

            tbody.innerHTML = html;

            // ì¸ì‚¬ì´íŠ¸ ì—…ë°ì´íŠ¸
            const deviceInsight = insights.find(i => i.type === 'retargeting_best_device');
            const insightText = document.getElementById('deviceRetargetInsightText');
            if (insightText && deviceInsight) {
                insightText.innerHTML = deviceInsight.message;
            } else if (insightText && sortedData.length > 0) {
                insightText.innerHTML = `<strong>${sortedData[0].device}</strong> ê¸°ê¸°ê°€ ROAS <strong>${formatPercent(sortedData[0].roas)}</strong>ë¡œ ê°€ì¥ ë†’ì€ íš¨ìœ¨ì„ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤.`;
            }
        }

        // í”Œë«í¼ë³„ ë¦¬íƒ€ê²ŸíŒ… í…Œì´ë¸” ë Œë”ë§
        function renderPlatformRetargetTable() {
            const periodData = getPeriodData();
            const retargeting = periodData.retargeting_analysis || {};
            const data = retargeting.by_platform || [];
            const insights = periodData.retargeting_insights || [];
            const tbody = document.getElementById('platformRetargetTableBody');

            if (!tbody || data.length === 0) {
                if (tbody) tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px; color: var(--grey-500);">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</td></tr>';
                return;
            }

            // ì •ë ¬ ìƒíƒœì— ë”°ë¥¸ ì •ë ¬
            const { column, direction } = retargetingSortState.platform;
            const sortedData = [...data].sort((a, b) => {
                const aVal = a[column] || 0;
                const bVal = b[column] || 0;
                return direction === 'desc' ? bVal - aVal : aVal - bVal;
            });
            const maxRoas = Math.max(...data.filter(d => d.roas > 0).map(d => d.roas), 100);

            let html = '';
            sortedData.forEach(item => {
                const platformIcon = getPlatformIcon(item.deviceplatform);
                const roasColor = item.roas >= 150 ? '#2e7d32' : item.roas >= 50 ? '#1565c0' : item.roas > 0 ? '#e65100' : '#9e9e9e';
                const efficiencyGrade = item.roas > 0 ? getEfficiencyGrade(item.roas, maxRoas) : '<span style="background: #f5f5f5; color: #9e9e9e; padding: 4px 8px; border-radius: 12px; font-size: 11px; font-weight: 600;">-</span>';

                html += `
                    <tr>
                        <td style="font-weight: 500;">${platformIcon} ${item.deviceplatform}</td>
                        <td style="text-align: right; font-weight: 700; color: ${roasColor};">${item.roas > 0 ? formatPercent(item.roas) : '-'}</td>
                        <td style="text-align: right;">${item.cpa > 0 ? formatCurrency(item.cpa) : '-'}</td>
                        <td style="text-align: right;">${formatCurrency(item.cost)}</td>
                        <td style="text-align: right;">${formatNumber(item.conversions)}</td>
                        <td style="text-align: right;">${formatCurrency(item.revenue)}</td>
                        <td style="text-align: center;">${efficiencyGrade}</td>
                    </tr>
                `;
            });

            tbody.innerHTML = html;

            // ì¸ì‚¬ì´íŠ¸ ì—…ë°ì´íŠ¸
            const platformInsight = insights.find(i => i.type === 'retargeting_best_deviceplatform');
            const insightText = document.getElementById('platformRetargetInsightText');
            if (insightText && platformInsight) {
                insightText.innerHTML = platformInsight.message;
            } else if (insightText && sortedData.length > 0 && sortedData[0].roas > 0) {
                insightText.innerHTML = `<strong>${sortedData[0].deviceplatform}</strong> ê¸°ê¸°í”Œë«í¼ì´ ROAS <strong>${formatPercent(sortedData[0].roas)}</strong>ë¡œ ê°€ì¥ ë†’ì€ íš¨ìœ¨ì„ ê¸°ë¡ ì¤‘ì…ë‹ˆë‹¤.`;
            }
        }

        // ë…¸ì¶œê¸°ê¸°ë³„ ë¦¬íƒ€ê²ŸíŒ… í…Œì´ë¸” ë Œë”ë§
        function renderDevicePlatformRetargetTable() {
            const periodData = getPeriodData();
            const retargeting = periodData.retargeting_analysis || {};
            const data = retargeting.by_device_platform || [];
            const insights = periodData.retargeting_insights || [];
            const tbody = document.getElementById('devicePlatformRetargetTableBody');

            if (!tbody || data.length === 0) {
                if (tbody) tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px; color: var(--grey-500);">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</td></tr>';
                return;
            }

            // ì •ë ¬ ìƒíƒœì— ë”°ë¥¸ ì •ë ¬
            const { column, direction } = retargetingSortState.devicePlatform;
            const sortedData = [...data].sort((a, b) => {
                const aVal = a[column] || 0;
                const bVal = b[column] || 0;
                return direction === 'desc' ? bVal - aVal : aVal - bVal;
            });
            const maxRoas = Math.max(...data.filter(d => d.roas > 0).map(d => d.roas), 100);

            let html = '';
            sortedData.forEach(item => {
                const devicePlatformIcon = getDevicePlatformIcon(item.device_platform);
                const roasColor = item.roas >= 30 ? '#2e7d32' : item.roas >= 10 ? '#1565c0' : item.roas > 0 ? '#e65100' : '#9e9e9e';
                const efficiencyGrade = item.roas > 0 ? getEfficiencyGrade(item.roas, maxRoas) : '<span style="background: #f5f5f5; color: #9e9e9e; padding: 4px 8px; border-radius: 12px; font-size: 11px; font-weight: 600;">-</span>';

                html += `
                    <tr>
                        <td style="font-weight: 500;">${devicePlatformIcon} ${item.device_platform}</td>
                        <td style="text-align: right; font-weight: 700; color: ${roasColor};">${item.roas > 0 ? formatPercent(item.roas) : '-'}</td>
                        <td style="text-align: right;">${item.cpa > 0 ? formatCurrency(item.cpa) : '-'}</td>
                        <td style="text-align: right;">${formatCurrency(item.cost)}</td>
                        <td style="text-align: right;">${formatNumber(item.conversions)}</td>
                        <td style="text-align: right;">${formatCurrency(item.revenue)}</td>
                        <td style="text-align: center;">${efficiencyGrade}</td>
                    </tr>
                `;
            });

            tbody.innerHTML = html;

            // ì¸ì‚¬ì´íŠ¸ ì—…ë°ì´íŠ¸
            const devicePlatformInsight = insights.find(i => i.type === 'retargeting_best_device_platform');
            const insightText = document.getElementById('devicePlatformRetargetInsightText');
            if (insightText && devicePlatformInsight) {
                insightText.innerHTML = devicePlatformInsight.message;
            } else if (insightText && sortedData.length > 0 && sortedData[0].roas > 0) {
                insightText.innerHTML = `<strong>${sortedData[0].device_platform}</strong> ë…¸ì¶œê¸°ê¸°ê°€ ROAS <strong>${formatPercent(sortedData[0].roas)}</strong>ë¡œ ê°€ì¥ ë†’ì€ íš¨ìœ¨ì„ ê¸°ë¡ ì¤‘ì…ë‹ˆë‹¤.`;
            }
        }

        // ë…¸ì¶œê¸°ê¸° ì•„ì´ì½˜ ë°˜í™˜
        function getDevicePlatformIcon(devicePlatform) {
            const icons = {
                'Mobile app': 'ğŸ“±',
                'Mobile web': 'ğŸ“²',
                'Desktop': 'ğŸ–¥ï¸',
                'Uncategorized': 'â“'
            };
            return icons[devicePlatform] || 'ğŸ“Š';
        }

        // ========== ë¶„ê¸°ë³„ ì¶”ì´ ì°¨íŠ¸ ë° í…Œì´ë¸” ==========
        let quarterlyTrendChartInstance = null;

        // ë¶„ê¸°ë³„ ì¶”ì´ ì°¨íŠ¸ ë Œë”ë§
        function renderQuarterlyTrendChart() {
            const seasonality = getSeasonalityData().seasonality_analysis || {};
            const quarterlyData = seasonality.quarterly_overall || [];
            const insights = getSeasonalityData().seasonality_insights || [];

            if (quarterlyData.length === 0) return;

            // ë¶„ê¸° ìˆœì„œ ì •ë ¬
            const quarterOrder = ['Q1(1~3ì›”)', 'Q2(4~6ì›”)', 'Q3(7~9ì›”)', 'Q4(10~12ì›”)'];
            const sortedData = [...quarterlyData].sort((a, b) =>
                quarterOrder.indexOf(a.quarter) - quarterOrder.indexOf(b.quarter)
            );

            const labels = sortedData.map(d => d.quarter);
            const costData = sortedData.map(d => Math.round(d.avg_cost / 10000)); // ë§Œì› ë‹¨ìœ„
            const roasData = sortedData.map(d => d.avg_roas);
            const cpaData = sortedData.map(d => Math.round(d.avg_cpa / 1000)); // ì²œì› ë‹¨ìœ„

            const ctx = document.getElementById('quarterlyTrendChart');
            if (!ctx) return;

            // ê¸°ì¡´ ì°¨íŠ¸ ì œê±°
            if (quarterlyTrendChartInstance) {
                quarterlyTrendChartInstance.destroy();
            }

            quarterlyTrendChartInstance = new Chart(ctx.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'ë¹„ìš© (ë§Œì›)',
                            data: costData,
                            backgroundColor: 'rgba(66, 133, 244, 0.7)',
                            borderColor: 'rgba(66, 133, 244, 1)',
                            borderWidth: 1,
                            borderRadius: 4,
                            yAxisID: 'y',
                            order: 2
                        },
                        {
                            label: 'ROAS (%)',
                            data: roasData,
                            type: 'line',
                            borderColor: '#34a853',
                            backgroundColor: 'rgba(52, 168, 83, 0.1)',
                            borderWidth: 3,
                            pointRadius: 6,
                            pointBackgroundColor: '#34a853',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            tension: 0.3,
                            fill: false,
                            yAxisID: 'y1',
                            order: 1
                        },
                        {
                            label: 'CPA (ì²œì›)',
                            data: cpaData,
                            type: 'line',
                            borderColor: '#ea4335',
                            backgroundColor: 'rgba(234, 67, 53, 0.1)',
                            borderWidth: 3,
                            pointRadius: 6,
                            pointBackgroundColor: '#ea4335',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            tension: 0.3,
                            fill: false,
                            yAxisID: 'y2',
                            order: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 20,
                                font: { size: 12, weight: '500' }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(255, 255, 255, 0.95)',
                            titleColor: '#333',
                            bodyColor: '#666',
                            borderColor: '#e0e0e0',
                            borderWidth: 1,
                            padding: 12,
                            callbacks: {
                                label: function(context) {
                                    const label = context.dataset.label || '';
                                    const value = context.parsed.y;
                                    if (label.includes('ë¹„ìš©')) return label + ': ' + value.toLocaleString() + 'ë§Œì›';
                                    if (label.includes('ROAS')) return label + ': ' + value.toFixed(1) + '%';
                                    if (label.includes('CPA')) return label + ': ' + value.toLocaleString() + 'ì²œì›';
                                    return label + ': ' + value;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { display: false },
                            ticks: { font: { size: 12, weight: '600' } }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'ë¹„ìš© (ë§Œì›)',
                                color: '#4285f4',
                                font: { size: 11, weight: '600' }
                            },
                            grid: { color: 'rgba(0, 0, 0, 0.05)' },
                            ticks: {
                                color: '#4285f4',
                                callback: function(value) { return value.toLocaleString(); }
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'ROAS (%)',
                                color: '#34a853',
                                font: { size: 11, weight: '600' }
                            },
                            grid: { drawOnChartArea: false },
                            ticks: {
                                color: '#34a853',
                                callback: function(value) { return value.toFixed(0) + '%'; }
                            }
                        },
                        y2: {
                            type: 'linear',
                            display: false,
                            position: 'right',
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });

            // KPI ì¹´ë“œ ë Œë”ë§
            renderQuarterlyKpiCards(sortedData);

            // ê³„ì ˆì„± ì¸ì‚¬ì´íŠ¸ ë Œë”ë§
            renderQuarterlySeasonalityInsight(sortedData, insights);
        }

        // ë¶„ê¸°ë³„ KPI ì¹´ë“œ ë Œë”ë§
        function renderQuarterlyKpiCards(quarterlyData) {
            const container = document.getElementById('quarterlyKpiCards');
            if (!container || quarterlyData.length === 0) return;

            // ë¶„ê¸°ë³„ ìƒ‰ìƒ
            const quarterColors = {
                'Q1(1~3ì›”)': { bg: '#e3f2fd', text: '#1565c0', icon: 'ğŸŒ¸' },
                'Q2(4~6ì›”)': { bg: '#e8f5e9', text: '#2e7d32', icon: 'â˜€ï¸' },
                'Q3(7~9ì›”)': { bg: '#fff3e0', text: '#ef6c00', icon: 'ğŸ‚' },
                'Q4(10~12ì›”)': { bg: '#fce4ec', text: '#c2185b', icon: 'â„ï¸' }
            };

            let html = '';
            quarterlyData.forEach(q => {
                const color = quarterColors[q.quarter] || { bg: '#f5f5f5', text: '#757575', icon: 'ğŸ“Š' };
                html += `
                    <div style="background: ${color.bg}; border-radius: 12px; padding: 16px; text-align: center;">
                        <div style="font-size: 20px; margin-bottom: 8px;">${color.icon}</div>
                        <div style="font-size: 13px; font-weight: 600; color: ${color.text}; margin-bottom: 4px;">${q.quarter}</div>
                        <div style="font-size: 18px; font-weight: 700; color: ${color.text};">${q.avg_roas.toFixed(1)}%</div>
                        <div style="font-size: 11px; color: #757575; margin-top: 4px;">ROAS</div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // ë¶„ê¸°ë³„ ê³„ì ˆì„± ì¸ì‚¬ì´íŠ¸ ë Œë”ë§
        function renderQuarterlySeasonalityInsight(quarterlyData, insights) {
            const insightText = document.getElementById('quarterlySeasonalityInsightText');
            if (!insightText) return;

            // ë¶„ê¸°ë³„ ë°ì´í„°ì—ì„œ ìµœê³ /ìµœì € ë¶„ê¸° ì°¾ê¸°
            const bestQuarter = [...quarterlyData].sort((a, b) => b.avg_roas - a.avg_roas)[0];
            const worstQuarter = [...quarterlyData].sort((a, b) => a.avg_roas - b.avg_roas)[0];
            const lowestCpaQuarter = [...quarterlyData].sort((a, b) => a.avg_cpa - b.avg_cpa)[0];

            // ìš”ì¼ë³„ ì¸ì‚¬ì´íŠ¸
            const bestDayInsight = insights.find(i => i.type === 'best_day_overall');
            const worstDayInsight = insights.find(i => i.type === 'worst_day_overall');
            const weekdayInsight = insights.find(i => i.type === 'weekday_better' || i.type === 'weekend_better');

            let insightHtml = '<div style="display: flex; flex-direction: column; gap: 12px;">';

            // ë¶„ê¸°ë³„ ì¸ì‚¬ì´íŠ¸
            insightHtml += `
                <div style="display: flex; align-items: flex-start; gap: 8px;">
                    <span style="color: #1565c0; font-size: 16px;">ğŸ“ˆ</span>
                    <div>
                        <strong style="color: #1565c0;">ë¶„ê¸°ë³„ ì„±ê³¼:</strong>
                        <strong>${bestQuarter.quarter}</strong>ì´ ROAS <strong>${bestQuarter.avg_roas.toFixed(1)}%</strong>ë¡œ ê°€ì¥ íš¨ìœ¨ì´ ë†’ê³ ,
                        ${worstQuarter.quarter}ì´ ${worstQuarter.avg_roas.toFixed(1)}%ë¡œ ê°€ì¥ ë‚®ìŠµë‹ˆë‹¤.
                        ${lowestCpaQuarter.quarter !== bestQuarter.quarter ?
                            ` CPAëŠ” ${lowestCpaQuarter.quarter}ì´ ${Math.round(lowestCpaQuarter.avg_cpa).toLocaleString()}ì›ìœ¼ë¡œ ê°€ì¥ ë‚®ìŠµë‹ˆë‹¤.` : ''}
                    </div>
                </div>
            `;

            // ìš”ì¼ë³„ ì¸ì‚¬ì´íŠ¸
            if (bestDayInsight) {
                insightHtml += `
                    <div style="display: flex; align-items: flex-start; gap: 8px;">
                        <span style="color: #2e7d32; font-size: 16px;">ğŸ“…</span>
                        <div>
                            <strong style="color: #2e7d32;">ìš”ì¼ë³„ ì„±ê³¼:</strong>
                            <strong>${bestDayInsight.day}</strong>ì´ ROAS ${bestDayInsight.avg_roas.toFixed(1)}%ë¡œ ìµœê³ ,
                            ${worstDayInsight ? worstDayInsight.day + 'ì´ ' + worstDayInsight.avg_roas.toFixed(1) + '%ë¡œ ìµœì €ì…ë‹ˆë‹¤.' : ''}
                        </div>
                    </div>
                `;
            }

            // ì£¼ì¤‘/ì£¼ë§ ì¸ì‚¬ì´íŠ¸
            if (weekdayInsight) {
                const isWeekdayBetter = weekdayInsight.type === 'weekday_better';
                insightHtml += `
                    <div style="display: flex; align-items: flex-start; gap: 8px;">
                        <span style="color: #f57c00; font-size: 16px;">ğŸ’¡</span>
                        <div>
                            <strong style="color: #f57c00;">ìš´ì˜ ì œì•ˆ:</strong>
                            ${isWeekdayBetter ?
                                'ì£¼ì¤‘ì´ ì£¼ë§ë³´ë‹¤ ROASê°€ ' + weekdayInsight.diff_percent.toFixed(1) + '% ë†’ìŠµë‹ˆë‹¤. <strong>ì£¼ì¤‘ ì§‘ì¤‘ ìš´ì˜</strong>ì„ ê¶Œì¥í•©ë‹ˆë‹¤.' :
                                'ì£¼ë§ì´ ì£¼ì¤‘ë³´ë‹¤ ROASê°€ ë†’ìŠµë‹ˆë‹¤. <strong>ì£¼ë§ ì˜ˆì‚° ì¦ì•¡</strong>ì„ ê³ ë ¤í•´ë³´ì„¸ìš”.'}
                        </div>
                    </div>
                `;
            }

            insightHtml += '</div>';
            insightText.innerHTML = insightHtml;
        }

        // ë¶„ê¸°ë³„ í…Œì´ë¸” ë Œë”ë§
        function renderQuarterlyTable() {
            const seasonality = getSeasonalityData().seasonality_analysis || {};
            const quarterlyData = seasonality.quarterly_overall || [];
            const tbody = document.getElementById('quarterlyTableBody');

            if (!tbody || quarterlyData.length === 0) {
                if (tbody) tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px; color: var(--grey-500);">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</td></tr>';
                return;
            }

            // ë¶„ê¸° ìˆœì„œ ì •ë ¬
            const quarterOrder = ['Q1(1~3ì›”)', 'Q2(4~6ì›”)', 'Q3(7~9ì›”)', 'Q4(10~12ì›”)'];
            const sortedData = [...quarterlyData].sort((a, b) =>
                quarterOrder.indexOf(a.quarter) - quarterOrder.indexOf(b.quarter)
            );

            // ROAS ê¸°ì¤€ ìµœëŒ€/ìµœì†Œ ê³„ì‚°
            const maxRoas = Math.max(...sortedData.map(d => d.avg_roas));
            const minRoas = Math.min(...sortedData.map(d => d.avg_roas));

            // ë¶„ê¸°ë³„ ì´ëª¨ì§€
            const quarterEmoji = {
                'Q1(1~3ì›”)': 'ğŸŒ¸',
                'Q2(4~6ì›”)': 'â˜€ï¸',
                'Q3(7~9ì›”)': 'ğŸ‚',
                'Q4(10~12ì›”)': 'â„ï¸'
            };

            let html = '';
            sortedData.forEach(item => {
                const emoji = quarterEmoji[item.quarter] || 'ğŸ“Š';

                // íš¨ìœ¨ ë“±ê¸‰ ê³„ì‚°
                let efficiencyGrade = '';
                let gradeColor = '';
                if (item.avg_roas >= maxRoas * 0.95) {
                    efficiencyGrade = 'ìµœê³ ';
                    gradeColor = '#2e7d32';
                } else if (item.avg_roas <= minRoas * 1.05) {
                    efficiencyGrade = 'ìµœì €';
                    gradeColor = '#d32f2f';
                } else {
                    efficiencyGrade = 'ë³´í†µ';
                    gradeColor = '#757575';
                }

                // ì„±ê³¼ ë°”
                const barWidth = maxRoas > minRoas ? ((item.avg_roas - minRoas) / (maxRoas - minRoas) * 100).toFixed(0) : 50;
                const performanceBar = '<div style="display: flex; align-items: center; gap: 8px;">' +
                    '<div style="flex: 1; background: #e9ecef; border-radius: 4px; height: 8px; overflow: hidden;">' +
                    '<div style="width: ' + barWidth + '%; background: ' + gradeColor + '; height: 100%; border-radius: 4px;"></div>' +
                    '</div>' +
                    '<span style="font-size: 11px; color: ' + gradeColor + '; font-weight: 600;">' + efficiencyGrade + '</span>' +
                    '</div>';

                html += '<tr>';
                html += '<td style="text-align: center; font-weight: 600;">' + emoji + ' ' + item.quarter + '</td>';
                html += '<td style="text-align: right;">' + formatCurrency(item.avg_cost) + '</td>';
                html += '<td style="text-align: right; font-weight: 600; color: #1565c0;">' + item.avg_roas.toFixed(1) + '%</td>';
                html += '<td style="text-align: right;">' + formatCurrency(item.avg_cpa) + '</td>';
                html += '<td style="text-align: right;">' + item.avg_conversions.toFixed(1) + '</td>';
                html += '<td style="text-align: right; font-weight: 500;">' + formatCurrency(item.avg_revenue) + '</td>';
                html += '<td>' + performanceBar + '</td>';
                html += '</tr>';
            });

            tbody.innerHTML = html;
        }

        // ìš”ì¼ë³„ ì „í™˜ í…Œì´ë¸” ë Œë”ë§
        function renderSeasonalityTable() {
            const seasonality = getSeasonalityData().seasonality_analysis || {};
            const data = seasonality.overall || [];
            const insights = getSeasonalityData().seasonality_insights || [];
            const tbody = document.getElementById('seasonalityTableBody');

            if (!tbody || data.length === 0) {
                if (tbody) tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px; color: var(--grey-500);">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</td></tr>';
                return;
            }

            // ë°ì´í„° ì •ê·œí™” (í•„ë“œëª… ë§¤í•‘)
            const normalizedData = data.map(item => ({
                day: item.day,
                roas: item.avg_roas || 0,
                cpa: item.avg_cpa || 0,
                cost: item.avg_cost || 0,
                conversions: item.avg_conversions || 0,
                revenue: item.avg_revenue || 0
            }));

            // ì •ë ¬ ìƒíƒœì— ë”°ë¥¸ ì •ë ¬
            const { column, direction } = retargetingSortState.seasonality;
            const sortedData = [...normalizedData].sort((a, b) => {
                const aVal = a[column] || 0;
                const bVal = b[column] || 0;
                return direction === 'desc' ? bVal - aVal : aVal - bVal;
            });

            // ROAS ê¸°ì¤€ ìµœëŒ€/ìµœì†Œ ê³„ì‚° (ì„±ê³¼ ìˆ˜ì¤€ ë°” í‘œì‹œìš©)
            const maxRoas = Math.max(...normalizedData.map(d => d.roas));
            const minRoas = Math.min(...normalizedData.map(d => d.roas));

            let html = '';
            sortedData.forEach(item => {
                const dayEmoji = getDayEmoji(item.day);

                // íš¨ìœ¨ ë“±ê¸‰ ê³„ì‚° (ROAS ê¸°ì¤€)
                let efficiencyGrade = '';
                let gradeColor = '';
                if (item.roas >= maxRoas * 0.95) {
                    efficiencyGrade = 'ìµœê³ ';
                    gradeColor = '#2e7d32';
                } else if (item.roas <= minRoas * 1.05) {
                    efficiencyGrade = 'ìµœì €';
                    gradeColor = '#d32f2f';
                } else if (item.roas >= maxRoas * 0.8) {
                    efficiencyGrade = 'ìš°ìˆ˜';
                    gradeColor = '#1565c0';
                } else {
                    efficiencyGrade = 'ë³´í†µ';
                    gradeColor = '#757575';
                }

                // ì„±ê³¼ ë°” (ROAS ê¸°ì¤€)
                const barWidth = maxRoas > minRoas ? ((item.roas - minRoas) / (maxRoas - minRoas) * 100).toFixed(0) : 50;
                const performanceBar = '<div style="display: flex; align-items: center; gap: 8px;">' +
                    '<div style="flex: 1; background: #e9ecef; border-radius: 4px; height: 8px; overflow: hidden;">' +
                    '<div style="width: ' + barWidth + '%; background: ' + gradeColor + '; height: 100%; border-radius: 4px;"></div>' +
                    '</div>' +
                    '<span style="font-size: 11px; color: ' + gradeColor + '; font-weight: 600;">' + efficiencyGrade + '</span>' +
                    '</div>';

                html += '<tr>';
                html += '<td style="text-align: center; font-weight: 600;">' + dayEmoji + ' ' + item.day + '</td>';
                html += '<td style="text-align: right; font-weight: 600; color: #1565c0;">' + item.roas.toFixed(1) + '%</td>';
                html += '<td style="text-align: right;">' + formatCurrency(item.cpa) + '</td>';
                html += '<td style="text-align: right;">' + formatCurrency(item.cost) + '</td>';
                html += '<td style="text-align: right;">' + item.conversions.toFixed(1) + '</td>';
                html += '<td style="text-align: right; font-weight: 500;">' + formatCurrency(item.revenue) + '</td>';
                html += '<td>' + performanceBar + '</td>';
                html += '</tr>';
            });

            tbody.innerHTML = html;

            // ì •ë ¬ ì•„ì´ì½˜ ì—…ë°ì´íŠ¸
            updateRetargetingSortIcons('seasonality');

            // ì¸ì‚¬ì´íŠ¸ ì—…ë°ì´íŠ¸
            const insightText = document.getElementById('seasonalityInsightText');
            if (insightText) {
                const bestDay = insights.find(i => i.type === 'best_day_overall');
                const worstDay = insights.find(i => i.type === 'worst_day_overall');
                const weekendInsight = insights.find(i => i.type === 'weekend_better' || i.type === 'weekday_better');

                let insightHtml = '';
                if (bestDay) insightHtml += bestDay.message + ' ';
                if (worstDay) insightHtml += worstDay.message + ' ';
                if (weekendInsight) insightHtml += '<br>' + weekendInsight.message;

                insightText.innerHTML = insightHtml || 'ìš”ì¼ë³„ ì „í™˜ ë°ì´í„°ë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤.';
            }
        }

        // ========================================
        // ì±„ë„ë³„ ìš”ì¼ ë¶„ì„ - ê°•í™”ëœ ë²„ì „
        // ========================================

        // ì±„ë„ë³„ KPI ì¹´ë“œ ë Œë”ë§
        function renderChannelDayKpiCards() {
            const seasonality = getSeasonalityData().seasonality_analysis || {};
            const byCategory = seasonality.by_category || {};
            const container = document.getElementById('channelDayKpiCards');

            if (!container) return;

            const categories = Object.keys(byCategory);
            if (categories.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: var(--grey-500); padding: 20px;">ì±„ë„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }

            // ì±„ë„ë³„ ìƒ‰ìƒ ì •ì˜
            const channelColors = {
                'ë©”íƒ€_ì „í™˜': { bg: '#e3f2fd', border: '#1976d2', icon: 'ğŸ“˜', gradient: 'linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%)' },
                'ë„¤ì´ë²„_ì‡¼í•‘ê²€ìƒ‰': { bg: '#e8f5e9', border: '#388e3c', icon: 'ğŸ›’', gradient: 'linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%)' },
                'ë„¤ì´ë²„_íŒŒì›Œë§í¬': { bg: '#fff3e0', border: '#f57c00', icon: 'ğŸ”—', gradient: 'linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%)' },
                'ë„¤ì´ë²„_ì‹ ì œí’ˆê²€ìƒ‰ê´‘ê³ ': { bg: '#fce4ec', border: '#c2185b', icon: 'âœ¨', gradient: 'linear-gradient(135deg, #fce4ec 0%, #f8bbd9 100%)' },
                'êµ¬ë¶„í•„ìš”': { bg: '#f3e5f5', border: '#7b1fa2', icon: 'â“', gradient: 'linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%)' }
            };

            let html = '';
            categories.forEach(category => {
                const dayData = byCategory[category];
                if (!dayData || dayData.length === 0) return;

                // ìµœê³ /ìµœì € ROAS ìš”ì¼ ì°¾ê¸°
                const sortedByRoas = [...dayData].sort((a, b) => (b.avg_roas || 0) - (a.avg_roas || 0));
                const bestRoasDay = sortedByRoas[0];
                const worstRoasDay = sortedByRoas[sortedByRoas.length - 1];

                // í‰ê·  ê³„ì‚°
                const avgRoas = dayData.reduce((sum, d) => sum + (d.avg_roas || 0), 0) / dayData.length;
                const avgCost = dayData.reduce((sum, d) => sum + (d.avg_cost || 0), 0) / dayData.length;
                const avgRevenue = dayData.reduce((sum, d) => sum + (d.avg_revenue || 0), 0) / dayData.length;

                const roasDiff = bestRoasDay.avg_roas && worstRoasDay.avg_roas
                    ? ((bestRoasDay.avg_roas - worstRoasDay.avg_roas) / worstRoasDay.avg_roas * 100).toFixed(1)
                    : '0';

                const colorConfig = channelColors[category] || { bg: '#f5f5f5', border: '#757575', icon: 'ğŸ“Š', gradient: 'linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%)' };

                html += `
                <div style="background: ${colorConfig.gradient}; border-radius: 12px; padding: 20px; border-left: 4px solid ${colorConfig.border}; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 16px;">
                        <span style="font-size: 24px;">${colorConfig.icon}</span>
                        <div>
                            <div style="font-size: 15px; font-weight: 700; color: #212121;">${category}</div>
                            <div style="font-size: 11px; color: #757575;">ì¼í‰ê·  ë¹„ìš© ${formatCurrency(avgCost)}</div>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px;">
                        <div style="background: rgba(255,255,255,0.8); padding: 12px; border-radius: 8px;">
                            <div style="font-size: 10px; color: #757575; margin-bottom: 4px;">ğŸ† ìµœê³  ROAS ìš”ì¼</div>
                            <div style="font-size: 14px; font-weight: 700; color: #2e7d32;">${getDayEmoji(bestRoasDay.day)} ${bestRoasDay.day}</div>
                            <div style="font-size: 18px; font-weight: 800; color: #1b5e20;">${(bestRoasDay.avg_roas || 0).toFixed(0)}%</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.8); padding: 12px; border-radius: 8px;">
                            <div style="font-size: 10px; color: #757575; margin-bottom: 4px;">ğŸ“‰ ìµœì € ROAS ìš”ì¼</div>
                            <div style="font-size: 14px; font-weight: 700; color: #c62828;">${getDayEmoji(worstRoasDay.day)} ${worstRoasDay.day}</div>
                            <div style="font-size: 18px; font-weight: 800; color: #b71c1c;">${(worstRoasDay.avg_roas || 0).toFixed(0)}%</div>
                        </div>
                    </div>

                    <div style="background: rgba(255,255,255,0.6); padding: 10px 12px; border-radius: 6px; display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 11px; color: #616161;">ìš”ì¼ë³„ ROAS í¸ì°¨</span>
                        <span style="font-size: 13px; font-weight: 700; color: ${parseFloat(roasDiff) > 20 ? '#d32f2f' : '#1565c0'};">+${roasDiff}%</span>
                    </div>
                </div>
                `;
            });

            container.innerHTML = html;
        }

        // ì±„ë„ë³„ ìš”ì¼ ROAS ë¹„êµ ì°¨íŠ¸ ë Œë”ë§
        let channelDayRoasChartInstance = null;
        function renderChannelDayRoasChart() {
            const seasonality = getSeasonalityData().seasonality_analysis || {};
            const byCategory = seasonality.by_category || {};
            const canvas = document.getElementById('channelDayRoasChart');

            if (!canvas) return;

            const categories = Object.keys(byCategory);
            if (categories.length === 0) return;

            // ìš”ì¼ ìˆœì„œ ì •ì˜
            const dayOrder = ['ì›”ìš”ì¼', 'í™”ìš”ì¼', 'ìˆ˜ìš”ì¼', 'ëª©ìš”ì¼', 'ê¸ˆìš”ì¼', 'í† ìš”ì¼', 'ì¼ìš”ì¼'];
            const dayLabels = ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† ', 'ì¼'];

            // ì±„ë„ë³„ ìƒ‰ìƒ
            const channelColorMap = {
                'ë©”íƒ€_ì „í™˜': { bg: 'rgba(25, 118, 210, 0.7)', border: '#1976d2' },
                'ë„¤ì´ë²„_ì‡¼í•‘ê²€ìƒ‰': { bg: 'rgba(56, 142, 60, 0.7)', border: '#388e3c' },
                'ë„¤ì´ë²„_íŒŒì›Œë§í¬': { bg: 'rgba(245, 124, 0, 0.7)', border: '#f57c00' },
                'ë„¤ì´ë²„_ì‹ ì œí’ˆê²€ìƒ‰ê´‘ê³ ': { bg: 'rgba(194, 24, 91, 0.7)', border: '#c2185b' },
                'êµ¬ë¶„í•„ìš”': { bg: 'rgba(123, 31, 162, 0.7)', border: '#7b1fa2' }
            };

            // ë°ì´í„°ì…‹ ìƒì„±
            const datasets = categories.map(category => {
                const dayData = byCategory[category];
                const roasByDay = {};
                dayData.forEach(d => { roasByDay[d.day] = d.avg_roas || 0; });

                const colors = channelColorMap[category] || { bg: 'rgba(158, 158, 158, 0.7)', border: '#9e9e9e' };

                return {
                    label: category,
                    data: dayOrder.map(day => roasByDay[day] || 0),
                    backgroundColor: colors.bg,
                    borderColor: colors.border,
                    borderWidth: 1,
                    borderRadius: 4
                };
            });

            // ê¸°ì¡´ ì°¨íŠ¸ ì œê±°
            if (channelDayRoasChartInstance) {
                channelDayRoasChartInstance.destroy();
            }

            const ctx = canvas.getContext('2d');
            channelDayRoasChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: dayLabels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 15,
                                font: { size: 11 }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ROAS ' + context.raw.toFixed(1) + '%';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { display: false }
                        },
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'ROAS (%)',
                                font: { size: 11 }
                            },
                            ticks: {
                                callback: function(value) { return value + '%'; }
                            }
                        }
                    }
                }
            });
        }

        // ì±„ë„ë³„ ìš”ì¼ ë¶„ì„ í…Œì´ë¸” ë Œë”ë§ (ë“œë¡­ë‹¤ìš´ ë°©ì‹)
        let channelDaySelectorInitialized = false;

        function renderSeasonalityCategoryTable() {
            const seasonality = getSeasonalityData().seasonality_analysis || {};
            const byCategory = seasonality.by_category || {};
            const selector = document.getElementById('channelDaySelector');
            const tbody = document.getElementById('seasonalityCategoryTableBody');

            const categories = Object.keys(byCategory);
            if (!tbody || categories.length === 0) {
                if (tbody) tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 20px; color: var(--grey-500);">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</td></tr>';
                return;
            }

            // ë“œë¡­ë‹¤ìš´ ì˜µì…˜ ìƒì„± (ìµœì´ˆ 1íšŒ)
            if (selector && !channelDaySelectorInitialized) {
                const channelIcons = {
                    'ë©”íƒ€_ì „í™˜': 'ğŸ“˜',
                    'ë„¤ì´ë²„_ì‡¼í•‘ê²€ìƒ‰': 'ğŸ›’',
                    'ë„¤ì´ë²„_íŒŒì›Œë§í¬': 'ğŸ”—',
                    'ë„¤ì´ë²„_ì‹ ì œí’ˆê²€ìƒ‰ê´‘ê³ ': 'âœ¨',
                    'êµ¬ë¶„í•„ìš”': 'â“'
                };

                selector.innerHTML = categories.map((cat, idx) => {
                    const icon = channelIcons[cat] || 'ğŸ“Š';
                    return `<option value="${cat}" ${idx === 0 ? 'selected' : ''}>${icon} ${cat}</option>`;
                }).join('');

                // ë“œë¡­ë‹¤ìš´ ë³€ê²½ ì´ë²¤íŠ¸
                selector.addEventListener('change', function() {
                    renderChannelDayTableForCategory(this.value);
                });

                channelDaySelectorInitialized = true;
            }

            // ì²« ë²ˆì§¸ ì±„ë„ ë°ì´í„° ë Œë”ë§
            const selectedCategory = selector ? selector.value : categories[0];
            renderChannelDayTableForCategory(selectedCategory);

            // ì¸ì‚¬ì´íŠ¸ ì—…ë°ì´íŠ¸
            renderChannelDayInsight();
        }

        // ì„ íƒëœ ì±„ë„ì˜ ìš”ì¼ë³„ ë°ì´í„° ë Œë”ë§
        function renderChannelDayTableForCategory(category) {
            const seasonality = getSeasonalityData().seasonality_analysis || {};
            const byCategory = seasonality.by_category || {};
            const tbody = document.getElementById('seasonalityCategoryTableBody');

            if (!tbody || !byCategory[category]) {
                if (tbody) tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 20px; color: var(--grey-500);">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</td></tr>';
                return;
            }

            const dayData = byCategory[category];
            const dayOrder = ['ì›”ìš”ì¼', 'í™”ìš”ì¼', 'ìˆ˜ìš”ì¼', 'ëª©ìš”ì¼', 'ê¸ˆìš”ì¼', 'í† ìš”ì¼', 'ì¼ìš”ì¼'];

            // ìš”ì¼ ë°ì´í„° ë§µ ìƒì„±
            const dayMap = {};
            dayData.forEach(d => { dayMap[d.day] = d; });

            // ìµœê³ /ìµœì € ROAS ì°¾ê¸°
            const roasValues = dayData.map(d => d.avg_roas || 0);
            const maxRoas = Math.max(...roasValues);
            const minRoas = Math.min(...roasValues);

            let html = '';
            dayOrder.forEach((day) => {
                const d = dayMap[day];
                if (!d) return;

                const isBest = d.avg_roas === maxRoas;
                const isWorst = d.avg_roas === minRoas;

                // ì„±ê³¼ ë ˆë²¨ íŒë‹¨
                let performanceLabel = 'ë³´í†µ';
                let performanceColor = '#757575';
                let performanceBg = '#f5f5f5';
                if (isBest) {
                    performanceLabel = 'ğŸ† ìµœê³ ';
                    performanceColor = '#1b5e20';
                    performanceBg = '#c8e6c9';
                } else if (isWorst) {
                    performanceLabel = 'ğŸ“‰ ìµœì €';
                    performanceColor = '#b71c1c';
                    performanceBg = '#ffcdd2';
                } else if (d.avg_roas > (maxRoas + minRoas) / 2) {
                    performanceLabel = 'ì–‘í˜¸';
                    performanceColor = '#2e7d32';
                    performanceBg = '#e8f5e9';
                }

                const rowBg = isBest ? 'background: #f1f8e9;' : (isWorst ? 'background: #fff8f8;' : '');

                html += `<tr style="${rowBg}">`;
                html += `<td style="text-align: center; font-weight: 600;">${getDayEmoji(day)} ${day}</td>`;
                html += `<td style="text-align: right;">${formatCurrency(d.avg_cost || 0)}</td>`;
                html += `<td style="text-align: right; font-weight: 500;">${formatCurrency(d.avg_revenue || 0)}</td>`;
                html += `<td style="text-align: right; font-weight: 700; font-size: 14px; color: ${isBest ? '#1b5e20' : (isWorst ? '#b71c1c' : '#424242')};">${(d.avg_roas || 0).toFixed(1)}%</td>`;
                html += `<td style="text-align: right; color: ${isWorst ? '#b71c1c' : '#616161'};">${formatCurrency(d.avg_cpa || 0)}</td>`;
                html += `<td style="text-align: center;"><span style="background: ${performanceBg}; color: ${performanceColor}; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 600;">${performanceLabel}</span></td>`;
                html += '</tr>';
            });

            tbody.innerHTML = html;
        }

        // ì±„ë„ë³„ ìš”ì¼ ì¸ì‚¬ì´íŠ¸ ë Œë”ë§ (ê°•í™”)
        function renderChannelDayInsight() {
            const seasonality = getSeasonalityData().seasonality_analysis || {};
            const byCategory = seasonality.by_category || {};
            const insights = getSeasonalityData().seasonality_insights || [];
            const insightText = document.getElementById('seasonalityCategoryInsightText');

            if (!insightText) return;

            const categories = Object.keys(byCategory);
            if (categories.length === 0) {
                insightText.innerHTML = 'ì±„ë„ë³„ ìš”ì¼ ë°ì´í„°ë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤.';
                return;
            }

            let insightParts = [];

            // ê° ì±„ë„ë³„ ë¶„ì„
            categories.forEach(category => {
                const dayData = byCategory[category];
                if (!dayData || dayData.length === 0) return;

                const sortedByRoas = [...dayData].sort((a, b) => (b.avg_roas || 0) - (a.avg_roas || 0));
                const bestDay = sortedByRoas[0];
                const worstDay = sortedByRoas[sortedByRoas.length - 1];

                const roasDiff = ((bestDay.avg_roas - worstDay.avg_roas) / worstDay.avg_roas * 100).toFixed(0);

                insightParts.push(`<strong>${category}</strong>: ${getDayEmoji(bestDay.day)} <span style="color: #1b5e20; font-weight: 600;">${bestDay.day}</span>ì´ ROAS ${bestDay.avg_roas.toFixed(0)}%ë¡œ ê°€ì¥ íš¨ìœ¨ì  (vs ${worstDay.day} ${worstDay.avg_roas.toFixed(0)}%, +${roasDiff}% ì°¨ì´)`);
            });

            // ì „ëµì  ì œì•ˆ ì¶”ê°€
            let strategy = '';
            if (categories.includes('ë©”íƒ€_ì „í™˜') && categories.includes('ë„¤ì´ë²„_ì‡¼í•‘ê²€ìƒ‰')) {
                const metaData = byCategory['ë©”íƒ€_ì „í™˜'];
                const naverData = byCategory['ë„¤ì´ë²„_ì‡¼í•‘ê²€ìƒ‰'];

                if (metaData && naverData) {
                    const metaBest = [...metaData].sort((a, b) => (b.avg_roas || 0) - (a.avg_roas || 0))[0];
                    const naverBest = [...naverData].sort((a, b) => (b.avg_roas || 0) - (a.avg_roas || 0))[0];

                    if (metaBest.day !== naverBest.day) {
                        strategy = `<br><br>ğŸ’¡ <strong>ì „ëµ ì œì•ˆ</strong>: ë©”íƒ€ëŠ” <span style="color: #1976d2; font-weight: 600;">${metaBest.day}</span>, ë„¤ì´ë²„ëŠ” <span style="color: #388e3c; font-weight: 600;">${naverBest.day}</span>ì— ì˜ˆì‚°ì„ ì§‘ì¤‘í•˜ë©´ ì±„ë„ë³„ ìµœì í™”ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.`;
                    } else {
                        strategy = `<br><br>ğŸ’¡ <strong>ì „ëµ ì œì•ˆ</strong>: ë‘ ì±„ë„ ëª¨ë‘ <span style="font-weight: 600;">${metaBest.day}</span>ì´ ìµœì ì…ë‹ˆë‹¤. í•´ë‹¹ ìš”ì¼ì— ì „ì²´ ì˜ˆì‚°ì„ ì§‘ì¤‘ ë°°ë¶„í•˜ì„¸ìš”.`;
                    }
                }
            }

            insightText.innerHTML = insightParts.join('<br>') + strategy;
        }

        // ê¸°ê¸° ì•„ì´ì½˜ ë°˜í™˜
        function getDeviceIcon(device) {
            const icons = {
                'Computers': 'ğŸ–¥ï¸',
                'Mobile phones': 'ğŸ“±',
                'Tablets': 'ğŸ“±',
                'TV screens': 'ğŸ“º',
                'OTHER': 'â“'
            };
            return icons[device] || 'ğŸ“Š';
        }

        // í”Œë«í¼ ì•„ì´ì½˜ ë°˜í™˜
        function getPlatformIcon(platform) {
            const icons = {
                'Cross-network': 'ğŸŒ',
                'Display Network': 'ğŸ–¼ï¸',
                'Google search': 'ğŸ”',
                'Search partners': 'ğŸ”',
                'YouTube': 'â–¶ï¸'
            };
            return icons[platform] || 'ğŸ“Š';
        }

        // ìš”ì¼ ì´ëª¨ì§€ ë°˜í™˜
        function getDayEmoji(day) {
            const emojis = {
                'ì›”ìš”ì¼': 'ğŸŒ™',
                'í™”ìš”ì¼': 'ğŸ”¥',
                'ìˆ˜ìš”ì¼': 'ğŸ’§',
                'ëª©ìš”ì¼': 'ğŸŒ³',
                'ê¸ˆìš”ì¼': 'ğŸ’°',
                'í† ìš”ì¼': 'ğŸŒ',
                'ì¼ìš”ì¼': 'â˜€ï¸'
            };
            return emojis[day] || 'ğŸ“…';
        }

        // ì±„ë„ ì•„ì´ì½˜ ë°˜í™˜
        function getCategoryIcon(category) {
            if (category.includes('ë©”íƒ€')) return 'ğŸ“˜';
            if (category.includes('ë„¤ì´ë²„')) return 'ğŸŸ¢';
            if (category.includes('êµ¬ê¸€')) return 'ğŸ”µ';
            return 'ğŸ“Š';
        }

        // íš¨ìœ¨ ë“±ê¸‰ ë±ƒì§€ ë°˜í™˜
        function getEfficiencyGrade(roas, maxRoas) {
            if (maxRoas === 0) return '<span style="background: #f5f5f5; color: #9e9e9e; padding: 4px 8px; border-radius: 12px; font-size: 11px; font-weight: 600;">-</span>';
            const ratio = roas / maxRoas;
            if (ratio >= 0.8) {
                return '<span style="background: #e8f5e9; color: #2e7d32; padding: 4px 8px; border-radius: 12px; font-size: 11px; font-weight: 600;">Aë“±ê¸‰</span>';
            } else if (ratio >= 0.5) {
                return '<span style="background: #e3f2fd; color: #1565c0; padding: 4px 8px; border-radius: 12px; font-size: 11px; font-weight: 600;">Bë“±ê¸‰</span>';
            } else if (ratio >= 0.2) {
                return '<span style="background: #fff3e0; color: #e65100; padding: 4px 8px; border-radius: 12px; font-size: 11px; font-weight: 600;">Cë“±ê¸‰</span>';
            } else {
                return '<span style="background: #ffebee; color: #d32f2f; padding: 4px 8px; border-radius: 12px; font-size: 11px; font-weight: 600;">Dë“±ê¸‰</span>';
            }
        }

        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        function formatCurrency(value) {
            if (value === null || value === undefined) return 'â‚©0';
            return 'â‚©' + Math.round(value).toLocaleString('ko-KR');
        }

        function formatNumber(value) {
            if (value === null || value === undefined) return '0';
            return Math.round(value).toLocaleString('ko-KR');
        }

        function formatPercent(value) {
            if (value === null || value === undefined) return '0%';
            return value.toFixed(1) + '%';
        }

        function formatValue(value) {
            if (value === null || value === undefined) return '0';
            return value.toFixed(1);
        }

        function getSeverityLabel(severity) {
            const labels = {
                'high': 'ë†’ìŒ',
                'warning': 'ê²½ê³ ',
                'opportunity': 'ê¸°íšŒ',
                'positive': 'ê¸ì •',
                'low': 'ë‚®ìŒ'
            };
            return labels[severity] || severity;
        }

        // ì ‘ê¸°/í¼ì¹˜ê¸° ê¸°ëŠ¥ (ìµœì í™”)
        document.querySelectorAll('.collapsible-header').forEach(header => {
            const content = header.nextElementSibling;
            const icon = header.querySelector('.collapsible-toggle-icon');
            const toggleText = header.querySelector('.collapsible-toggle span:first-child');

            header.addEventListener('click', function(e) {
                e.preventDefault();
                const isExpanded = content.classList.contains('expanded');
                content.classList.toggle('expanded', !isExpanded);
                icon.classList.toggle('collapsed', isExpanded);
                toggleText.textContent = isExpanded ? 'í¼ì¹˜ê¸°' : 'ì ‘ê¸°';
            });
        });

        // ì„±ê³¼ ë¶„ì„ ì„œë¸Œíƒ­ ë²„íŠ¼
        document.querySelectorAll('.performance-subtab').forEach(btn => {
            btn.addEventListener('click', function() {
                const targetTab = this.dataset.perfTab;

                // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ë³€ê²½
                document.querySelectorAll('.performance-subtab').forEach(b => {
                    b.style.background = 'white';
                    b.style.color = '#495057';
                    b.style.border = '1px solid #dee2e6';
                    b.classList.remove('active');
                });
                this.style.background = '#1a73e8';
                this.style.color = 'white';
                this.style.border = 'none';
                this.classList.add('active');

                // ì»¨í…ì¸  í‘œì‹œ
                document.querySelectorAll('.performance-filter-content').forEach(content => {
                    content.style.display = 'none';
                    content.classList.remove('active');
                });

                const viewMap = {
                    'brand': 'brandView',
                    'product': 'productView',
                    'promotion': 'promotionView',
                    'targeting': 'targetingView'
                };

                const targetView = document.getElementById(viewMap[targetTab]);
                if (targetView) {
                    targetView.style.display = 'block';
                    targetView.classList.add('active');
                }
            });
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° ë¡œë”©
        // íƒ­ ì „í™˜ ë° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        function setupEventListeners() {
            // ì¶”ì´ ë¶„ì„ íƒ­ ì „í™˜
            document.querySelectorAll('.trend-analysis-tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.trend-analysis-tab-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');

                    const targetTab = this.dataset.tab;
                    document.querySelectorAll('.trend-analysis-tab-content').forEach(content => {
                        content.style.display = 'none';
                        content.classList.remove('active');
                    });

                    let selectedTab = null;
                    if (targetTab === 'timeseries') selectedTab = document.getElementById('timeseriesTab');
                    else if (targetTab === 'gender') selectedTab = document.getElementById('genderTab');
                    else if (targetTab === 'age') selectedTab = document.getElementById('ageTab');
                    else if (targetTab === 'platform') selectedTab = document.getElementById('platformTab');
                    else if (targetTab === 'device-platform') selectedTab = document.getElementById('devicePlatformTab');
                    else if (targetTab === 'device-type') selectedTab = document.getElementById('deviceTypeTab');
                    else if (targetTab === 'age-gender-pivot') selectedTab = document.getElementById('ageGenderPivotTab');

                    if (selectedTab) {
                        selectedTab.style.display = 'block';
                        selectedTab.classList.add('active');
                    }
                });
            });

            // ì‹œê³„ì—´ ê¸°ê°„ ë²„íŠ¼ ì´ë²¤íŠ¸
            document.querySelectorAll('.timeseries-period-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.timeseries-period-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentTimeseriesPeriod = this.dataset.period;
                    renderTimeseriesTrendChart();
                });
            });

            // ì‹œê³„ì—´ ì§€í‘œ ë“œë¡­ë‹¤ìš´ ì´ë²¤íŠ¸
            const timeseriesMetricDropdown = document.getElementById('timeseriesMetricDropdown');
            if (timeseriesMetricDropdown) {
                timeseriesMetricDropdown.addEventListener('change', function() {
                    currentTimeseriesMetric = this.value;
                    renderTimeseriesTrendChart();
                });
            }

            // ì‹œê³„ì—´ ê¸°ê°„ ì„ íƒ ì´ë²¤íŠ¸
            const timeseriesStartDateInput = document.getElementById('timeseriesStartDate');
            const timeseriesEndDateInput = document.getElementById('timeseriesEndDate');

            if (timeseriesStartDateInput) {
                timeseriesStartDateInput.addEventListener('change', function(e) {
                    timeseriesStartDate = e.target.value;
                    renderTimeseriesTrendChart();
                });
            }

            if (timeseriesEndDateInput) {
                timeseriesEndDateInput.addEventListener('change', function(e) {
                    timeseriesEndDate = e.target.value;
                    renderTimeseriesTrendChart();
                });
            }

            // ì‹œê³„ì—´ í•„í„° ë²„íŠ¼ ì´ë²¤íŠ¸
            // ì‹œê³„ì—´ í•„í„° - ì´ì œ ì²´í¬ë°•ìŠ¤ë¡œ ì²˜ë¦¬ë¨ (initTimeseriesDropdownsì—ì„œ ì²˜ë¦¬)

            // ì„±ë³„ í•„í„° ë²„íŠ¼ ì´ë²¤íŠ¸
            document.querySelectorAll('.gender-filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.gender-filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentGenderFilter = this.dataset.filter;
                    selectedGenderItems = [];
                    initGenderDropdowns();
                });
            });

            // ì„±ë³„ ê¸°ê°„ ë²„íŠ¼ ì´ë²¤íŠ¸
            document.querySelectorAll('.gender-period-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.gender-period-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentGenderPeriod = this.dataset.period;
                    renderGenderTrendChart();
                });
            });

            // ì„±ë³„ ì§€í‘œ ë“œë¡­ë‹¤ìš´ ì´ë²¤íŠ¸
            const genderMetricDropdown = document.getElementById('genderMetricDropdown');
            if (genderMetricDropdown) {
                genderMetricDropdown.addEventListener('change', function() {
                    currentGenderMetric = this.value;
                    renderGenderTrendChart();
                });
            }

            // ì„±ë³„ ê¸°ê°„ ì„ íƒ ì´ë²¤íŠ¸
            const genderStartDateInput = document.getElementById('genderStartDate');
            const genderEndDateInput = document.getElementById('genderEndDate');

            if (genderStartDateInput) {
                genderStartDateInput.addEventListener('change', function(e) {
                    genderStartDate = e.target.value;
                    renderGenderTrendChart();
                });
            }

            if (genderEndDateInput) {
                genderEndDateInput.addEventListener('change', function(e) {
                    genderEndDate = e.target.value;
                    renderGenderTrendChart();
                });
            }

            // ì—°ë ¹ í•„í„° ë²„íŠ¼ ì´ë²¤íŠ¸
            document.querySelectorAll('.age-filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.age-filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentAgeFilter = this.dataset.filter;
                    selectedAgeItems = [];
                    initAgeDropdowns();
                });
            });

            // ì—°ë ¹ ê¸°ê°„ ë²„íŠ¼ ì´ë²¤íŠ¸
            document.querySelectorAll('.age-period-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.age-period-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentAgePeriod = this.dataset.period;
                    renderAgeTrendChart();
                });
            });

            // ì—°ë ¹ ì§€í‘œ ë“œë¡­ë‹¤ìš´ ì´ë²¤íŠ¸
            const ageMetricDropdown = document.getElementById('ageMetricDropdown');
            if (ageMetricDropdown) {
                ageMetricDropdown.addEventListener('change', function() {
                    currentAgeMetric = this.value;
                    renderAgeTrendChart();
                });
            }

            // ì—°ë ¹ ê¸°ê°„ ì„ íƒ ì´ë²¤íŠ¸
            const ageStartDateInput = document.getElementById('ageStartDate');
            const ageEndDateInput = document.getElementById('ageEndDate');

            if (ageStartDateInput) {
                ageStartDateInput.addEventListener('change', function(e) {
                    ageStartDate = e.target.value;
                    renderAgeTrendChart();
                });
            }

            if (ageEndDateInput) {
                ageEndDateInput.addEventListener('change', function(e) {
                    ageEndDate = e.target.value;
                    renderAgeTrendChart();
                });
            }

            // í”Œë«í¼ í•„í„° ë²„íŠ¼ ì´ë²¤íŠ¸
            document.querySelectorAll('.platform-filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.platform-filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentPlatformFilter = this.dataset.filter;
                    selectedPlatformItems = [];
                    initPlatformDropdowns();
                });
            });

            // í”Œë«í¼ ê¸°ê°„ ë²„íŠ¼ ì´ë²¤íŠ¸
            document.querySelectorAll('.platform-period-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.platform-period-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentPlatformPeriod = this.dataset.period;
                    renderPlatformTrendChart();
                });
            });

            // í”Œë«í¼ ì§€í‘œ ë“œë¡­ë‹¤ìš´ ì´ë²¤íŠ¸
            const platformMetricDropdown = document.getElementById('platformMetricDropdown');
            if (platformMetricDropdown) {
                platformMetricDropdown.addEventListener('change', function() {
                    currentPlatformMetric = this.value;
                    renderPlatformTrendChart();
                });
            }

            // í”Œë«í¼ ê¸°ê°„ ì„ íƒ ì´ë²¤íŠ¸
            const platformStartDateInput = document.getElementById('platformStartDate');
            const platformEndDateInput = document.getElementById('platformEndDate');

            if (platformStartDateInput) {
                platformStartDateInput.addEventListener('change', function(e) {
                    platformStartDate = e.target.value;
                    renderPlatformTrendChart();
                });
            }

            if (platformEndDateInput) {
                platformEndDateInput.addEventListener('change', function(e) {
                    platformEndDate = e.target.value;
                    renderPlatformTrendChart();
                });
            }

            // ê¸°ê¸°í”Œë«í¼ í•„í„° ë²„íŠ¼ ì´ë²¤íŠ¸
            document.querySelectorAll('.device-platform-filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.device-platform-filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentDevicePlatformFilter = this.dataset.filter;
                    selectedDevicePlatformItems = [];
                    initDevicePlatformDropdowns();
                });
            });

            // ê¸°ê¸°í”Œë«í¼ ê¸°ê°„ ë²„íŠ¼ ì´ë²¤íŠ¸
            document.querySelectorAll('.device-platform-period-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.device-platform-period-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentDevicePlatformPeriod = this.dataset.period;
                    renderDevicePlatformTrendChart();
                });
            });

            // ê¸°ê¸°í”Œë«í¼ ì§€í‘œ ë“œë¡­ë‹¤ìš´ ì´ë²¤íŠ¸
            const devicePlatformMetricDropdown = document.getElementById('devicePlatformMetricDropdown');
            if (devicePlatformMetricDropdown) {
                devicePlatformMetricDropdown.addEventListener('change', function() {
                    currentDevicePlatformMetric = this.value;
                    renderDevicePlatformTrendChart();
                });
            }

            // ê¸°ê¸°í”Œë«í¼ ê¸°ê°„ ì„ íƒ ì´ë²¤íŠ¸
            const devicePlatformStartDateInput = document.getElementById('devicePlatformStartDate');
            const devicePlatformEndDateInput = document.getElementById('devicePlatformEndDate');

            if (devicePlatformStartDateInput) {
                devicePlatformStartDateInput.addEventListener('change', function(e) {
                    devicePlatformStartDate = e.target.value;
                    renderDevicePlatformTrendChart();
                });
            }

            if (devicePlatformEndDateInput) {
                devicePlatformEndDateInput.addEventListener('change', function(e) {
                    devicePlatformEndDate = e.target.value;
                    renderDevicePlatformTrendChart();
                });
            }

            // ê¸°ê¸°ìœ í˜• í•„í„° ë²„íŠ¼ ì´ë²¤íŠ¸
            document.querySelectorAll('.device-type-filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.device-type-filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentDeviceTypeFilter = this.dataset.filter;
                    selectedDeviceTypeItems = [];
                    initDeviceTypeDropdowns();
                });
            });

            // ê¸°ê¸°ìœ í˜• ê¸°ê°„ ë²„íŠ¼ ì´ë²¤íŠ¸
            document.querySelectorAll('.device-type-period-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.device-type-period-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentDeviceTypePeriod = this.dataset.period;
                    renderDeviceTypeTrendChart();
                });
            });

            // ê¸°ê¸°ìœ í˜• ì§€í‘œ ë“œë¡­ë‹¤ìš´ ì´ë²¤íŠ¸
            const deviceTypeMetricDropdown = document.getElementById('deviceTypeMetricDropdown');
            if (deviceTypeMetricDropdown) {
                deviceTypeMetricDropdown.addEventListener('change', function() {
                    currentDeviceTypeMetric = this.value;
                    renderDeviceTypeTrendChart();
                });
            }

            // ê¸°ê¸°ìœ í˜• ê¸°ê°„ ì„ íƒ ì´ë²¤íŠ¸
            const deviceTypeStartDateInput = document.getElementById('deviceTypeStartDate');
            const deviceTypeEndDateInput = document.getElementById('deviceTypeEndDate');

            if (deviceTypeStartDateInput) {
                deviceTypeStartDateInput.addEventListener('change', function(e) {
                    deviceTypeStartDate = e.target.value;
                    renderDeviceTypeTrendChart();
                });
            }

            if (deviceTypeEndDateInput) {
                deviceTypeEndDateInput.addEventListener('change', function(e) {
                    deviceTypeEndDate = e.target.value;
                    renderDeviceTypeTrendChart();
                });
            }

            // PIVOT ê¸°ê°„ ì„ íƒ ì´ë²¤íŠ¸
            const pivotStartDateInput = document.getElementById('pivotStartDate');
            const pivotEndDateInput = document.getElementById('pivotEndDate');

            if (pivotStartDateInput) {
                pivotStartDateInput.addEventListener('change', function(e) {
                    pivotStartDate = e.target.value;
                    renderAgeGenderPivotTable();
                });
            }

            if (pivotEndDateInput) {
                pivotEndDateInput.addEventListener('change', function(e) {
                    pivotEndDate = e.target.value;
                    renderAgeGenderPivotTable();
                });
            }
        }

        // ì´ˆê¸°í™” í•„í„° í•¨ìˆ˜
        function initTrendAnalysisFilters() {
            // í˜„ì¬ëŠ” ë³„ë„ í•„í„° í•„ìš” ì—†ìŒ
        }

        // ì‹œê³„ì—´ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”
        function initTimeseriesDropdowns() {
            if (!adsetDimensionData) return;

            const filterMap = {
                'channel': { column: 'ìœ í˜•êµ¬ë¶„', listId: 'filterChannelList', label: 'ì±„ë„' },
                'product': { column: 'ìƒí’ˆëª…', listId: 'filterProductList', label: 'ì œí’ˆ' },
                'brand': { column: 'ë¸Œëœë“œëª…', listId: 'filterBrandList', label: 'ë¸Œëœë“œ' },
                'promotion': { column: 'í”„ë¡œëª¨ì…˜', listId: 'filterPromotionList', label: 'í”„ë¡œëª¨ì…˜' }
            };

            // ê° í•„í„°ì— ëŒ€í•œ ì²´í¬ë°•ìŠ¤ ë¦¬ìŠ¤íŠ¸ ìƒì„±
            Object.keys(filterMap).forEach(filterKey => {
                const { column, listId } = filterMap[filterKey];
                const list = document.getElementById(listId);
                if (!list) return;

                const items = [...new Set(adsetDimensionData.map(row => row[column]).filter(v => v && v !== '' && v !== '-'))];
                items.sort();

                list.innerHTML = items.map(item => `
                    <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-size: 12px; border-radius: 4px; transition: background 0.2s;" onmouseover="this.style.background='var(--grey-100)'" onmouseout="this.style.background='transparent'">
                        <input type="checkbox" class="filter-item-checkbox" data-filter="${filterKey}" value="${item}" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                        ${item}
                    </label>
                `).join('');

                // ê°œë³„ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
                list.querySelectorAll('.filter-item-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', function() {
                        updateTimeseriesFilters();
                        updateFilterButtonText(filterKey);
                    });
                });
            });

            // ë“œë¡­ë‹¤ìš´ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
            document.querySelectorAll('.filter-dropdown-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const filterType = this.dataset.filter;
                    const dropdown = document.querySelector(`.filter-dropdown-list[data-filter="${filterType}"]`);

                    // ë‹¤ë¥¸ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
                    document.querySelectorAll('.filter-dropdown-list').forEach(dd => {
                        if (dd !== dropdown) dd.style.display = 'none';
                    });

                    // í˜„ì¬ ë“œë¡­ë‹¤ìš´ í† ê¸€
                    if (dropdown) {
                        dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
                    }
                });
            });

            // ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
            document.querySelectorAll('.filter-select-all').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const filterType = this.dataset.filter;
                    const list = document.getElementById(`filter${filterType.charAt(0).toUpperCase() + filterType.slice(1)}List`);
                    if (!list) return;

                    const itemCheckboxes = list.querySelectorAll('.filter-item-checkbox');
                    itemCheckboxes.forEach(cb => {
                        cb.checked = this.checked;
                    });

                    updateTimeseriesFilters();
                    updateFilterButtonText(filterType);
                });
            });

            // ì™¸ë¶€ í´ë¦­ ì‹œ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.filter-dropdown-btn') && !e.target.closest('.filter-dropdown-list')) {
                    document.querySelectorAll('.filter-dropdown-list').forEach(dd => {
                        dd.style.display = 'none';
                    });
                }
            });

            // ê¸°ê°„ ì„ íƒ ì´ˆê¸°ê°’ ì„¤ì • (ì „ì²´ ë°ì´í„°ì˜ ìµœì†Œ/ìµœëŒ€ ë‚ ì§œ)
            const dates = dimensionData
                .map(row => row['ì¼'])
                .filter(date => date && date !== '' && date !== '-')
                .map(date => new Date(date))
                .filter(date => !isNaN(date));

            if (dates.length > 0) {
                const minDate = new Date(Math.min(...dates));
                const maxDate = new Date(Math.max(...dates));

                const formatDateForInput = (date) => {
                    const year = date.getFullYear();
                    const month = String(date.getMonth() + 1).padStart(2, '0');
                    const day = String(date.getDate()).padStart(2, '0');
                    return `${year}-${month}-${day}`;
                };

                const startInput = document.getElementById('timeseriesStartDate');
                const endInput = document.getElementById('timeseriesEndDate');

                if (startInput && endInput) {
                    startInput.value = formatDateForInput(minDate);
                    endInput.value = formatDateForInput(maxDate);
                    timeseriesStartDate = formatDateForInput(minDate);
                    timeseriesEndDate = formatDateForInput(maxDate);
                }
            }

            // ì´ˆê¸° ì°¨íŠ¸ ë Œë”ë§ (í•„í„° ë¯¸ì„ íƒ ìƒíƒœ)
            renderTimeseriesTrendChart();
        }

        function updateFilterButtonText(filterKey) {
            const filterMap = {
                'channel': 'ì±„ë„',
                'product': 'ì œí’ˆ',
                'brand': 'ë¸Œëœë“œ',
                'promotion': 'í”„ë¡œëª¨ì…˜'
            };

            const btn = document.querySelector(`.filter-dropdown-btn[data-filter="${filterKey}"]`);
            const list = document.getElementById(`filter${filterKey.charAt(0).toUpperCase() + filterKey.slice(1)}List`);

            if (!btn || !list) return;

            const checkedBoxes = list.querySelectorAll('.filter-item-checkbox:checked');
            const totalBoxes = list.querySelectorAll('.filter-item-checkbox');
            const btnText = btn.querySelector('span:first-child');
            const countText = btn.querySelector('.selected-count');

            if (checkedBoxes.length === 0) {
                btnText.textContent = `${filterMap[filterKey]}_ì „ì²´`;
                countText.textContent = '';
            } else if (checkedBoxes.length === totalBoxes.length) {
                btnText.textContent = `${filterMap[filterKey]}_ì „ì²´`;
                countText.textContent = `(${checkedBoxes.length})`;
            } else if (checkedBoxes.length === 1) {
                btnText.textContent = checkedBoxes[0].value;
                countText.textContent = '';
            } else {
                btnText.textContent = `${checkedBoxes[0].value} ì™¸`;
                countText.textContent = `(${checkedBoxes.length})`;
            }
        }

        function updateTimeseriesFilters() {
            if (!adsetDimensionData) return;

            const filterMap = {
                'channel': { column: 'ìœ í˜•êµ¬ë¶„', listId: 'filterChannelList' },
                'product': { column: 'ìƒí’ˆëª…', listId: 'filterProductList' },
                'brand': { column: 'ë¸Œëœë“œëª…', listId: 'filterBrandList' },
                'promotion': { column: 'í”„ë¡œëª¨ì…˜', listId: 'filterPromotionList' }
            };

            // ì„ íƒëœ í•„í„° ê°’ ìˆ˜ì§‘
            Object.keys(filterMap).forEach(filterKey => {
                const { listId } = filterMap[filterKey];
                const list = document.getElementById(listId);

                if (list) {
                    const checkedBoxes = list.querySelectorAll('.filter-item-checkbox:checked');
                    timeseriesFilters[filterKey] = Array.from(checkedBoxes).map(cb => cb.value);
                } else {
                    timeseriesFilters[filterKey] = [];
                }
            });

            // í•„í„°ë§ëœ ê´‘ê³ ì„¸íŠ¸ ê³„ì‚° ë° í‘œì‹œ
            updateFilteredAdsets();

            // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            renderTimeseriesTrendChart();
        }

        function updateFilteredAdsets() {
            if (!adsetDimensionData) return;

            const filterMap = {
                'channel': 'ìœ í˜•êµ¬ë¶„',
                'product': 'ìƒí’ˆëª…',
                'brand': 'ë¸Œëœë“œëª…',
                'promotion': 'í”„ë¡œëª¨ì…˜'
            };

            // AND ì—°ì‚°ìœ¼ë¡œ ê´‘ê³ ì„¸íŠ¸ í•„í„°ë§
            const filteredAdsets = new Set();

            adsetDimensionData.forEach(row => {
                const adset = row['ê´‘ê³ ì„¸íŠ¸'];
                if (!adset || adset === '' || adset === '-') return;

                let matchesAllFilters = true;

                // ê° í•„í„° íƒ€ì…ë³„ë¡œ AND ì—°ì‚°
                Object.keys(filterMap).forEach(filterKey => {
                    const column = filterMap[filterKey];
                    const selectedValues = timeseriesFilters[filterKey];

                    // í•´ë‹¹ í•„í„°ê°€ í™œì„±í™”ë˜ì–´ ìˆê³  ê°’ì´ ì„ íƒëœ ê²½ìš°
                    if (selectedValues && selectedValues.length > 0) {
                        const rowValue = row[column];
                        // ì„ íƒëœ ê°’ ì¤‘ í•˜ë‚˜ë¼ë„ ì¼ì¹˜í•˜ì§€ ì•Šìœ¼ë©´ ì œì™¸
                        if (!selectedValues.includes(rowValue)) {
                            matchesAllFilters = false;
                        }
                    }
                });

                if (matchesAllFilters) {
                    filteredAdsets.add(adset);
                }
            });

            // ê²°ê³¼ í‘œì‹œ
            const adsetArray = Array.from(filteredAdsets).sort();
            const countEl = document.getElementById('filteredAdsetCount');
            const listEl = document.getElementById('filteredAdsetList');

            if (countEl) countEl.textContent = adsetArray.length;

            if (listEl) {
                if (adsetArray.length === 0) {
                    listEl.textContent = 'í•„í„°ë¥¼ ì„ íƒí•˜ë©´ í•´ë‹¹í•˜ëŠ” ê´‘ê³ ì„¸íŠ¸ê°€ í‘œì‹œë©ë‹ˆë‹¤.';
                } else {
                    listEl.innerHTML = adsetArray.map(adset =>
                        `<div style="padding: 4px 8px; margin: 4px 0; background: white; border-radius: 4px; border: 1px solid var(--grey-200);">${adset}</div>`
                    ).join('');
                }
            }
        }

        // ì„±ë³„ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”
        function initGenderDropdowns() {
            if (!genderDimensionData) return;

            const filterMap = {
                'channel': { column: 'ìœ í˜•êµ¬ë¶„', listId: 'genderFilterChannelList', label: 'ì±„ë„' },
                'product': { column: 'ìƒí’ˆëª…', listId: 'genderFilterProductList', label: 'ì œí’ˆ' },
                'brand': { column: 'ë¸Œëœë“œëª…', listId: 'genderFilterBrandList', label: 'ë¸Œëœë“œ' },
                'promotion': { column: 'í”„ë¡œëª¨ì…˜', listId: 'genderFilterPromotionList', label: 'í”„ë¡œëª¨ì…˜' },
                'adset': { column: 'ê´‘ê³ ì„¸íŠ¸', listId: 'genderFilterAdsetList', label: 'ê´‘ê³ ì„¸íŠ¸' }
            };

            // ê° í•„í„°ì— ëŒ€í•œ ì²´í¬ë°•ìŠ¤ ë¦¬ìŠ¤íŠ¸ ìƒì„±
            Object.keys(filterMap).forEach(filterKey => {
                const { column, listId } = filterMap[filterKey];
                const list = document.getElementById(listId);
                if (!list) return;

                const items = [...new Set(genderDimensionData.map(row => row[column]).filter(v => v && v !== '' && v !== '-'))];
                items.sort();

                list.innerHTML = items.map(item => `
                    <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-size: 12px; border-radius: 4px; transition: background 0.2s;" onmouseover="this.style.background='var(--grey-100)'" onmouseout="this.style.background='transparent'">
                        <input type="checkbox" class="gender-filter-item-checkbox" data-filter="${filterKey}" value="${item}" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                        ${item}
                    </label>
                `).join('');

                // ê°œë³„ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
                list.querySelectorAll('.gender-filter-item-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', function() {
                        // ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸
                        const selectAllCheckbox = document.querySelector(`.gender-filter-select-all[data-filter="${filterKey}"]`);
                        if (selectAllCheckbox) {
                            const allCheckboxes = list.querySelectorAll('.gender-filter-item-checkbox');
                            const checkedCheckboxes = list.querySelectorAll('.gender-filter-item-checkbox:checked');
                            selectAllCheckbox.checked = allCheckboxes.length === checkedCheckboxes.length && allCheckboxes.length > 0;
                        }

                        updateGenderFilters();
                        updateGenderFilterButtonText(filterKey);
                    });
                });
            });

            // ë“œë¡­ë‹¤ìš´ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
            document.querySelectorAll('.gender-filter-dropdown-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const filterType = this.dataset.filter;
                    const dropdown = document.querySelector(`.gender-filter-dropdown-list[data-filter="${filterType}"]`);

                    // ë‹¤ë¥¸ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
                    document.querySelectorAll('.gender-filter-dropdown-list').forEach(dd => {
                        if (dd !== dropdown) dd.style.display = 'none';
                    });

                    // í˜„ì¬ ë“œë¡­ë‹¤ìš´ í† ê¸€
                    if (dropdown) {
                        dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
                    }
                });
            });

            // ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
            document.querySelectorAll('.gender-filter-select-all').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const filterType = this.dataset.filter;
                    const list = document.getElementById(`genderFilter${filterType.charAt(0).toUpperCase() + filterType.slice(1)}List`);
                    if (!list) return;

                    const itemCheckboxes = list.querySelectorAll('.gender-filter-item-checkbox');
                    itemCheckboxes.forEach(cb => {
                        cb.checked = this.checked;
                    });

                    updateGenderFilters();
                    updateGenderFilterButtonText(filterType);
                });
            });

            // ì™¸ë¶€ í´ë¦­ ì‹œ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.gender-filter-dropdown-btn') && !e.target.closest('.gender-filter-dropdown-list')) {
                    document.querySelectorAll('.gender-filter-dropdown-list').forEach(dd => {
                        dd.style.display = 'none';
                    });
                }
            });

            // ê¸°ê°„ ì„ íƒ ì´ˆê¸°ê°’ ì„¤ì • (ì „ì²´ ë°ì´í„°ì˜ ìµœì†Œ/ìµœëŒ€ ë‚ ì§œ)
            const dates = dimensionData
                .map(row => row['ì¼'])
                .filter(date => date && date !== '' && date !== '-')
                .map(date => new Date(date))
                .filter(date => !isNaN(date));

            if (dates.length > 0) {
                const minDate = new Date(Math.min(...dates));
                const maxDate = new Date(Math.max(...dates));

                const formatDateForInput = (date) => {
                    const year = date.getFullYear();
                    const month = String(date.getMonth() + 1).padStart(2, '0');
                    const day = String(date.getDate()).padStart(2, '0');
                    return `${year}-${month}-${day}`;
                };

                const startInput = document.getElementById('genderStartDate');
                const endInput = document.getElementById('genderEndDate');

                if (startInput && endInput) {
                    startInput.value = formatDateForInput(minDate);
                    endInput.value = formatDateForInput(maxDate);
                    genderStartDate = formatDateForInput(minDate);
                    genderEndDate = formatDateForInput(maxDate);
                }
            }

            // ì´ˆê¸° ì°¨íŠ¸ ë Œë”ë§ (í•„í„° ë¯¸ì„ íƒ ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ)
            renderGenderTrendChart();
        }

        function updateGenderFilterButtonText(filterKey) {
            const filterMap = {
                'channel': 'ì±„ë„',
                'product': 'ì œí’ˆ',
                'brand': 'ë¸Œëœë“œ',
                'promotion': 'í”„ë¡œëª¨ì…˜',
                'adset': 'ê´‘ê³ ì„¸íŠ¸'
            };

            const btn = document.querySelector(`.gender-filter-dropdown-btn[data-filter="${filterKey}"]`);
            const list = document.getElementById(`genderFilter${filterKey.charAt(0).toUpperCase() + filterKey.slice(1)}List`);

            if (!btn || !list) return;

            const checkedBoxes = list.querySelectorAll('.gender-filter-item-checkbox:checked');
            const totalBoxes = list.querySelectorAll('.gender-filter-item-checkbox');
            const btnText = btn.querySelector('span:first-child');
            const countText = btn.querySelector('.gender-selected-count');

            if (checkedBoxes.length === 0) {
                btnText.textContent = `${filterMap[filterKey]}_ì „ì²´`;
                countText.textContent = '';
            } else if (checkedBoxes.length === totalBoxes.length) {
                btnText.textContent = `${filterMap[filterKey]}_ì „ì²´`;
                countText.textContent = `(${checkedBoxes.length})`;
            } else if (checkedBoxes.length === 1) {
                btnText.textContent = checkedBoxes[0].value;
                countText.textContent = '';
            } else {
                btnText.textContent = `${checkedBoxes[0].value} ì™¸`;
                countText.textContent = `(${checkedBoxes.length})`;
            }
        }

        // ì „ì—­ í•„í„° ìƒíƒœ ì €ì¥
        let currentGenderFilters = {
            channel: [],
            product: [],
            brand: [],
            promotion: [],
            adset: []
        };

        function updateGenderFilters() {
            if (!genderDimensionData) return;

            const filterMap = {
                'channel': { column: 'ìœ í˜•êµ¬ë¶„', listId: 'genderFilterChannelList' },
                'product': { column: 'ìƒí’ˆëª…', listId: 'genderFilterProductList' },
                'brand': { column: 'ë¸Œëœë“œëª…', listId: 'genderFilterBrandList' },
                'promotion': { column: 'í”„ë¡œëª¨ì…˜', listId: 'genderFilterPromotionList' },
                'adset': { column: 'ê´‘ê³ ì„¸íŠ¸', listId: 'genderFilterAdsetList' }
            };

            // ì„ íƒëœ í•„í„° ê°’ ìˆ˜ì§‘
            Object.keys(filterMap).forEach(filterKey => {
                const { listId } = filterMap[filterKey];
                const list = document.getElementById(listId);

                if (list) {
                    const checkedBoxes = list.querySelectorAll('.gender-filter-item-checkbox:checked');
                    currentGenderFilters[filterKey] = Array.from(checkedBoxes).map(cb => cb.value);
                } else {
                    currentGenderFilters[filterKey] = [];
                }
            });

            // ëª¨ë“  í•„í„°ê°€ ë¹„ì–´ìˆëŠ”ì§€ í™•ì¸
            const allFiltersEmpty = Object.values(currentGenderFilters).every(arr => arr.length === 0);

            if (allFiltersEmpty) {
                // ëª¨ë“  í•„í„°ê°€ í•´ì œë˜ë©´ í•„í„° ìƒíƒœ ì´ˆê¸°í™”
                currentGenderFilters = {
                    channel: [],
                    product: [],
                    brand: [],
                    promotion: [],
                    adset: []
                };
            }

            // í•„í„°ë§ëœ ì„±ë³„ ë°ì´í„° ê³„ì‚°
            updateFilteredGenderCount(currentGenderFilters);

            // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            renderGenderTrendChart();
        }

        function updateFilteredGenderCount(filters) {
            if (!genderDimensionData) return;

            const filterMap = {
                'channel': 'ìœ í˜•êµ¬ë¶„',
                'product': 'ìƒí’ˆëª…',
                'brand': 'ë¸Œëœë“œëª…',
                'promotion': 'í”„ë¡œëª¨ì…˜',
                'adset': 'ê´‘ê³ ì„¸íŠ¸'
            };

            const gendersToShow = new Set();

            genderDimensionData.forEach(row => {
                // ì„±ë³„_í†µí•© ì»¬ëŸ¼ ìš°ì„  ì‚¬ìš© (ì—†ìœ¼ë©´ ì„±ë³„ ì»¬ëŸ¼ ì‚¬ìš©)
                const rawGender = row['ì„±ë³„_í†µí•©'] || row['ì„±ë³„'];
                // ì•Œìˆ˜ì—†ìŒ í•„í„°ë§ ë° ì •ê·œí™” ì ìš©
                const normalizedGender = normalizeGender(rawGender);
                if (!normalizedGender) return;

                let matchesAllFilters = true;

                // AND ì—°ì‚°ìœ¼ë¡œ ëª¨ë“  í•„í„° í™•ì¸
                Object.keys(filterMap).forEach(filterKey => {
                    const column = filterMap[filterKey];
                    const selectedValues = filters[filterKey];

                    if (selectedValues && selectedValues.length > 0) {
                        const rowValue = row[column];
                        if (!selectedValues.includes(rowValue)) {
                            matchesAllFilters = false;
                        }
                    }
                });

                if (matchesAllFilters) {
                    gendersToShow.add(normalizedGender);
                }
            });

            document.getElementById('filteredGenderCount').textContent = gendersToShow.size;
        }

        function handleGenderDropdownChange(dropdown, index) {
            if (dropdown.value && selectedGenderItems.length < 5) {
                const nextIndex = index + 1;
                const nextDropdown = document.getElementById(`genderDropdown${nextIndex}`);
                if (!nextDropdown && nextIndex < 5) {
                    addGenderDropdown(nextIndex);
                }
            } else if (!dropdown.value) {
                removeGenderDropdownsAfter(index);
            }
            updateSelectedGenderItems();
        }

        function addGenderDropdown(index) {
            if (!dimensionData) return;

            const filterMap = {
                'channel': 'ìœ í˜•êµ¬ë¶„',
                'product': 'ìƒí’ˆëª…',
                'brand': 'ë¸Œëœë“œëª…',
                'promotion': 'í”„ë¡œëª¨ì…˜'
            };

            const column = filterMap[currentGenderFilter];
            const items = [...new Set(dimensionData.map(row => row[column]).filter(v => v && v !== '' && v !== '-'))];
            items.sort();

            const container = document.getElementById('genderDropdownContainer');
            if (!container) return;

            const wrapper = document.createElement('div');
            wrapper.id = `genderDropdown${index}`;
            wrapper.className = 'gender-dropdown-wrapper';
            wrapper.style.position = 'relative';

            const dropdown = document.createElement('select');
            dropdown.className = 'gender-dropdown';
            dropdown.style.cssText = 'min-width: 200px; padding: 10px 12px; border: 1px solid var(--grey-300); border-radius: 6px; background: white; font-size: 13px; color: var(--grey-800); cursor: pointer;';

            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = 'í•­ëª©ì„ ì„ íƒí•˜ì„¸ìš”';
            dropdown.appendChild(defaultOption);

            items.forEach(item => {
                if (!selectedGenderItems.includes(item)) {
                    const option = document.createElement('option');
                    option.value = item;
                    option.textContent = item;
                    dropdown.appendChild(option);
                }
            });

            dropdown.addEventListener('change', function() {
                handleGenderDropdownChange(this, index);
            });

            wrapper.appendChild(dropdown);
            container.appendChild(wrapper);
        }

        function removeGenderDropdownsAfter(index) {
            for (let i = index + 1; i <= 5; i++) {
                const dropdown = document.getElementById(`genderDropdown${i}`);
                if (dropdown) dropdown.remove();
            }
        }

        function updateSelectedGenderItems() {
            const container = document.getElementById('genderDropdownContainer');
            if (!container) return;

            selectedGenderItems = [];
            container.querySelectorAll('.gender-dropdown').forEach(dropdown => {
                if (dropdown.value) {
                    selectedGenderItems.push(dropdown.value);
                }
            });

            document.getElementById('selectedGenderCount').textContent = selectedGenderItems.length;
            renderGenderTrendChart();
        }

        // ì—°ë ¹ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”
        function initAgeDropdowns() {
            if (!ageDimensionData) return;

            const filterMap = {
                'channel': { column: 'ìœ í˜•êµ¬ë¶„', listId: 'ageFilterChannelList', label: 'ì±„ë„' },
                'product': { column: 'ìƒí’ˆëª…', listId: 'ageFilterProductList', label: 'ì œí’ˆ' },
                'brand': { column: 'ë¸Œëœë“œëª…', listId: 'ageFilterBrandList', label: 'ë¸Œëœë“œ' },
                'promotion': { column: 'í”„ë¡œëª¨ì…˜', listId: 'ageFilterPromotionList', label: 'í”„ë¡œëª¨ì…˜' },
                'adset': { column: 'ê´‘ê³ ì„¸íŠ¸', listId: 'ageFilterAdsetList', label: 'ê´‘ê³ ì„¸íŠ¸' }
            };

            // ê° í•„í„°ì— ëŒ€í•œ ì²´í¬ë°•ìŠ¤ ë¦¬ìŠ¤íŠ¸ ìƒì„±
            Object.keys(filterMap).forEach(filterKey => {
                const { column, listId } = filterMap[filterKey];
                const list = document.getElementById(listId);
                if (!list) return;

                const items = [...new Set(ageDimensionData.map(row => row[column]).filter(v => v && v !== '' && v !== '-'))];
                items.sort();

                list.innerHTML = items.map(item => `
                    <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-size: 12px; border-radius: 4px; transition: background 0.2s;" onmouseover="this.style.background='var(--grey-100)'" onmouseout="this.style.background='transparent'">
                        <input type="checkbox" class="age-filter-item-checkbox" data-filter="${filterKey}" value="${item}" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                        ${item}
                    </label>
                `).join('');

                // ê°œë³„ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
                list.querySelectorAll('.age-filter-item-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', function() {
                        // ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸
                        const selectAllCheckbox = document.querySelector(`.age-filter-select-all[data-filter="${filterKey}"]`);
                        if (selectAllCheckbox) {
                            const allCheckboxes = list.querySelectorAll('.age-filter-item-checkbox');
                            const checkedCheckboxes = list.querySelectorAll('.age-filter-item-checkbox:checked');
                            selectAllCheckbox.checked = allCheckboxes.length === checkedCheckboxes.length && allCheckboxes.length > 0;
                        }

                        updateAgeFilters();
                        updateAgeFilterButtonText(filterKey);
                    });
                });
            });

            // ë“œë¡­ë‹¤ìš´ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
            document.querySelectorAll('.age-filter-dropdown-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const filterType = this.dataset.filter;
                    const dropdown = document.querySelector(`.age-filter-dropdown-list[data-filter="${filterType}"]`);

                    // ë‹¤ë¥¸ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
                    document.querySelectorAll('.age-filter-dropdown-list').forEach(dd => {
                        if (dd !== dropdown) dd.style.display = 'none';
                    });

                    // í˜„ì¬ ë“œë¡­ë‹¤ìš´ í† ê¸€
                    if (dropdown) {
                        dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
                    }
                });
            });

            // ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
            document.querySelectorAll('.age-filter-select-all').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const filterType = this.dataset.filter;
                    const list = document.getElementById(`ageFilter${filterType.charAt(0).toUpperCase() + filterType.slice(1)}List`);
                    if (!list) return;

                    const itemCheckboxes = list.querySelectorAll('.age-filter-item-checkbox');
                    itemCheckboxes.forEach(cb => {
                        cb.checked = this.checked;
                    });

                    updateAgeFilters();
                    updateAgeFilterButtonText(filterType);
                });
            });

            // ê¸°ê°„ ì„ íƒ ì´ˆê¸°ê°’ ì„¤ì • (ì „ì²´ ë°ì´í„°ì˜ ìµœì†Œ/ìµœëŒ€ ë‚ ì§œ)
            const dates = dimensionData
                .map(row => row['ì¼'])
                .filter(date => date && date !== '' && date !== '-')
                .map(date => new Date(date))
                .filter(date => !isNaN(date));

            if (dates.length > 0) {
                const minDate = new Date(Math.min(...dates));
                const maxDate = new Date(Math.max(...dates));

                const formatDateForInput = (date) => {
                    const year = date.getFullYear();
                    const month = String(date.getMonth() + 1).padStart(2, '0');
                    const day = String(date.getDate()).padStart(2, '0');
                    return `${year}-${month}-${day}`;
                };

                const startInput = document.getElementById('ageStartDate');
                const endInput = document.getElementById('ageEndDate');

                if (startInput && endInput) {
                    startInput.value = formatDateForInput(minDate);
                    endInput.value = formatDateForInput(maxDate);
                    ageStartDate = formatDateForInput(minDate);
                    ageEndDate = formatDateForInput(maxDate);
                }
            }

            // ì´ˆê¸° ì°¨íŠ¸ ë Œë”ë§ (í•„í„° ë¯¸ì„ íƒ ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ)
            renderAgeTrendChart();
        }

        function updateAgeFilterButtonText(filterKey) {
            const filterMap = {
                'channel': 'ì±„ë„',
                'product': 'ì œí’ˆ',
                'brand': 'ë¸Œëœë“œ',
                'promotion': 'í”„ë¡œëª¨ì…˜',
                'adset': 'ê´‘ê³ ì„¸íŠ¸'
            };

            const btn = document.querySelector(`.age-filter-dropdown-btn[data-filter="${filterKey}"]`);
            const list = document.getElementById(`ageFilter${filterKey.charAt(0).toUpperCase() + filterKey.slice(1)}List`);

            if (!btn || !list) return;

            const checkedBoxes = list.querySelectorAll('.age-filter-item-checkbox:checked');
            const totalBoxes = list.querySelectorAll('.age-filter-item-checkbox');
            const btnText = btn.querySelector('span:first-child');
            const countText = btn.querySelector('.age-selected-count');

            if (checkedBoxes.length === 0) {
                btnText.textContent = `${filterMap[filterKey]}_ì „ì²´`;
                countText.textContent = '';
            } else if (checkedBoxes.length === totalBoxes.length) {
                btnText.textContent = `${filterMap[filterKey]}_ì „ì²´`;
                countText.textContent = `(${checkedBoxes.length})`;
            } else if (checkedBoxes.length === 1) {
                btnText.textContent = checkedBoxes[0].value;
                countText.textContent = '';
            } else {
                btnText.textContent = `${checkedBoxes[0].value} ì™¸`;
                countText.textContent = `(${checkedBoxes.length})`;
            }
        }

        // ì „ì—­ í•„í„° ìƒíƒœ ì €ì¥
        let currentAgeFilters = {
            channel: [],
            product: [],
            brand: [],
            promotion: [],
            adset: []
        };

        function updateAgeFilters() {
            if (!ageDimensionData) return;

            const filterMap = {
                'channel': { column: 'ìœ í˜•êµ¬ë¶„', listId: 'ageFilterChannelList' },
                'product': { column: 'ìƒí’ˆëª…', listId: 'ageFilterProductList' },
                'brand': { column: 'ë¸Œëœë“œëª…', listId: 'ageFilterBrandList' },
                'promotion': { column: 'í”„ë¡œëª¨ì…˜', listId: 'ageFilterPromotionList' },
                'adset': { column: 'ê´‘ê³ ì„¸íŠ¸', listId: 'ageFilterAdsetList' }
            };

            // ì„ íƒëœ í•„í„° ê°’ ìˆ˜ì§‘
            Object.keys(filterMap).forEach(filterKey => {
                const { listId } = filterMap[filterKey];
                const list = document.getElementById(listId);

                if (list) {
                    const checkedBoxes = list.querySelectorAll('.age-filter-item-checkbox:checked');
                    currentAgeFilters[filterKey] = Array.from(checkedBoxes).map(cb => cb.value);
                } else {
                    currentAgeFilters[filterKey] = [];
                }
            });

            // ëª¨ë“  í•„í„°ê°€ ë¹„ì–´ìˆëŠ”ì§€ í™•ì¸
            const allFiltersEmpty = Object.values(currentAgeFilters).every(arr => arr.length === 0);

            if (allFiltersEmpty) {
                // ëª¨ë“  í•„í„°ê°€ í•´ì œë˜ë©´ í•„í„° ìƒíƒœ ì´ˆê¸°í™”
                currentAgeFilters = {
                    channel: [],
                    product: [],
                    brand: [],
                    promotion: [],
                    adset: []
                };
            }

            // í•„í„°ë§ëœ ì—°ë ¹ ë°ì´í„° ê³„ì‚°
            updateFilteredAgeCount(currentAgeFilters);

            // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            renderAgeTrendChart();
        }

        function updateFilteredAgeCount(filters) {
            if (!ageDimensionData) return;

            const filterMap = {
                'channel': 'ìœ í˜•êµ¬ë¶„',
                'product': 'ìƒí’ˆëª…',
                'brand': 'ë¸Œëœë“œëª…',
                'promotion': 'í”„ë¡œëª¨ì…˜',
                'adset': 'ê´‘ê³ ì„¸íŠ¸'
            };

            const agesToShow = new Set();

            ageDimensionData.forEach(row => {
                // ì—°ë ¹_í†µí•© ì»¬ëŸ¼ ìš°ì„  ì‚¬ìš©
                const age = row['ì—°ë ¹_í†µí•©'] || row['ì—°ë ¹'];
                if (!age || age === '' || age === '-') return;

                let matchesAllFilters = true;

                // AND ì—°ì‚°ìœ¼ë¡œ ëª¨ë“  í•„í„° í™•ì¸
                Object.keys(filterMap).forEach(filterKey => {
                    const column = filterMap[filterKey];
                    const selectedValues = filters[filterKey];

                    if (selectedValues && selectedValues.length > 0) {
                        const rowValue = row[column];
                        if (!selectedValues.includes(rowValue)) {
                            matchesAllFilters = false;
                        }
                    }
                });

                if (matchesAllFilters) {
                    agesToShow.add(age);
                }
            });

            document.getElementById('filteredAgeCount').textContent = agesToShow.size;
        }

        function handleAgeDropdownChange(dropdown, index) {
            if (dropdown.value && selectedAgeItems.length < 5) {
                const nextIndex = index + 1;
                const nextDropdown = document.getElementById(`ageDropdown${nextIndex}`);
                if (!nextDropdown && nextIndex < 5) {
                    addAgeDropdown(nextIndex);
                }
            } else if (!dropdown.value) {
                removeAgeDropdownsAfter(index);
            }
            updateSelectedAgeItems();
        }

        function addAgeDropdown(index) {
            if (!dimensionData) return;

            const filterMap = {
                'channel': 'ìœ í˜•êµ¬ë¶„',
                'product': 'ìƒí’ˆëª…',
                'brand': 'ë¸Œëœë“œëª…',
                'promotion': 'í”„ë¡œëª¨ì…˜'
            };

            const column = filterMap[currentAgeFilter];
            const items = [...new Set(dimensionData.map(row => row[column]).filter(v => v && v !== '' && v !== '-'))];
            items.sort();

            const container = document.getElementById('ageDropdownContainer');
            if (!container) return;

            const wrapper = document.createElement('div');
            wrapper.id = `ageDropdown${index}`;
            wrapper.className = 'age-dropdown-wrapper';
            wrapper.style.position = 'relative';

            const dropdown = document.createElement('select');
            dropdown.className = 'age-dropdown';
            dropdown.style.cssText = 'min-width: 200px; padding: 10px 12px; border: 1px solid var(--grey-300); border-radius: 6px; background: white; font-size: 13px; color: var(--grey-800); cursor: pointer;';

            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = 'í•­ëª©ì„ ì„ íƒí•˜ì„¸ìš”';
            dropdown.appendChild(defaultOption);

            items.forEach(item => {
                if (!selectedAgeItems.includes(item)) {
                    const option = document.createElement('option');
                    option.value = item;
                    option.textContent = item;
                    dropdown.appendChild(option);
                }
            });

            dropdown.addEventListener('change', function() {
                handleAgeDropdownChange(this, index);
            });

            wrapper.appendChild(dropdown);
            container.appendChild(wrapper);
        }

        function removeAgeDropdownsAfter(index) {
            for (let i = index + 1; i <= 5; i++) {
                const dropdown = document.getElementById(`ageDropdown${i}`);
                if (dropdown) dropdown.remove();
            }
        }

        function updateSelectedAgeItems() {
            const container = document.getElementById('ageDropdownContainer');
            if (!container) return;

            selectedAgeItems = [];
            container.querySelectorAll('.age-dropdown').forEach(dropdown => {
                if (dropdown.value) {
                    selectedAgeItems.push(dropdown.value);
                }
            });

            document.getElementById('selectedAgeCount').textContent = selectedAgeItems.length;
            renderAgeTrendChart();
        }

        // í”Œë«í¼ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”
        function initPlatformDropdowns() {
            if (!platformDimensionData) return;

            const filterMap = {
                'channel': { column: 'ìœ í˜•êµ¬ë¶„', listId: 'platformFilterChannelList', label: 'ì±„ë„' },
                'product': { column: 'ìƒí’ˆëª…', listId: 'platformFilterProductList', label: 'ì œí’ˆ' },
                'brand': { column: 'ë¸Œëœë“œëª…', listId: 'platformFilterBrandList', label: 'ë¸Œëœë“œ' },
                'promotion': { column: 'í”„ë¡œëª¨ì…˜', listId: 'platformFilterPromotionList', label: 'í”„ë¡œëª¨ì…˜' },
                'adset': { column: 'ê´‘ê³ ì„¸íŠ¸', listId: 'platformFilterAdsetList', label: 'ê´‘ê³ ì„¸íŠ¸' }
            };

            // ê° í•„í„°ì— ëŒ€í•œ ì²´í¬ë°•ìŠ¤ ë¦¬ìŠ¤íŠ¸ ìƒì„±
            Object.keys(filterMap).forEach(filterKey => {
                const { column, listId } = filterMap[filterKey];
                const list = document.getElementById(listId);
                if (!list) return;

                const items = [...new Set(platformDimensionData.map(row => row[column]).filter(v => v && v !== '' && v !== '-'))];
                items.sort();

                list.innerHTML = items.map(item => `
                    <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-size: 12px; border-radius: 4px; transition: background 0.2s;" onmouseover="this.style.background='var(--grey-100)'" onmouseout="this.style.background='transparent'">
                        <input type="checkbox" class="platform-filter-item-checkbox" data-filter="${filterKey}" value="${item}" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                        ${item}
                    </label>
                `).join('');

                // ê°œë³„ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
                list.querySelectorAll('.platform-filter-item-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', function() {
                        // ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸
                        const selectAllCheckbox = document.querySelector(`.platform-filter-select-all[data-filter="${filterKey}"]`);
                        if (selectAllCheckbox) {
                            const allCheckboxes = list.querySelectorAll('.platform-filter-item-checkbox');
                            const checkedCheckboxes = list.querySelectorAll('.platform-filter-item-checkbox:checked');
                            selectAllCheckbox.checked = allCheckboxes.length === checkedCheckboxes.length && allCheckboxes.length > 0;
                        }

                        updatePlatformFilters();
                        updatePlatformFilterButtonText(filterKey);
                    });
                });
            });

            // ë“œë¡­ë‹¤ìš´ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
            document.querySelectorAll('.platform-filter-dropdown-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const filterType = this.dataset.filter;
                    const dropdown = document.querySelector(`.platform-filter-dropdown-list[data-filter="${filterType}"]`);

                    // ë‹¤ë¥¸ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
                    document.querySelectorAll('.platform-filter-dropdown-list').forEach(dd => {
                        if (dd !== dropdown) dd.style.display = 'none';
                    });

                    // í˜„ì¬ ë“œë¡­ë‹¤ìš´ í† ê¸€
                    if (dropdown) {
                        dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
                    }
                });
            });

            // ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
            document.querySelectorAll('.platform-filter-select-all').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const filterType = this.dataset.filter;
                    const list = document.getElementById(`platformFilter${filterType.charAt(0).toUpperCase() + filterType.slice(1)}List`);
                    if (!list) return;

                    const itemCheckboxes = list.querySelectorAll('.platform-filter-item-checkbox');
                    itemCheckboxes.forEach(cb => {
                        cb.checked = this.checked;
                    });

                    updatePlatformFilters();
                    updatePlatformFilterButtonText(filterType);
                });
            });

            // ì™¸ë¶€ í´ë¦­ ì‹œ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.platform-filter-dropdown-btn') && !e.target.closest('.platform-filter-dropdown-list')) {
                    document.querySelectorAll('.platform-filter-dropdown-list').forEach(dd => {
                        dd.style.display = 'none';
                    });
                }
            });

            // ê¸°ê°„ ì„ íƒ ì´ˆê¸°ê°’ ì„¤ì • (ì „ì²´ ë°ì´í„°ì˜ ìµœì†Œ/ìµœëŒ€ ë‚ ì§œ)
            const dates = dimensionData
                .map(row => row['ì¼'])
                .filter(date => date && date !== '' && date !== '-')
                .map(date => new Date(date))
                .filter(date => !isNaN(date));

            if (dates.length > 0) {
                const minDate = new Date(Math.min(...dates));
                const maxDate = new Date(Math.max(...dates));

                const formatDateForInput = (date) => {
                    const year = date.getFullYear();
                    const month = String(date.getMonth() + 1).padStart(2, '0');
                    const day = String(date.getDate()).padStart(2, '0');
                    return `${year}-${month}-${day}`;
                };

                const startInput = document.getElementById('platformStartDate');
                const endInput = document.getElementById('platformEndDate');

                if (startInput && endInput) {
                    startInput.value = formatDateForInput(minDate);
                    endInput.value = formatDateForInput(maxDate);
                    platformStartDate = formatDateForInput(minDate);
                    platformEndDate = formatDateForInput(maxDate);
                }
            }

            // ì´ˆê¸° ì°¨íŠ¸ ë Œë”ë§ (í•„í„° ë¯¸ì„ íƒ ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ)
            renderPlatformTrendChart();
        }

        function updatePlatformFilterButtonText(filterKey) {
            const filterMap = {
                'channel': 'ì±„ë„',
                'product': 'ì œí’ˆ',
                'brand': 'ë¸Œëœë“œ',
                'promotion': 'í”„ë¡œëª¨ì…˜',
                'adset': 'ê´‘ê³ ì„¸íŠ¸'
            };

            const btn = document.querySelector(`.platform-filter-dropdown-btn[data-filter="${filterKey}"]`);
            const list = document.getElementById(`platformFilter${filterKey.charAt(0).toUpperCase() + filterKey.slice(1)}List`);

            if (!btn || !list) return;

            const checkedBoxes = list.querySelectorAll('.platform-filter-item-checkbox:checked');
            const totalBoxes = list.querySelectorAll('.platform-filter-item-checkbox');
            const btnText = btn.querySelector('span:first-child');
            const countText = btn.querySelector('.platform-selected-count');

            if (checkedBoxes.length === 0) {
                btnText.textContent = `${filterMap[filterKey]}_ì „ì²´`;
                countText.textContent = '';
            } else if (checkedBoxes.length === totalBoxes.length) {
                btnText.textContent = `${filterMap[filterKey]}_ì „ì²´`;
                countText.textContent = `(${checkedBoxes.length})`;
            } else if (checkedBoxes.length === 1) {
                btnText.textContent = checkedBoxes[0].value;
                countText.textContent = '';
            } else {
                btnText.textContent = `${checkedBoxes[0].value} ì™¸`;
                countText.textContent = `(${checkedBoxes.length})`;
            }
        }

        // ì „ì—­ í•„í„° ìƒíƒœ ì €ì¥
        let currentPlatformFilters = {
            channel: [],
            product: [],
            brand: [],
            promotion: [],
            adset: []
        };

        function updatePlatformFilters() {
            if (!platformDimensionData) return;

            const filterMap = {
                'channel': { column: 'ìœ í˜•êµ¬ë¶„', listId: 'platformFilterChannelList' },
                'product': { column: 'ìƒí’ˆëª…', listId: 'platformFilterProductList' },
                'brand': { column: 'ë¸Œëœë“œëª…', listId: 'platformFilterBrandList' },
                'promotion': { column: 'í”„ë¡œëª¨ì…˜', listId: 'platformFilterPromotionList' },
                'adset': { column: 'ê´‘ê³ ì„¸íŠ¸', listId: 'platformFilterAdsetList' }
            };

            // ì„ íƒëœ í•„í„° ê°’ ìˆ˜ì§‘
            Object.keys(filterMap).forEach(filterKey => {
                const { listId } = filterMap[filterKey];
                const list = document.getElementById(listId);

                if (list) {
                    const checkedBoxes = list.querySelectorAll('.platform-filter-item-checkbox:checked');
                    currentPlatformFilters[filterKey] = Array.from(checkedBoxes).map(cb => cb.value);
                } else {
                    currentPlatformFilters[filterKey] = [];
                }
            });

            // ëª¨ë“  í•„í„°ê°€ ë¹„ì–´ìˆëŠ”ì§€ í™•ì¸
            const allFiltersEmpty = Object.values(currentPlatformFilters).every(arr => arr.length === 0);

            if (allFiltersEmpty) {
                // ëª¨ë“  í•„í„°ê°€ í•´ì œë˜ë©´ í•„í„° ìƒíƒœ ì´ˆê¸°í™”
                currentPlatformFilters = {
                    channel: [],
                    product: [],
                    brand: [],
                    promotion: [],
                    adset: []
                };
            }

            // í•„í„°ë§ëœ í”Œë«í¼ ë°ì´í„° ê³„ì‚°
            updateFilteredPlatformCount(currentPlatformFilters);

            // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            renderPlatformTrendChart();
        }

        function updateFilteredPlatformCount(filters) {
            if (!platformDimensionData) return;

            const filterMap = {
                'channel': 'ìœ í˜•êµ¬ë¶„',
                'product': 'ìƒí’ˆëª…',
                'brand': 'ë¸Œëœë“œëª…',
                'promotion': 'í”„ë¡œëª¨ì…˜',
                'adset': 'ê´‘ê³ ì„¸íŠ¸'
            };

            const platformsToShow = new Set();

            platformDimensionData.forEach(row => {
                const platform = row['í”Œë«í¼'];
                if (!platform || platform === '' || platform === '-') return;

                let matchesAllFilters = true;

                // AND ì—°ì‚°ìœ¼ë¡œ ëª¨ë“  í•„í„° í™•ì¸
                Object.keys(filterMap).forEach(filterKey => {
                    const column = filterMap[filterKey];
                    const selectedValues = filters[filterKey];

                    if (selectedValues && selectedValues.length > 0) {
                        const rowValue = row[column];
                        if (!selectedValues.includes(rowValue)) {
                            matchesAllFilters = false;
                        }
                    }
                });

                if (matchesAllFilters) {
                    platformsToShow.add(platform);
                }
            });

            document.getElementById('filteredPlatformCount').textContent = platformsToShow.size;
        }

        // PIVOT ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”
        function initPivotDropdowns() {
            if (!pivotDimensionData) return;

            const filterMap = {
                'channel': { column: 'ìœ í˜•êµ¬ë¶„', listId: 'pivotFilterChannelList', label: 'ì±„ë„' },
                'product': { column: 'ìƒí’ˆëª…', listId: 'pivotFilterProductList', label: 'ì œí’ˆ' },
                'brand': { column: 'ë¸Œëœë“œëª…', listId: 'pivotFilterBrandList', label: 'ë¸Œëœë“œ' },
                'promotion': { column: 'í”„ë¡œëª¨ì…˜', listId: 'pivotFilterPromotionList', label: 'í”„ë¡œëª¨ì…˜' },
                'adset': { column: 'ê´‘ê³ ì„¸íŠ¸', listId: 'pivotFilterAdsetList', label: 'ê´‘ê³ ì„¸íŠ¸' }
            };

            // ê° í•„í„°ì— ëŒ€í•œ ì²´í¬ë°•ìŠ¤ ë¦¬ìŠ¤íŠ¸ ìƒì„±
            Object.keys(filterMap).forEach(filterKey => {
                const { column, listId } = filterMap[filterKey];
                const list = document.getElementById(listId);
                if (!list) return;

                const items = [...new Set(pivotDimensionData.map(row => row[column]).filter(v => v && v !== '' && v !== '-'))];
                items.sort();

                list.innerHTML = items.map(item => `
                    <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-size: 12px; border-radius: 4px; transition: background 0.2s;" onmouseover="this.style.background='var(--grey-100)'" onmouseout="this.style.background='transparent'">
                        <input type="checkbox" class="pivot-filter-item-checkbox" data-filter="${filterKey}" value="${item}" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                        ${item}
                    </label>
                `).join('');

                // ê°œë³„ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
                list.querySelectorAll('.pivot-filter-item-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', function() {
                        // ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸
                        const selectAllCheckbox = document.querySelector(`.pivot-filter-select-all[data-filter="${filterKey}"]`);
                        if (selectAllCheckbox) {
                            const allCheckboxes = list.querySelectorAll('.pivot-filter-item-checkbox');
                            const checkedCheckboxes = list.querySelectorAll('.pivot-filter-item-checkbox:checked');
                            selectAllCheckbox.checked = allCheckboxes.length === checkedCheckboxes.length && allCheckboxes.length > 0;
                        }

                        updatePivotFilters();
                        updatePivotFilterButtonText(filterKey);
                    });
                });
            });

            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆëŠ” í•œ ë²ˆë§Œ ë“±ë¡
            if (!pivotDropdownsInitialized) {
                // ë“œë¡­ë‹¤ìš´ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
                document.querySelectorAll('.pivot-filter-dropdown-btn').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const filterType = this.dataset.filter;
                        const dropdown = document.querySelector(`.pivot-filter-dropdown-list[data-filter="${filterType}"]`);

                        // ë‹¤ë¥¸ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
                        document.querySelectorAll('.pivot-filter-dropdown-list').forEach(dd => {
                            if (dd !== dropdown) dd.style.display = 'none';
                        });

                        // í˜„ì¬ ë“œë¡­ë‹¤ìš´ í† ê¸€
                        if (dropdown) {
                            dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
                        }
                    });
                });

                // ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
                document.querySelectorAll('.pivot-filter-select-all').forEach(checkbox => {
                    checkbox.addEventListener('change', function() {
                        const filterType = this.dataset.filter;
                        const list = document.getElementById(`pivotFilter${filterType.charAt(0).toUpperCase() + filterType.slice(1)}List`);
                        if (!list) return;

                        const itemCheckboxes = list.querySelectorAll('.pivot-filter-item-checkbox');
                        itemCheckboxes.forEach(cb => {
                            cb.checked = this.checked;
                        });

                        updatePivotFilters();
                        updatePivotFilterButtonText(filterType);
                    });
                });

                pivotDropdownsInitialized = true;
            }

            // ê¸°ê°„ ì„ íƒ ì´ˆê¸°ê°’ ì„¤ì • (ì „ì²´ ë°ì´í„°ì˜ ìµœì†Œ/ìµœëŒ€ ë‚ ì§œ)
            const dates = dimensionData
                .map(row => row['ì¼'])
                .filter(date => date && date !== '' && date !== '-')
                .map(date => new Date(date))
                .filter(date => !isNaN(date));

            if (dates.length > 0) {
                const minDate = new Date(Math.min(...dates));
                const maxDate = new Date(Math.max(...dates));

                const formatDateForInput = (date) => {
                    const year = date.getFullYear();
                    const month = String(date.getMonth() + 1).padStart(2, '0');
                    const day = String(date.getDate()).padStart(2, '0');
                    return `${year}-${month}-${day}`;
                };

                const startInput = document.getElementById('pivotStartDate');
                const endInput = document.getElementById('pivotEndDate');

                if (startInput && endInput) {
                    startInput.value = formatDateForInput(minDate);
                    endInput.value = formatDateForInput(maxDate);
                    pivotStartDate = formatDateForInput(minDate);
                    pivotEndDate = formatDateForInput(maxDate);
                }
            }

            // ì´ˆê¸° í…Œì´ë¸” ë Œë”ë§ (í•„í„° ë¯¸ì„ íƒ ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ)
            renderAgeGenderPivotTable();
        }

        function updatePivotFilterButtonText(filterKey) {
            const filterMap = {
                'channel': 'ì±„ë„',
                'product': 'ì œí’ˆ',
                'brand': 'ë¸Œëœë“œ',
                'promotion': 'í”„ë¡œëª¨ì…˜',
                'adset': 'ê´‘ê³ ì„¸íŠ¸'
            };

            const btn = document.querySelector(`.pivot-filter-dropdown-btn[data-filter="${filterKey}"]`);
            const list = document.getElementById(`pivotFilter${filterKey.charAt(0).toUpperCase() + filterKey.slice(1)}List`);

            if (!btn || !list) return;

            const checkedBoxes = list.querySelectorAll('.pivot-filter-item-checkbox:checked');
            const totalBoxes = list.querySelectorAll('.pivot-filter-item-checkbox');
            const btnText = btn.querySelector('span:first-child');
            const countText = btn.querySelector('.pivot-selected-count');

            if (checkedBoxes.length === 0) {
                btnText.textContent = `${filterMap[filterKey]}_ì „ì²´`;
                if (countText) countText.textContent = '0ê°œ';
            } else if (checkedBoxes.length === totalBoxes.length) {
                btnText.textContent = `${filterMap[filterKey]}_ì „ì²´`;
                if (countText) countText.textContent = `${checkedBoxes.length}ê°œ`;
            } else if (checkedBoxes.length === 1) {
                btnText.textContent = checkedBoxes[0].value;
                if (countText) countText.textContent = '1ê°œ';
            } else {
                btnText.textContent = `${checkedBoxes[0].value} ì™¸ ${checkedBoxes.length - 1}ê°œ`;
                if (countText) countText.textContent = `${checkedBoxes.length}ê°œ`;
            }
        }

        function updatePivotFilters() {
            const filterMap = {
                'channel': 'pivotFilterChannelList',
                'product': 'pivotFilterProductList',
                'brand': 'pivotFilterBrandList',
                'promotion': 'pivotFilterPromotionList',
                'adset': 'pivotFilterAdsetList'
            };

            Object.keys(filterMap).forEach(filterKey => {
                const list = document.getElementById(filterMap[filterKey]);
                if (!list) return;

                const checkedBoxes = list.querySelectorAll('.pivot-filter-item-checkbox:checked');
                currentPivotFilters[filterKey] = Array.from(checkedBoxes).map(cb => cb.value);
            });

            renderAgeGenderPivotTable();
        }

        // ì°¨íŠ¸ ë Œë”ë§ í•¨ìˆ˜ë“¤
        function renderTimeseriesTrendChart() {
            const canvas = document.getElementById('timeseriesTrendChart');
            if (!canvas) return;

            if (timeseriesTrendChart) {
                timeseriesTrendChart.destroy();
            }

            if (!adsetDimensionData) {
                const ctx = canvas.getContext('2d');
                timeseriesTrendChart = new Chart(ctx, {
                    type: 'line',
                    data: { labels: [], datasets: [] },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: true, position: 'top' },
                            title: { display: true, text: 'ë°ì´í„° ë¡œë”© ì¤‘...' }
                        }
                    }
                });
                return;
            }

            const filterMap = {
                'channel': 'ìœ í˜•êµ¬ë¶„',
                'product': 'ìƒí’ˆëª…',
                'brand': 'ë¸Œëœë“œëª…',
                'promotion': 'í”„ë¡œëª¨ì…˜'
            };

            // AND ì—°ì‚°ìœ¼ë¡œ ê´‘ê³ ì„¸íŠ¸ ì°¾ê¸°
            const adsetsToShow = new Set();

            // í•„í„°ê°€ í•˜ë‚˜ë„ ì„ íƒë˜ì§€ ì•Šì€ ê²½ìš° ì²´í¬
            const hasActiveFilters = Object.values(timeseriesFilters).some(arr => arr.length > 0);

            adsetDimensionData.forEach(row => {
                const adset = row['ê´‘ê³ ì„¸íŠ¸'];
                if (!adset || adset === '' || adset === '-') return;

                let matchesAllFilters = true;

                // ê° í•„í„° íƒ€ì…ë³„ë¡œ AND ì—°ì‚°
                Object.keys(filterMap).forEach(filterKey => {
                    const column = filterMap[filterKey];
                    const selectedValues = timeseriesFilters[filterKey];

                    // í•´ë‹¹ í•„í„°ê°€ í™œì„±í™”ë˜ì–´ ìˆê³  ê°’ì´ ì„ íƒëœ ê²½ìš°
                    if (selectedValues && selectedValues.length > 0) {
                        const rowValue = row[column];
                        // ì„ íƒëœ ê°’ ì¤‘ í•˜ë‚˜ë¼ë„ ì¼ì¹˜í•˜ì§€ ì•Šìœ¼ë©´ ì œì™¸
                        if (!selectedValues.includes(rowValue)) {
                            matchesAllFilters = false;
                        }
                    }
                });

                if (matchesAllFilters && row['ì¼']) {
                    adsetsToShow.add(adset);
                }
            });

            if (adsetsToShow.size === 0 || !hasActiveFilters) {
                const ctx = canvas.getContext('2d');
                timeseriesTrendChart = new Chart(ctx, {
                    type: 'line',
                    data: { labels: [], datasets: [] },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: true, position: 'top' },
                            title: { display: true, text: hasActiveFilters ? 'í•„í„° ì¡°ê±´ì— ë§ëŠ” ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤' : 'í•„í„°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”' }
                        }
                    }
                });
                return;
            }

            // ê´‘ê³ ì„¸íŠ¸ë³„ ì¼ë³„ ë°ì´í„° ì§‘ê³„
            const timeSeriesData = {};
            adsetsToShow.forEach(adset => {
                timeSeriesData[adset] = {};
            });

            adsetDimensionData.forEach(row => {
                const adset = row['ê´‘ê³ ì„¸íŠ¸'];
                if (!adsetsToShow.has(adset) || !row['ì¼']) return;

                // AND ì—°ì‚°ìœ¼ë¡œ í•„í„° ì²´í¬
                let matchesAllFilters = true;
                Object.keys(filterMap).forEach(filterKey => {
                    const column = filterMap[filterKey];
                    const selectedValues = timeseriesFilters[filterKey];

                    if (selectedValues && selectedValues.length > 0) {
                        const rowValue = row[column];
                        if (!selectedValues.includes(rowValue)) {
                            matchesAllFilters = false;
                        }
                    }
                });

                if (!matchesAllFilters) return;

                const date = row['ì¼'];

                // ê¸°ê°„ í•„í„°ë§
                if (timeseriesStartDate || timeseriesEndDate) {
                    const rowDate = new Date(date);
                    if (isNaN(rowDate)) return;
                    if (timeseriesStartDate && rowDate < new Date(timeseriesStartDate)) return;
                    if (timeseriesEndDate && rowDate > new Date(timeseriesEndDate)) return;
                }
                const cost = parseFloat(row['ë¹„ìš©']?.replace(/,/g, '') || row['ë¹„ìš©']) || 0;
                const revenue = parseFloat(row['ì „í™˜ê°’']?.replace(/,/g, '') || row['ì „í™˜ê°’']) || 0;
                const conversions = parseFloat(row['ì „í™˜ìˆ˜']?.replace(/,/g, '') || row['ì „í™˜ìˆ˜']) || 0;
                const impressions = parseFloat(row['ë…¸ì¶œ']?.replace(/,/g, '') || row['ë…¸ì¶œ']) || 0;
                const clicks = parseFloat(row['í´ë¦­']?.replace(/,/g, '') || row['í´ë¦­']) || 0;

                if (!timeSeriesData[adset][date]) {
                    timeSeriesData[adset][date] = {
                        cost: 0,
                        revenue: 0,
                        conversions: 0,
                        impressions: 0,
                        clicks: 0
                    };
                }
                timeSeriesData[adset][date].cost += cost;
                timeSeriesData[adset][date].revenue += revenue;
                timeSeriesData[adset][date].conversions += conversions;
                timeSeriesData[adset][date].impressions += impressions;
                timeSeriesData[adset][date].clicks += clicks;
            });

            // ê¸°ê°„ë³„ ì§‘ê³„
            const aggregatedData = {};
            Array.from(adsetsToShow).forEach(adset => {
                aggregatedData[adset] = {};
            });

            Object.keys(timeSeriesData).forEach(adset => {
                Object.keys(timeSeriesData[adset]).forEach(date => {
                    const periodKey = getPeriodKey(date, currentTimeseriesPeriod);
                    if (!aggregatedData[adset][periodKey]) {
                        aggregatedData[adset][periodKey] = {
                            cost: 0,
                            revenue: 0,
                            conversions: 0,
                            impressions: 0,
                            clicks: 0
                        };
                    }
                    aggregatedData[adset][periodKey].cost += timeSeriesData[adset][date].cost;
                    aggregatedData[adset][periodKey].revenue += timeSeriesData[adset][date].revenue;
                    aggregatedData[adset][periodKey].conversions += timeSeriesData[adset][date].conversions;
                    aggregatedData[adset][periodKey].impressions += timeSeriesData[adset][date].impressions;
                    aggregatedData[adset][periodKey].clicks += timeSeriesData[adset][date].clicks;
                });
            });

            // ì„ íƒëœ ì§€í‘œì— ë”°ë¼ ë°ì´í„° ê³„ì‚°
            const metricData = {};
            Object.keys(aggregatedData).forEach(adset => {
                metricData[adset] = {};
                Object.keys(aggregatedData[adset]).forEach(period => {
                    const { cost, revenue, conversions, impressions, clicks } = aggregatedData[adset][period];

                    switch(currentTimeseriesMetric) {
                        case 'roas':
                            metricData[adset][period] = cost > 0 ? (revenue / cost * 100) : 0;
                            break;
                        case 'cost':
                            metricData[adset][period] = cost;
                            break;
                        case 'revenue':
                            metricData[adset][period] = revenue;
                            break;
                        case 'conversions':
                            metricData[adset][period] = conversions;
                            break;
                        case 'impressions':
                            metricData[adset][period] = impressions;
                            break;
                        case 'clicks':
                            metricData[adset][period] = clicks;
                            break;
                        case 'cpm':
                            metricData[adset][period] = impressions > 0 ? (cost / impressions * 1000) : 0;
                            break;
                        case 'cpc':
                            metricData[adset][period] = clicks > 0 ? (cost / clicks) : 0;
                            break;
                        case 'cpa':
                            metricData[adset][period] = conversions > 0 ? (cost / conversions) : 0;
                            break;
                        case 'ctr':
                            metricData[adset][period] = impressions > 0 ? (clicks / impressions * 100) : 0;
                            break;
                        case 'cvr':
                            metricData[adset][period] = clicks > 0 ? (conversions / clicks * 100) : 0;
                            break;
                        default:
                            metricData[adset][period] = 0;
                    }
                });
            });

            // ê¸°ê°„ ì •ë ¬
            const allPeriods = [...new Set(Object.values(metricData).flatMap(data => Object.keys(data)))].sort();

            // ë°ì´í„°ì…‹ ìƒì„±
            const colors = ['#673ab7', '#2196f3', '#4caf50', '#ff9800', '#f44336', '#e91e63', '#009688', '#795548', '#607d8b', '#3f51b5'];
            const adsetArray = Array.from(adsetsToShow).sort();
            const datasets = adsetArray.map((adset, index) => {
                return {
                    label: adset,
                    data: allPeriods.map(period => metricData[adset][period] || 0),
                    borderColor: colors[index % colors.length],
                    backgroundColor: colors[index % colors.length] + '20',
                    borderWidth: 2,
                    tension: 0.3
                };
            });

            const ctx = canvas.getContext('2d');
            timeseriesTrendChart = new Chart(ctx, {
                type: 'line',
                data: { labels: allPeriods, datasets: datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: true, position: 'top' },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const adset = adsetArray[context.datasetIndex];
                                    const period = allPeriods[context.dataIndex];
                                    const data = aggregatedData[adset][period] || {};
                                    const { cost = 0, revenue = 0, conversions = 0, impressions = 0, clicks = 0 } = data;

                                    const roas = cost > 0 ? (revenue / cost * 100) : 0;
                                    const cpm = impressions > 0 ? (cost / impressions * 1000) : 0;
                                    const cpc = clicks > 0 ? (cost / clicks) : 0;
                                    const cpa = conversions > 0 ? (cost / conversions) : 0;
                                    const ctr = impressions > 0 ? (clicks / impressions * 100) : 0;
                                    const cvr = clicks > 0 ? (conversions / clicks * 100) : 0;

                                    const lines = [`${adset}`];

                                    switch(currentTimeseriesMetric) {
                                        case 'roas':
                                            lines.push(`ROAS: ${roas.toFixed(1)}%`);
                                            lines.push(`ë¹„ìš©: ${formatCurrency(cost)}`);
                                            lines.push(`ì „í™˜ê°’: ${formatCurrency(revenue)}`);
                                            break;
                                        case 'cost':
                                            lines.push(`ë¹„ìš©: ${formatCurrency(context.parsed.y)}`);
                                            lines.push(`ROAS: ${roas.toFixed(1)}%`);
                                            break;
                                        case 'revenue':
                                            lines.push(`ì „í™˜ê°’: ${formatCurrency(context.parsed.y)}`);
                                            lines.push(`ë¹„ìš©: ${formatCurrency(cost)}`);
                                            lines.push(`ROAS: ${roas.toFixed(1)}%`);
                                            break;
                                        case 'conversions':
                                            lines.push(`ì „í™˜ìˆ˜: ${conversions.toLocaleString()}ê±´`);
                                            lines.push(`ì „í™˜ìœ¨: ${cvr.toFixed(2)}%`);
                                            break;
                                        case 'impressions':
                                            lines.push(`ë…¸ì¶œìˆ˜: ${impressions.toLocaleString()}íšŒ`);
                                            lines.push(`CTR: ${ctr.toFixed(2)}%`);
                                            break;
                                        case 'clicks':
                                            lines.push(`í´ë¦­ìˆ˜: ${clicks.toLocaleString()}íšŒ`);
                                            lines.push(`CTR: ${ctr.toFixed(2)}%`);
                                            break;
                                        case 'cpm':
                                            lines.push(`CPM: ${formatCurrency(context.parsed.y)}`);
                                            lines.push(`ë…¸ì¶œìˆ˜: ${impressions.toLocaleString()}íšŒ`);
                                            break;
                                        case 'cpc':
                                            lines.push(`CPC: ${formatCurrency(context.parsed.y)}`);
                                            lines.push(`í´ë¦­ìˆ˜: ${clicks.toLocaleString()}íšŒ`);
                                            break;
                                        case 'cpa':
                                            lines.push(`CPA: ${formatCurrency(context.parsed.y)}`);
                                            lines.push(`ì „í™˜ìˆ˜: ${conversions.toLocaleString()}ê±´`);
                                            break;
                                        case 'ctr':
                                            lines.push(`CTR: ${context.parsed.y.toFixed(2)}%`);
                                            lines.push(`í´ë¦­ìˆ˜: ${clicks.toLocaleString()}íšŒ`);
                                            lines.push(`ë…¸ì¶œìˆ˜: ${impressions.toLocaleString()}íšŒ`);
                                            break;
                                        case 'cvr':
                                            lines.push(`ì „í™˜ìœ¨: ${context.parsed.y.toFixed(2)}%`);
                                            lines.push(`ì „í™˜ìˆ˜: ${conversions.toLocaleString()}ê±´`);
                                            lines.push(`í´ë¦­ìˆ˜: ${clicks.toLocaleString()}íšŒ`);
                                            break;
                                    }

                                    return lines;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: (function() {
                                    switch(currentTimeseriesMetric) {
                                        case 'roas': return 'ROAS (%)';
                                        case 'cost': return 'ë¹„ìš© (ì›)';
                                        case 'revenue': return 'ì „í™˜ê°’ (ì›)';
                                        case 'conversions': return 'ì „í™˜ìˆ˜ (ê±´)';
                                        case 'impressions': return 'ë…¸ì¶œìˆ˜ (íšŒ)';
                                        case 'clicks': return 'í´ë¦­ìˆ˜ (íšŒ)';
                                        case 'cpm': return 'CPM (ì›)';
                                        case 'cpc': return 'CPC (ì›)';
                                        case 'cpa': return 'CPA (ì›)';
                                        case 'ctr': return 'CTR (%)';
                                        case 'cvr': return 'ì „í™˜ìœ¨ (%)';
                                        default: return 'ì§€í‘œ';
                                    }
                                })()
                            },
                            ticks: {
                                callback: function(value) {
                                    switch(currentTimeseriesMetric) {
                                        case 'roas':
                                        case 'ctr':
                                        case 'cvr':
                                            return value.toFixed(1) + '%';
                                        case 'cost':
                                        case 'revenue':
                                        case 'cpm':
                                        case 'cpc':
                                        case 'cpa':
                                            return formatCurrency(value);
                                        case 'conversions':
                                        case 'impressions':
                                        case 'clicks':
                                            return value.toLocaleString();
                                        default:
                                            return value;
                                    }
                                }
                            }
                        },
                        x: {
                            title: { display: true, text: 'ê¸°ê°„' }
                        }
                    }
                }
            });
        }

        function renderGenderTrendChart() {
            const canvas = document.getElementById('genderTrendChart');
            if (!canvas) return;

            if (genderTrendChart) {
                genderTrendChart.destroy();
            }

            if (!genderDimensionData) {
                const ctx = canvas.getContext('2d');
                genderTrendChart = new Chart(ctx, {
                    type: 'line',
                    data: { labels: [], datasets: [] },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: true, position: 'top' },
                            title: { display: true, text: 'ë°ì´í„° ë¡œë”© ì¤‘...' }
                        }
                    }
                });
                return;
            }

            const filterMap = {
                'channel': 'ìœ í˜•êµ¬ë¶„',
                'product': 'ìƒí’ˆëª…',
                'brand': 'ë¸Œëœë“œëª…',
                'promotion': 'í”„ë¡œëª¨ì…˜',
                'adset': 'ê´‘ê³ ì„¸íŠ¸'
            };

            // í•„í„° ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” í–‰ë§Œ í•„í„°ë§í•˜ëŠ” í—¬í¼ í•¨ìˆ˜
            const rowMatchesFilters = (row) => {
                // ëª¨ë“  í•„í„°ê°€ ë¹„ì–´ìˆëŠ”ì§€ í™•ì¸
                const allFiltersEmpty = Object.values(currentGenderFilters).every(arr => !arr || arr.length === 0);

                // ëª¨ë“  í•„í„°ê°€ ë¹„ì–´ìˆìœ¼ë©´ false ë°˜í™˜ (ë°ì´í„° í‘œì‹œ ì•ˆ í•¨)
                if (allFiltersEmpty) {
                    return false;
                }

                // ëª¨ë“  í•„í„°ë¥¼ AND ì¡°ê±´ìœ¼ë¡œ í™•ì¸
                for (const filterKey of Object.keys(filterMap)) {
                    const column = filterMap[filterKey];
                    const selectedValues = currentGenderFilters[filterKey];

                    if (selectedValues && selectedValues.length > 0) {
                        const rowValue = row[column];
                        if (!selectedValues.includes(rowValue)) {
                            return false;
                        }
                    }
                }
                return true;
            };

            // ì„±ë³„ ëª©ë¡ ê°€ì ¸ì˜¤ê¸° (ì„±ë³„_í†µí•© ì»¬ëŸ¼ ìš°ì„  ì‚¬ìš©)
            const gendersToShow = new Set();
            genderDimensionData.forEach(row => {
                if (rowMatchesFilters(row)) {
                    const rawGender = row['ì„±ë³„_í†µí•©'] || row['ì„±ë³„'];
                    const normalizedGender = normalizeGender(rawGender);
                    if (normalizedGender) {
                        gendersToShow.add(normalizedGender);
                    }
                }
            });

            // ëª¨ë“  í•„í„°ê°€ ë¹„ì–´ìˆëŠ”ì§€ í™•ì¸
            const allFiltersEmpty = Object.values(currentGenderFilters).every(arr => !arr || arr.length === 0);

            if (allFiltersEmpty || gendersToShow.size === 0) {
                const ctx = canvas.getContext('2d');
                genderTrendChart = new Chart(ctx, {
                    type: 'line',
                    data: { labels: [], datasets: [] },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: true, position: 'top' },
                            title: { display: true, text: allFiltersEmpty ? 'í•„í„°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”' : 'í•„í„° ì¡°ê±´ì— ë§ëŠ” ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤' }
                        }
                    }
                });
                return;
            }

            // ì„±ë³„ë³„ ì¼ë³„ ë°ì´í„° ì§‘ê³„
            const timeSeriesData = {};
            gendersToShow.forEach(gender => {
                timeSeriesData[gender] = {};
            });

            genderDimensionData.forEach(row => {
                if (!rowMatchesFilters(row)) return;

                // ì„±ë³„_í†µí•© ì»¬ëŸ¼ ìš°ì„  ì‚¬ìš©
                const rawGender = row['ì„±ë³„_í†µí•©'] || row['ì„±ë³„'];
                const normalizedGender = normalizeGender(rawGender);

                if (normalizedGender && gendersToShow.has(normalizedGender) && row['ì¼']) {
                    const date = row['ì¼'];

                    // ê¸°ê°„ í•„í„°ë§
                    if (genderStartDate || genderEndDate) {
                        const rowDate = new Date(date);
                        if (isNaN(rowDate)) return;
                        if (genderStartDate && rowDate < new Date(genderStartDate)) return;
                        if (genderEndDate && rowDate > new Date(genderEndDate)) return;
                    }

                    const cost = parseFloat(row['ë¹„ìš©']?.replace(/,/g, '') || row['ë¹„ìš©']) || 0;
                    const revenue = parseFloat(row['ì „í™˜ê°’']?.replace(/,/g, '') || row['ì „í™˜ê°’']) || 0;
                    const conversions = parseFloat(row['ì „í™˜ìˆ˜']?.replace(/,/g, '') || row['ì „í™˜ìˆ˜']) || 0;
                    const impressions = parseFloat(row['ë…¸ì¶œ']?.replace(/,/g, '') || row['ë…¸ì¶œ']) || 0;
                    const clicks = parseFloat(row['í´ë¦­']?.replace(/,/g, '') || row['í´ë¦­']) || 0;

                    if (!timeSeriesData[normalizedGender][date]) {
                        timeSeriesData[normalizedGender][date] = {
                            cost: 0,
                            revenue: 0,
                            conversions: 0,
                            impressions: 0,
                            clicks: 0
                        };
                    }
                    timeSeriesData[normalizedGender][date].cost += cost;
                    timeSeriesData[normalizedGender][date].revenue += revenue;
                    timeSeriesData[normalizedGender][date].conversions += conversions;
                    timeSeriesData[normalizedGender][date].impressions += impressions;
                    timeSeriesData[normalizedGender][date].clicks += clicks;
                }
            });

            // ê¸°ê°„ë³„ ì§‘ê³„
            const aggregatedData = {};
            gendersToShow.forEach(gender => {
                aggregatedData[gender] = {};
            });

            Object.keys(timeSeriesData).forEach(gender => {
                Object.keys(timeSeriesData[gender]).forEach(date => {
                    const periodKey = getPeriodKey(date, currentGenderPeriod);
                    if (!aggregatedData[gender][periodKey]) {
                        aggregatedData[gender][periodKey] = {
                            cost: 0,
                            revenue: 0,
                            conversions: 0,
                            impressions: 0,
                            clicks: 0
                        };
                    }
                    aggregatedData[gender][periodKey].cost += timeSeriesData[gender][date].cost;
                    aggregatedData[gender][periodKey].revenue += timeSeriesData[gender][date].revenue;
                    aggregatedData[gender][periodKey].conversions += timeSeriesData[gender][date].conversions;
                    aggregatedData[gender][periodKey].impressions += timeSeriesData[gender][date].impressions;
                    aggregatedData[gender][periodKey].clicks += timeSeriesData[gender][date].clicks;
                });
            });

            // ì„ íƒëœ ì§€í‘œì— ë”°ë¼ ë°ì´í„° ê³„ì‚°
            const metricData = {};
            Object.keys(aggregatedData).forEach(gender => {
                metricData[gender] = {};
                Object.keys(aggregatedData[gender]).forEach(period => {
                    const { cost, revenue, conversions, impressions, clicks } = aggregatedData[gender][period];

                    switch(currentGenderMetric) {
                        case 'roas':
                            metricData[gender][period] = cost > 0 ? (revenue / cost * 100) : 0;
                            break;
                        case 'cost':
                            metricData[gender][period] = cost;
                            break;
                        case 'revenue':
                            metricData[gender][period] = revenue;
                            break;
                        case 'conversions':
                            metricData[gender][period] = conversions;
                            break;
                        case 'impressions':
                            metricData[gender][period] = impressions;
                            break;
                        case 'clicks':
                            metricData[gender][period] = clicks;
                            break;
                        case 'cpm':
                            metricData[gender][period] = impressions > 0 ? (cost / impressions * 1000) : 0;
                            break;
                        case 'cpc':
                            metricData[gender][period] = clicks > 0 ? (cost / clicks) : 0;
                            break;
                        case 'cpa':
                            metricData[gender][period] = conversions > 0 ? (cost / conversions) : 0;
                            break;
                        case 'ctr':
                            metricData[gender][period] = impressions > 0 ? (clicks / impressions * 100) : 0;
                            break;
                        case 'cvr':
                            metricData[gender][period] = clicks > 0 ? (conversions / clicks * 100) : 0;
                            break;
                        default:
                            metricData[gender][period] = 0;
                    }
                });
            });

            // ê¸°ê°„ ì •ë ¬
            const allPeriods = [...new Set(Object.values(metricData).flatMap(data => Object.keys(data)))].sort();

            // ë°ì´í„°ì…‹ ìƒì„±
            const colors = ['#673ab7', '#2196f3', '#4caf50', '#ff9800', '#f44336'];
            const genderArray = Array.from(gendersToShow).sort();
            const datasets = genderArray.map((gender, index) => {
                return {
                    label: getGenderDisplayName(gender),
                    data: allPeriods.map(period => metricData[gender][period] || 0),
                    borderColor: colors[index % colors.length],
                    backgroundColor: colors[index % colors.length] + '20',
                    borderWidth: 2,
                    tension: 0.3
                };
            });

            const ctx = canvas.getContext('2d');
            genderTrendChart = new Chart(ctx, {
                type: 'line',
                data: { labels: allPeriods, datasets: datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: true, position: 'top' },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const gender = genderArray[context.datasetIndex];
                                    const period = allPeriods[context.dataIndex];
                                    const data = aggregatedData[gender][period] || {};
                                    const { cost = 0, revenue = 0, conversions = 0, impressions = 0, clicks = 0 } = data;

                                    const roas = cost > 0 ? (revenue / cost * 100) : 0;
                                    const cpm = impressions > 0 ? (cost / impressions * 1000) : 0;
                                    const cpc = clicks > 0 ? (cost / clicks) : 0;
                                    const cpa = conversions > 0 ? (cost / conversions) : 0;
                                    const ctr = impressions > 0 ? (clicks / impressions * 100) : 0;
                                    const cvr = clicks > 0 ? (conversions / clicks * 100) : 0;

                                    const lines = [`${getGenderDisplayName(gender)}`];

                                    switch(currentGenderMetric) {
                                        case 'roas':
                                            lines.push(`ROAS: ${roas.toFixed(1)}%`);
                                            lines.push(`ë¹„ìš©: ${formatCurrency(cost)}`);
                                            lines.push(`ì „í™˜ê°’: ${formatCurrency(revenue)}`);
                                            break;
                                        case 'cost':
                                            lines.push(`ë¹„ìš©: ${formatCurrency(context.parsed.y)}`);
                                            lines.push(`ROAS: ${roas.toFixed(1)}%`);
                                            break;
                                        case 'revenue':
                                            lines.push(`ì „í™˜ê°’: ${formatCurrency(context.parsed.y)}`);
                                            lines.push(`ë¹„ìš©: ${formatCurrency(cost)}`);
                                            lines.push(`ROAS: ${roas.toFixed(1)}%`);
                                            break;
                                        case 'conversions':
                                            lines.push(`ì „í™˜ìˆ˜: ${conversions.toLocaleString()}ê±´`);
                                            lines.push(`ì „í™˜ìœ¨: ${cvr.toFixed(2)}%`);
                                            break;
                                        case 'impressions':
                                            lines.push(`ë…¸ì¶œìˆ˜: ${impressions.toLocaleString()}íšŒ`);
                                            lines.push(`CTR: ${ctr.toFixed(2)}%`);
                                            break;
                                        case 'clicks':
                                            lines.push(`í´ë¦­ìˆ˜: ${clicks.toLocaleString()}íšŒ`);
                                            lines.push(`CTR: ${ctr.toFixed(2)}%`);
                                            break;
                                        case 'cpm':
                                            lines.push(`CPM: ${formatCurrency(context.parsed.y)}`);
                                            lines.push(`ë…¸ì¶œìˆ˜: ${impressions.toLocaleString()}íšŒ`);
                                            break;
                                        case 'cpc':
                                            lines.push(`CPC: ${formatCurrency(context.parsed.y)}`);
                                            lines.push(`í´ë¦­ìˆ˜: ${clicks.toLocaleString()}íšŒ`);
                                            break;
                                        case 'cpa':
                                            lines.push(`CPA: ${formatCurrency(context.parsed.y)}`);
                                            lines.push(`ì „í™˜ìˆ˜: ${conversions.toLocaleString()}ê±´`);
                                            break;
                                        case 'ctr':
                                            lines.push(`CTR: ${context.parsed.y.toFixed(2)}%`);
                                            lines.push(`í´ë¦­ìˆ˜: ${clicks.toLocaleString()}íšŒ`);
                                            lines.push(`ë…¸ì¶œìˆ˜: ${impressions.toLocaleString()}íšŒ`);
                                            break;
                                        case 'cvr':
                                            lines.push(`ì „í™˜ìœ¨: ${context.parsed.y.toFixed(2)}%`);
                                            lines.push(`ì „í™˜ìˆ˜: ${conversions.toLocaleString()}ê±´`);
                                            lines.push(`í´ë¦­ìˆ˜: ${clicks.toLocaleString()}íšŒ`);
                                            break;
                                    }

                                    return lines;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: (function() {
                                    switch(currentGenderMetric) {
                                        case 'roas': return 'ROAS (%)';
                                        case 'cost': return 'ë¹„ìš© (ì›)';
                                        case 'revenue': return 'ì „í™˜ê°’ (ì›)';
                                        case 'conversions': return 'ì „í™˜ìˆ˜ (ê±´)';
                                        case 'impressions': return 'ë…¸ì¶œìˆ˜ (íšŒ)';
                                        case 'clicks': return 'í´ë¦­ìˆ˜ (íšŒ)';
                                        case 'cpm': return 'CPM (ì›)';
                                        case 'cpc': return 'CPC (ì›)';
                                        case 'cpa': return 'CPA (ì›)';
                                        case 'ctr': return 'CTR (%)';
                                        case 'cvr': return 'ì „í™˜ìœ¨ (%)';
                                        default: return 'ì§€í‘œ';
                                    }
                                })()
                            },
                            ticks: {
                                callback: function(value) {
                                    switch(currentGenderMetric) {
                                        case 'roas':
                                        case 'ctr':
                                        case 'cvr':
                                            return value.toFixed(1) + '%';
                                        case 'cost':
                                        case 'revenue':
                                        case 'cpm':
                                        case 'cpc':
                                        case 'cpa':
                                            return formatCurrency(value);
                                        case 'conversions':
                                        case 'impressions':
                                        case 'clicks':
                                            return value.toLocaleString();
                                        default:
                                            return value;
                                    }
                                }
                            }
                        },
                        x: {
                            title: { display: true, text: 'ê¸°ê°„' }
                        }
                    }
                }
            });
        }

        function renderAgeTrendChart() {
            const canvas = document.getElementById('ageTrendChart');
            if (!canvas) return;

            if (ageTrendChart) {
                ageTrendChart.destroy();
            }

            if (!ageDimensionData) {
                const ctx = canvas.getContext('2d');
                ageTrendChart = new Chart(ctx, {
                    type: 'line',
                    data: { labels: [], datasets: [] },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: true, position: 'top' },
                            title: { display: true, text: 'ë°ì´í„° ë¡œë”© ì¤‘...' }
                        }
                    }
                });
                return;
            }

            const filterMap = {
                'channel': 'ìœ í˜•êµ¬ë¶„',
                'product': 'ìƒí’ˆëª…',
                'brand': 'ë¸Œëœë“œëª…',
                'promotion': 'í”„ë¡œëª¨ì…˜',
                'adset': 'ê´‘ê³ ì„¸íŠ¸'
            };

            // í•„í„° ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” í–‰ë§Œ í•„í„°ë§í•˜ëŠ” í—¬í¼ í•¨ìˆ˜
            const rowMatchesFilters = (row) => {
                // ëª¨ë“  í•„í„°ê°€ ë¹„ì–´ìˆëŠ”ì§€ í™•ì¸
                const allFiltersEmpty = Object.values(currentAgeFilters).every(arr => !arr || arr.length === 0);

                // ëª¨ë“  í•„í„°ê°€ ë¹„ì–´ìˆìœ¼ë©´ false ë°˜í™˜ (ë°ì´í„° í‘œì‹œ ì•ˆ í•¨)
                if (allFiltersEmpty) {
                    return false;
                }

                // ëª¨ë“  í•„í„°ë¥¼ AND ì¡°ê±´ìœ¼ë¡œ í™•ì¸
                for (const filterKey of Object.keys(filterMap)) {
                    const column = filterMap[filterKey];
                    const selectedValues = currentAgeFilters[filterKey];

                    if (selectedValues && selectedValues.length > 0) {
                        const rowValue = row[column];
                        if (!selectedValues.includes(rowValue)) {
                            return false;
                        }
                    }
                }
                return true;
            };

            // ì—°ë ¹ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
            const agesToShow = new Set();
            ageDimensionData.forEach(row => {
                if (rowMatchesFilters(row)) {
                    const age = row['ì—°ë ¹_í†µí•©'] || row['ì—°ë ¹'];
                    if (age && age !== '' && age !== '-') {
                        agesToShow.add(age);
                    }
                }
            });

            // ëª¨ë“  í•„í„°ê°€ ë¹„ì–´ìˆëŠ”ì§€ í™•ì¸
            const allFiltersEmpty = Object.values(currentAgeFilters).every(arr => !arr || arr.length === 0);

            if (allFiltersEmpty || agesToShow.size === 0) {
                const ctx = canvas.getContext('2d');
                ageTrendChart = new Chart(ctx, {
                    type: 'line',
                    data: { labels: [], datasets: [] },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: true, position: 'top' },
                            title: { display: true, text: allFiltersEmpty ? 'í•„í„°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”' : 'í•„í„° ì¡°ê±´ì— ë§ëŠ” ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤' }
                        }
                    }
                });
                return;
            }

            // ì—°ë ¹ëŒ€ë³„ ì¼ë³„ ë°ì´í„° ì§‘ê³„
            const timeSeriesData = {};
            agesToShow.forEach(age => {
                timeSeriesData[age] = {};
            });

            ageDimensionData.forEach(row => {
                if (!rowMatchesFilters(row)) return;

                const age = row['ì—°ë ¹_í†µí•©'] || row['ì—°ë ¹'];

                if (agesToShow.has(age) && row['ì¼']) {
                    const date = row['ì¼'];

                    // ê¸°ê°„ í•„í„°ë§
                    if (ageStartDate || ageEndDate) {
                        const rowDate = new Date(date);
                        if (isNaN(rowDate)) return;
                        if (ageStartDate && rowDate < new Date(ageStartDate)) return;
                        if (ageEndDate && rowDate > new Date(ageEndDate)) return;
                    }

                    const cost = parseFloat(row['ë¹„ìš©']?.replace(/,/g, '') || row['ë¹„ìš©']) || 0;
                    const revenue = parseFloat(row['ì „í™˜ê°’']?.replace(/,/g, '') || row['ì „í™˜ê°’']) || 0;
                    const conversions = parseFloat(row['ì „í™˜ìˆ˜']?.replace(/,/g, '') || row['ì „í™˜ìˆ˜']) || 0;
                    const impressions = parseFloat(row['ë…¸ì¶œ']?.replace(/,/g, '') || row['ë…¸ì¶œ']) || 0;
                    const clicks = parseFloat(row['í´ë¦­']?.replace(/,/g, '') || row['í´ë¦­']) || 0;

                    if (!timeSeriesData[age][date]) {
                        timeSeriesData[age][date] = {
                            cost: 0,
                            revenue: 0,
                            conversions: 0,
                            impressions: 0,
                            clicks: 0
                        };
                    }
                    timeSeriesData[age][date].cost += cost;
                    timeSeriesData[age][date].revenue += revenue;
                    timeSeriesData[age][date].conversions += conversions;
                    timeSeriesData[age][date].impressions += impressions;
                    timeSeriesData[age][date].clicks += clicks;
                }
            });

            // ê¸°ê°„ë³„ ì§‘ê³„
            const aggregatedData = {};
            agesToShow.forEach(age => {
                aggregatedData[age] = {};
            });

            Object.keys(timeSeriesData).forEach(age => {
                Object.keys(timeSeriesData[age]).forEach(date => {
                    const periodKey = getPeriodKey(date, currentAgePeriod);
                    if (!aggregatedData[age][periodKey]) {
                        aggregatedData[age][periodKey] = {
                            cost: 0,
                            revenue: 0,
                            conversions: 0,
                            impressions: 0,
                            clicks: 0
                        };
                    }
                    aggregatedData[age][periodKey].cost += timeSeriesData[age][date].cost;
                    aggregatedData[age][periodKey].revenue += timeSeriesData[age][date].revenue;
                    aggregatedData[age][periodKey].conversions += timeSeriesData[age][date].conversions;
                    aggregatedData[age][periodKey].impressions += timeSeriesData[age][date].impressions;
                    aggregatedData[age][periodKey].clicks += timeSeriesData[age][date].clicks;
                });
            });

            // ì„ íƒëœ ì§€í‘œì— ë”°ë¼ ë°ì´í„° ê³„ì‚°
            const metricData = {};
            Object.keys(aggregatedData).forEach(age => {
                metricData[age] = {};
                Object.keys(aggregatedData[age]).forEach(period => {
                    const { cost, revenue, conversions, impressions, clicks } = aggregatedData[age][period];

                    switch(currentAgeMetric) {
                        case 'roas':
                            metricData[age][period] = cost > 0 ? (revenue / cost * 100) : 0;
                            break;
                        case 'cost':
                            metricData[age][period] = cost;
                            break;
                        case 'revenue':
                            metricData[age][period] = revenue;
                            break;
                        case 'conversions':
                            metricData[age][period] = conversions;
                            break;
                        case 'impressions':
                            metricData[age][period] = impressions;
                            break;
                        case 'clicks':
                            metricData[age][period] = clicks;
                            break;
                        case 'cpm':
                            metricData[age][period] = impressions > 0 ? (cost / impressions * 1000) : 0;
                            break;
                        case 'cpc':
                            metricData[age][period] = clicks > 0 ? (cost / clicks) : 0;
                            break;
                        case 'cpa':
                            metricData[age][period] = conversions > 0 ? (cost / conversions) : 0;
                            break;
                        case 'ctr':
                            metricData[age][period] = impressions > 0 ? (clicks / impressions * 100) : 0;
                            break;
                        case 'cvr':
                            metricData[age][period] = clicks > 0 ? (conversions / clicks * 100) : 0;
                            break;
                        default:
                            metricData[age][period] = 0;
                    }
                });
            });

            // ê¸°ê°„ ì •ë ¬
            const allPeriods = [...new Set(Object.values(metricData).flatMap(data => Object.keys(data)))].sort();

            // ë°ì´í„°ì…‹ ìƒì„±
            const colors = ['#673ab7', '#2196f3', '#4caf50', '#ff9800', '#f44336'];
            const ageArray = Array.from(agesToShow).sort();
            const datasets = ageArray.map((age, index) => {
                return {
                    label: age,
                    data: allPeriods.map(period => metricData[age][period] || 0),
                    borderColor: colors[index % colors.length],
                    backgroundColor: colors[index % colors.length] + '20',
                    borderWidth: 2,
                    tension: 0.3
                };
            });

            const ctx = canvas.getContext('2d');
            ageTrendChart = new Chart(ctx, {
                type: 'line',
                data: { labels: allPeriods, datasets: datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: true, position: 'top' },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const age = ageArray[context.datasetIndex];
                                    const period = allPeriods[context.dataIndex];
                                    const data = aggregatedData[age][period] || {};
                                    const { cost = 0, revenue = 0, conversions = 0, impressions = 0, clicks = 0 } = data;

                                    const roas = cost > 0 ? (revenue / cost * 100) : 0;
                                    const cpm = impressions > 0 ? (cost / impressions * 1000) : 0;
                                    const cpc = clicks > 0 ? (cost / clicks) : 0;
                                    const cpa = conversions > 0 ? (cost / conversions) : 0;
                                    const ctr = impressions > 0 ? (clicks / impressions * 100) : 0;
                                    const cvr = clicks > 0 ? (conversions / clicks * 100) : 0;

                                    const lines = [`${age}`];

                                    switch(currentAgeMetric) {
                                        case 'roas':
                                            lines.push(`ROAS: ${roas.toFixed(1)}%`);
                                            lines.push(`ë¹„ìš©: ${formatCurrency(cost)}`);
                                            lines.push(`ì „í™˜ê°’: ${formatCurrency(revenue)}`);
                                            break;
                                        case 'cost':
                                            lines.push(`ë¹„ìš©: ${formatCurrency(context.parsed.y)}`);
                                            lines.push(`ROAS: ${roas.toFixed(1)}%`);
                                            break;
                                        case 'revenue':
                                            lines.push(`ì „í™˜ê°’: ${formatCurrency(context.parsed.y)}`);
                                            lines.push(`ë¹„ìš©: ${formatCurrency(cost)}`);
                                            lines.push(`ROAS: ${roas.toFixed(1)}%`);
                                            break;
                                        case 'conversions':
                                            lines.push(`ì „í™˜ìˆ˜: ${conversions.toLocaleString()}ê±´`);
                                            lines.push(`ì „í™˜ìœ¨: ${cvr.toFixed(2)}%`);
                                            break;
                                        case 'impressions':
                                            lines.push(`ë…¸ì¶œìˆ˜: ${impressions.toLocaleString()}íšŒ`);
                                            lines.push(`CTR: ${ctr.toFixed(2)}%`);
                                            break;
                                        case 'clicks':
                                            lines.push(`í´ë¦­ìˆ˜: ${clicks.toLocaleString()}íšŒ`);
                                            lines.push(`CTR: ${ctr.toFixed(2)}%`);
                                            break;
                                        case 'cpm':
                                            lines.push(`CPM: ${formatCurrency(context.parsed.y)}`);
                                            lines.push(`ë…¸ì¶œìˆ˜: ${impressions.toLocaleString()}íšŒ`);
                                            break;
                                        case 'cpc':
                                            lines.push(`CPC: ${formatCurrency(context.parsed.y)}`);
                                            lines.push(`í´ë¦­ìˆ˜: ${clicks.toLocaleString()}íšŒ`);
                                            break;
                                        case 'cpa':
                                            lines.push(`CPA: ${formatCurrency(context.parsed.y)}`);
                                            lines.push(`ì „í™˜ìˆ˜: ${conversions.toLocaleString()}ê±´`);
                                            break;
                                        case 'ctr':
                                            lines.push(`CTR: ${context.parsed.y.toFixed(2)}%`);
                                            lines.push(`í´ë¦­ìˆ˜: ${clicks.toLocaleString()}íšŒ`);
                                            lines.push(`ë…¸ì¶œìˆ˜: ${impressions.toLocaleString()}íšŒ`);
                                            break;
                                        case 'cvr':
                                            lines.push(`ì „í™˜ìœ¨: ${context.parsed.y.toFixed(2)}%`);
                                            lines.push(`ì „í™˜ìˆ˜: ${conversions.toLocaleString()}ê±´`);
                                            lines.push(`í´ë¦­ìˆ˜: ${clicks.toLocaleString()}íšŒ`);
                                            break;
                                    }

                                    return lines;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: (function() {
                                    switch(currentAgeMetric) {
                                        case 'roas': return 'ROAS (%)';
                                        case 'cost': return 'ë¹„ìš© (ì›)';
                                        case 'revenue': return 'ì „í™˜ê°’ (ì›)';
                                        case 'conversions': return 'ì „í™˜ìˆ˜ (ê±´)';
                                        case 'impressions': return 'ë…¸ì¶œìˆ˜ (íšŒ)';
                                        case 'clicks': return 'í´ë¦­ìˆ˜ (íšŒ)';
                                        case 'cpm': return 'CPM (ì›)';
                                        case 'cpc': return 'CPC (ì›)';
                                        case 'cpa': return 'CPA (ì›)';
                                        case 'ctr': return 'CTR (%)';
                                        case 'cvr': return 'ì „í™˜ìœ¨ (%)';
                                        default: return 'ì§€í‘œ';
                                    }
                                })()
                            },
                            ticks: {
                                callback: function(value) {
                                    switch(currentAgeMetric) {
                                        case 'roas':
                                        case 'ctr':
                                        case 'cvr':
                                            return value.toFixed(1) + '%';
                                        case 'cost':
                                        case 'revenue':
                                        case 'cpm':
                                        case 'cpc':
                                        case 'cpa':
                                            return formatCurrency(value);
                                        case 'conversions':
                                        case 'impressions':
                                        case 'clicks':
                                            return value.toLocaleString();
                                        default:
                                            return value;
                                    }
                                }
                            }
                        },
                        x: {
                            title: { display: true, text: 'ê¸°ê°„' }
                        }
                    }
                }
            });
        }

        function renderPlatformTrendChart() {
            const canvas = document.getElementById('platformTrendChart');
            if (!canvas) return;

            if (platformTrendChart) {
                platformTrendChart.destroy();
            }

            if (!platformDimensionData) {
                const ctx = canvas.getContext('2d');
                platformTrendChart = new Chart(ctx, {
                    type: 'line',
                    data: { labels: [], datasets: [] },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: true, position: 'top' },
                            title: { display: true, text: 'ë°ì´í„° ë¡œë”© ì¤‘...' }
                        }
                    }
                });
                return;
            }

            const filterMap = {
                'channel': 'ìœ í˜•êµ¬ë¶„',
                'product': 'ìƒí’ˆëª…',
                'brand': 'ë¸Œëœë“œëª…',
                'promotion': 'í”„ë¡œëª¨ì…˜',
                'adset': 'ê´‘ê³ ì„¸íŠ¸'
            };

            // í•„í„° ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” í–‰ë§Œ í•„í„°ë§í•˜ëŠ” í—¬í¼ í•¨ìˆ˜
            const rowMatchesFilters = (row) => {
                // ëª¨ë“  í•„í„°ê°€ ë¹„ì–´ìˆëŠ”ì§€ í™•ì¸
                const allFiltersEmpty = Object.values(currentPlatformFilters).every(arr => !arr || arr.length === 0);

                // ëª¨ë“  í•„í„°ê°€ ë¹„ì–´ìˆìœ¼ë©´ false ë°˜í™˜ (ë°ì´í„° í‘œì‹œ ì•ˆ í•¨)
                if (allFiltersEmpty) {
                    return false;
                }

                // ëª¨ë“  í•„í„°ë¥¼ AND ì¡°ê±´ìœ¼ë¡œ í™•ì¸
                for (const filterKey of Object.keys(filterMap)) {
                    const column = filterMap[filterKey];
                    const selectedValues = currentPlatformFilters[filterKey];

                    if (selectedValues && selectedValues.length > 0) {
                        const rowValue = row[column];
                        if (!selectedValues.includes(rowValue)) {
                            return false;
                        }
                    }
                }
                return true;
            };

            // í”Œë«í¼ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
            const platformsToShow = new Set();
            platformDimensionData.forEach(row => {
                if (rowMatchesFilters(row)) {
                    const platform = row['í”Œë«í¼'];
                    if (platform && platform !== '' && platform !== '-') {
                        platformsToShow.add(platform);
                    }
                }
            });

            // ëª¨ë“  í•„í„°ê°€ ë¹„ì–´ìˆëŠ”ì§€ í™•ì¸
            const allFiltersEmpty = Object.values(currentPlatformFilters).every(arr => !arr || arr.length === 0);

            if (allFiltersEmpty || platformsToShow.size === 0) {
                const ctx = canvas.getContext('2d');
                platformTrendChart = new Chart(ctx, {
                    type: 'line',
                    data: { labels: [], datasets: [] },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: true, position: 'top' },
                            title: { display: true, text: allFiltersEmpty ? 'í•„í„°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”' : 'í•„í„° ì¡°ê±´ì— ë§ëŠ” ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤' }
                        }
                    }
                });
                return;
            }

            // í”Œë«í¼ë³„ ì¼ë³„ ë°ì´í„° ì§‘ê³„
            const timeSeriesData = {};
            platformsToShow.forEach(platform => {
                timeSeriesData[platform] = {};
            });

            platformDimensionData.forEach(row => {
                if (!rowMatchesFilters(row)) return;

                const platform = row['í”Œë«í¼'];
                if (platformsToShow.has(platform) && row['ì¼']) {
                    const date = row['ì¼'];

                    // ê¸°ê°„ í•„í„°ë§
                    if (platformStartDate || platformEndDate) {
                        const rowDate = new Date(date);
                        if (isNaN(rowDate)) return;
                        if (platformStartDate && rowDate < new Date(platformStartDate)) return;
                        if (platformEndDate && rowDate > new Date(platformEndDate)) return;
                    }

                    const cost = parseFloat(row['ë¹„ìš©']?.replace(/,/g, '') || row['ë¹„ìš©']) || 0;
                    const revenue = parseFloat(row['ì „í™˜ê°’']?.replace(/,/g, '') || row['ì „í™˜ê°’']) || 0;
                    const conversions = parseFloat(row['ì „í™˜ìˆ˜']?.replace(/,/g, '') || row['ì „í™˜ìˆ˜']) || 0;
                    const impressions = parseFloat(row['ë…¸ì¶œ']?.replace(/,/g, '') || row['ë…¸ì¶œ']) || 0;
                    const clicks = parseFloat(row['í´ë¦­']?.replace(/,/g, '') || row['í´ë¦­']) || 0;

                    if (!timeSeriesData[platform][date]) {
                        timeSeriesData[platform][date] = {
                            cost: 0,
                            revenue: 0,
                            conversions: 0,
                            impressions: 0,
                            clicks: 0
                        };
                    }
                    timeSeriesData[platform][date].cost += cost;
                    timeSeriesData[platform][date].revenue += revenue;
                    timeSeriesData[platform][date].conversions += conversions;
                    timeSeriesData[platform][date].impressions += impressions;
                    timeSeriesData[platform][date].clicks += clicks;
                }
            });

            // ê¸°ê°„ë³„ ì§‘ê³„
            const aggregatedData = {};
            platformsToShow.forEach(platform => {
                aggregatedData[platform] = {};
            });

            Object.keys(timeSeriesData).forEach(platform => {
                Object.keys(timeSeriesData[platform]).forEach(date => {
                    const periodKey = getPeriodKey(date, currentPlatformPeriod);
                    if (!aggregatedData[platform][periodKey]) {
                        aggregatedData[platform][periodKey] = {
                            cost: 0,
                            revenue: 0,
                            conversions: 0,
                            impressions: 0,
                            clicks: 0
                        };
                    }
                    aggregatedData[platform][periodKey].cost += timeSeriesData[platform][date].cost;
                    aggregatedData[platform][periodKey].revenue += timeSeriesData[platform][date].revenue;
                    aggregatedData[platform][periodKey].conversions += timeSeriesData[platform][date].conversions;
                    aggregatedData[platform][periodKey].impressions += timeSeriesData[platform][date].impressions;
                    aggregatedData[platform][periodKey].clicks += timeSeriesData[platform][date].clicks;
                });
            });

            // ì„ íƒëœ ì§€í‘œì— ë”°ë¼ ë°ì´í„° ê³„ì‚°
            const metricData = {};
            Object.keys(aggregatedData).forEach(platform => {
                metricData[platform] = {};
                Object.keys(aggregatedData[platform]).forEach(period => {
                    const { cost, revenue, conversions, impressions, clicks } = aggregatedData[platform][period];

                    switch(currentPlatformMetric) {
                        case 'roas':
                            metricData[platform][period] = cost > 0 ? (revenue / cost * 100) : 0;
                            break;
                        case 'cost':
                            metricData[platform][period] = cost;
                            break;
                        case 'revenue':
                            metricData[platform][period] = revenue;
                            break;
                        case 'conversions':
                            metricData[platform][period] = conversions;
                            break;
                        case 'impressions':
                            metricData[platform][period] = impressions;
                            break;
                        case 'clicks':
                            metricData[platform][period] = clicks;
                            break;
                        case 'cpm':
                            metricData[platform][period] = impressions > 0 ? (cost / impressions * 1000) : 0;
                            break;
                        case 'cpc':
                            metricData[platform][period] = clicks > 0 ? (cost / clicks) : 0;
                            break;
                        case 'cpa':
                            metricData[platform][period] = conversions > 0 ? (cost / conversions) : 0;
                            break;
                        case 'ctr':
                            metricData[platform][period] = impressions > 0 ? (clicks / impressions * 100) : 0;
                            break;
                        case 'cvr':
                            metricData[platform][period] = clicks > 0 ? (conversions / clicks * 100) : 0;
                            break;
                        default:
                            metricData[platform][period] = 0;
                    }
                });
            });

            // ê¸°ê°„ ì •ë ¬
            const allPeriods = [...new Set(Object.values(metricData).flatMap(data => Object.keys(data)))].sort();

            // ë°ì´í„°ì…‹ ìƒì„±
            const colors = ['#673ab7', '#2196f3', '#4caf50', '#ff9800', '#f44336'];
            const platformArray = Array.from(platformsToShow).sort();
            const datasets = platformArray.map((platform, index) => {
                return {
                    label: platform,
                    data: allPeriods.map(period => metricData[platform][period] || 0),
                    borderColor: colors[index % colors.length],
                    backgroundColor: colors[index % colors.length] + '20',
                    borderWidth: 2,
                    tension: 0.3
                };
            });

            const ctx = canvas.getContext('2d');
            platformTrendChart = new Chart(ctx, {
                type: 'line',
                data: { labels: allPeriods, datasets: datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: true, position: 'top' },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const platform = platformArray[context.datasetIndex];
                                    const period = allPeriods[context.dataIndex];
                                    const data = aggregatedData[platform][period] || {};
                                    const { cost = 0, revenue = 0, conversions = 0, impressions = 0, clicks = 0 } = data;

                                    const roas = cost > 0 ? (revenue / cost * 100) : 0;
                                    const cpm = impressions > 0 ? (cost / impressions * 1000) : 0;
                                    const cpc = clicks > 0 ? (cost / clicks) : 0;
                                    const cpa = conversions > 0 ? (cost / conversions) : 0;
                                    const ctr = impressions > 0 ? (clicks / impressions * 100) : 0;
                                    const cvr = clicks > 0 ? (conversions / clicks * 100) : 0;

                                    const lines = [`${platform}`];

                                    switch(currentPlatformMetric) {
                                        case 'roas':
                                            lines.push(`ROAS: ${roas.toFixed(1)}%`);
                                            lines.push(`ë¹„ìš©: ${formatCurrency(cost)}`);
                                            lines.push(`ì „í™˜ê°’: ${formatCurrency(revenue)}`);
                                            break;
                                        case 'cost':
                                            lines.push(`ë¹„ìš©: ${formatCurrency(context.parsed.y)}`);
                                            lines.push(`ROAS: ${roas.toFixed(1)}%`);
                                            break;
                                        case 'revenue':
                                            lines.push(`ì „í™˜ê°’: ${formatCurrency(context.parsed.y)}`);
                                            lines.push(`ë¹„ìš©: ${formatCurrency(cost)}`);
                                            lines.push(`ROAS: ${roas.toFixed(1)}%`);
                                            break;
                                        case 'conversions':
                                            lines.push(`ì „í™˜ìˆ˜: ${conversions.toLocaleString()}ê±´`);
                                            lines.push(`ì „í™˜ìœ¨: ${cvr.toFixed(2)}%`);
                                            break;
                                        case 'impressions':
                                            lines.push(`ë…¸ì¶œìˆ˜: ${impressions.toLocaleString()}íšŒ`);
                                            lines.push(`CTR: ${ctr.toFixed(2)}%`);
                                            break;
                                        case 'clicks':
                                            lines.push(`í´ë¦­ìˆ˜: ${clicks.toLocaleString()}íšŒ`);
                                            lines.push(`CTR: ${ctr.toFixed(2)}%`);
                                            break;
                                        case 'cpm':
                                            lines.push(`CPM: ${formatCurrency(context.parsed.y)}`);
                                            lines.push(`ë…¸ì¶œìˆ˜: ${impressions.toLocaleString()}íšŒ`);
                                            break;
                                        case 'cpc':
                                            lines.push(`CPC: ${formatCurrency(context.parsed.y)}`);
                                            lines.push(`í´ë¦­ìˆ˜: ${clicks.toLocaleString()}íšŒ`);
                                            break;
                                        case 'cpa':
                                            lines.push(`CPA: ${formatCurrency(context.parsed.y)}`);
                                            lines.push(`ì „í™˜ìˆ˜: ${conversions.toLocaleString()}ê±´`);
                                            break;
                                        case 'ctr':
                                            lines.push(`CTR: ${context.parsed.y.toFixed(2)}%`);
                                            lines.push(`í´ë¦­ìˆ˜: ${clicks.toLocaleString()}íšŒ`);
                                            lines.push(`ë…¸ì¶œìˆ˜: ${impressions.toLocaleString()}íšŒ`);
                                            break;
                                        case 'cvr':
                                            lines.push(`ì „í™˜ìœ¨: ${context.parsed.y.toFixed(2)}%`);
                                            lines.push(`ì „í™˜ìˆ˜: ${conversions.toLocaleString()}ê±´`);
                                            lines.push(`í´ë¦­ìˆ˜: ${clicks.toLocaleString()}íšŒ`);
                                            break;
                                    }

                                    return lines;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: (function() {
                                    switch(currentPlatformMetric) {
                                        case 'roas': return 'ROAS (%)';
                                        case 'cost': return 'ë¹„ìš© (ì›)';
                                        case 'revenue': return 'ì „í™˜ê°’ (ì›)';
                                        case 'conversions': return 'ì „í™˜ìˆ˜ (ê±´)';
                                        case 'impressions': return 'ë…¸ì¶œìˆ˜ (íšŒ)';
                                        case 'clicks': return 'í´ë¦­ìˆ˜ (íšŒ)';
                                        case 'cpm': return 'CPM (ì›)';
                                        case 'cpc': return 'CPC (ì›)';
                                        case 'cpa': return 'CPA (ì›)';
                                        case 'ctr': return 'CTR (%)';
                                        case 'cvr': return 'ì „í™˜ìœ¨ (%)';
                                        default: return 'ì§€í‘œ';
                                    }
                                })()
                            },
                            ticks: {
                                callback: function(value) {
                                    switch(currentPlatformMetric) {
                                        case 'roas':
                                        case 'ctr':
                                        case 'cvr':
                                            return value.toFixed(1) + '%';
                                        case 'cost':
                                        case 'revenue':
                                        case 'cpm':
                                        case 'cpc':
                                        case 'cpa':
                                            return formatCurrency(value);
                                        case 'conversions':
                                        case 'impressions':
                                        case 'clicks':
                                            return value.toLocaleString();
                                        default:
                                            return value;
                                    }
                                }
                            }
                        },
                        x: {
                            title: { display: true, text: 'ê¸°ê°„' }
                        }
                    }
                }
            });
        }

        // ê¸°ê¸°í”Œë«í¼ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”
        let devicePlatformDropdownsInitialized = false;

        function initDevicePlatformDropdowns() {
            if (!devicePlatformDimensionData) return;

            const filterMap = {
                'channel': { column: 'ìœ í˜•êµ¬ë¶„', listId: 'deviceplatformFilterChannelList', label: 'ì±„ë„' },
                'product': { column: 'ìƒí’ˆëª…', listId: 'deviceplatformFilterProductList', label: 'ì œí’ˆ' },
                'brand': { column: 'ë¸Œëœë“œëª…', listId: 'deviceplatformFilterBrandList', label: 'ë¸Œëœë“œ' },
                'promotion': { column: 'í”„ë¡œëª¨ì…˜', listId: 'deviceplatformFilterPromotionList', label: 'í”„ë¡œëª¨ì…˜' },
                'adset': { column: 'ê´‘ê³ ì„¸íŠ¸', listId: 'deviceplatformFilterAdsetList', label: 'ê´‘ê³ ì„¸íŠ¸' }
            };

            // ê° í•„í„°ì— ëŒ€í•œ ì²´í¬ë°•ìŠ¤ ë¦¬ìŠ¤íŠ¸ ìƒì„±
            Object.keys(filterMap).forEach(filterKey => {
                const { column, listId } = filterMap[filterKey];
                const list = document.getElementById(listId);
                if (!list) return;

                const items = [...new Set(devicePlatformDimensionData.map(row => row[column]).filter(v => v && v !== '' && v !== '-'))];
                items.sort();

                list.innerHTML = items.map(item => `
                    <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-size: 12px; border-radius: 4px; transition: background 0.2s;" onmouseover="this.style.background='var(--grey-100)'" onmouseout="this.style.background='transparent'">
                        <input type="checkbox" class="device-platform-filter-item-checkbox" data-filter="${filterKey}" value="${item}" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                        ${item}
                    </label>
                `).join('');

                // ê°œë³„ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
                list.querySelectorAll('.device-platform-filter-item-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', function() {
                        // ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸
                        const selectAllCheckbox = document.querySelector(`.deviceplatform-filter-select-all[data-filter="${filterKey}"]`);
                        if (selectAllCheckbox) {
                            const allCheckboxes = list.querySelectorAll('.device-platform-filter-item-checkbox');
                            const checkedCheckboxes = list.querySelectorAll('.device-platform-filter-item-checkbox:checked');
                            selectAllCheckbox.checked = allCheckboxes.length === checkedCheckboxes.length && allCheckboxes.length > 0;
                        }

                        updateDevicePlatformFilters();
                        updateDevicePlatformFilterButtonText(filterKey);
                    });
                });
            });

            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆëŠ” í•œ ë²ˆë§Œ ë“±ë¡
            if (!devicePlatformDropdownsInitialized) {
                // ë“œë¡­ë‹¤ìš´ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
                document.querySelectorAll('.deviceplatform-filter-dropdown-btn').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const filterType = this.dataset.filter;
                        const dropdown = document.querySelector(`.deviceplatform-filter-dropdown-list[data-filter="${filterType}"]`);

                        // ë‹¤ë¥¸ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
                        document.querySelectorAll('.deviceplatform-filter-dropdown-list').forEach(dd => {
                            if (dd !== dropdown) dd.style.display = 'none';
                        });

                        // í˜„ì¬ ë“œë¡­ë‹¤ìš´ í† ê¸€
                        if (dropdown) {
                            dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
                        }
                    });
                });

                // ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
                document.querySelectorAll('.deviceplatform-filter-select-all').forEach(checkbox => {
                    checkbox.addEventListener('change', function() {
                        const filterType = this.dataset.filter;
                        const list = document.getElementById(`deviceplatformFilter${filterType.charAt(0).toUpperCase() + filterType.slice(1)}List`);
                        if (!list) return;

                        const itemCheckboxes = list.querySelectorAll('.device-platform-filter-item-checkbox');
                        itemCheckboxes.forEach(cb => {
                            cb.checked = this.checked;
                        });

                        updateDevicePlatformFilters();
                        updateDevicePlatformFilterButtonText(filterType);
                    });
                });

                devicePlatformDropdownsInitialized = true;
            }

            // ê¸°ê°„ ì„ íƒ ì´ˆê¸°ê°’ ì„¤ì • (ì „ì²´ ë°ì´í„°ì˜ ìµœì†Œ/ìµœëŒ€ ë‚ ì§œ)
            const dates = dimensionData
                .map(row => row['ì¼'])
                .filter(date => date && date !== '' && date !== '-')
                .map(date => new Date(date))
                .filter(date => !isNaN(date));

            if (dates.length > 0) {
                const minDate = new Date(Math.min(...dates));
                const maxDate = new Date(Math.max(...dates));

                const formatDateForInput = (date) => {
                    const year = date.getFullYear();
                    const month = String(date.getMonth() + 1).padStart(2, '0');
                    const day = String(date.getDate()).padStart(2, '0');
                    return `${year}-${month}-${day}`;
                };

                const startInput = document.getElementById('devicePlatformStartDate');
                const endInput = document.getElementById('devicePlatformEndDate');

                if (startInput && endInput) {
                    startInput.value = formatDateForInput(minDate);
                    endInput.value = formatDateForInput(maxDate);
                    devicePlatformStartDate = formatDateForInput(minDate);
                    devicePlatformEndDate = formatDateForInput(maxDate);
                }
            }

            // ì´ˆê¸° ì°¨íŠ¸ ë Œë”ë§ (í•„í„° ë¯¸ì„ íƒ ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ)
            updateDevicePlatformFilters();
            renderDevicePlatformTrendChart();
        }

        function updateDevicePlatformFilterButtonText(filterKey) {
            const filterMap = {
                'channel': 'ì±„ë„',
                'product': 'ì œí’ˆ',
                'brand': 'ë¸Œëœë“œ',
                'promotion': 'í”„ë¡œëª¨ì…˜',
                'adset': 'ê´‘ê³ ì„¸íŠ¸'
            };

            const btn = document.querySelector(`.deviceplatform-filter-dropdown-btn[data-filter="${filterKey}"]`);
            const list = document.getElementById(`deviceplatformFilter${filterKey.charAt(0).toUpperCase() + filterKey.slice(1)}List`);

            if (!btn || !list) return;

            const checkedBoxes = list.querySelectorAll('.device-platform-filter-item-checkbox:checked');
            const totalBoxes = list.querySelectorAll('.device-platform-filter-item-checkbox');
            const btnText = btn.querySelector('span:first-child');
            const countText = btn.querySelector('.deviceplatform-selected-count');

            if (checkedBoxes.length === 0) {
                btnText.textContent = `${filterMap[filterKey]}_ì „ì²´`;
                countText.textContent = '';
            } else if (checkedBoxes.length === totalBoxes.length) {
                btnText.textContent = `${filterMap[filterKey]}_ì „ì²´`;
                countText.textContent = `(${checkedBoxes.length})`;
            } else if (checkedBoxes.length === 1) {
                btnText.textContent = checkedBoxes[0].value;
                countText.textContent = '';
            } else {
                btnText.textContent = `${checkedBoxes[0].value} ì™¸`;
                countText.textContent = `(${checkedBoxes.length})`;
            }
        }

        // ì „ì—­ í•„í„° ìƒíƒœ ì €ì¥
        let currentDevicePlatformFilters = {
            channel: [],
            product: [],
            brand: [],
            promotion: [],
            adset: []
        };

        function updateDevicePlatformFilters() {
            if (!devicePlatformDimensionData) return;

            const filterMap = {
                'channel': { column: 'ìœ í˜•êµ¬ë¶„', listId: 'deviceplatformFilterChannelList' },
                'product': { column: 'ìƒí’ˆëª…', listId: 'deviceplatformFilterProductList' },
                'brand': { column: 'ë¸Œëœë“œëª…', listId: 'deviceplatformFilterBrandList' },
                'promotion': { column: 'í”„ë¡œëª¨ì…˜', listId: 'deviceplatformFilterPromotionList' },
                'adset': { column: 'ê´‘ê³ ì„¸íŠ¸', listId: 'deviceplatformFilterAdsetList' }
            };

            // ì„ íƒëœ í•„í„° ê°’ ìˆ˜ì§‘
            Object.keys(filterMap).forEach(filterKey => {
                const { listId } = filterMap[filterKey];
                const list = document.getElementById(listId);

                if (list) {
                    const checkedBoxes = list.querySelectorAll('.device-platform-filter-item-checkbox:checked');
                    currentDevicePlatformFilters[filterKey] = Array.from(checkedBoxes).map(cb => cb.value);
                } else {
                    currentDevicePlatformFilters[filterKey] = [];
                }
            });

            // ëª¨ë“  í•„í„°ê°€ ë¹„ì–´ìˆëŠ”ì§€ í™•ì¸
            const allFiltersEmpty = Object.values(currentDevicePlatformFilters).every(arr => arr.length === 0);

            if (allFiltersEmpty) {
                // ëª¨ë“  í•„í„°ê°€ í•´ì œë˜ë©´ í•„í„° ìƒíƒœ ì´ˆê¸°í™”
                currentDevicePlatformFilters = {
                    channel: [],
                    product: [],
                    brand: [],
                    promotion: [],
                    adset: []
                };
            }

            // í•„í„°ë§ëœ ê¸°ê¸°í”Œë«í¼ ë°ì´í„° ê³„ì‚°
            updateFilteredDevicePlatformCount(currentDevicePlatformFilters);

            // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            renderDevicePlatformTrendChart();
        }

        function updateFilteredDevicePlatformCount(filters) {
            if (!devicePlatformDimensionData) return;

            const filterMap = {
                'channel': 'ìœ í˜•êµ¬ë¶„',
                'product': 'ìƒí’ˆëª…',
                'brand': 'ë¸Œëœë“œëª…',
                'promotion': 'í”„ë¡œëª¨ì…˜',
                'adset': 'ê´‘ê³ ì„¸íŠ¸'
            };

            const devicePlatformsToShow = new Set();

            devicePlatformDimensionData.forEach(row => {
                const devicePlatform = row['ê¸°ê¸°í”Œë«í¼'];
                if (!devicePlatform || devicePlatform === '' || devicePlatform === '-') return;

                let matchesAllFilters = true;

                // AND ì—°ì‚°ìœ¼ë¡œ ëª¨ë“  í•„í„° í™•ì¸
                Object.keys(filterMap).forEach(filterKey => {
                    const column = filterMap[filterKey];
                    const selectedValues = filters[filterKey];

                    if (selectedValues && selectedValues.length > 0) {
                        const rowValue = row[column];
                        if (!selectedValues.includes(rowValue)) {
                            matchesAllFilters = false;
                        }
                    }
                });

                if (matchesAllFilters) {
                    devicePlatformsToShow.add(devicePlatform);
                }
            });

            document.getElementById('filteredDevicePlatformCount').textContent = devicePlatformsToShow.size;
        }

        // ê¸°ê¸°ìœ í˜• ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”
        let deviceTypeDropdownsInitialized = false;

        function initDeviceTypeDropdowns() {
            if (!deviceTypeDimensionData) return;

            const filterMap = {
                'channel': { column: 'ìœ í˜•êµ¬ë¶„', listId: 'devicetypeFilterChannelList', label: 'ì±„ë„' },
                'product': { column: 'ìƒí’ˆëª…', listId: 'devicetypeFilterProductList', label: 'ì œí’ˆ' },
                'brand': { column: 'ë¸Œëœë“œëª…', listId: 'devicetypeFilterBrandList', label: 'ë¸Œëœë“œ' },
                'promotion': { column: 'í”„ë¡œëª¨ì…˜', listId: 'devicetypeFilterPromotionList', label: 'í”„ë¡œëª¨ì…˜' },
                'adset': { column: 'ê´‘ê³ ì„¸íŠ¸', listId: 'devicetypeFilterAdsetList', label: 'ê´‘ê³ ì„¸íŠ¸' }
            };

            // ê° í•„í„°ì— ëŒ€í•œ ì²´í¬ë°•ìŠ¤ ë¦¬ìŠ¤íŠ¸ ìƒì„±
            Object.keys(filterMap).forEach(filterKey => {
                const { column, listId } = filterMap[filterKey];
                const list = document.getElementById(listId);
                if (!list) return;

                const items = [...new Set(deviceTypeDimensionData.map(row => row[column]).filter(v => v && v !== '' && v !== '-'))];
                items.sort();

                list.innerHTML = items.map(item => `
                    <label style="display: flex; align-items: center; padding: 8px 10px; cursor: pointer; font-size: 12px; border-radius: 4px; transition: background 0.2s;" onmouseover="this.style.background='var(--grey-100)'" onmouseout="this.style.background='transparent'">
                        <input type="checkbox" class="device-type-filter-item-checkbox" data-filter="${filterKey}" value="${item}" style="margin-right: 10px; width: 16px; height: 16px; cursor: pointer;">
                        ${item}
                    </label>
                `).join('');

                // ê°œë³„ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
                list.querySelectorAll('.device-type-filter-item-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', function() {
                        // ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸
                        const selectAllCheckbox = document.querySelector(`.devicetype-filter-select-all[data-filter="${filterKey}"]`);
                        if (selectAllCheckbox) {
                            const allCheckboxes = list.querySelectorAll('.device-type-filter-item-checkbox');
                            const checkedCheckboxes = list.querySelectorAll('.device-type-filter-item-checkbox:checked');
                            selectAllCheckbox.checked = allCheckboxes.length === checkedCheckboxes.length && allCheckboxes.length > 0;
                        }

                        updateDeviceTypeFilters();
                        updateDeviceTypeFilterButtonText(filterKey);
                    });
                });
            });

            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆëŠ” í•œ ë²ˆë§Œ ë“±ë¡
            if (!deviceTypeDropdownsInitialized) {
                // ë“œë¡­ë‹¤ìš´ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
                document.querySelectorAll('.devicetype-filter-dropdown-btn').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const filterType = this.dataset.filter;
                        const dropdown = document.querySelector(`.devicetype-filter-dropdown-list[data-filter="${filterType}"]`);

                        // ë‹¤ë¥¸ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
                        document.querySelectorAll('.devicetype-filter-dropdown-list').forEach(dd => {
                            if (dd !== dropdown) dd.style.display = 'none';
                        });

                        // í˜„ì¬ ë“œë¡­ë‹¤ìš´ í† ê¸€
                        if (dropdown) {
                            dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
                        }
                    });
                });

                // ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
                document.querySelectorAll('.devicetype-filter-select-all').forEach(checkbox => {
                    checkbox.addEventListener('change', function() {
                        const filterType = this.dataset.filter;
                        const list = document.getElementById(`devicetypeFilter${filterType.charAt(0).toUpperCase() + filterType.slice(1)}List`);
                        if (!list) return;

                        const itemCheckboxes = list.querySelectorAll('.device-type-filter-item-checkbox');
                        itemCheckboxes.forEach(cb => {
                            cb.checked = this.checked;
                        });

                        updateDeviceTypeFilters();
                        updateDeviceTypeFilterButtonText(filterType);
                    });
                });

                deviceTypeDropdownsInitialized = true;
            }

            // ê¸°ê°„ ì„ íƒ ì´ˆê¸°ê°’ ì„¤ì • (ì „ì²´ ë°ì´í„°ì˜ ìµœì†Œ/ìµœëŒ€ ë‚ ì§œ)
            const dates = dimensionData
                .map(row => row['ì¼'])
                .filter(date => date && date !== '' && date !== '-')
                .map(date => new Date(date))
                .filter(date => !isNaN(date));

            if (dates.length > 0) {
                const minDate = new Date(Math.min(...dates));
                const maxDate = new Date(Math.max(...dates));

                const formatDateForInput = (date) => {
                    const year = date.getFullYear();
                    const month = String(date.getMonth() + 1).padStart(2, '0');
                    const day = String(date.getDate()).padStart(2, '0');
                    return `${year}-${month}-${day}`;
                };

                const startInput = document.getElementById('deviceTypeStartDate');
                const endInput = document.getElementById('deviceTypeEndDate');

                if (startInput && endInput) {
                    startInput.value = formatDateForInput(minDate);
                    endInput.value = formatDateForInput(maxDate);
                    deviceTypeStartDate = formatDateForInput(minDate);
                    deviceTypeEndDate = formatDateForInput(maxDate);
                }
            }

            // ì´ˆê¸° ì°¨íŠ¸ ë Œë”ë§ (í•„í„° ë¯¸ì„ íƒ ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ)
            updateDeviceTypeFilters();
            renderDeviceTypeTrendChart();
        }

        function updateDeviceTypeFilterButtonText(filterKey) {
            const filterMap = {
                'channel': 'ì±„ë„',
                'product': 'ì œí’ˆ',
                'brand': 'ë¸Œëœë“œ',
                'promotion': 'í”„ë¡œëª¨ì…˜',
                'adset': 'ê´‘ê³ ì„¸íŠ¸'
            };

            const btn = document.querySelector(`.devicetype-filter-dropdown-btn[data-filter="${filterKey}"]`);
            const list = document.getElementById(`devicetypeFilter${filterKey.charAt(0).toUpperCase() + filterKey.slice(1)}List`);

            if (!btn || !list) return;

            const checkedBoxes = list.querySelectorAll('.device-type-filter-item-checkbox:checked');
            const totalBoxes = list.querySelectorAll('.device-type-filter-item-checkbox');
            const btnText = btn.querySelector('span:first-child');
            const countText = btn.querySelector('.devicetype-selected-count');

            if (checkedBoxes.length === 0) {
                btnText.textContent = `${filterMap[filterKey]}_ì „ì²´`;
                countText.textContent = '';
            } else if (checkedBoxes.length === totalBoxes.length) {
                btnText.textContent = `${filterMap[filterKey]}_ì „ì²´`;
                countText.textContent = `(${checkedBoxes.length})`;
            } else if (checkedBoxes.length === 1) {
                btnText.textContent = checkedBoxes[0].value;
                countText.textContent = '';
            } else {
                btnText.textContent = `${checkedBoxes[0].value} ì™¸`;
                countText.textContent = `(${checkedBoxes.length})`;
            }
        }

        // ì „ì—­ í•„í„° ìƒíƒœ ì €ì¥
        let currentDeviceTypeFilters = {
            channel: [],
            product: [],
            brand: [],
            promotion: [],
            adset: []
        };

        function updateDeviceTypeFilters() {
            if (!deviceTypeDimensionData) return;

            const filterMap = {
                'channel': { column: 'ìœ í˜•êµ¬ë¶„', listId: 'devicetypeFilterChannelList' },
                'product': { column: 'ìƒí’ˆëª…', listId: 'devicetypeFilterProductList' },
                'brand': { column: 'ë¸Œëœë“œëª…', listId: 'devicetypeFilterBrandList' },
                'promotion': { column: 'í”„ë¡œëª¨ì…˜', listId: 'devicetypeFilterPromotionList' },
                'adset': { column: 'ê´‘ê³ ì„¸íŠ¸', listId: 'devicetypeFilterAdsetList' }
            };

            // ì„ íƒëœ í•„í„° ê°’ ìˆ˜ì§‘
            Object.keys(filterMap).forEach(filterKey => {
                const { listId } = filterMap[filterKey];
                const list = document.getElementById(listId);

                if (list) {
                    const checkedBoxes = list.querySelectorAll('.device-type-filter-item-checkbox:checked');
                    currentDeviceTypeFilters[filterKey] = Array.from(checkedBoxes).map(cb => cb.value);
                } else {
                    currentDeviceTypeFilters[filterKey] = [];
                }
            });

            // ëª¨ë“  í•„í„°ê°€ ë¹„ì–´ìˆëŠ”ì§€ í™•ì¸
            const allFiltersEmpty = Object.values(currentDeviceTypeFilters).every(arr => arr.length === 0);

            if (allFiltersEmpty) {
                // ëª¨ë“  í•„í„°ê°€ í•´ì œë˜ë©´ í•„í„° ìƒíƒœ ì´ˆê¸°í™”
                currentDeviceTypeFilters = {
                    channel: [],
                    product: [],
                    brand: [],
                    promotion: [],
                    adset: []
                };
            }

            // í•„í„°ë§ëœ ê¸°ê¸°ìœ í˜• ë°ì´í„° ê³„ì‚°
            updateFilteredDeviceTypeCount(currentDeviceTypeFilters);

            // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            renderDeviceTypeTrendChart();
        }

        function updateFilteredDeviceTypeCount(filters) {
            if (!deviceTypeDimensionData) return;

            const filterMap = {
                'channel': 'ìœ í˜•êµ¬ë¶„',
                'product': 'ìƒí’ˆëª…',
                'brand': 'ë¸Œëœë“œëª…',
                'promotion': 'í”„ë¡œëª¨ì…˜',
                'adset': 'ê´‘ê³ ì„¸íŠ¸'
            };

            const deviceTypesToShow = new Set();

            deviceTypeDimensionData.forEach(row => {
                const deviceType = row['ê¸°ê¸°ìœ í˜•'];
                if (!deviceType || deviceType === '' || deviceType === '-') return;

                let matchesAllFilters = true;

                // AND ì—°ì‚°ìœ¼ë¡œ ëª¨ë“  í•„í„° í™•ì¸
                Object.keys(filterMap).forEach(filterKey => {
                    const column = filterMap[filterKey];
                    const selectedValues = filters[filterKey];

                    if (selectedValues && selectedValues.length > 0) {
                        const rowValue = row[column];
                        if (!selectedValues.includes(rowValue)) {
                            matchesAllFilters = false;
                        }
                    }
                });

                if (matchesAllFilters) {
                    deviceTypesToShow.add(deviceType);
                }
            });

            document.getElementById('filteredDeviceTypeCount').textContent = deviceTypesToShow.size;
        }

        // ê¸°ê¸°í”Œë«í¼ ì¶”ì´ ì°¨íŠ¸ ë Œë”ë§
        function renderDevicePlatformTrendChart() {
            const canvas = document.getElementById('devicePlatformTrendChart');
            if (!canvas) return;

            if (devicePlatformTrendChart) {
                devicePlatformTrendChart.destroy();
            }

            if (!devicePlatformDimensionData) {
                const ctx = canvas.getContext('2d');
                devicePlatformTrendChart = new Chart(ctx, {
                    type: 'line',
                    data: { labels: [], datasets: [] },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: true, position: 'top' },
                            title: { display: true, text: 'ë°ì´í„° ë¡œë”© ì¤‘...' }
                        }
                    }
                });
                return;
            }

            const filterMap = {
                'channel': 'ìœ í˜•êµ¬ë¶„',
                'product': 'ìƒí’ˆëª…',
                'brand': 'ë¸Œëœë“œëª…',
                'promotion': 'í”„ë¡œëª¨ì…˜',
                'adset': 'ê´‘ê³ ì„¸íŠ¸'
            };

            // í•„í„° ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” í–‰ë§Œ í•„í„°ë§í•˜ëŠ” í—¬í¼ í•¨ìˆ˜
            const rowMatchesFilters = (row) => {
                // ëª¨ë“  í•„í„°ê°€ ë¹„ì–´ìˆëŠ”ì§€ í™•ì¸
                const allFiltersEmpty = Object.values(currentDevicePlatformFilters).every(arr => !arr || arr.length === 0);

                // ëª¨ë“  í•„í„°ê°€ ë¹„ì–´ìˆìœ¼ë©´ false ë°˜í™˜ (ë°ì´í„° í‘œì‹œ ì•ˆ í•¨)
                if (allFiltersEmpty) {
                    return false;
                }

                // ëª¨ë“  í•„í„°ë¥¼ AND ì¡°ê±´ìœ¼ë¡œ í™•ì¸
                for (const filterKey of Object.keys(filterMap)) {
                    const column = filterMap[filterKey];
                    const selectedValues = currentDevicePlatformFilters[filterKey];

                    if (selectedValues && selectedValues.length > 0) {
                        const rowValue = row[column];
                        if (!selectedValues.includes(rowValue)) {
                            return false;
                        }
                    }
                }
                return true;
            };

            // ê¸°ê¸°í”Œë«í¼ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
            const devicePlatformsToShow = new Set();
            devicePlatformDimensionData.forEach(row => {
                if (rowMatchesFilters(row)) {
                    const devicePlatform = row['ê¸°ê¸°í”Œë«í¼'];
                    if (devicePlatform && devicePlatform !== '' && devicePlatform !== '-') {
                        devicePlatformsToShow.add(devicePlatform);
                    }
                }
            });

            // ëª¨ë“  í•„í„°ê°€ ë¹„ì–´ìˆëŠ”ì§€ í™•ì¸
            const allFiltersEmpty = Object.values(currentDevicePlatformFilters).every(arr => !arr || arr.length === 0);

            if (allFiltersEmpty || devicePlatformsToShow.size === 0) {
                const ctx = canvas.getContext('2d');
                devicePlatformTrendChart = new Chart(ctx, {
                    type: 'line',
                    data: { labels: [], datasets: [] },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: true, position: 'top' },
                            title: { display: true, text: allFiltersEmpty ? 'í•„í„°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”' : 'í•„í„° ì¡°ê±´ì— ë§ëŠ” ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤' }
                        }
                    }
                });
                return;
            }

            // ê¸°ê¸°í”Œë«í¼ë³„ ì¼ë³„ ë°ì´í„° ì§‘ê³„
            const timeSeriesData = {};
            devicePlatformsToShow.forEach(devicePlatform => {
                timeSeriesData[devicePlatform] = {};
            });

            devicePlatformDimensionData.forEach(row => {
                if (!rowMatchesFilters(row)) return;

                const devicePlatform = row['ê¸°ê¸°í”Œë«í¼'];
                if (devicePlatformsToShow.has(devicePlatform) && row['ì¼']) {
                    const date = row['ì¼'];

                    // ê¸°ê°„ í•„í„°ë§
                    if (devicePlatformStartDate || devicePlatformEndDate) {
                        const rowDate = new Date(date);
                        if (isNaN(rowDate)) return;
                        if (devicePlatformStartDate && rowDate < new Date(devicePlatformStartDate)) return;
                        if (devicePlatformEndDate && rowDate > new Date(devicePlatformEndDate)) return;
                    }

                    const cost = parseFloat(row['ë¹„ìš©']?.replace(/,/g, '') || row['ë¹„ìš©']) || 0;
                    const revenue = parseFloat(row['ì „í™˜ê°’']?.replace(/,/g, '') || row['ì „í™˜ê°’']) || 0;
                    const conversions = parseFloat(row['ì „í™˜ìˆ˜']?.replace(/,/g, '') || row['ì „í™˜ìˆ˜']) || 0;
                    const impressions = parseFloat(row['ë…¸ì¶œ']?.replace(/,/g, '') || row['ë…¸ì¶œ']) || 0;
                    const clicks = parseFloat(row['í´ë¦­']?.replace(/,/g, '') || row['í´ë¦­']) || 0;

                    if (!timeSeriesData[devicePlatform][date]) {
                        timeSeriesData[devicePlatform][date] = {
                            cost: 0,
                            revenue: 0,
                            conversions: 0,
                            impressions: 0,
                            clicks: 0
                        };
                    }
                    timeSeriesData[devicePlatform][date].cost += cost;
                    timeSeriesData[devicePlatform][date].revenue += revenue;
                    timeSeriesData[devicePlatform][date].conversions += conversions;
                    timeSeriesData[devicePlatform][date].impressions += impressions;
                    timeSeriesData[devicePlatform][date].clicks += clicks;
                }
            });

            // ê¸°ê°„ë³„ ì§‘ê³„
            const aggregatedData = {};
            devicePlatformsToShow.forEach(devicePlatform => {
                aggregatedData[devicePlatform] = {};
            });

            Object.keys(timeSeriesData).forEach(devicePlatform => {
                Object.keys(timeSeriesData[devicePlatform]).forEach(date => {
                    const periodKey = getPeriodKey(date, currentDevicePlatformPeriod);
                    if (!aggregatedData[devicePlatform][periodKey]) {
                        aggregatedData[devicePlatform][periodKey] = {
                            cost: 0,
                            revenue: 0,
                            conversions: 0,
                            impressions: 0,
                            clicks: 0
                        };
                    }
                    aggregatedData[devicePlatform][periodKey].cost += timeSeriesData[devicePlatform][date].cost;
                    aggregatedData[devicePlatform][periodKey].revenue += timeSeriesData[devicePlatform][date].revenue;
                    aggregatedData[devicePlatform][periodKey].conversions += timeSeriesData[devicePlatform][date].conversions;
                    aggregatedData[devicePlatform][periodKey].impressions += timeSeriesData[devicePlatform][date].impressions;
                    aggregatedData[devicePlatform][periodKey].clicks += timeSeriesData[devicePlatform][date].clicks;
                });
            });

            // ì„ íƒëœ ì§€í‘œì— ë”°ë¼ ë°ì´í„° ê³„ì‚°
            const metricData = {};
            Object.keys(aggregatedData).forEach(devicePlatform => {
                metricData[devicePlatform] = {};
                Object.keys(aggregatedData[devicePlatform]).forEach(period => {
                    const { cost, revenue, conversions, impressions, clicks } = aggregatedData[devicePlatform][period];

                    switch(currentDevicePlatformMetric) {
                        case 'roas':
                            metricData[devicePlatform][period] = cost > 0 ? (revenue / cost * 100) : 0;
                            break;
                        case 'cost':
                            metricData[devicePlatform][period] = cost;
                            break;
                        case 'revenue':
                            metricData[devicePlatform][period] = revenue;
                            break;
                        case 'conversions':
                            metricData[devicePlatform][period] = conversions;
                            break;
                        case 'impressions':
                            metricData[devicePlatform][period] = impressions;
                            break;
                        case 'clicks':
                            metricData[devicePlatform][period] = clicks;
                            break;
                        case 'cpm':
                            metricData[devicePlatform][period] = impressions > 0 ? (cost / impressions * 1000) : 0;
                            break;
                        case 'cpc':
                            metricData[devicePlatform][period] = clicks > 0 ? (cost / clicks) : 0;
                            break;
                        case 'cpa':
                            metricData[devicePlatform][period] = conversions > 0 ? (cost / conversions) : 0;
                            break;
                        case 'ctr':
                            metricData[devicePlatform][period] = impressions > 0 ? (clicks / impressions * 100) : 0;
                            break;
                        case 'cvr':
                            metricData[devicePlatform][period] = clicks > 0 ? (conversions / clicks * 100) : 0;
                            break;
                        default:
                            metricData[devicePlatform][period] = 0;
                    }
                });
            });

            // ê¸°ê°„ ì •ë ¬
            const allPeriods = [...new Set(Object.values(metricData).flatMap(data => Object.keys(data)))].sort();

            // ë°ì´í„°ì…‹ ìƒì„±
            const colors = ['#673ab7', '#2196f3', '#4caf50', '#ff9800', '#f44336'];
            const devicePlatformArray = Array.from(devicePlatformsToShow).sort();
            const datasets = devicePlatformArray.map((devicePlatform, index) => {
                return {
                    label: devicePlatform,
                    data: allPeriods.map(period => metricData[devicePlatform][period] || 0),
                    borderColor: colors[index % colors.length],
                    backgroundColor: colors[index % colors.length] + '20',
                    borderWidth: 2,
                    tension: 0.3
                };
            });

            const ctx = canvas.getContext('2d');
            devicePlatformTrendChart = new Chart(ctx, {
                type: 'line',
                data: { labels: allPeriods, datasets: datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: true, position: 'top' },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const devicePlatform = devicePlatformArray[context.datasetIndex];
                                    const period = allPeriods[context.dataIndex];
                                    const data = aggregatedData[devicePlatform][period] || {};
                                    const { cost = 0, revenue = 0, conversions = 0, impressions = 0, clicks = 0 } = data;

                                    const roas = cost > 0 ? (revenue / cost * 100) : 0;
                                    const cpm = impressions > 0 ? (cost / impressions * 1000) : 0;
                                    const cpc = clicks > 0 ? (cost / clicks) : 0;
                                    const cpa = conversions > 0 ? (cost / conversions) : 0;
                                    const ctr = impressions > 0 ? (clicks / impressions * 100) : 0;
                                    const cvr = clicks > 0 ? (conversions / clicks * 100) : 0;

                                    const lines = [`${devicePlatform}`];

                                    switch(currentDevicePlatformMetric) {
                                        case 'roas':
                                            lines.push(`ROAS: ${roas.toFixed(1)}%`);
                                            lines.push(`ë¹„ìš©: ${formatCurrency(cost)}`);
                                            lines.push(`ì „í™˜ê°’: ${formatCurrency(revenue)}`);
                                            break;
                                        case 'cost':
                                            lines.push(`ë¹„ìš©: ${formatCurrency(context.parsed.y)}`);
                                            lines.push(`ROAS: ${roas.toFixed(1)}%`);
                                            break;
                                        case 'revenue':
                                            lines.push(`ì „í™˜ê°’: ${formatCurrency(context.parsed.y)}`);
                                            lines.push(`ë¹„ìš©: ${formatCurrency(cost)}`);
                                            lines.push(`ROAS: ${roas.toFixed(1)}%`);
                                            break;
                                        case 'conversions':
                                            lines.push(`ì „í™˜ìˆ˜: ${conversions.toLocaleString()}ê±´`);
                                            lines.push(`ì „í™˜ìœ¨: ${cvr.toFixed(2)}%`);
                                            break;
                                        case 'impressions':
                                            lines.push(`ë…¸ì¶œìˆ˜: ${impressions.toLocaleString()}íšŒ`);
                                            lines.push(`CTR: ${ctr.toFixed(2)}%`);
                                            break;
                                        case 'clicks':
                                            lines.push(`í´ë¦­ìˆ˜: ${clicks.toLocaleString()}íšŒ`);
                                            lines.push(`CTR: ${ctr.toFixed(2)}%`);
                                            break;
                                        case 'cpm':
                                            lines.push(`CPM: ${formatCurrency(context.parsed.y)}`);
                                            lines.push(`ë…¸ì¶œìˆ˜: ${impressions.toLocaleString()}íšŒ`);
                                            break;
                                        case 'cpc':
                                            lines.push(`CPC: ${formatCurrency(context.parsed.y)}`);
                                            lines.push(`í´ë¦­ìˆ˜: ${clicks.toLocaleString()}íšŒ`);
                                            break;
                                        case 'cpa':
                                            lines.push(`CPA: ${formatCurrency(context.parsed.y)}`);
                                            lines.push(`ì „í™˜ìˆ˜: ${conversions.toLocaleString()}ê±´`);
                                            break;
                                        case 'ctr':
                                            lines.push(`CTR: ${context.parsed.y.toFixed(2)}%`);
                                            lines.push(`í´ë¦­ìˆ˜: ${clicks.toLocaleString()}íšŒ`);
                                            lines.push(`ë…¸ì¶œìˆ˜: ${impressions.toLocaleString()}íšŒ`);
                                            break;
                                        case 'cvr':
                                            lines.push(`ì „í™˜ìœ¨: ${context.parsed.y.toFixed(2)}%`);
                                            lines.push(`ì „í™˜ìˆ˜: ${conversions.toLocaleString()}ê±´`);
                                            lines.push(`í´ë¦­ìˆ˜: ${clicks.toLocaleString()}íšŒ`);
                                            break;
                                    }

                                    return lines;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: (function() {
                                    switch(currentDevicePlatformMetric) {
                                        case 'roas': return 'ROAS (%)';
                                        case 'cost': return 'ë¹„ìš© (ì›)';
                                        case 'revenue': return 'ì „í™˜ê°’ (ì›)';
                                        case 'conversions': return 'ì „í™˜ìˆ˜ (ê±´)';
                                        case 'impressions': return 'ë…¸ì¶œìˆ˜ (íšŒ)';
                                        case 'clicks': return 'í´ë¦­ìˆ˜ (íšŒ)';
                                        case 'cpm': return 'CPM (ì›)';
                                        case 'cpc': return 'CPC (ì›)';
                                        case 'cpa': return 'CPA (ì›)';
                                        case 'ctr': return 'CTR (%)';
                                        case 'cvr': return 'ì „í™˜ìœ¨ (%)';
                                        default: return 'ì§€í‘œ';
                                    }
                                })()
                            },
                            ticks: {
                                callback: function(value) {
                                    switch(currentDevicePlatformMetric) {
                                        case 'roas':
                                        case 'ctr':
                                        case 'cvr':
                                            return value.toFixed(1) + '%';
                                        case 'cost':
                                        case 'revenue':
                                        case 'cpm':
                                        case 'cpc':
                                        case 'cpa':
                                            return formatCurrency(value);
                                        case 'conversions':
                                        case 'impressions':
                                        case 'clicks':
                                            return value.toLocaleString();
                                        default:
                                            return value;
                                    }
                                }
                            }
                        },
                        x: {
                            title: { display: true, text: 'ê¸°ê°„' }
                        }
                    }
                }
            });
        }

        // ê¸°ê¸°ìœ í˜• ì¶”ì´ ì°¨íŠ¸ ë Œë”ë§
        function renderDeviceTypeTrendChart() {
            const canvas = document.getElementById('deviceTypeTrendChart');
            if (!canvas) return;

            if (deviceTypeTrendChart) {
                deviceTypeTrendChart.destroy();
            }

            if (!deviceTypeDimensionData) {
                const ctx = canvas.getContext('2d');
                deviceTypeTrendChart = new Chart(ctx, {
                    type: 'line',
                    data: { labels: [], datasets: [] },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: true, position: 'top' },
                            title: { display: true, text: 'ë°ì´í„° ë¡œë”© ì¤‘...' }
                        }
                    }
                });
                return;
            }

            const filterMap = {
                'channel': 'ìœ í˜•êµ¬ë¶„',
                'product': 'ìƒí’ˆëª…',
                'brand': 'ë¸Œëœë“œëª…',
                'promotion': 'í”„ë¡œëª¨ì…˜',
                'adset': 'ê´‘ê³ ì„¸íŠ¸'
            };

            // í•„í„° ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” í–‰ë§Œ í•„í„°ë§í•˜ëŠ” í—¬í¼ í•¨ìˆ˜
            const rowMatchesFilters = (row) => {
                // ëª¨ë“  í•„í„°ê°€ ë¹„ì–´ìˆëŠ”ì§€ í™•ì¸
                const allFiltersEmpty = Object.values(currentDeviceTypeFilters).every(arr => !arr || arr.length === 0);

                // ëª¨ë“  í•„í„°ê°€ ë¹„ì–´ìˆìœ¼ë©´ false ë°˜í™˜ (ë°ì´í„° í‘œì‹œ ì•ˆ í•¨)
                if (allFiltersEmpty) {
                    return false;
                }

                // ëª¨ë“  í•„í„°ë¥¼ AND ì¡°ê±´ìœ¼ë¡œ í™•ì¸
                for (const filterKey of Object.keys(filterMap)) {
                    const column = filterMap[filterKey];
                    const selectedValues = currentDeviceTypeFilters[filterKey];

                    if (selectedValues && selectedValues.length > 0) {
                        const rowValue = row[column];
                        if (!selectedValues.includes(rowValue)) {
                            return false;
                        }
                    }
                }
                return true;
            };

            // ê¸°ê¸°ìœ í˜• ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
            const deviceTypesToShow = new Set();
            deviceTypeDimensionData.forEach(row => {
                if (rowMatchesFilters(row)) {
                    const deviceType = row['ê¸°ê¸°ìœ í˜•'];
                    if (deviceType && deviceType !== '' && deviceType !== '-') {
                        deviceTypesToShow.add(deviceType);
                    }
                }
            });

            // ëª¨ë“  í•„í„°ê°€ ë¹„ì–´ìˆëŠ”ì§€ í™•ì¸
            const allFiltersEmpty = Object.values(currentDeviceTypeFilters).every(arr => !arr || arr.length === 0);

            if (allFiltersEmpty || deviceTypesToShow.size === 0) {
                const ctx = canvas.getContext('2d');
                deviceTypeTrendChart = new Chart(ctx, {
                    type: 'line',
                    data: { labels: [], datasets: [] },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: true, position: 'top' },
                            title: { display: true, text: allFiltersEmpty ? 'í•„í„°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”' : 'í•„í„° ì¡°ê±´ì— ë§ëŠ” ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤' }
                        }
                    }
                });
                return;
            }

            // ê¸°ê¸°ìœ í˜•ë³„ ì¼ë³„ ë°ì´í„° ì§‘ê³„
            const timeSeriesData = {};
            deviceTypesToShow.forEach(deviceType => {
                timeSeriesData[deviceType] = {};
            });

            deviceTypeDimensionData.forEach(row => {
                if (!rowMatchesFilters(row)) return;

                const deviceType = row['ê¸°ê¸°ìœ í˜•'];
                if (deviceTypesToShow.has(deviceType) && row['ì¼']) {
                    const date = row['ì¼'];

                    // ê¸°ê°„ í•„í„°ë§
                    if (deviceTypeStartDate || deviceTypeEndDate) {
                        const rowDate = new Date(date);
                        if (isNaN(rowDate)) return;
                        if (deviceTypeStartDate && rowDate < new Date(deviceTypeStartDate)) return;
                        if (deviceTypeEndDate && rowDate > new Date(deviceTypeEndDate)) return;
                    }

                    const cost = parseFloat(row['ë¹„ìš©']?.replace(/,/g, '') || row['ë¹„ìš©']) || 0;
                    const revenue = parseFloat(row['ì „í™˜ê°’']?.replace(/,/g, '') || row['ì „í™˜ê°’']) || 0;
                    const conversions = parseFloat(row['ì „í™˜ìˆ˜']?.replace(/,/g, '') || row['ì „í™˜ìˆ˜']) || 0;
                    const impressions = parseFloat(row['ë…¸ì¶œ']?.replace(/,/g, '') || row['ë…¸ì¶œ']) || 0;
                    const clicks = parseFloat(row['í´ë¦­']?.replace(/,/g, '') || row['í´ë¦­']) || 0;

                    if (!timeSeriesData[deviceType][date]) {
                        timeSeriesData[deviceType][date] = {
                            cost: 0,
                            revenue: 0,
                            conversions: 0,
                            impressions: 0,
                            clicks: 0
                        };
                    }
                    timeSeriesData[deviceType][date].cost += cost;
                    timeSeriesData[deviceType][date].revenue += revenue;
                    timeSeriesData[deviceType][date].conversions += conversions;
                    timeSeriesData[deviceType][date].impressions += impressions;
                    timeSeriesData[deviceType][date].clicks += clicks;
                }
            });

            // ê¸°ê°„ë³„ ì§‘ê³„
            const aggregatedData = {};
            deviceTypesToShow.forEach(deviceType => {
                aggregatedData[deviceType] = {};
            });

            Object.keys(timeSeriesData).forEach(deviceType => {
                Object.keys(timeSeriesData[deviceType]).forEach(date => {
                    const periodKey = getPeriodKey(date, currentDeviceTypePeriod);
                    if (!aggregatedData[deviceType][periodKey]) {
                        aggregatedData[deviceType][periodKey] = {
                            cost: 0,
                            revenue: 0,
                            conversions: 0,
                            impressions: 0,
                            clicks: 0
                        };
                    }
                    aggregatedData[deviceType][periodKey].cost += timeSeriesData[deviceType][date].cost;
                    aggregatedData[deviceType][periodKey].revenue += timeSeriesData[deviceType][date].revenue;
                    aggregatedData[deviceType][periodKey].conversions += timeSeriesData[deviceType][date].conversions;
                    aggregatedData[deviceType][periodKey].impressions += timeSeriesData[deviceType][date].impressions;
                    aggregatedData[deviceType][periodKey].clicks += timeSeriesData[deviceType][date].clicks;
                });
            });

            // ì„ íƒëœ ì§€í‘œì— ë”°ë¼ ë°ì´í„° ê³„ì‚°
            const metricData = {};
            Object.keys(aggregatedData).forEach(deviceType => {
                metricData[deviceType] = {};
                Object.keys(aggregatedData[deviceType]).forEach(period => {
                    const { cost, revenue, conversions, impressions, clicks } = aggregatedData[deviceType][period];

                    switch(currentDeviceTypeMetric) {
                        case 'roas':
                            metricData[deviceType][period] = cost > 0 ? (revenue / cost * 100) : 0;
                            break;
                        case 'cost':
                            metricData[deviceType][period] = cost;
                            break;
                        case 'revenue':
                            metricData[deviceType][period] = revenue;
                            break;
                        case 'conversions':
                            metricData[deviceType][period] = conversions;
                            break;
                        case 'impressions':
                            metricData[deviceType][period] = impressions;
                            break;
                        case 'clicks':
                            metricData[deviceType][period] = clicks;
                            break;
                        case 'cpm':
                            metricData[deviceType][period] = impressions > 0 ? (cost / impressions * 1000) : 0;
                            break;
                        case 'cpc':
                            metricData[deviceType][period] = clicks > 0 ? (cost / clicks) : 0;
                            break;
                        case 'cpa':
                            metricData[deviceType][period] = conversions > 0 ? (cost / conversions) : 0;
                            break;
                        case 'ctr':
                            metricData[deviceType][period] = impressions > 0 ? (clicks / impressions * 100) : 0;
                            break;
                        case 'cvr':
                            metricData[deviceType][period] = clicks > 0 ? (conversions / clicks * 100) : 0;
                            break;
                        default:
                            metricData[deviceType][period] = 0;
                    }
                });
            });

            // ê¸°ê°„ ì •ë ¬
            const allPeriods = [...new Set(Object.values(metricData).flatMap(data => Object.keys(data)))].sort();

            // ë°ì´í„°ì…‹ ìƒì„±
            const colors = ['#673ab7', '#2196f3', '#4caf50', '#ff9800', '#f44336'];
            const deviceTypeArray = Array.from(deviceTypesToShow).sort();
            const datasets = deviceTypeArray.map((deviceType, index) => {
                return {
                    label: deviceType,
                    data: allPeriods.map(period => metricData[deviceType][period] || 0),
                    borderColor: colors[index % colors.length],
                    backgroundColor: colors[index % colors.length] + '20',
                    borderWidth: 2,
                    tension: 0.3
                };
            });

            const ctx = canvas.getContext('2d');
            deviceTypeTrendChart = new Chart(ctx, {
                type: 'line',
                data: { labels: allPeriods, datasets: datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: true, position: 'top' },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const deviceType = deviceTypeArray[context.datasetIndex];
                                    const period = allPeriods[context.dataIndex];
                                    const data = aggregatedData[deviceType][period] || {};
                                    const { cost = 0, revenue = 0, conversions = 0, impressions = 0, clicks = 0 } = data;

                                    const roas = cost > 0 ? (revenue / cost * 100) : 0;
                                    const cpm = impressions > 0 ? (cost / impressions * 1000) : 0;
                                    const cpc = clicks > 0 ? (cost / clicks) : 0;
                                    const cpa = conversions > 0 ? (cost / conversions) : 0;
                                    const ctr = impressions > 0 ? (clicks / impressions * 100) : 0;
                                    const cvr = clicks > 0 ? (conversions / clicks * 100) : 0;

                                    const lines = [`${deviceType}`];

                                    switch(currentDeviceTypeMetric) {
                                        case 'roas':
                                            lines.push(`ROAS: ${roas.toFixed(1)}%`);
                                            lines.push(`ë¹„ìš©: ${formatCurrency(cost)}`);
                                            lines.push(`ì „í™˜ê°’: ${formatCurrency(revenue)}`);
                                            break;
                                        case 'cost':
                                            lines.push(`ë¹„ìš©: ${formatCurrency(context.parsed.y)}`);
                                            lines.push(`ROAS: ${roas.toFixed(1)}%`);
                                            break;
                                        case 'revenue':
                                            lines.push(`ì „í™˜ê°’: ${formatCurrency(context.parsed.y)}`);
                                            lines.push(`ë¹„ìš©: ${formatCurrency(cost)}`);
                                            lines.push(`ROAS: ${roas.toFixed(1)}%`);
                                            break;
                                        case 'conversions':
                                            lines.push(`ì „í™˜ìˆ˜: ${conversions.toLocaleString()}ê±´`);
                                            lines.push(`ì „í™˜ìœ¨: ${cvr.toFixed(2)}%`);
                                            break;
                                        case 'impressions':
                                            lines.push(`ë…¸ì¶œìˆ˜: ${impressions.toLocaleString()}íšŒ`);
                                            lines.push(`CTR: ${ctr.toFixed(2)}%`);
                                            break;
                                        case 'clicks':
                                            lines.push(`í´ë¦­ìˆ˜: ${clicks.toLocaleString()}íšŒ`);
                                            lines.push(`CTR: ${ctr.toFixed(2)}%`);
                                            break;
                                        case 'cpm':
                                            lines.push(`CPM: ${formatCurrency(context.parsed.y)}`);
                                            lines.push(`ë…¸ì¶œìˆ˜: ${impressions.toLocaleString()}íšŒ`);
                                            break;
                                        case 'cpc':
                                            lines.push(`CPC: ${formatCurrency(context.parsed.y)}`);
                                            lines.push(`í´ë¦­ìˆ˜: ${clicks.toLocaleString()}íšŒ`);
                                            break;
                                        case 'cpa':
                                            lines.push(`CPA: ${formatCurrency(context.parsed.y)}`);
                                            lines.push(`ì „í™˜ìˆ˜: ${conversions.toLocaleString()}ê±´`);
                                            break;
                                        case 'ctr':
                                            lines.push(`CTR: ${context.parsed.y.toFixed(2)}%`);
                                            lines.push(`í´ë¦­ìˆ˜: ${clicks.toLocaleString()}íšŒ`);
                                            lines.push(`ë…¸ì¶œìˆ˜: ${impressions.toLocaleString()}íšŒ`);
                                            break;
                                        case 'cvr':
                                            lines.push(`ì „í™˜ìœ¨: ${context.parsed.y.toFixed(2)}%`);
                                            lines.push(`ì „í™˜ìˆ˜: ${conversions.toLocaleString()}ê±´`);
                                            lines.push(`í´ë¦­ìˆ˜: ${clicks.toLocaleString()}íšŒ`);
                                            break;
                                    }

                                    return lines;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: (function() {
                                    switch(currentDeviceTypeMetric) {
                                        case 'roas': return 'ROAS (%)';
                                        case 'cost': return 'ë¹„ìš© (ì›)';
                                        case 'revenue': return 'ì „í™˜ê°’ (ì›)';
                                        case 'conversions': return 'ì „í™˜ìˆ˜ (ê±´)';
                                        case 'impressions': return 'ë…¸ì¶œìˆ˜ (íšŒ)';
                                        case 'clicks': return 'í´ë¦­ìˆ˜ (íšŒ)';
                                        case 'cpm': return 'CPM (ì›)';
                                        case 'cpc': return 'CPC (ì›)';
                                        case 'cpa': return 'CPA (ì›)';
                                        case 'ctr': return 'CTR (%)';
                                        case 'cvr': return 'ì „í™˜ìœ¨ (%)';
                                        default: return 'ì§€í‘œ';
                                    }
                                })()
                            },
                            ticks: {
                                callback: function(value) {
                                    switch(currentDeviceTypeMetric) {
                                        case 'roas':
                                        case 'ctr':
                                        case 'cvr':
                                            return value.toFixed(1) + '%';
                                        case 'cost':
                                        case 'revenue':
                                        case 'cpm':
                                        case 'cpc':
                                        case 'cpa':
                                            return formatCurrency(value);
                                        case 'conversions':
                                        case 'impressions':
                                        case 'clicks':
                                            return value.toLocaleString();
                                        default:
                                            return value;
                                    }
                                }
                            }
                        },
                        x: {
                            title: { display: true, text: 'ê¸°ê°„' }
                        }
                    }
                }
            });
        }

        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        function getPeriodKey(dateString, period) {
            const date = new Date(dateString);
            if (period === 'daily') {
                return dateString;
            } else if (period === 'weekly') {
                const year = date.getFullYear();
                const weekNum = getWeekNumber(date);
                return `${year}-W${String(weekNum).padStart(2, '0')}`;
            } else if (period === 'monthly') {
                const year = date.getFullYear();
                const month = date.getMonth() + 1;
                return `${year}-${String(month).padStart(2, '0')}`;
            }
            return dateString;
        }

        function getWeekNumber(date) {
            const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
            const dayNum = d.getUTCDay() || 7;
            d.setUTCDate(d.getUTCDate() + 4 - dayNum);
            const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
            return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
        }

        function formatCurrency(value) {
            return new Intl.NumberFormat('ko-KR', {
                style: 'currency',
                currency: 'KRW',
                minimumFractionDigits: 0
            }).format(value);
        }

        // ì„±ë³„ í•œê¸€ ë ˆì´ë¸” í•¨ìˆ˜ (í•˜ìœ„ í˜¸í™˜ì„± ìœ ì§€)
        function getGenderDisplayName(normalizedGender) {
            if (normalizedGender === 'ë‚¨ì„±' || normalizedGender === 'Male') return 'ë‚¨ì„±';
            if (normalizedGender === 'ì—¬ì„±' || normalizedGender === 'Female') return 'ì—¬ì„±';
            return null;
        }

        // ì„±ë³„ ì—°ë ¹ PIVOT í…Œì´ë¸” ë Œë”ë§
        function renderAgeGenderPivotTable() {
            const container = document.getElementById('ageGenderPivotTableContainer');
            if (!container || !pivotDimensionData) return;

            const filterMap = {
                'channel': 'ìœ í˜•êµ¬ë¶„',
                'product': 'ìƒí’ˆëª…',
                'brand': 'ë¸Œëœë“œëª…',
                'promotion': 'í”„ë¡œëª¨ì…˜',
                'adset': 'ê´‘ê³ ì„¸íŠ¸'
            };

            // í•„í„° ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” í–‰ë§Œ í•„í„°ë§í•˜ëŠ” í—¬í¼ í•¨ìˆ˜
            const rowMatchesFilters = (row) => {
                // ëª¨ë“  í•„í„°ê°€ ë¹„ì–´ìˆëŠ”ì§€ í™•ì¸
                const allFiltersEmpty = Object.values(currentPivotFilters).every(arr => !arr || arr.length === 0);

                // ëª¨ë“  í•„í„°ê°€ ë¹„ì–´ìˆìœ¼ë©´ false ë°˜í™˜ (ë°ì´í„° í‘œì‹œ ì•ˆ í•¨)
                if (allFiltersEmpty) {
                    return false;
                }

                // ëª¨ë“  í•„í„°ë¥¼ AND ì¡°ê±´ìœ¼ë¡œ í™•ì¸
                for (const filterKey of Object.keys(filterMap)) {
                    const column = filterMap[filterKey];
                    const selectedValues = currentPivotFilters[filterKey];

                    if (selectedValues && selectedValues.length > 0) {
                        const rowValue = row[column];
                        if (!selectedValues.includes(rowValue)) {
                            return false;
                        }
                    }
                }
                return true;
            };

            // ì„±ë³„ê³¼ ì—°ë ¹ëŒ€ë³„ ë°ì´í„° ì§‘ê³„
            const pivotData = {};

            pivotDimensionData.forEach(row => {
                if (!rowMatchesFilters(row)) return;

                // ì„±ë³„_í†µí•©, ì—°ë ¹_í†µí•© ì»¬ëŸ¼ ìš°ì„  ì‚¬ìš©
                const rawGender = row['ì„±ë³„_í†µí•©'] || row['ì„±ë³„'];
                const normalizedGender = normalizeGender(rawGender);
                const age = row['ì—°ë ¹_í†µí•©'] || row['ì—°ë ¹'];

                if (!normalizedGender || !age || age === '' || age === '-') return;

                // ê¸°ê°„ í•„í„°ë§
                const date = row['ì¼'];
                if (pivotStartDate || pivotEndDate) {
                    const rowDate = new Date(date);
                    if (isNaN(rowDate)) return;
                    if (pivotStartDate && rowDate < new Date(pivotStartDate)) return;
                    if (pivotEndDate && rowDate > new Date(pivotEndDate)) return;
                }

                const key = `${normalizedGender}_${age}`;
                if (!pivotData[key]) {
                    pivotData[key] = {
                        gender: normalizedGender,
                        age: age,
                        cost: 0,
                        revenue: 0,
                        conversions: 0,
                        impressions: 0,
                        clicks: 0
                    };
                }

                const cost = parseFloat(row['ë¹„ìš©']?.replace(/,/g, '') || row['ë¹„ìš©']) || 0;
                const revenue = parseFloat(row['ì „í™˜ê°’']?.replace(/,/g, '') || row['ì „í™˜ê°’']) || 0;
                const conversions = parseFloat(row['ì „í™˜ìˆ˜']?.replace(/,/g, '') || row['ì „í™˜ìˆ˜']) || 0;
                const impressions = parseFloat(row['ë…¸ì¶œ']?.replace(/,/g, '') || row['ë…¸ì¶œ']) || 0;
                const clicks = parseFloat(row['í´ë¦­']?.replace(/,/g, '') || row['í´ë¦­']) || 0;

                pivotData[key].cost += cost;
                pivotData[key].revenue += revenue;
                pivotData[key].conversions += conversions;
                pivotData[key].impressions += impressions;
                pivotData[key].clicks += clicks;
            });

            // ì§€í‘œ ê³„ì‚°
            Object.keys(pivotData).forEach(key => {
                const data = pivotData[key];
                data.roas = data.cost > 0 ? (data.revenue / data.cost * 100) : 0;
                data.cpm = data.impressions > 0 ? (data.cost / data.impressions * 1000) : 0;
                data.cpc = data.clicks > 0 ? (data.cost / data.clicks) : 0;
                data.cpa = data.conversions > 0 ? (data.cost / data.conversions) : 0;
            });

            // ê³ ìœ í•œ ì„±ë³„ê³¼ ì—°ë ¹ ì¶”ì¶œ ë° ì •ë ¬
            let genders = [...new Set(Object.values(pivotData).map(d => d.gender))].sort();
            const ages = [...new Set(Object.values(pivotData).map(d => d.age))].filter(a => isValidAge(a)).sort();

            // Unknown ì œì™¸í•˜ê³  ë‚¨ì„±, ì—¬ì„±ë§Œ ì‚¬ìš© (normalizeGenderê°€ ë°˜í™˜í•˜ëŠ” ê°’)
            genders = genders.filter(g => g === 'ë‚¨ì„±' || g === 'ì—¬ì„±');

            // ëª¨ë“  í•„í„°ê°€ ë¹„ì–´ìˆëŠ”ì§€ í™•ì¸
            const allFiltersEmpty = Object.values(currentPivotFilters).every(arr => !arr || arr.length === 0);

            // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ì•ˆë‚´ ë©”ì‹œì§€ í‘œì‹œ
            if (allFiltersEmpty || Object.keys(pivotData).length === 0 || genders.length === 0 || ages.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; color: var(--grey-500);">
                        <div style="font-size: 48px; margin-bottom: 16px;">ğŸ“Š</div>
                        <div style="font-size: 16px; font-weight: 600; margin-bottom: 8px;">${allFiltersEmpty ? 'í•„í„°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”' : 'ë°ì´í„°ë¥¼ í‘œì‹œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤'}</div>
                        <div style="font-size: 13px; color: var(--grey-400);">
                            ${allFiltersEmpty ? 'ìœ„ì˜ ë¶„ë¥˜ ê¸°ì¤€ì—ì„œ í•˜ë‚˜ ì´ìƒì˜ í•­ëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”.' : 'í•„í„° ì¡°ê±´ì— ë§ëŠ” ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.'}
                        </div>
                    </div>
                `;
                return;
            }

            // í…Œì´ë¸” HTML ìƒì„± - ìƒˆë¡œìš´ í˜•ì‹: ì—°ë ¹ë³„ í–‰, ì§€í‘œë³„ ë‚¨ì/ì—¬ì ì»¬ëŸ¼
            const metrics = [
                { key: 'cost', label: 'ë¹„ìš©', format: (v) => formatCurrency(v) },
                { key: 'cpm', label: 'CPM', format: (v) => formatCurrency(v) },
                { key: 'cpc', label: 'CPC', format: (v) => formatCurrency(v) },
                { key: 'cpa', label: 'CPA', format: (v) => formatCurrency(v) },
                { key: 'roas', label: 'ROAS', format: (v) => v.toFixed(1) + '%' }
            ];

            // ì§€í‘œë³„ ìµœì†Œ/ìµœëŒ€ê°’ ê³„ì‚° (ìƒ‰ìƒ ìŠ¤ì¼€ì¼ìš©)
            const metricRanges = {};
            metrics.forEach(metric => {
                let min = Infinity;
                let max = -Infinity;
                Object.values(pivotData).forEach(data => {
                    const value = data[metric.key];
                    if (value < min) min = value;
                    if (value > max) max = value;
                });
                metricRanges[metric.key] = { min, max };
            });

            // ìƒ‰ìƒ ê³„ì‚° í•¨ìˆ˜ (ì§€í‘œë³„)
            function getColorScaleForMetric(value, metricKey) {
                const range = metricRanges[metricKey];
                if (range.max === range.min) return 'rgba(103, 58, 183, 0.1)';

                const ratio = (value - range.min) / (range.max - range.min);
                // í°ìƒ‰(ë‚®ìŒ)ì—ì„œ íŒŒë€ìƒ‰(ë†’ìŒ)ìœ¼ë¡œ ê·¸ë¼ë°ì´ì…˜
                const r = Math.round(255 - (152 * ratio)); // 255 -> 103
                const g = Math.round(255 - (197 * ratio)); // 255 -> 58
                const b = Math.round(255 - (72 * ratio));  // 255 -> 183
                const alpha = 0.1 + (ratio * 0.3); // 0.1 -> 0.4

                return `rgba(${r}, ${g}, ${b}, ${alpha})`;
            }

            let tableHTML = `
                <table style="width: 100%; border-collapse: collapse; font-size: 11px;">
                    <thead>
                        <tr style="background: var(--grey-100);">
                            <th rowspan="2" style="padding: 10px 8px; text-align: center; font-weight: 700; border: 1px solid var(--grey-300); background: var(--grey-200); width: 70px;">
                                ì—°ë ¹
                            </th>
            `;

            // í—¤ë”: ì§€í‘œë³„ë¡œ ë‚¨ì/ì—¬ì ì»¬ëŸ¼
            metrics.forEach(metric => {
                tableHTML += `
                    <th colspan="2" style="padding: 8px 6px; text-align: center; font-weight: 700; border: 1px solid var(--grey-300); background: var(--primary-light); color: var(--primary-dark); font-size: 11px;">
                        ${metric.label}
                    </th>
                `;
            });

            tableHTML += `
                        </tr>
                        <tr style="background: var(--grey-50);">
            `;

            // ë‘ ë²ˆì§¸ í—¤ë” í–‰: ë‚¨ì/ì—¬ì ë°˜ë³µ
            metrics.forEach(metric => {
                genders.forEach(gender => {
                    tableHTML += `
                        <th style="padding: 6px 4px; text-align: center; font-weight: 600; border: 1px solid var(--grey-300); font-size: 10px;">
                            ${getGenderDisplayName(gender)}
                        </th>
                    `;
                });
            });

            tableHTML += `</tr></thead><tbody>`;

            // ë°ì´í„° í–‰: ì—°ë ¹ë³„
            ages.forEach((age, ageIndex) => {
                const rowBg = ageIndex % 2 === 0 ? 'var(--paper)' : 'var(--grey-50)';
                tableHTML += `
                    <tr style="background: ${rowBg};">
                        <td style="padding: 8px 6px; font-weight: 600; text-align: center; border: 1px solid var(--grey-300); background: var(--grey-100); font-size: 11px;">
                            ${age}
                        </td>
                `;

                // ê° ì§€í‘œë³„ë¡œ ë‚¨ì/ì—¬ì ë°ì´í„° ì¶œë ¥
                metrics.forEach(metric => {
                    genders.forEach(gender => {
                        const key = `${gender}_${age}`;
                        const data = pivotData[key];

                        if (data) {
                            const value = data[metric.key];
                            const bgColor = getColorScaleForMetric(value, metric.key);
                            const formattedValue = metric.format(value);

                            tableHTML += `
                                <td style="padding: 6px 4px; text-align: right; background: ${bgColor}; border: 1px solid var(--grey-300); cursor: pointer; transition: all 0.2s; font-weight: 500; font-size: 10px; white-space: nowrap;"
                                    onmouseover="this.style.background='var(--primary-light)'; this.style.transform='scale(1.02)';"
                                    onmouseout="this.style.background='${bgColor}'; this.style.transform='scale(1)';"
                                    title="${getGenderDisplayName(gender)} / ${age}&#10;${metric.label}: ${formattedValue}&#10;&#10;ë¹„ìš©: ${formatCurrency(data.cost)}&#10;CPM: ${formatCurrency(data.cpm)}&#10;CPC: ${formatCurrency(data.cpc)}&#10;CPA: ${formatCurrency(data.cpa)}&#10;ROAS: ${data.roas.toFixed(1)}%&#10;ì „í™˜ìˆ˜: ${data.conversions.toFixed(0)}">
                                    ${formattedValue}
                                </td>
                            `;
                        } else {
                            tableHTML += `
                                <td style="padding: 6px 4px; text-align: center; background: var(--grey-50); border: 1px solid var(--grey-300); color: var(--grey-400); font-size: 10px;">
                                    -
                                </td>
                            `;
                        }
                    });
                });

                tableHTML += `</tr>`;
            });

            tableHTML += `</tbody></table>`;

            // í†µê³„ ìš”ì•½ ì¶”ê°€
            const totalCost = Object.values(pivotData).reduce((sum, d) => sum + d.cost, 0);
            const totalRevenue = Object.values(pivotData).reduce((sum, d) => sum + d.revenue, 0);
            const totalConversions = Object.values(pivotData).reduce((sum, d) => sum + d.conversions, 0);
            const totalImpressions = Object.values(pivotData).reduce((sum, d) => sum + d.impressions, 0);
            const totalClicks = Object.values(pivotData).reduce((sum, d) => sum + d.clicks, 0);

            const avgRoas = totalCost > 0 ? (totalRevenue / totalCost * 100) : 0;
            const avgCpm = totalImpressions > 0 ? (totalCost / totalImpressions * 1000) : 0;
            const avgCpc = totalClicks > 0 ? (totalCost / totalClicks) : 0;
            const avgCpa = totalConversions > 0 ? (totalCost / totalConversions) : 0;

            const statsHTML = `
                <div style="margin-top: 20px; padding: 16px; background: linear-gradient(135deg, var(--primary-light) 0%, var(--secondary-light) 100%); border-radius: 8px; display: grid; grid-template-columns: repeat(5, 1fr); gap: 12px;">
                    <div style="text-align: center; padding: 12px; background: white; border-radius: 6px;">
                        <div style="font-size: 11px; color: var(--grey-600); margin-bottom: 4px;">ì „ì²´ ë¹„ìš©</div>
                        <div style="font-size: 16px; font-weight: 700; color: var(--grey-900);">${formatCurrency(totalCost)}</div>
                    </div>
                    <div style="text-align: center; padding: 12px; background: white; border-radius: 6px;">
                        <div style="font-size: 11px; color: var(--grey-600); margin-bottom: 4px;">í‰ê·  CPM</div>
                        <div style="font-size: 16px; font-weight: 700; color: var(--grey-900);">${formatCurrency(avgCpm)}</div>
                    </div>
                    <div style="text-align: center; padding: 12px; background: white; border-radius: 6px;">
                        <div style="font-size: 11px; color: var(--grey-600); margin-bottom: 4px;">í‰ê·  CPC</div>
                        <div style="font-size: 16px; font-weight: 700; color: var(--grey-900);">${formatCurrency(avgCpc)}</div>
                    </div>
                    <div style="text-align: center; padding: 12px; background: white; border-radius: 6px;">
                        <div style="font-size: 11px; color: var(--grey-600); margin-bottom: 4px;">í‰ê·  CPA</div>
                        <div style="font-size: 16px; font-weight: 700; color: var(--grey-900);">${formatCurrency(avgCpa)}</div>
                    </div>
                    <div style="text-align: center; padding: 12px; background: white; border-radius: 6px;">
                        <div style="font-size: 11px; color: var(--grey-600); margin-bottom: 4px;">ì „ì²´ ROAS</div>
                        <div style="font-size: 16px; font-weight: 700; color: var(--primary-main);">${avgRoas.toFixed(1)}%</div>
                    </div>
                </div>
            `;

            container.innerHTML = tableHTML + statsHTML;
        }

        // ========== ì„±ê³¼ ìƒì„¸ ë¶„ì„ ì„¹ì…˜ í•¨ìˆ˜ë“¤ ==========

        // ê³µí†µ í—¬í¼: ì§€í‘œ ê°’ ê³„ì‚°
        function calculateMetricValue(data, metric) {
            const cost = data.cost || 0;
            const revenue = data.revenue || 0;
            const conversions = data.conversions || 0;
            const impressions = data.impressions || 0;
            const clicks = data.clicks || 0;

            switch(metric) {
                case 'roas': return cost > 0 ? (revenue / cost * 100) : 0;
                case 'cost': return cost;
                case 'revenue': return revenue;
                case 'conversions': return conversions;
                case 'impressions': return impressions;
                case 'clicks': return clicks;
                case 'cpm': return impressions > 0 ? (cost / impressions * 1000) : 0;
                case 'cpc': return clicks > 0 ? (cost / clicks) : 0;
                case 'cpa': return conversions > 0 ? (cost / conversions) : 0;
                case 'ctr': return impressions > 0 ? (clicks / impressions * 100) : 0;
                case 'cvr': return clicks > 0 ? (conversions / clicks * 100) : 0;
                default: return 0;
            }
        }

        // ê³µí†µ í—¬í¼: ì§€í‘œ í¬ë§·íŒ…
        function formatMetricValue(value, metric) {
            switch(metric) {
                case 'roas':
                case 'ctr':
                case 'cvr':
                    return value.toFixed(1) + '%';
                case 'cost':
                case 'revenue':
                case 'cpm':
                case 'cpc':
                case 'cpa':
                    return formatCurrency(value);
                default:
                    return value.toLocaleString();
            }
        }

        // ê³µí†µ Bar ì°¨íŠ¸ ë Œë”ë§ í•¨ìˆ˜ (ìˆ˜í‰ ë§‰ëŒ€) - ë‹¨ìˆœ ë²„ì „
        function renderDetailBarChart(canvasId, chartVar, labels, values, metric, chartTitle) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return null;

            if (chartVar) {
                chartVar.destroy();
            }

            const colors = [
                'rgba(33, 150, 243, 0.8)',
                'rgba(76, 175, 80, 0.8)',
                'rgba(255, 152, 0, 0.8)',
                'rgba(156, 39, 176, 0.8)',
                'rgba(244, 67, 54, 0.8)',
                'rgba(0, 188, 212, 0.8)',
                'rgba(255, 87, 34, 0.8)',
                'rgba(63, 81, 181, 0.8)',
                'rgba(139, 195, 74, 0.8)',
                'rgba(255, 193, 7, 0.8)'
            ];

            const metricLabels = {
                'roas': 'ROAS (%)',
                'cost': 'ë¹„ìš© (ì›)',
                'revenue': 'ì „í™˜ê°’ (ì›)',
                'conversions': 'ì „í™˜ìˆ˜',
                'impressions': 'ë…¸ì¶œìˆ˜',
                'clicks': 'í´ë¦­ìˆ˜',
                'cpm': 'CPM (ì›)',
                'cpc': 'CPC (ì›)',
                'cpa': 'CPA (ì›)',
                'ctr': 'CTR (%)',
                'cvr': 'ì „í™˜ìœ¨ (%)'
            };

            const ctx = canvas.getContext('2d');
            return new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: metricLabels[metric] || metric,
                        data: values,
                        backgroundColor: labels.map((_, i) => colors[i % colors.length]),
                        borderColor: labels.map((_, i) => colors[i % colors.length].replace('0.8', '1')),
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        title: {
                            display: !!chartTitle,
                            text: chartTitle || ''
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return formatMetricValue(context.raw, metric);
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: metricLabels[metric] || metric
                            }
                        },
                        y: {
                            ticks: {
                                font: { size: 11 }
                            }
                        }
                    }
                }
            });
        }

        // ëˆ„ì  ë°” ì°¨íŠ¸ ë Œë”ë§ í•¨ìˆ˜ (ë¶„ë¥˜ê¸°ì¤€ë³„ ìƒ‰ìƒ)
        function renderDetailStackedBarChart(canvasId, chartVar, dimensionLabels, stackedData, metric) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return null;

            if (chartVar) {
                chartVar.destroy();
            }

            const stackColors = [
                'rgba(33, 150, 243, 0.8)',   // íŒŒë‘
                'rgba(76, 175, 80, 0.8)',    // ì´ˆë¡
                'rgba(255, 152, 0, 0.8)',    // ì£¼í™©
                'rgba(156, 39, 176, 0.8)',   // ë³´ë¼
                'rgba(244, 67, 54, 0.8)',    // ë¹¨ê°•
                'rgba(0, 188, 212, 0.8)',    // ì²­ë¡
                'rgba(255, 87, 34, 0.8)',    // ë”¥ì˜¤ë Œì§€
                'rgba(63, 81, 181, 0.8)',    // ì¸ë””ê³ 
                'rgba(139, 195, 74, 0.8)',   // ë¼ì´íŠ¸ê·¸ë¦°
                'rgba(255, 193, 7, 0.8)'     // ì•°ë²„
            ];

            const metricLabels = {
                'roas': 'ROAS (%)',
                'cost': 'ë¹„ìš© (ì›)',
                'revenue': 'ì „í™˜ê°’ (ì›)',
                'conversions': 'ì „í™˜ìˆ˜',
                'impressions': 'ë…¸ì¶œìˆ˜',
                'clicks': 'í´ë¦­ìˆ˜',
                'cpm': 'CPM (ì›)',
                'cpc': 'CPC (ì›)',
                'cpa': 'CPA (ì›)',
                'ctr': 'CTR (%)',
                'cvr': 'ì „í™˜ìœ¨ (%)'
            };

            // stackedData í˜•ì‹: { 'ì±„ë„A': [val1, val2, ...], 'ì±„ë„B': [val1, val2, ...] }
            const datasets = Object.entries(stackedData).map(([stackLabel, values], idx) => ({
                label: stackLabel,
                data: values,
                backgroundColor: stackColors[idx % stackColors.length],
                borderColor: stackColors[idx % stackColors.length].replace('0.8', '1'),
                borderWidth: 1
            }));

            const ctx = canvas.getContext('2d');
            return new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: dimensionLabels,
                    datasets: datasets
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: { font: { size: 11 } }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${formatMetricValue(context.raw, metric)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            stacked: true,
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: metricLabels[metric] || metric
                            }
                        },
                        y: {
                            stacked: true,
                            ticks: { font: { size: 11 } }
                        }
                    }
                }
            });
        }

        // ê´‘ê³ ì„¸íŠ¸ ìƒì„¸ í•„í„° ì´ˆê¸°í™”
        function initDetailAdsetDropdowns() {
            if (!adsetDimensionData) return;

            const filterMap = {
                'channel': 'ìœ í˜•êµ¬ë¶„',
                'product': 'ìƒí’ˆëª…',
                'brand': 'ë¸Œëœë“œëª…',
                'promotion': 'í”„ë¡œëª¨ì…˜'
            };

            Object.keys(filterMap).forEach(filterKey => {
                const column = filterMap[filterKey];
                const uniqueValues = [...new Set(adsetDimensionData.map(row => row[column]).filter(v => v && v !== '' && v !== '-'))];
                uniqueValues.sort();

                const listId = `detailFilter${filterKey.charAt(0).toUpperCase() + filterKey.slice(1)}List`;
                const listContainer = document.getElementById(listId);
                if (!listContainer) return;

                listContainer.innerHTML = uniqueValues.map(value => `
                    <label style="display: flex; align-items: center; padding: 6px 10px; cursor: pointer; font-size: 12px; border-radius: 4px; transition: background 0.2s;">
                        <input type="checkbox" class="detail-filter-checkbox" data-filter="${filterKey}" data-value="${value}" style="margin-right: 10px; width: 14px; height: 14px; cursor: pointer;">
                        ${value}
                    </label>
                `).join('');
            });

            // ë“œë¡­ë‹¤ìš´ í† ê¸€ ì´ë²¤íŠ¸
            document.querySelectorAll('.detail-filter-dropdown-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const filter = this.dataset.filter;
                    document.querySelectorAll('.detail-filter-dropdown-list').forEach(list => {
                        if (list.dataset.filter === filter) {
                            list.style.display = list.style.display === 'none' ? 'block' : 'none';
                        } else {
                            list.style.display = 'none';
                        }
                    });
                });
            });

            // ì²´í¬ë°•ìŠ¤ ë³€ê²½ ì´ë²¤íŠ¸
            document.querySelectorAll('.detail-filter-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const filter = this.dataset.filter;
                    const value = this.dataset.value;
                    if (this.checked) {
                        if (!detailAdsetFilters[filter].includes(value)) {
                            detailAdsetFilters[filter].push(value);
                        }
                    } else {
                        detailAdsetFilters[filter] = detailAdsetFilters[filter].filter(v => v !== value);
                    }
                    updateDetailAdsetCount();
                    renderDetailAdsetBarChart();
                });
            });

            // ì „ì²´ ì„ íƒ ì´ë²¤íŠ¸
            document.querySelectorAll('.detail-filter-select-all').forEach(selectAll => {
                selectAll.addEventListener('change', function() {
                    const filter = this.dataset.filter;
                    const checkboxes = document.querySelectorAll(`.detail-filter-checkbox[data-filter="${filter}"]`);
                    checkboxes.forEach(cb => {
                        cb.checked = this.checked;
                        const value = cb.dataset.value;
                        if (this.checked) {
                            if (!detailAdsetFilters[filter].includes(value)) {
                                detailAdsetFilters[filter].push(value);
                            }
                        } else {
                            detailAdsetFilters[filter] = [];
                        }
                    });
                    updateDetailAdsetCount();
                    renderDetailAdsetBarChart();
                });
            });

            // ì™¸ë¶€ í´ë¦­ ì‹œ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.detail-filter-dropdown-btn') && !e.target.closest('.detail-filter-dropdown-list')) {
                    document.querySelectorAll('.detail-filter-dropdown-list').forEach(list => {
                        list.style.display = 'none';
                    });
                }
            });
        }

        function updateDetailAdsetCount() {
            if (!adsetDimensionData) return;
            const filterMap = { 'channel': 'ìœ í˜•êµ¬ë¶„', 'product': 'ìƒí’ˆëª…', 'brand': 'ë¸Œëœë“œëª…', 'promotion': 'í”„ë¡œëª¨ì…˜' };
            const hasActiveFilters = Object.values(detailAdsetFilters).some(arr => arr.length > 0);

            const matchedAdsets = new Set();
            adsetDimensionData.forEach(row => {
                const adset = row['ê´‘ê³ ì„¸íŠ¸'];
                if (!adset || adset === '' || adset === '-') return;
                let matches = true;
                Object.keys(filterMap).forEach(filterKey => {
                    const column = filterMap[filterKey];
                    const selectedValues = detailAdsetFilters[filterKey];
                    if (selectedValues && selectedValues.length > 0) {
                        if (!selectedValues.includes(row[column])) {
                            matches = false;
                        }
                    }
                });
                if (matches && hasActiveFilters) matchedAdsets.add(adset);
            });

            const countEl = document.getElementById('detailFilteredAdsetCount');
            if (countEl) countEl.textContent = matchedAdsets.size;
        }

        // ê´‘ê³ ì„¸íŠ¸ ìƒì„¸ Bar ì°¨íŠ¸ ë Œë”ë§
        function renderDetailAdsetBarChart() {
            if (!adsetDimensionData) {
                detailAdsetBarChart = renderDetailBarChart('detailAdsetBarChart', detailAdsetBarChart, [], [], detailAdsetMetric, 'ë°ì´í„°ë¥¼ ë¡œë“œ ì¤‘...');
                return;
            }

            const filterMap = { 'channel': 'ìœ í˜•êµ¬ë¶„', 'product': 'ìƒí’ˆëª…', 'brand': 'ë¸Œëœë“œëª…', 'promotion': 'í”„ë¡œëª¨ì…˜' };
            const hasActiveFilters = Object.values(detailAdsetFilters).some(arr => arr.length > 0);

            // í™œì„±í™”ëœ í•„í„° ì°¾ê¸°
            let activeFilterKey = null;
            let activeFilterValues = [];
            for (const [key, values] of Object.entries(detailAdsetFilters)) {
                if (values && values.length > 0) {
                    activeFilterKey = key;
                    activeFilterValues = values;
                    break;
                }
            }

            if (hasActiveFilters && activeFilterKey) {
                // ìŠ¤íƒ ë°” ì°¨íŠ¸: í•„í„° ë¶„ë¥˜ ê¸°ì¤€ë³„ë¡œ ê·¸ë£¹í™”
                const stackedDataMap = {}; // { adset: { stackValue: {metrics} } }

                adsetDimensionData.forEach(row => {
                    const adset = row['ê´‘ê³ ì„¸íŠ¸'];
                    if (!adset || adset === '' || adset === '-') return;

                    // í•„í„° ë§¤ì¹­ í™•ì¸
                    let matches = true;
                    Object.keys(filterMap).forEach(filterKey => {
                        const column = filterMap[filterKey];
                        const selectedValues = detailAdsetFilters[filterKey];
                        if (selectedValues && selectedValues.length > 0) {
                            if (!selectedValues.includes(row[column])) matches = false;
                        }
                    });
                    if (!matches) return;

                    const date = row['ì¼'];
                    if (detailAdsetStartDate || detailAdsetEndDate) {
                        const rowDate = new Date(date);
                        if (isNaN(rowDate)) return;
                        if (detailAdsetStartDate && rowDate < new Date(detailAdsetStartDate)) return;
                        if (detailAdsetEndDate && rowDate > new Date(detailAdsetEndDate)) return;
                    }

                    const stackValue = row[filterMap[activeFilterKey]] || 'ê¸°íƒ€';

                    if (!stackedDataMap[adset]) {
                        stackedDataMap[adset] = {};
                    }
                    if (!stackedDataMap[adset][stackValue]) {
                        stackedDataMap[adset][stackValue] = { cost: 0, revenue: 0, conversions: 0, impressions: 0, clicks: 0 };
                    }

                    stackedDataMap[adset][stackValue].cost += parseFloat(row['ë¹„ìš©']?.toString().replace(/,/g, '') || 0) || 0;
                    stackedDataMap[adset][stackValue].revenue += parseFloat(row['ì „í™˜ê°’']?.toString().replace(/,/g, '') || 0) || 0;
                    stackedDataMap[adset][stackValue].conversions += parseFloat(row['ì „í™˜ìˆ˜']?.toString().replace(/,/g, '') || 0) || 0;
                    stackedDataMap[adset][stackValue].impressions += parseFloat(row['ë…¸ì¶œ']?.toString().replace(/,/g, '') || 0) || 0;
                    stackedDataMap[adset][stackValue].clicks += parseFloat(row['í´ë¦­']?.toString().replace(/,/g, '') || 0) || 0;
                });

                // ê´‘ê³ ì„¸íŠ¸ í•©ê³„ë¡œ ì •ë ¬
                const adsetTotals = {};
                Object.entries(stackedDataMap).forEach(([adset, stacks]) => {
                    let total = 0;
                    Object.values(stacks).forEach(data => {
                        total += calculateMetricValue(data, detailAdsetMetric);
                    });
                    adsetTotals[adset] = total;
                });
                const sortedAdsets = Object.keys(adsetTotals).sort((a, b) => adsetTotals[b] - adsetTotals[a]).slice(0, 15);

                // ëª¨ë“  ìŠ¤íƒ ê°’ ìˆ˜ì§‘
                const allStackValues = new Set();
                Object.values(stackedDataMap).forEach(stacks => {
                    Object.keys(stacks).forEach(sv => allStackValues.add(sv));
                });
                const stackValuesList = Array.from(allStackValues);

                // ìŠ¤íƒ ë°ì´í„° êµ¬ì¡° ë³€í™˜
                const stackedData = {};
                stackValuesList.forEach(sv => {
                    stackedData[sv] = sortedAdsets.map(adset => {
                        if (stackedDataMap[adset] && stackedDataMap[adset][sv]) {
                            return calculateMetricValue(stackedDataMap[adset][sv], detailAdsetMetric);
                        }
                        return 0;
                    });
                });

                detailAdsetBarChart = renderDetailStackedBarChart('detailAdsetBarChart', detailAdsetBarChart, sortedAdsets, stackedData, detailAdsetMetric);
            } else {
                // í•„í„° ì—†ì„ ë•Œ: ì´ˆê¸°í™” ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ
                detailAdsetBarChart = renderDetailBarChart('detailAdsetBarChart', detailAdsetBarChart, [], [], detailAdsetMetric, 'í•„í„°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”');
            }
        }

        // ì„±ë³„ ìƒì„¸ í•„í„° ì´ˆê¸°í™” ë° ì°¨íŠ¸ ë Œë”ë§
        function initDetailGenderDropdowns() {
            if (!genderDimensionData) return;

            const filterMap = { 'channel': 'ìœ í˜•êµ¬ë¶„', 'product': 'ìƒí’ˆëª…', 'brand': 'ë¸Œëœë“œëª…', 'promotion': 'í”„ë¡œëª¨ì…˜', 'adset': 'ê´‘ê³ ì„¸íŠ¸' };

            Object.keys(filterMap).forEach(filterKey => {
                const column = filterMap[filterKey];
                const uniqueValues = [...new Set(genderDimensionData.map(row => row[column]).filter(v => v && v !== '' && v !== '-'))];
                uniqueValues.sort();

                const listId = `detailGenderFilter${filterKey.charAt(0).toUpperCase() + filterKey.slice(1)}List`;
                const listContainer = document.getElementById(listId);
                if (!listContainer) return;

                listContainer.innerHTML = uniqueValues.map(value => `
                    <label style="display: flex; align-items: center; padding: 6px 10px; cursor: pointer; font-size: 12px;">
                        <input type="checkbox" class="detail-gender-filter-checkbox" data-filter="${filterKey}" data-value="${value}" style="margin-right: 10px; width: 14px; height: 14px;">
                        ${value}
                    </label>
                `).join('');
            });

            document.querySelectorAll('.detail-gender-filter-dropdown-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const filter = this.dataset.filter;
                    document.querySelectorAll('.detail-gender-filter-dropdown-list').forEach(list => {
                        list.style.display = list.dataset.filter === filter ? (list.style.display === 'none' ? 'block' : 'none') : 'none';
                    });
                });
            });

            document.querySelectorAll('.detail-gender-filter-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const filter = this.dataset.filter;
                    const value = this.dataset.value;
                    if (this.checked) {
                        if (!detailGenderFilters[filter].includes(value)) detailGenderFilters[filter].push(value);
                    } else {
                        detailGenderFilters[filter] = detailGenderFilters[filter].filter(v => v !== value);
                    }
                    renderDetailGenderBarChart();
                });
            });

            document.querySelectorAll('.detail-gender-filter-select-all').forEach(selectAll => {
                selectAll.addEventListener('change', function() {
                    const filter = this.dataset.filter;
                    document.querySelectorAll(`.detail-gender-filter-checkbox[data-filter="${filter}"]`).forEach(cb => {
                        cb.checked = this.checked;
                        const value = cb.dataset.value;
                        if (this.checked) {
                            if (!detailGenderFilters[filter].includes(value)) detailGenderFilters[filter].push(value);
                        }
                    });
                    if (!this.checked) detailGenderFilters[filter] = [];
                    renderDetailGenderBarChart();
                });
            });
        }

        function renderDetailGenderBarChart() {
            if (!genderDimensionData) {
                detailGenderBarChart = renderDetailBarChart('detailGenderBarChart', detailGenderBarChart, [], [], detailGenderMetric, 'ë°ì´í„° ë¡œë”© ì¤‘...');
                return;
            }

            const filterMap = { 'channel': 'ìœ í˜•êµ¬ë¶„', 'product': 'ìƒí’ˆëª…', 'brand': 'ë¸Œëœë“œëª…', 'promotion': 'í”„ë¡œëª¨ì…˜', 'adset': 'ê´‘ê³ ì„¸íŠ¸' };
            const hasActiveFilters = Object.values(detailGenderFilters).some(arr => arr.length > 0);

            // ì–´ë–¤ í•„í„°ê°€ í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
            let activeFilterKey = null;
            let activeFilterColumn = null;
            Object.keys(filterMap).forEach(filterKey => {
                if (detailGenderFilters[filterKey] && detailGenderFilters[filterKey].length > 0) {
                    activeFilterKey = filterKey;
                    activeFilterColumn = filterMap[filterKey];
                }
            });

            // ì„±ë³„_í†µí•© ì»¬ëŸ¼ ì‚¬ìš©
            const genderColumn = 'ì„±ë³„_í†µí•©';

            if (hasActiveFilters && activeFilterKey) {
                // ëˆ„ì  ë°” ì°¨íŠ¸: ì„±ë³„ë³„ë¡œ ë¶„ë¥˜ê¸°ì¤€ë³„ ë°ì´í„° ì§‘ê³„
                const genderStackData = {};  // { 'ë‚¨ì„±': { 'ì±„ë„A': {}, 'ì±„ë„B': {} }, ... }

                genderDimensionData.forEach(row => {
                    const rawGender = row[genderColumn] || row['ì„±ë³„'];
                    if (!rawGender || rawGender === '' || rawGender === '-' || rawGender === 'unknown') return;

                    const stackValue = row[activeFilterColumn];
                    if (!stackValue || stackValue === '' || stackValue === '-') return;
                    if (!detailGenderFilters[activeFilterKey].includes(stackValue)) return;

                    // ê¸°ê°„ í•„í„°ë§
                    const date = row['ì¼'];
                    if (detailGenderStartDate || detailGenderEndDate) {
                        const rowDate = new Date(date);
                        if (isNaN(rowDate)) return;
                        if (detailGenderStartDate && rowDate < new Date(detailGenderStartDate)) return;
                        if (detailGenderEndDate && rowDate > new Date(detailGenderEndDate)) return;
                    }

                    if (!genderStackData[rawGender]) genderStackData[rawGender] = {};
                    if (!genderStackData[rawGender][stackValue]) {
                        genderStackData[rawGender][stackValue] = { cost: 0, revenue: 0, conversions: 0, impressions: 0, clicks: 0 };
                    }

                    genderStackData[rawGender][stackValue].cost += parseFloat(row['ë¹„ìš©']?.toString().replace(/,/g, '') || 0) || 0;
                    genderStackData[rawGender][stackValue].revenue += parseFloat(row['ì „í™˜ê°’']?.toString().replace(/,/g, '') || 0) || 0;
                    genderStackData[rawGender][stackValue].conversions += parseFloat(row['ì „í™˜ìˆ˜']?.toString().replace(/,/g, '') || 0) || 0;
                    genderStackData[rawGender][stackValue].impressions += parseFloat(row['ë…¸ì¶œ']?.toString().replace(/,/g, '') || 0) || 0;
                    genderStackData[rawGender][stackValue].clicks += parseFloat(row['í´ë¦­']?.toString().replace(/,/g, '') || 0) || 0;
                });

                // ëˆ„ì  ë°” ì°¨íŠ¸ ë°ì´í„° êµ¬ì„±
                const genderLabels = Object.keys(genderStackData).sort();
                const stackLabels = detailGenderFilters[activeFilterKey];
                const stackedData = {};

                stackLabels.forEach(stackLabel => {
                    stackedData[stackLabel] = genderLabels.map(gender => {
                        const data = genderStackData[gender]?.[stackLabel];
                        return data ? calculateMetricValue(data, detailGenderMetric) : 0;
                    });
                });

                detailGenderBarChart = renderDetailStackedBarChart('detailGenderBarChart', detailGenderBarChart, genderLabels, stackedData, detailGenderMetric);
            } else {
                // í•„í„° ì—†ì„ ë•Œ: ì´ˆê¸°í™” ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ
                detailGenderBarChart = renderDetailBarChart('detailGenderBarChart', detailGenderBarChart, [], [], detailGenderMetric, 'í•„í„°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”');
            }
        }

        // ì—°ë ¹ ìƒì„¸ í•„í„° ì´ˆê¸°í™” ë° ì°¨íŠ¸ ë Œë”ë§
        function initDetailAgeDropdowns() {
            if (!ageDimensionData) return;

            const filterMap = { 'channel': 'ìœ í˜•êµ¬ë¶„', 'product': 'ìƒí’ˆëª…', 'brand': 'ë¸Œëœë“œëª…', 'promotion': 'í”„ë¡œëª¨ì…˜', 'adset': 'ê´‘ê³ ì„¸íŠ¸' };

            Object.keys(filterMap).forEach(filterKey => {
                const column = filterMap[filterKey];
                const uniqueValues = [...new Set(ageDimensionData.map(row => row[column]).filter(v => v && v !== '' && v !== '-'))];
                uniqueValues.sort();

                const listId = `detailAgeFilter${filterKey.charAt(0).toUpperCase() + filterKey.slice(1)}List`;
                const listContainer = document.getElementById(listId);
                if (!listContainer) return;

                listContainer.innerHTML = uniqueValues.map(value => `
                    <label style="display: flex; align-items: center; padding: 6px 10px; cursor: pointer; font-size: 12px;">
                        <input type="checkbox" class="detail-age-filter-checkbox" data-filter="${filterKey}" data-value="${value}" style="margin-right: 10px; width: 14px; height: 14px;">
                        ${value}
                    </label>
                `).join('');
            });

            document.querySelectorAll('.detail-age-filter-dropdown-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const filter = this.dataset.filter;
                    document.querySelectorAll('.detail-age-filter-dropdown-list').forEach(list => {
                        list.style.display = list.dataset.filter === filter ? (list.style.display === 'none' ? 'block' : 'none') : 'none';
                    });
                });
            });

            document.querySelectorAll('.detail-age-filter-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const filter = this.dataset.filter;
                    const value = this.dataset.value;
                    if (this.checked) {
                        if (!detailAgeFilters[filter].includes(value)) detailAgeFilters[filter].push(value);
                    } else {
                        detailAgeFilters[filter] = detailAgeFilters[filter].filter(v => v !== value);
                    }
                    renderDetailAgeBarChart();
                });
            });

            document.querySelectorAll('.detail-age-filter-select-all').forEach(selectAll => {
                selectAll.addEventListener('change', function() {
                    const filter = this.dataset.filter;
                    document.querySelectorAll(`.detail-age-filter-checkbox[data-filter="${filter}"]`).forEach(cb => {
                        cb.checked = this.checked;
                        const value = cb.dataset.value;
                        if (this.checked) {
                            if (!detailAgeFilters[filter].includes(value)) detailAgeFilters[filter].push(value);
                        }
                    });
                    if (!this.checked) detailAgeFilters[filter] = [];
                    renderDetailAgeBarChart();
                });
            });
        }

        function renderDetailAgeBarChart() {
            if (!ageDimensionData) {
                detailAgeBarChart = renderDetailBarChart('detailAgeBarChart', detailAgeBarChart, [], [], detailAgeMetric, 'ë°ì´í„° ë¡œë”© ì¤‘...');
                return;
            }

            const filterMap = { 'channel': 'ìœ í˜•êµ¬ë¶„', 'product': 'ìƒí’ˆëª…', 'brand': 'ë¸Œëœë“œëª…', 'promotion': 'í”„ë¡œëª¨ì…˜', 'adset': 'ê´‘ê³ ì„¸íŠ¸' };
            const hasActiveFilters = Object.values(detailAgeFilters).some(arr => arr.length > 0);

            // ì–´ë–¤ í•„í„°ê°€ í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
            let activeFilterKey = null;
            let activeFilterColumn = null;
            Object.keys(filterMap).forEach(filterKey => {
                if (detailAgeFilters[filterKey] && detailAgeFilters[filterKey].length > 0) {
                    activeFilterKey = filterKey;
                    activeFilterColumn = filterMap[filterKey];
                }
            });

            // ì—°ë ¹_í†µí•© ì»¬ëŸ¼ ì‚¬ìš©
            const ageColumn = 'ì—°ë ¹_í†µí•©';

            if (hasActiveFilters && activeFilterKey) {
                // ëˆ„ì  ë°” ì°¨íŠ¸: ì—°ë ¹ë³„ë¡œ ë¶„ë¥˜ê¸°ì¤€ë³„ ë°ì´í„° ì§‘ê³„
                const ageStackData = {};

                ageDimensionData.forEach(row => {
                    const rawAge = row[ageColumn] || row['ì—°ë ¹'];
                    if (!rawAge || rawAge === '' || rawAge === '-' || rawAge === 'unknown') return;

                    const stackValue = row[activeFilterColumn];
                    if (!stackValue || stackValue === '' || stackValue === '-') return;
                    if (!detailAgeFilters[activeFilterKey].includes(stackValue)) return;

                    // ê¸°ê°„ í•„í„°ë§
                    const date = row['ì¼'];
                    if (detailAgeStartDate || detailAgeEndDate) {
                        const rowDate = new Date(date);
                        if (isNaN(rowDate)) return;
                        if (detailAgeStartDate && rowDate < new Date(detailAgeStartDate)) return;
                        if (detailAgeEndDate && rowDate > new Date(detailAgeEndDate)) return;
                    }

                    if (!ageStackData[rawAge]) ageStackData[rawAge] = {};
                    if (!ageStackData[rawAge][stackValue]) {
                        ageStackData[rawAge][stackValue] = { cost: 0, revenue: 0, conversions: 0, impressions: 0, clicks: 0 };
                    }

                    ageStackData[rawAge][stackValue].cost += parseFloat(row['ë¹„ìš©']?.toString().replace(/,/g, '') || 0) || 0;
                    ageStackData[rawAge][stackValue].revenue += parseFloat(row['ì „í™˜ê°’']?.toString().replace(/,/g, '') || 0) || 0;
                    ageStackData[rawAge][stackValue].conversions += parseFloat(row['ì „í™˜ìˆ˜']?.toString().replace(/,/g, '') || 0) || 0;
                    ageStackData[rawAge][stackValue].impressions += parseFloat(row['ë…¸ì¶œ']?.toString().replace(/,/g, '') || 0) || 0;
                    ageStackData[rawAge][stackValue].clicks += parseFloat(row['í´ë¦­']?.toString().replace(/,/g, '') || 0) || 0;
                });

                // ëˆ„ì  ë°” ì°¨íŠ¸ ë°ì´í„° êµ¬ì„±
                const ageLabels = Object.keys(ageStackData).sort();
                const stackLabels = detailAgeFilters[activeFilterKey];
                const stackedData = {};

                stackLabels.forEach(stackLabel => {
                    stackedData[stackLabel] = ageLabels.map(age => {
                        const data = ageStackData[age]?.[stackLabel];
                        return data ? calculateMetricValue(data, detailAgeMetric) : 0;
                    });
                });

                detailAgeBarChart = renderDetailStackedBarChart('detailAgeBarChart', detailAgeBarChart, ageLabels, stackedData, detailAgeMetric);
            } else {
                // í•„í„° ì—†ì„ ë•Œ: ì´ˆê¸°í™” ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ
                detailAgeBarChart = renderDetailBarChart('detailAgeBarChart', detailAgeBarChart, [], [], detailAgeMetric, 'í•„í„°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”');
            }
        }

        // í”Œë«í¼ ìƒì„¸ í•„í„° ì´ˆê¸°í™” ë° ì°¨íŠ¸ ë Œë”ë§
        function initDetailPlatformDropdowns() {
            if (!platformDimensionData) return;

            const filterMap = { 'channel': 'ìœ í˜•êµ¬ë¶„', 'product': 'ìƒí’ˆëª…', 'brand': 'ë¸Œëœë“œëª…', 'promotion': 'í”„ë¡œëª¨ì…˜', 'adset': 'ê´‘ê³ ì„¸íŠ¸' };

            Object.keys(filterMap).forEach(filterKey => {
                const column = filterMap[filterKey];
                const uniqueValues = [...new Set(platformDimensionData.map(row => row[column]).filter(v => v && v !== '' && v !== '-'))];
                uniqueValues.sort();

                const listId = `detailPlatformFilter${filterKey.charAt(0).toUpperCase() + filterKey.slice(1)}List`;
                const listContainer = document.getElementById(listId);
                if (!listContainer) return;

                listContainer.innerHTML = uniqueValues.map(value => `
                    <label style="display: flex; align-items: center; padding: 6px 10px; cursor: pointer; font-size: 12px;">
                        <input type="checkbox" class="detail-platform-filter-checkbox" data-filter="${filterKey}" data-value="${value}" style="margin-right: 10px; width: 14px; height: 14px;">
                        ${value}
                    </label>
                `).join('');
            });

            document.querySelectorAll('.detail-platform-filter-dropdown-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const filter = this.dataset.filter;
                    document.querySelectorAll('.detail-platform-filter-dropdown-list').forEach(list => {
                        list.style.display = list.dataset.filter === filter ? (list.style.display === 'none' ? 'block' : 'none') : 'none';
                    });
                });
            });

            document.querySelectorAll('.detail-platform-filter-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const filter = this.dataset.filter;
                    const value = this.dataset.value;
                    if (this.checked) {
                        if (!detailPlatformFilters[filter].includes(value)) detailPlatformFilters[filter].push(value);
                    } else {
                        detailPlatformFilters[filter] = detailPlatformFilters[filter].filter(v => v !== value);
                    }
                    renderDetailPlatformBarChart();
                });
            });

            document.querySelectorAll('.detail-platform-filter-select-all').forEach(selectAll => {
                selectAll.addEventListener('change', function() {
                    const filter = this.dataset.filter;
                    document.querySelectorAll(`.detail-platform-filter-checkbox[data-filter="${filter}"]`).forEach(cb => {
                        cb.checked = this.checked;
                        const value = cb.dataset.value;
                        if (this.checked) {
                            if (!detailPlatformFilters[filter].includes(value)) detailPlatformFilters[filter].push(value);
                        }
                    });
                    if (!this.checked) detailPlatformFilters[filter] = [];
                    renderDetailPlatformBarChart();
                });
            });
        }

        function renderDetailPlatformBarChart() {
            if (!platformDimensionData) {
                detailPlatformBarChart = renderDetailBarChart('detailPlatformBarChart', detailPlatformBarChart, [], [], detailPlatformMetric, 'ë°ì´í„° ë¡œë”© ì¤‘...');
                return;
            }

            const filterMap = { 'channel': 'ìœ í˜•êµ¬ë¶„', 'product': 'ìƒí’ˆëª…', 'brand': 'ë¸Œëœë“œëª…', 'promotion': 'í”„ë¡œëª¨ì…˜', 'adset': 'ê´‘ê³ ì„¸íŠ¸' };
            const hasActiveFilters = Object.values(detailPlatformFilters).some(arr => arr.length > 0);

            // ì–´ë–¤ í•„í„°ê°€ í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
            let activeFilterKey = null;
            let activeFilterColumn = null;
            Object.keys(filterMap).forEach(filterKey => {
                if (detailPlatformFilters[filterKey] && detailPlatformFilters[filterKey].length > 0) {
                    activeFilterKey = filterKey;
                    activeFilterColumn = filterMap[filterKey];
                }
            });

            // í”Œë«í¼_í†µí•© ì»¬ëŸ¼ ì‚¬ìš©
            const platformColumn = 'í”Œë«í¼_í†µí•©';

            if (hasActiveFilters && activeFilterKey) {
                // ëˆ„ì  ë°” ì°¨íŠ¸
                const platformStackData = {};

                platformDimensionData.forEach(row => {
                    const rawPlatform = row[platformColumn] || row['í”Œë«í¼'];
                    if (!rawPlatform || rawPlatform === '' || rawPlatform === '-' || rawPlatform === 'unknown') return;

                    const stackValue = row[activeFilterColumn];
                    if (!stackValue || stackValue === '' || stackValue === '-') return;
                    if (!detailPlatformFilters[activeFilterKey].includes(stackValue)) return;

                    const date = row['ì¼'];
                    if (detailPlatformStartDate || detailPlatformEndDate) {
                        const rowDate = new Date(date);
                        if (isNaN(rowDate)) return;
                        if (detailPlatformStartDate && rowDate < new Date(detailPlatformStartDate)) return;
                        if (detailPlatformEndDate && rowDate > new Date(detailPlatformEndDate)) return;
                    }

                    if (!platformStackData[rawPlatform]) platformStackData[rawPlatform] = {};
                    if (!platformStackData[rawPlatform][stackValue]) {
                        platformStackData[rawPlatform][stackValue] = { cost: 0, revenue: 0, conversions: 0, impressions: 0, clicks: 0 };
                    }

                    platformStackData[rawPlatform][stackValue].cost += parseFloat(row['ë¹„ìš©']?.toString().replace(/,/g, '') || 0) || 0;
                    platformStackData[rawPlatform][stackValue].revenue += parseFloat(row['ì „í™˜ê°’']?.toString().replace(/,/g, '') || 0) || 0;
                    platformStackData[rawPlatform][stackValue].conversions += parseFloat(row['ì „í™˜ìˆ˜']?.toString().replace(/,/g, '') || 0) || 0;
                    platformStackData[rawPlatform][stackValue].impressions += parseFloat(row['ë…¸ì¶œ']?.toString().replace(/,/g, '') || 0) || 0;
                    platformStackData[rawPlatform][stackValue].clicks += parseFloat(row['í´ë¦­']?.toString().replace(/,/g, '') || 0) || 0;
                });

                const platformLabels = Object.keys(platformStackData).sort();
                const stackLabels = detailPlatformFilters[activeFilterKey];
                const stackedData = {};

                stackLabels.forEach(stackLabel => {
                    stackedData[stackLabel] = platformLabels.map(platform => {
                        const data = platformStackData[platform]?.[stackLabel];
                        return data ? calculateMetricValue(data, detailPlatformMetric) : 0;
                    });
                });

                detailPlatformBarChart = renderDetailStackedBarChart('detailPlatformBarChart', detailPlatformBarChart, platformLabels, stackedData, detailPlatformMetric);
            } else {
                // í•„í„° ì—†ì„ ë•Œ: ì´ˆê¸°í™” ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ
                detailPlatformBarChart = renderDetailBarChart('detailPlatformBarChart', detailPlatformBarChart, [], [], detailPlatformMetric, 'í•„í„°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”');
            }
        }

        // ê¸°ê¸°í”Œë«í¼ ìƒì„¸ í•„í„° ì´ˆê¸°í™” ë° ì°¨íŠ¸ ë Œë”ë§
        function initDetailDevicePlatformDropdowns() {
            if (!devicePlatformDimensionData) return;

            const filterMap = { 'channel': 'ìœ í˜•êµ¬ë¶„', 'product': 'ìƒí’ˆëª…', 'brand': 'ë¸Œëœë“œëª…', 'promotion': 'í”„ë¡œëª¨ì…˜', 'adset': 'ê´‘ê³ ì„¸íŠ¸' };

            Object.keys(filterMap).forEach(filterKey => {
                const column = filterMap[filterKey];
                const uniqueValues = [...new Set(devicePlatformDimensionData.map(row => row[column]).filter(v => v && v !== '' && v !== '-'))];
                uniqueValues.sort();

                const listId = `detailDevicePlatformFilter${filterKey.charAt(0).toUpperCase() + filterKey.slice(1)}List`;
                const listContainer = document.getElementById(listId);
                if (!listContainer) return;

                listContainer.innerHTML = uniqueValues.map(value => `
                    <label style="display: flex; align-items: center; padding: 6px 10px; cursor: pointer; font-size: 12px;">
                        <input type="checkbox" class="detail-device-platform-filter-checkbox" data-filter="${filterKey}" data-value="${value}" style="margin-right: 10px; width: 14px; height: 14px;">
                        ${value}
                    </label>
                `).join('');
            });

            document.querySelectorAll('.detail-device-platform-filter-dropdown-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const filter = this.dataset.filter;
                    document.querySelectorAll('.detail-device-platform-filter-dropdown-list').forEach(list => {
                        list.style.display = list.dataset.filter === filter ? (list.style.display === 'none' ? 'block' : 'none') : 'none';
                    });
                });
            });

            document.querySelectorAll('.detail-device-platform-filter-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const filter = this.dataset.filter;
                    const value = this.dataset.value;
                    if (this.checked) {
                        if (!detailDevicePlatformFilters[filter].includes(value)) detailDevicePlatformFilters[filter].push(value);
                    } else {
                        detailDevicePlatformFilters[filter] = detailDevicePlatformFilters[filter].filter(v => v !== value);
                    }
                    renderDetailDevicePlatformBarChart();
                });
            });

            document.querySelectorAll('.detail-device-platform-filter-select-all').forEach(selectAll => {
                selectAll.addEventListener('change', function() {
                    const filter = this.dataset.filter;
                    document.querySelectorAll(`.detail-device-platform-filter-checkbox[data-filter="${filter}"]`).forEach(cb => {
                        cb.checked = this.checked;
                        const value = cb.dataset.value;
                        if (this.checked) {
                            if (!detailDevicePlatformFilters[filter].includes(value)) detailDevicePlatformFilters[filter].push(value);
                        }
                    });
                    if (!this.checked) detailDevicePlatformFilters[filter] = [];
                    renderDetailDevicePlatformBarChart();
                });
            });
        }

        function renderDetailDevicePlatformBarChart() {
            if (!devicePlatformDimensionData) {
                detailDevicePlatformBarChart = renderDetailBarChart('detailDevicePlatformBarChart', detailDevicePlatformBarChart, [], [], detailDevicePlatformMetric, 'ë°ì´í„°ë¥¼ ë¡œë“œ ì¤‘...');
                return;
            }

            const filterMap = { 'channel': 'ìœ í˜•êµ¬ë¶„', 'product': 'ìƒí’ˆëª…', 'brand': 'ë¸Œëœë“œëª…', 'promotion': 'í”„ë¡œëª¨ì…˜', 'adset': 'ê´‘ê³ ì„¸íŠ¸' };
            const hasActiveFilters = Object.values(detailDevicePlatformFilters).some(arr => arr.length > 0);

            // í™œì„±í™”ëœ í•„í„° ì°¾ê¸°
            let activeFilterKey = null;
            let activeFilterValues = [];
            for (const [key, values] of Object.entries(detailDevicePlatformFilters)) {
                if (values && values.length > 0) {
                    activeFilterKey = key;
                    activeFilterValues = values;
                    break;
                }
            }

            // ê¸°ê¸°í”Œë«í¼_í†µí•© ì»¬ëŸ¼ ì‚¬ìš©
            const devicePlatformColumn = 'ê¸°ê¸°í”Œë«í¼_í†µí•©';

            if (hasActiveFilters && activeFilterKey) {
                // ìŠ¤íƒ ë°” ì°¨íŠ¸: í•„í„° ë¶„ë¥˜ ê¸°ì¤€ë³„ë¡œ ê·¸ë£¹í™”
                const stackedDataMap = {}; // { devicePlatform: { stackValue: {metrics} } }

                devicePlatformDimensionData.forEach(row => {
                    const rawDevicePlatform = row[devicePlatformColumn] || row['ê¸°ê¸°í”Œë«í¼'];
                    if (!rawDevicePlatform || rawDevicePlatform === '' || rawDevicePlatform === '-') return;

                    // í•„í„° ë§¤ì¹­ í™•ì¸
                    let matches = true;
                    Object.keys(filterMap).forEach(filterKey => {
                        const column = filterMap[filterKey];
                        const selectedValues = detailDevicePlatformFilters[filterKey];
                        if (selectedValues && selectedValues.length > 0) {
                            if (!selectedValues.includes(row[column])) matches = false;
                        }
                    });
                    if (!matches) return;

                    const date = row['ì¼'];
                    if (detailDevicePlatformStartDate || detailDevicePlatformEndDate) {
                        const rowDate = new Date(date);
                        if (isNaN(rowDate)) return;
                        if (detailDevicePlatformStartDate && rowDate < new Date(detailDevicePlatformStartDate)) return;
                        if (detailDevicePlatformEndDate && rowDate > new Date(detailDevicePlatformEndDate)) return;
                    }

                    const stackValue = row[filterMap[activeFilterKey]] || 'ê¸°íƒ€';

                    if (!stackedDataMap[rawDevicePlatform]) {
                        stackedDataMap[rawDevicePlatform] = {};
                    }
                    if (!stackedDataMap[rawDevicePlatform][stackValue]) {
                        stackedDataMap[rawDevicePlatform][stackValue] = { cost: 0, revenue: 0, conversions: 0, impressions: 0, clicks: 0 };
                    }

                    stackedDataMap[rawDevicePlatform][stackValue].cost += parseFloat(row['ë¹„ìš©']?.toString().replace(/,/g, '') || 0) || 0;
                    stackedDataMap[rawDevicePlatform][stackValue].revenue += parseFloat(row['ì „í™˜ê°’']?.toString().replace(/,/g, '') || 0) || 0;
                    stackedDataMap[rawDevicePlatform][stackValue].conversions += parseFloat(row['ì „í™˜ìˆ˜']?.toString().replace(/,/g, '') || 0) || 0;
                    stackedDataMap[rawDevicePlatform][stackValue].impressions += parseFloat(row['ë…¸ì¶œ']?.toString().replace(/,/g, '') || 0) || 0;
                    stackedDataMap[rawDevicePlatform][stackValue].clicks += parseFloat(row['í´ë¦­']?.toString().replace(/,/g, '') || 0) || 0;
                });

                // ê¸°ê¸°í”Œë«í¼ í•©ê³„ë¡œ ì •ë ¬
                const devicePlatformTotals = {};
                Object.entries(stackedDataMap).forEach(([dp, stacks]) => {
                    let total = 0;
                    Object.values(stacks).forEach(data => {
                        total += calculateMetricValue(data, detailDevicePlatformMetric);
                    });
                    devicePlatformTotals[dp] = total;
                });
                const sortedDevicePlatforms = Object.keys(devicePlatformTotals).sort((a, b) => devicePlatformTotals[b] - devicePlatformTotals[a]);

                // ëª¨ë“  ìŠ¤íƒ ê°’ ìˆ˜ì§‘
                const allStackValues = new Set();
                Object.values(stackedDataMap).forEach(stacks => {
                    Object.keys(stacks).forEach(sv => allStackValues.add(sv));
                });
                const stackValuesList = Array.from(allStackValues);

                // ìŠ¤íƒ ë°ì´í„° êµ¬ì¡° ë³€í™˜
                const stackedData = {};
                stackValuesList.forEach(sv => {
                    stackedData[sv] = sortedDevicePlatforms.map(dp => {
                        if (stackedDataMap[dp] && stackedDataMap[dp][sv]) {
                            return calculateMetricValue(stackedDataMap[dp][sv], detailDevicePlatformMetric);
                        }
                        return 0;
                    });
                });

                detailDevicePlatformBarChart = renderDetailStackedBarChart('detailDevicePlatformBarChart', detailDevicePlatformBarChart, sortedDevicePlatforms, stackedData, detailDevicePlatformMetric);
            } else {
                // í•„í„° ì—†ì„ ë•Œ: ì´ˆê¸°í™” ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ
                detailDevicePlatformBarChart = renderDetailBarChart('detailDevicePlatformBarChart', detailDevicePlatformBarChart, [], [], detailDevicePlatformMetric, 'í•„í„°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”');
            }
        }

        // ê¸°ê¸° ìƒì„¸ í•„í„° ì´ˆê¸°í™” ë° ì°¨íŠ¸ ë Œë”ë§
        function initDetailDeviceTypeDropdowns() {
            if (!deviceTypeDimensionData) return;

            const filterMap = { 'channel': 'ìœ í˜•êµ¬ë¶„', 'product': 'ìƒí’ˆëª…', 'brand': 'ë¸Œëœë“œëª…', 'promotion': 'í”„ë¡œëª¨ì…˜', 'adset': 'ê´‘ê³ ì„¸íŠ¸' };

            Object.keys(filterMap).forEach(filterKey => {
                const column = filterMap[filterKey];
                const uniqueValues = [...new Set(deviceTypeDimensionData.map(row => row[column]).filter(v => v && v !== '' && v !== '-'))];
                uniqueValues.sort();

                const listId = `detailDeviceTypeFilter${filterKey.charAt(0).toUpperCase() + filterKey.slice(1)}List`;
                const listContainer = document.getElementById(listId);
                if (!listContainer) return;

                listContainer.innerHTML = uniqueValues.map(value => `
                    <label style="display: flex; align-items: center; padding: 6px 10px; cursor: pointer; font-size: 12px;">
                        <input type="checkbox" class="detail-device-type-filter-checkbox" data-filter="${filterKey}" data-value="${value}" style="margin-right: 10px; width: 14px; height: 14px;">
                        ${value}
                    </label>
                `).join('');
            });

            document.querySelectorAll('.detail-device-type-filter-dropdown-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const filter = this.dataset.filter;
                    document.querySelectorAll('.detail-device-type-filter-dropdown-list').forEach(list => {
                        list.style.display = list.dataset.filter === filter ? (list.style.display === 'none' ? 'block' : 'none') : 'none';
                    });
                });
            });

            document.querySelectorAll('.detail-device-type-filter-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const filter = this.dataset.filter;
                    const value = this.dataset.value;
                    if (this.checked) {
                        if (!detailDeviceTypeFilters[filter].includes(value)) detailDeviceTypeFilters[filter].push(value);
                    } else {
                        detailDeviceTypeFilters[filter] = detailDeviceTypeFilters[filter].filter(v => v !== value);
                    }
                    renderDetailDeviceTypeBarChart();
                });
            });

            document.querySelectorAll('.detail-device-type-filter-select-all').forEach(selectAll => {
                selectAll.addEventListener('change', function() {
                    const filter = this.dataset.filter;
                    document.querySelectorAll(`.detail-device-type-filter-checkbox[data-filter="${filter}"]`).forEach(cb => {
                        cb.checked = this.checked;
                        const value = cb.dataset.value;
                        if (this.checked) {
                            if (!detailDeviceTypeFilters[filter].includes(value)) detailDeviceTypeFilters[filter].push(value);
                        }
                    });
                    if (!this.checked) detailDeviceTypeFilters[filter] = [];
                    renderDetailDeviceTypeBarChart();
                });
            });
        }

        function renderDetailDeviceTypeBarChart() {
            if (!deviceTypeDimensionData) {
                detailDeviceTypeBarChart = renderDetailBarChart('detailDeviceTypeBarChart', detailDeviceTypeBarChart, [], [], detailDeviceTypeMetric, 'ë°ì´í„°ë¥¼ ë¡œë“œ ì¤‘...');
                return;
            }

            const filterMap = { 'channel': 'ìœ í˜•êµ¬ë¶„', 'product': 'ìƒí’ˆëª…', 'brand': 'ë¸Œëœë“œëª…', 'promotion': 'í”„ë¡œëª¨ì…˜', 'adset': 'ê´‘ê³ ì„¸íŠ¸' };
            const hasActiveFilters = Object.values(detailDeviceTypeFilters).some(arr => arr.length > 0);

            // í™œì„±í™”ëœ í•„í„° ì°¾ê¸°
            let activeFilterKey = null;
            let activeFilterValues = [];
            for (const [key, values] of Object.entries(detailDeviceTypeFilters)) {
                if (values && values.length > 0) {
                    activeFilterKey = key;
                    activeFilterValues = values;
                    break;
                }
            }

            // ê¸°ê¸°ìœ í˜•_í†µí•© ì»¬ëŸ¼ ì‚¬ìš©
            const deviceTypeColumn = 'ê¸°ê¸°ìœ í˜•_í†µí•©';

            if (hasActiveFilters && activeFilterKey) {
                // ìŠ¤íƒ ë°” ì°¨íŠ¸: í•„í„° ë¶„ë¥˜ ê¸°ì¤€ë³„ë¡œ ê·¸ë£¹í™”
                const stackedDataMap = {}; // { deviceType: { stackValue: {metrics} } }

                deviceTypeDimensionData.forEach(row => {
                    const rawDeviceType = row[deviceTypeColumn] || row['ê¸°ê¸°ìœ í˜•'];
                    if (!rawDeviceType || rawDeviceType === '' || rawDeviceType === '-') return;

                    // í•„í„° ë§¤ì¹­ í™•ì¸
                    let matches = true;
                    Object.keys(filterMap).forEach(filterKey => {
                        const column = filterMap[filterKey];
                        const selectedValues = detailDeviceTypeFilters[filterKey];
                        if (selectedValues && selectedValues.length > 0) {
                            if (!selectedValues.includes(row[column])) matches = false;
                        }
                    });
                    if (!matches) return;

                    const date = row['ì¼'];
                    if (detailDeviceTypeStartDate || detailDeviceTypeEndDate) {
                        const rowDate = new Date(date);
                        if (isNaN(rowDate)) return;
                        if (detailDeviceTypeStartDate && rowDate < new Date(detailDeviceTypeStartDate)) return;
                        if (detailDeviceTypeEndDate && rowDate > new Date(detailDeviceTypeEndDate)) return;
                    }

                    const stackValue = row[filterMap[activeFilterKey]] || 'ê¸°íƒ€';

                    if (!stackedDataMap[rawDeviceType]) {
                        stackedDataMap[rawDeviceType] = {};
                    }
                    if (!stackedDataMap[rawDeviceType][stackValue]) {
                        stackedDataMap[rawDeviceType][stackValue] = { cost: 0, revenue: 0, conversions: 0, impressions: 0, clicks: 0 };
                    }

                    stackedDataMap[rawDeviceType][stackValue].cost += parseFloat(row['ë¹„ìš©']?.toString().replace(/,/g, '') || 0) || 0;
                    stackedDataMap[rawDeviceType][stackValue].revenue += parseFloat(row['ì „í™˜ê°’']?.toString().replace(/,/g, '') || 0) || 0;
                    stackedDataMap[rawDeviceType][stackValue].conversions += parseFloat(row['ì „í™˜ìˆ˜']?.toString().replace(/,/g, '') || 0) || 0;
                    stackedDataMap[rawDeviceType][stackValue].impressions += parseFloat(row['ë…¸ì¶œ']?.toString().replace(/,/g, '') || 0) || 0;
                    stackedDataMap[rawDeviceType][stackValue].clicks += parseFloat(row['í´ë¦­']?.toString().replace(/,/g, '') || 0) || 0;
                });

                // ê¸°ê¸°ìœ í˜• í•©ê³„ë¡œ ì •ë ¬
                const deviceTypeTotals = {};
                Object.entries(stackedDataMap).forEach(([dt, stacks]) => {
                    let total = 0;
                    Object.values(stacks).forEach(data => {
                        total += calculateMetricValue(data, detailDeviceTypeMetric);
                    });
                    deviceTypeTotals[dt] = total;
                });
                const sortedDeviceTypes = Object.keys(deviceTypeTotals).sort((a, b) => deviceTypeTotals[b] - deviceTypeTotals[a]);

                // ëª¨ë“  ìŠ¤íƒ ê°’ ìˆ˜ì§‘
                const allStackValues = new Set();
                Object.values(stackedDataMap).forEach(stacks => {
                    Object.keys(stacks).forEach(sv => allStackValues.add(sv));
                });
                const stackValuesList = Array.from(allStackValues);

                // ìŠ¤íƒ ë°ì´í„° êµ¬ì¡° ë³€í™˜
                const stackedData = {};
                stackValuesList.forEach(sv => {
                    stackedData[sv] = sortedDeviceTypes.map(dt => {
                        if (stackedDataMap[dt] && stackedDataMap[dt][sv]) {
                            return calculateMetricValue(stackedDataMap[dt][sv], detailDeviceTypeMetric);
                        }
                        return 0;
                    });
                });

                detailDeviceTypeBarChart = renderDetailStackedBarChart('detailDeviceTypeBarChart', detailDeviceTypeBarChart, sortedDeviceTypes, stackedData, detailDeviceTypeMetric);
            } else {
                // í•„í„° ì—†ì„ ë•Œ: ì´ˆê¸°í™” ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ
                detailDeviceTypeBarChart = renderDetailBarChart('detailDeviceTypeBarChart', detailDeviceTypeBarChart, [], [], detailDeviceTypeMetric, 'í•„í„°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”');
            }
        }

        // ì„±ê³¼ ìƒì„¸ ë¶„ì„ íƒ­ ì „í™˜ ì´ë²¤íŠ¸ ì„¤ì •
        function setupDetailAnalysisTabEvents() {
            document.querySelectorAll('.detail-analysis-tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.detail-analysis-tab-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');

                    const targetTab = this.dataset.tab;
                    document.querySelectorAll('.detail-analysis-tab-content').forEach(content => {
                        content.style.display = 'none';
                        content.classList.remove('active');
                    });

                    const tabMap = {
                        'detail-adset': 'detailAdsetTab',
                        'detail-gender': 'detailGenderTab',
                        'detail-age': 'detailAgeTab',
                        'detail-platform': 'detailPlatformTab',
                        'detail-device-platform': 'detailDevicePlatformTab',
                        'detail-device-type': 'detailDeviceTypeTab'
                    };

                    const selectedTab = document.getElementById(tabMap[targetTab]);
                    if (selectedTab) {
                        selectedTab.style.display = 'block';
                        selectedTab.classList.add('active');
                    }
                });
            });

            // ì§€í‘œ ë“œë¡­ë‹¤ìš´ ì´ë²¤íŠ¸
            const metricDropdowns = [
                { id: 'detailAdsetMetricDropdown', varName: 'detailAdsetMetric', renderFn: renderDetailAdsetBarChart },
                { id: 'detailGenderMetricDropdown', varName: 'detailGenderMetric', renderFn: renderDetailGenderBarChart },
                { id: 'detailAgeMetricDropdown', varName: 'detailAgeMetric', renderFn: renderDetailAgeBarChart },
                { id: 'detailPlatformMetricDropdown', varName: 'detailPlatformMetric', renderFn: renderDetailPlatformBarChart },
                { id: 'detailDevicePlatformMetricDropdown', varName: 'detailDevicePlatformMetric', renderFn: renderDetailDevicePlatformBarChart },
                { id: 'detailDeviceTypeMetricDropdown', varName: 'detailDeviceTypeMetric', renderFn: renderDetailDeviceTypeBarChart }
            ];

            metricDropdowns.forEach(({ id, varName, renderFn }) => {
                const dropdown = document.getElementById(id);
                if (dropdown) {
                    dropdown.addEventListener('change', function() {
                        window[varName] = this.value;
                        if (varName === 'detailAdsetMetric') detailAdsetMetric = this.value;
                        else if (varName === 'detailGenderMetric') detailGenderMetric = this.value;
                        else if (varName === 'detailAgeMetric') detailAgeMetric = this.value;
                        else if (varName === 'detailPlatformMetric') detailPlatformMetric = this.value;
                        else if (varName === 'detailDevicePlatformMetric') detailDevicePlatformMetric = this.value;
                        else if (varName === 'detailDeviceTypeMetric') detailDeviceTypeMetric = this.value;
                        renderFn();
                    });
                }
            });

            // ë‚ ì§œ ì…ë ¥ ì´ë²¤íŠ¸
            const dateInputs = [
                { startId: 'detailAdsetStartDate', endId: 'detailAdsetEndDate', startVar: 'detailAdsetStartDate', endVar: 'detailAdsetEndDate', renderFn: renderDetailAdsetBarChart },
                { startId: 'detailGenderStartDate', endId: 'detailGenderEndDate', startVar: 'detailGenderStartDate', endVar: 'detailGenderEndDate', renderFn: renderDetailGenderBarChart },
                { startId: 'detailAgeStartDate', endId: 'detailAgeEndDate', startVar: 'detailAgeStartDate', endVar: 'detailAgeEndDate', renderFn: renderDetailAgeBarChart },
                { startId: 'detailPlatformStartDate', endId: 'detailPlatformEndDate', startVar: 'detailPlatformStartDate', endVar: 'detailPlatformEndDate', renderFn: renderDetailPlatformBarChart },
                { startId: 'detailDevicePlatformStartDate', endId: 'detailDevicePlatformEndDate', startVar: 'detailDevicePlatformStartDate', endVar: 'detailDevicePlatformEndDate', renderFn: renderDetailDevicePlatformBarChart },
                { startId: 'detailDeviceTypeStartDate', endId: 'detailDeviceTypeEndDate', startVar: 'detailDeviceTypeStartDate', endVar: 'detailDeviceTypeEndDate', renderFn: renderDetailDeviceTypeBarChart }
            ];

            dateInputs.forEach(({ startId, endId, startVar, endVar, renderFn }) => {
                const startInput = document.getElementById(startId);
                const endInput = document.getElementById(endId);
                if (startInput) {
                    startInput.addEventListener('change', function() {
                        if (startVar === 'detailAdsetStartDate') detailAdsetStartDate = this.value;
                        else if (startVar === 'detailGenderStartDate') detailGenderStartDate = this.value;
                        else if (startVar === 'detailAgeStartDate') detailAgeStartDate = this.value;
                        else if (startVar === 'detailPlatformStartDate') detailPlatformStartDate = this.value;
                        else if (startVar === 'detailDevicePlatformStartDate') detailDevicePlatformStartDate = this.value;
                        else if (startVar === 'detailDeviceTypeStartDate') detailDeviceTypeStartDate = this.value;
                        renderFn();
                    });
                }
                if (endInput) {
                    endInput.addEventListener('change', function() {
                        if (endVar === 'detailAdsetEndDate') detailAdsetEndDate = this.value;
                        else if (endVar === 'detailGenderEndDate') detailGenderEndDate = this.value;
                        else if (endVar === 'detailAgeEndDate') detailAgeEndDate = this.value;
                        else if (endVar === 'detailPlatformEndDate') detailPlatformEndDate = this.value;
                        else if (endVar === 'detailDevicePlatformEndDate') detailDevicePlatformEndDate = this.value;
                        else if (endVar === 'detailDeviceTypeEndDate') detailDeviceTypeEndDate = this.value;
                        renderFn();
                    });
                }
            });
        }

        // ì„±ê³¼ ìƒì„¸ ë¶„ì„ ì´ˆê¸°í™” í•¨ìˆ˜
        function initDetailAnalysis() {
            initDetailAdsetDropdowns();
            initDetailGenderDropdowns();
            initDetailAgeDropdowns();
            initDetailPlatformDropdowns();
            initDetailDevicePlatformDropdowns();
            initDetailDeviceTypeDropdowns();
            setupDetailAnalysisTabEvents();

            // ê¸°ë³¸ ë‚ ì§œ ì„¤ì • (ë°ì´í„°ì—ì„œ min/max ë‚ ì§œ ì¶”ì¶œ)
            setDetailAnalysisDefaultDates();

            // ì´ˆê¸° ì°¨íŠ¸ ë Œë”ë§
            renderDetailAdsetBarChart();
            renderDetailGenderBarChart();
            renderDetailAgeBarChart();
            renderDetailPlatformBarChart();
            renderDetailDevicePlatformBarChart();
            renderDetailDeviceTypeBarChart();
        }

        // ì„±ê³¼ ìƒì„¸ ë¶„ì„ ê¸°ë³¸ ë‚ ì§œ ì„¤ì •
        function setDetailAnalysisDefaultDates() {
            // ë°ì´í„°ì—ì„œ ë‚ ì§œ ë²”ìœ„ ì¶”ì¶œ (adsetDimensionData ì‚¬ìš©)
            const sourceData = adsetDimensionData || genderDimensionData || ageDimensionData || platformDimensionData || devicePlatformDimensionData || deviceTypeDimensionData;
            if (!sourceData || sourceData.length === 0) return;

            const dates = sourceData.map(row => new Date(row['ì¼'])).filter(d => !isNaN(d));
            if (dates.length === 0) return;

            const minDate = new Date(Math.min(...dates));
            const maxDate = new Date(Math.max(...dates));

            const formatDateForInput = (date) => {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            };

            const minDateStr = formatDateForInput(minDate);
            const maxDateStr = formatDateForInput(maxDate);

            // ê° íƒ­ì˜ ë‚ ì§œ ì…ë ¥ í•„ë“œ ì„¤ì •
            const dateInputs = [
                { startId: 'detailAdsetStartDate', endId: 'detailAdsetEndDate', setStart: (v) => { detailAdsetStartDate = v; }, setEnd: (v) => { detailAdsetEndDate = v; } },
                { startId: 'detailGenderStartDate', endId: 'detailGenderEndDate', setStart: (v) => { detailGenderStartDate = v; }, setEnd: (v) => { detailGenderEndDate = v; } },
                { startId: 'detailAgeStartDate', endId: 'detailAgeEndDate', setStart: (v) => { detailAgeStartDate = v; }, setEnd: (v) => { detailAgeEndDate = v; } },
                { startId: 'detailPlatformStartDate', endId: 'detailPlatformEndDate', setStart: (v) => { detailPlatformStartDate = v; }, setEnd: (v) => { detailPlatformEndDate = v; } },
                { startId: 'detailDevicePlatformStartDate', endId: 'detailDevicePlatformEndDate', setStart: (v) => { detailDevicePlatformStartDate = v; }, setEnd: (v) => { detailDevicePlatformEndDate = v; } },
                { startId: 'detailDeviceTypeStartDate', endId: 'detailDeviceTypeEndDate', setStart: (v) => { detailDeviceTypeStartDate = v; }, setEnd: (v) => { detailDeviceTypeEndDate = v; } }
            ];

            dateInputs.forEach(({ startId, endId, setStart, setEnd }) => {
                const startInput = document.getElementById(startId);
                const endInput = document.getElementById(endId);
                if (startInput) {
                    startInput.value = minDateStr;
                    setStart(minDateStr);
                }
                if (endInput) {
                    endInput.value = maxDateStr;
                    setEnd(maxDateStr);
                }
            });
        }

        window.addEventListener('DOMContentLoaded', loadData);
    </script>
</body>
</html>
